!(function(){var Yy=(Ht,re,B)=>new Promise((ne,de)=>{var y=ue=>{try{L(B.next(ue))}catch(oe){de(oe)}},ce=ue=>{try{L(B.throw(ue))}catch(oe){de(oe)}},L=ue=>ue.done?ne(ue.value):Promise.resolve(ue.value).then(y,ce);L((B=B.apply(Ht,re)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5783],{64183:function(Ht,re,B){"use strict";var ne=B(67294),de=B(15415),y=function(){return y=Object.assign||function(L){for(var ue,oe=1,Be=arguments.length;oe<Be;oe++){ue=arguments[oe];for(var se in ue)Object.prototype.hasOwnProperty.call(ue,se)&&(L[se]=ue[se])}return L},y.apply(this,arguments)},ce=function(L){return ne.createElement(de.P,y({},L,{chartType:"Area"}))};re.Z=ce},35099:function(Ht,re,B){"use strict";var ne=B(67294),de=B(15415),y=function(){return y=Object.assign||function(L){for(var ue,oe=1,Be=arguments.length;oe<Be;oe++){ue=arguments[oe];for(var se in ue)Object.prototype.hasOwnProperty.call(ue,se)&&(L[se]=ue[se])}return L},y.apply(this,arguments)},ce=function(L){return ne.createElement(de.P,y({},L,{chartType:"Gauge"}))};re.Z=ce},65337:function(Ht,re,B){"use strict";var ne=B(67294),de=B(15415),y=function(){return y=Object.assign||function(L){for(var ue,oe=1,Be=arguments.length;oe<Be;oe++){ue=arguments[oe];for(var se in ue)Object.prototype.hasOwnProperty.call(ue,se)&&(L[se]=ue[se])}return L},y.apply(this,arguments)},ce=function(L){return ne.createElement(de.P,y({},L,{chartType:"Liquid"}))};re.Z=ce},92688:function(Ht,re,B){"use strict";var ne=B(67294),de=B(15415),y=function(){return y=Object.assign||function(L){for(var ue,oe=1,Be=arguments.length;oe<Be;oe++){ue=arguments[oe];for(var se in ue)Object.prototype.hasOwnProperty.call(ue,se)&&(L[se]=ue[se])}return L},y.apply(this,arguments)},ce=function(L){return ne.createElement(de.P,y({},L,{chartType:"WordCloud"}))};re.Z=ce},88372:function(Ht,re,B){"use strict";B.d(re,{f:function(){return Ke}});var ne=B(4942),de=B(28459),y=B(93967),ce=B.n(y),L=B(67294),ue=B(76509),oe=B(1413),Be=B(98082),se=function(St){return(0,ne.Z)({},St.componentCls,{width:"100%","&-wide":{maxWidth:1152,margin:"0 auto"}})};function ze(Rt){return(0,Be.Xj)("ProLayoutGridContent",function(St){var Nt=(0,oe.Z)((0,oe.Z)({},St),{},{componentCls:".".concat(Rt)});return[se(Nt)]})}var Ge=B(85893),Ke=function(St){var Nt=(0,L.useContext)(ue.X),Pt=St.children,Ct=St.contentWidth,pt=St.className,mt=St.style,pr=(0,L.useContext)(de.ZP.ConfigContext),gr=pr.getPrefixCls,lr=St.prefixCls||gr("pro"),ut=Ct||Nt.contentWidth,we="".concat(lr,"-grid-content"),At=ze(we),Fe=At.wrapSSR,Zt=At.hashId,vr=ut==="Fixed"&&Nt.layout==="top";return Fe((0,Ge.jsx)("div",{className:ce()(we,Zt,pt,(0,ne.Z)({},"".concat(we,"-wide"),vr)),style:mt,children:(0,Ge.jsx)("div",{className:"".concat(lr,"-grid-content-children ").concat(Zt).trim(),children:Pt})}))}},83832:function(Ht,re,B){"use strict";B.d(re,{S:function(){return oe}});var ne=B(1413),de=B(91),y=B(75081),ce=B(67294),L=B(85893),ue=["isLoading","pastDelay","timedOut","error","retry"],oe=function(se){var ze=se.isLoading,Ge=se.pastDelay,Ke=se.timedOut,Rt=se.error,St=se.retry,Nt=(0,de.Z)(se,ue);return(0,L.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,L.jsx)(y.Z,(0,ne.Z)({size:"large"},Nt))})}},76509:function(Ht,re,B){"use strict";B.d(re,{X:function(){return de}});var ne=B(67294),de=(0,ne.createContext)({})},90857:function(Ht){"use strict";var re=Object.prototype.hasOwnProperty,B="~";function ne(){}Object.create&&(ne.prototype=Object.create(null),new ne().__proto__||(B=!1));function de(ue,oe,Be){this.fn=ue,this.context=oe,this.once=Be||!1}function y(ue,oe,Be,se,ze){if(typeof Be!="function")throw new TypeError("The listener must be a function");var Ge=new de(Be,se||ue,ze),Ke=B?B+oe:oe;return ue._events[Ke]?ue._events[Ke].fn?ue._events[Ke]=[ue._events[Ke],Ge]:ue._events[Ke].push(Ge):(ue._events[Ke]=Ge,ue._eventsCount++),ue}function ce(ue,oe){--ue._eventsCount===0?ue._events=new ne:delete ue._events[oe]}function L(){this._events=new ne,this._eventsCount=0}L.prototype.eventNames=function(){var oe=[],Be,se;if(this._eventsCount===0)return oe;for(se in Be=this._events)re.call(Be,se)&&oe.push(B?se.slice(1):se);return Object.getOwnPropertySymbols?oe.concat(Object.getOwnPropertySymbols(Be)):oe},L.prototype.listeners=function(oe){var Be=B?B+oe:oe,se=this._events[Be];if(!se)return[];if(se.fn)return[se.fn];for(var ze=0,Ge=se.length,Ke=new Array(Ge);ze<Ge;ze++)Ke[ze]=se[ze].fn;return Ke},L.prototype.listenerCount=function(oe){var Be=B?B+oe:oe,se=this._events[Be];return se?se.fn?1:se.length:0},L.prototype.emit=function(oe,Be,se,ze,Ge,Ke){var Rt=B?B+oe:oe;if(!this._events[Rt])return!1;var St=this._events[Rt],Nt=arguments.length,Pt,Ct;if(St.fn){switch(St.once&&this.removeListener(oe,St.fn,void 0,!0),Nt){case 1:return St.fn.call(St.context),!0;case 2:return St.fn.call(St.context,Be),!0;case 3:return St.fn.call(St.context,Be,se),!0;case 4:return St.fn.call(St.context,Be,se,ze),!0;case 5:return St.fn.call(St.context,Be,se,ze,Ge),!0;case 6:return St.fn.call(St.context,Be,se,ze,Ge,Ke),!0}for(Ct=1,Pt=new Array(Nt-1);Ct<Nt;Ct++)Pt[Ct-1]=arguments[Ct];St.fn.apply(St.context,Pt)}else{var pt=St.length,mt;for(Ct=0;Ct<pt;Ct++)switch(St[Ct].once&&this.removeListener(oe,St[Ct].fn,void 0,!0),Nt){case 1:St[Ct].fn.call(St[Ct].context);break;case 2:St[Ct].fn.call(St[Ct].context,Be);break;case 3:St[Ct].fn.call(St[Ct].context,Be,se);break;case 4:St[Ct].fn.call(St[Ct].context,Be,se,ze);break;default:if(!Pt)for(mt=1,Pt=new Array(Nt-1);mt<Nt;mt++)Pt[mt-1]=arguments[mt];St[Ct].fn.apply(St[Ct].context,Pt)}}return!0},L.prototype.on=function(oe,Be,se){return y(this,oe,Be,se,!1)},L.prototype.once=function(oe,Be,se){return y(this,oe,Be,se,!0)},L.prototype.removeListener=function(oe,Be,se,ze){var Ge=B?B+oe:oe;if(!this._events[Ge])return this;if(!Be)return ce(this,Ge),this;var Ke=this._events[Ge];if(Ke.fn)Ke.fn===Be&&(!ze||Ke.once)&&(!se||Ke.context===se)&&ce(this,Ge);else{for(var Rt=0,St=[],Nt=Ke.length;Rt<Nt;Rt++)(Ke[Rt].fn!==Be||ze&&!Ke[Rt].once||se&&Ke[Rt].context!==se)&&St.push(Ke[Rt]);St.length?this._events[Ge]=St.length===1?St[0]:St:ce(this,Ge)}return this},L.prototype.removeAllListeners=function(oe){var Be;return oe?(Be=B?B+oe:oe,this._events[Be]&&ce(this,Be)):(this._events=new ne,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=B,L.EventEmitter=L,Ht.exports=L},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Ht){try{let se=function(){L||(L=!0,y())},ze=function(){try{ce.documentElement.doScroll("left")}catch(Ge){return void setTimeout(ze,50)}se()};var oe=se,Be=ze,B=(B=document.getElementsByTagName("script"))[B.length-1],re=B.getAttribute("data-injectcss"),B=B.getAttribute("data-disable-injectsvg");if(!B){var ne,de,y,ce,L,ue=function(Ke,Rt){Rt.parentNode.insertBefore(Ke,Rt)};if(re&&!Ht.__iconfont__svg__cssinject__){Ht.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(Ge){console&&console.log(Ge)}}ne=function(){var Ke,Rt=document.createElement("div");Rt.innerHTML=Ht._iconfont_svg_string_3580659,(Rt=Rt.getElementsByTagName("svg")[0])&&(Rt.setAttribute("aria-hidden","true"),Rt.style.position="absolute",Rt.style.width=0,Rt.style.height=0,Rt.style.overflow="hidden",Rt=Rt,(Ke=document.body).firstChild?ue(Rt,Ke.firstChild):Ke.appendChild(Rt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ne,0):(de=function(){document.removeEventListener("DOMContentLoaded",de,!1),ne()},document.addEventListener("DOMContentLoaded",de,!1)):document.attachEvent&&(y=ne,ce=Ht.document,L=!1,ze(),ce.onreadystatechange=function(){ce.readyState=="complete"&&(ce.onreadystatechange=null,se())})}}catch(se){}}(window)},83557:function(Ht,re,B){var ne=B(34155);var de;(function(y){(function(ce){var L=typeof B.g=="object"?B.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ue=oe(y);typeof L.Reflect=="undefined"?L.Reflect=y:ue=oe(L.Reflect,ue),ce(ue);function oe(Be,se){return function(ze,Ge){typeof Be[ze]!="function"&&Object.defineProperty(Be,ze,{configurable:!0,writable:!0,value:Ge}),se&&se(ze,Ge)}}})(function(ce){var L=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",oe=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",se=typeof Object.create=="function",ze={__proto__:[]}instanceof Array,Ge=!se&&!ze,Ke={create:se?function(){return Mo(Object.create(null))}:ze?function(){return Mo({__proto__:null})}:function(){return Mo({})},has:Ge?function(Gt,_r){return L.call(Gt,_r)}:function(Gt,_r){return _r in Gt},get:Ge?function(Gt,_r){return L.call(Gt,_r)?Gt[_r]:void 0}:function(Gt,_r){return Gt[_r]}},Rt=Object.getPrototypeOf(Function),St=typeof ne=="object"&&ne["env"]&&ne["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",Nt=!St&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:va(),Pt=!St&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oo(),Ct=!St&&typeof WeakMap=="function"?WeakMap:po(),pt=new Ct;function mt(Gt,_r,Gr,rn){if(Ot(Gr)){if(!Vn(Gt))throw new TypeError;if(!hn(_r))throw new TypeError;return ee(Gt,_r)}else{if(!Vn(Gt))throw new TypeError;if(!Or(_r))throw new TypeError;if(!Or(rn)&&!Ot(rn)&&!Vr(rn))throw new TypeError;return Vr(rn)&&(rn=void 0),Gr=Lr(Gr),V(Gt,_r,Gr,rn)}}ce("decorate",mt);function pr(Gt,_r){function Gr(rn,yn){if(!Or(rn))throw new TypeError;if(!Ot(yn)&&!qi(yn))throw new TypeError;Ye(Gt,_r,rn,yn)}return Gr}ce("metadata",pr);function gr(Gt,_r,Gr,rn){if(!Or(Gr))throw new TypeError;return Ot(rn)||(rn=Lr(rn)),Ye(Gt,_r,Gr,rn)}ce("defineMetadata",gr);function lr(Gt,_r,Gr){if(!Or(_r))throw new TypeError;return Ot(Gr)||(Gr=Lr(Gr)),Re(Gt,_r,Gr)}ce("hasMetadata",lr);function ut(Gt,_r,Gr){if(!Or(_r))throw new TypeError;return Ot(Gr)||(Gr=Lr(Gr)),xe(Gt,_r,Gr)}ce("hasOwnMetadata",ut);function we(Gt,_r,Gr){if(!Or(_r))throw new TypeError;return Ot(Gr)||(Gr=Lr(Gr)),nt(Gt,_r,Gr)}ce("getMetadata",we);function At(Gt,_r,Gr){if(!Or(_r))throw new TypeError;return Ot(Gr)||(Gr=Lr(Gr)),Le(Gt,_r,Gr)}ce("getOwnMetadata",At);function Fe(Gt,_r){if(!Or(Gt))throw new TypeError;return Ot(_r)||(_r=Lr(_r)),rt(Gt,_r)}ce("getMetadataKeys",Fe);function Zt(Gt,_r){if(!Or(Gt))throw new TypeError;return Ot(_r)||(_r=Lr(_r)),Tt(Gt,_r)}ce("getOwnMetadataKeys",Zt);function vr(Gt,_r,Gr){if(!Or(_r))throw new TypeError;Ot(Gr)||(Gr=Lr(Gr));var rn=Q(_r,Gr,!1);if(Ot(rn)||!rn.delete(Gt))return!1;if(rn.size>0)return!0;var yn=pt.get(_r);return yn.delete(Gr),yn.size>0||pt.delete(_r),!0}ce("deleteMetadata",vr);function ee(Gt,_r){for(var Gr=Gt.length-1;Gr>=0;--Gr){var rn=Gt[Gr],yn=rn(_r);if(!Ot(yn)&&!Vr(yn)){if(!hn(yn))throw new TypeError;_r=yn}}return _r}function V(Gt,_r,Gr,rn){for(var yn=Gt.length-1;yn>=0;--yn){var Ti=Gt[yn],fe=Ti(_r,Gr,rn);if(!Ot(fe)&&!Vr(fe)){if(!Or(fe))throw new TypeError;rn=fe}}return rn}function Q(Gt,_r,Gr){var rn=pt.get(Gt);if(Ot(rn)){if(!Gr)return;rn=new Nt,pt.set(Gt,rn)}var yn=rn.get(_r);if(Ot(yn)){if(!Gr)return;yn=new Nt,rn.set(_r,yn)}return yn}function Re(Gt,_r,Gr){var rn=xe(Gt,_r,Gr);if(rn)return!0;var yn=aa(_r);return Vr(yn)?!1:Re(Gt,yn,Gr)}function xe(Gt,_r,Gr){var rn=Q(_r,Gr,!1);return Ot(rn)?!1:nn(rn.has(Gt))}function nt(Gt,_r,Gr){var rn=xe(Gt,_r,Gr);if(rn)return Le(Gt,_r,Gr);var yn=aa(_r);if(!Vr(yn))return nt(Gt,yn,Gr)}function Le(Gt,_r,Gr){var rn=Q(_r,Gr,!1);if(!Ot(rn))return rn.get(Gt)}function Ye(Gt,_r,Gr,rn){var yn=Q(Gr,rn,!0);yn.set(Gt,_r)}function rt(Gt,_r){var Gr=Tt(Gt,_r),rn=aa(Gt);if(rn===null)return Gr;var yn=rt(rn,_r);if(yn.length<=0)return Gr;if(Gr.length<=0)return yn;for(var Ti=new Pt,fe=[],k=0,z=Gr;k<z.length;k++){var le=z[k],Se=Ti.has(le);Se||(Ti.add(le),fe.push(le))}for(var De=0,$t=yn;De<$t.length;De++){var le=$t[De],Se=Ti.has(le);Se||(Ti.add(le),fe.push(le))}return fe}function Tt(Gt,_r){var Gr=[],rn=Q(Gt,_r,!1);if(Ot(rn))return Gr;for(var yn=rn.keys(),Ti=ia(yn),fe=0;;){var k=be(Ti);if(!k)return Gr.length=fe,Gr;var z=ea(k);try{Gr[fe]=z}catch(le){try{Fi(Ti)}finally{throw le}}fe++}}function dr(Gt){if(Gt===null)return 1;switch(typeof Gt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Gt===null?1:6;default:return 6}}function Ot(Gt){return Gt===void 0}function Vr(Gt){return Gt===null}function Kr(Gt){return typeof Gt=="symbol"}function Or(Gt){return typeof Gt=="object"?Gt!==null:typeof Gt=="function"}function In(Gt,_r){switch(dr(Gt)){case 0:return Gt;case 1:return Gt;case 2:return Gt;case 3:return Gt;case 4:return Gt;case 5:return Gt}var Gr=_r===3?"string":_r===5?"number":"default",rn=xi(Gt,oe);if(rn!==void 0){var yn=rn.call(Gt,Gr);if(Or(yn))throw new TypeError;return yn}return gn(Gt,Gr==="default"?"number":Gr)}function gn(Gt,_r){if(_r==="string"){var Gr=Gt.toString;if(Hr(Gr)){var rn=Gr.call(Gt);if(!Or(rn))return rn}var yn=Gt.valueOf;if(Hr(yn)){var rn=yn.call(Gt);if(!Or(rn))return rn}}else{var yn=Gt.valueOf;if(Hr(yn)){var rn=yn.call(Gt);if(!Or(rn))return rn}var Ti=Gt.toString;if(Hr(Ti)){var rn=Ti.call(Gt);if(!Or(rn))return rn}}throw new TypeError}function nn(Gt){return!!Gt}function fi(Gt){return""+Gt}function Lr(Gt){var _r=In(Gt,3);return Kr(_r)?_r:fi(_r)}function Vn(Gt){return Array.isArray?Array.isArray(Gt):Gt instanceof Object?Gt instanceof Array:Object.prototype.toString.call(Gt)==="[object Array]"}function Hr(Gt){return typeof Gt=="function"}function hn(Gt){return typeof Gt=="function"}function qi(Gt){switch(dr(Gt)){case 3:return!0;case 4:return!0;default:return!1}}function xi(Gt,_r){var Gr=Gt[_r];if(Gr!=null){if(!Hr(Gr))throw new TypeError;return Gr}}function ia(Gt){var _r=xi(Gt,Be);if(!Hr(_r))throw new TypeError;var Gr=_r.call(Gt);if(!Or(Gr))throw new TypeError;return Gr}function ea(Gt){return Gt.value}function be(Gt){var _r=Gt.next();return _r.done?!1:_r}function Fi(Gt){var _r=Gt.return;_r&&_r.call(Gt)}function aa(Gt){var _r=Object.getPrototypeOf(Gt);if(typeof Gt!="function"||Gt===Rt||_r!==Rt)return _r;var Gr=Gt.prototype,rn=Gr&&Object.getPrototypeOf(Gr);if(rn==null||rn===Object.prototype)return _r;var yn=rn.constructor;return typeof yn!="function"||yn===Gt?_r:yn}function va(){var Gt={},_r=[],Gr=function(){function fe(k,z,le){this._index=0,this._keys=k,this._values=z,this._selector=le}return fe.prototype["@@iterator"]=function(){return this},fe.prototype[Be]=function(){return this},fe.prototype.next=function(){var k=this._index;if(k>=0&&k<this._keys.length){var z=this._selector(this._keys[k],this._values[k]);return k+1>=this._keys.length?(this._index=-1,this._keys=_r,this._values=_r):this._index++,{value:z,done:!1}}return{value:void 0,done:!0}},fe.prototype.throw=function(k){throw this._index>=0&&(this._index=-1,this._keys=_r,this._values=_r),k},fe.prototype.return=function(k){return this._index>=0&&(this._index=-1,this._keys=_r,this._values=_r),{value:k,done:!0}},fe}();return function(){function fe(){this._keys=[],this._values=[],this._cacheKey=Gt,this._cacheIndex=-2}return Object.defineProperty(fe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),fe.prototype.has=function(k){return this._find(k,!1)>=0},fe.prototype.get=function(k){var z=this._find(k,!1);return z>=0?this._values[z]:void 0},fe.prototype.set=function(k,z){var le=this._find(k,!0);return this._values[le]=z,this},fe.prototype.delete=function(k){var z=this._find(k,!1);if(z>=0){for(var le=this._keys.length,Se=z+1;Se<le;Se++)this._keys[Se-1]=this._keys[Se],this._values[Se-1]=this._values[Se];return this._keys.length--,this._values.length--,k===this._cacheKey&&(this._cacheKey=Gt,this._cacheIndex=-2),!0}return!1},fe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Gt,this._cacheIndex=-2},fe.prototype.keys=function(){return new Gr(this._keys,this._values,rn)},fe.prototype.values=function(){return new Gr(this._keys,this._values,yn)},fe.prototype.entries=function(){return new Gr(this._keys,this._values,Ti)},fe.prototype["@@iterator"]=function(){return this.entries()},fe.prototype[Be]=function(){return this.entries()},fe.prototype._find=function(k,z){return this._cacheKey!==k&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=k)),this._cacheIndex<0&&z&&(this._cacheIndex=this._keys.length,this._keys.push(k),this._values.push(void 0)),this._cacheIndex},fe}();function rn(fe,k){return fe}function yn(fe,k){return k}function Ti(fe,k){return[fe,k]}}function oo(){return function(){function Gt(){this._map=new Nt}return Object.defineProperty(Gt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Gt.prototype.has=function(_r){return this._map.has(_r)},Gt.prototype.add=function(_r){return this._map.set(_r,_r),this},Gt.prototype.delete=function(_r){return this._map.delete(_r)},Gt.prototype.clear=function(){this._map.clear()},Gt.prototype.keys=function(){return this._map.keys()},Gt.prototype.values=function(){return this._map.values()},Gt.prototype.entries=function(){return this._map.entries()},Gt.prototype["@@iterator"]=function(){return this.keys()},Gt.prototype[Be]=function(){return this.keys()},Gt}()}function po(){var Gt=16,_r=Ke.create(),Gr=rn();return function(){function z(){this._key=rn()}return z.prototype.has=function(le){var Se=yn(le,!1);return Se!==void 0?Ke.has(Se,this._key):!1},z.prototype.get=function(le){var Se=yn(le,!1);return Se!==void 0?Ke.get(Se,this._key):void 0},z.prototype.set=function(le,Se){var De=yn(le,!0);return De[this._key]=Se,this},z.prototype.delete=function(le){var Se=yn(le,!1);return Se!==void 0?delete Se[this._key]:!1},z.prototype.clear=function(){this._key=rn()},z}();function rn(){var z;do z="@@WeakMap@@"+k();while(Ke.has(_r,z));return _r[z]=!0,z}function yn(z,le){if(!L.call(z,Gr)){if(!le)return;Object.defineProperty(z,Gr,{value:Ke.create()})}return z[Gr]}function Ti(z,le){for(var Se=0;Se<le;++Se)z[Se]=Math.random()*255|0;return z}function fe(z){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(z)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(z)):Ti(new Uint8Array(z),z):Ti(new Array(z),z)}function k(){var z=fe(Gt);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var le="",Se=0;Se<Gt;++Se){var De=z[Se];(Se===4||Se===6||Se===8)&&(le+="-"),De<16&&(le+="0"),le+=De.toString(16).toLowerCase()}return le}}function Mo(Gt){return Gt.__=void 0,delete Gt.__,Gt}})})(de||(de={}))},44875:function(Ht,re,B){"use strict";B.d(re,{zP:function(){return QB},JE:function(){return qL},ns:function(){return KB}});var ne=B(67294),de=(0,ne.createContext)({});function y(){return(0,ne.useContext)(de)}var ce={},L={},ue=function(r){return L[r]},oe=function(r,t){L[r]=t},Be=function(r){return ce[r]},se=function(r,t){ce[r]=t},ze={},Ge={},Ke=34,Rt=10,St=13;function Nt(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function Pt(e,r){var t=Nt(e);return function(n,i){return r(t(n),i,e)}}function Ct(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function pt(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function mt(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function pr(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":mt(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(i?"T"+pt(r,2)+":"+pt(t,2)+":"+pt(n,2)+"."+pt(i,3)+"Z":n?"T"+pt(r,2)+":"+pt(t,2)+":"+pt(n,2)+"Z":t||r?"T"+pt(r,2)+":"+pt(t,2)+"Z":"")}function gr(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(x,A){var C,I,O=i(x,function(Z,Y){if(C)return C(Z,Y-1);I=Z,C=A?Pt(Z,A):Nt(Z)});return O.columns=I||[],O}function i(x,A){var C=[],I=x.length,O=0,Z=0,Y,ie=I<=0,ge=!1;x.charCodeAt(I-1)===Rt&&--I,x.charCodeAt(I-1)===St&&--I;function Ve(){if(ie)return Ge;if(ge)return ge=!1,ze;var lt,Qe=O,Mt;if(x.charCodeAt(Qe)===Ke){for(;O++<I&&x.charCodeAt(O)!==Ke||x.charCodeAt(++O)===Ke;);return(lt=O)>=I?ie=!0:(Mt=x.charCodeAt(O++))===Rt?ge=!0:Mt===St&&(ge=!0,x.charCodeAt(O)===Rt&&++O),x.slice(Qe+1,lt-1).replace(/""/g,'"')}for(;O<I;){if((Mt=x.charCodeAt(lt=O++))===Rt)ge=!0;else if(Mt===St)ge=!0,x.charCodeAt(O)===Rt&&++O;else if(Mt!==t)continue;return x.slice(Qe,lt)}return ie=!0,x.slice(Qe,I)}for(;(Y=Ve())!==Ge;){for(var gt=[];Y!==ze&&Y!==Ge;)gt.push(Y),Y=Ve();A&&(gt=A(gt,Z++))==null||C.push(gt)}return C}function a(x,A){return x.map(function(C){return A.map(function(I){return _(C[I])}).join(e)})}function s(x,A){return A==null&&(A=Ct(x)),[A.map(_).join(e)].concat(a(x,A)).join(`
`)}function l(x,A){return A==null&&(A=Ct(x)),a(x,A).join(`
`)}function f(x){return x.map(d).join(`
`)}function d(x){return x.map(_).join(e)}function _(x){return x==null?"":x instanceof Date?pr(x):r.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:f,formatRow:d,formatValue:_}}var lr=gr(","),ut=lr.parse,we=lr.parseRows,At=lr.format,Fe=lr.formatBody,Zt=lr.formatRows,vr=lr.formatRow,ee=lr.formatValue,V=B(1413),Q=63710088e-1,Re={centimeters:Q*100,centimetres:Q*100,degrees:Q/111325,feet:Q*3.28084,inches:Q*39.37,kilometers:Q/1e3,kilometres:Q/1e3,meters:Q,metres:Q,miles:Q/1609.344,millimeters:Q*1e3,millimetres:Q*1e3,nauticalmiles:Q/1852,radians:1,yards:Q*1.0936},xe={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Q,yards:1.0936133},nt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Le(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Ye(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return rt(r).geometry;case"LineString":return Vr(r).geometry;case"Polygon":return dr(r).geometry;case"MultiPoint":return gn(r).geometry;case"MultiLineString":return In(r).geometry;case"MultiPolygon":return nn(r).geometry;default:throw new Error(e+" is invalid")}}function rt(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Fi(e[0])||!Fi(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Le(n,r,t)}function Tt(e,r,t){return t===void 0&&(t={}),Or(e.map(function(n){return rt(n,r)}),t)}function dr(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return Le(l,r,t)}function Ot(e,r,t){return t===void 0&&(t={}),Or(e.map(function(n){return dr(n,r)}),t)}function Vr(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Le(n,r,t)}function Kr(e,r,t){return t===void 0&&(t={}),Or(e.map(function(n){return Vr(n,r)}),t)}function Or(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function In(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return Le(n,r,t)}function gn(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return Le(n,r,t)}function nn(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return Le(n,r,t)}function fi(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return Le(n,r,t)}function Lr(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function Vn(e,r){r===void 0&&(r="kilometers");var t=Re[r];if(!t)throw new Error(r+" units is invalid");return e*t}function Hr(e,r){r===void 0&&(r="kilometers");var t=Re[r];if(!t)throw new Error(r+" units is invalid");return e/t}function hn(e,r){return xi(Hr(e,r))}function qi(e){var r=e%360;return r<0&&(r+=360),r}function xi(e){var r=e%(2*Math.PI);return r*180/Math.PI}function ia(e){var r=e%360;return r*Math.PI/180}function ea(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Vn(Hr(e,r),t)}function be(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=nt[r];if(!n)throw new Error("invalid original units");var i=nt[t];if(!i)throw new Error("invalid final units");return e/n*i}function Fi(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function aa(e){return!!e&&e.constructor===Object}function va(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Fi(r))throw new Error("bbox must only contain numbers")})}function oo(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function po(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mo(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Gt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Gt(e[0]);throw new Error("coordinates must only contain numbers")}function _r(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function Gr(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function rn(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function yn(e){return e.type==="Feature"?e.geometry:e}function Ti(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function fe(e,r,t){if(e!==null)for(var n,i,a,s,l,f,d,_=0,x=0,A,C=e.type,I=C==="FeatureCollection",O=C==="Feature",Z=I?e.features.length:1,Y=0;Y<Z;Y++){d=I?e.features[Y].geometry:O?e.geometry:e,A=d?d.type==="GeometryCollection":!1,l=A?d.geometries.length:1;for(var ie=0;ie<l;ie++){var ge=0,Ve=0;if(s=A?d.geometries[ie]:d,s!==null){f=s.coordinates;var gt=s.type;switch(_=t&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(r(f,x,Y,ge,Ve)===!1)return!1;x++,ge++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(r(f[n],x,Y,ge,Ve)===!1)return!1;x++,gt==="MultiPoint"&&ge++}gt==="LineString"&&ge++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(i=0;i<f[n].length-_;i++){if(r(f[n][i],x,Y,ge,Ve)===!1)return!1;x++}gt==="MultiLineString"&&ge++,gt==="Polygon"&&Ve++}gt==="Polygon"&&ge++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(Ve=0,i=0;i<f[n].length;i++){for(a=0;a<f[n][i].length-_;a++){if(r(f[n][i][a],x,Y,ge,Ve)===!1)return!1;x++}Ve++}ge++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(fe(s.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function k(e,r,t,n){var i=t;return fe(e,function(a,s,l,f,d){s===0&&t===void 0?i=a:i=r(i,a,s,l,f,d)},n),i}function z(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function le(e,r,t){var n=t;return z(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function Se(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function De(e,r,t){var n=t;return Se(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function $t(e){var r=[];return fe(e,function(t){r.push(t)}),r}function Dt(e,r){var t,n,i,a,s,l,f,d,_,x,A=0,C=e.type==="FeatureCollection",I=e.type==="Feature",O=C?e.features.length:1;for(t=0;t<O;t++){for(l=C?e.features[t].geometry:I?e.geometry:e,d=C?e.features[t].properties:I?e.properties:{},_=C?e.features[t].bbox:I?e.bbox:void 0,x=C?e.features[t].id:I?e.id:void 0,f=l?l.type==="GeometryCollection":!1,s=f?l.geometries.length:1,i=0;i<s;i++){if(a=f?l.geometries[i]:l,a===null){if(r(null,A,d,_,x)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,A,d,_,x)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],A,d,_,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Bt(e,r,t){var n=t;return Dt(e,function(i,a,s,l,f){a===0&&t===void 0?n=i:n=r(n,i,a,s,l,f)}),n}function yt(e,r){Dt(e,function(t,n,i,a,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(Le(t,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var d=0;d<t.coordinates.length;d++){var _=t.coordinates[d],x={type:f,coordinates:_};if(r(Le(x,i),n,d)===!1)return!1}})}function U(e,r,t){var n=t;return yt(e,function(i,a,s){a===0&&s===0&&t===void 0?n=i:n=r(n,i,a,s)}),n}function N(e,r){yt(e,function(t,n,i){var a=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,f=0,d=0,_=0;if(fe(t,function(x,A,C,I,O){if(l===void 0||n>f||I>d||O>_){l=x,f=n,d=I,_=O,a=0;return}var Z=lineString([l,x],t.properties);if(r(Z,n,i,O,a)===!1)return!1;a++,l=x})===!1)return!1}}})}function $(e,r,t){var n=t,i=!1;return N(e,function(a,s,l,f,d){i===!1&&t===void 0?n=a:n=r(n,a,s,l,f,d),i=!0}),n}function ae(e,r){if(!e)throw new Error("geojson is required");yt(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,s=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(r(lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function Ae(e,r,t){var n=t;return ae(e,function(i,a,s,l){a===0&&t===void 0?n=i:n=r(n,i,a,s,l)}),n}function Ze(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=f.length+a-1),lineString([f[a],f[a+1]],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a-1),lineString([f[i][a],f[i][a+1]],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a-1),lineString([f[n][a],f[n][a+1]],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a-1),lineString([f[n][i][a],f[n][i][a+1]],s,r)}throw new Error("geojson is invalid")}function at(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return point(f,s,r);case"MultiPoint":return n<0&&(n=f.length+n),point(f[n],s,r);case"LineString":return a<0&&(a=f.length+a),point(f[a],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),point(f[i][a],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a),point(f[n][a],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a),point(f[n][i][a],s,r)}throw new Error("geojson is invalid")}var j=B(43144),J=B(15671),Ne=B(60136),st=B(82963),Te=B(61120),Kt=B(89611);function xr(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var sn=B(78814);function un(e,r,t){if((0,sn.Z)())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,r);var i=new(e.bind.apply(e,n));return t&&(0,Kt.Z)(i,t.prototype),i}function nr(e){var r=typeof Map=="function"?new Map:void 0;return nr=function(n){if(n===null||!xr(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return un(n,arguments,(0,Te.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,Kt.Z)(i,n)},nr(e)}var Qr={REGISTERED_PROTOCOLS:{}};function Wr(e){var r=$r();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function $r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ii=function(r){return Qr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},pn=function(e){(0,Ne.Z)(t,e);var r=Wr(t);function t(n,i,a,s){var l;return(0,J.Z)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,j.Z)(t)}(nr(Error));function mi(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new pn(t.status,t.statusText,n.toString(),s))}},t.cancel=t.abort,t.send(e.body),t}function Gi(e){return new Promise(function(r,t){mi(e,function(n,i,a,s,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function di(e,r){return mi(e,r)}var Ui=function(r,t){var n=ii(r.url)||di;return n((0,V.Z)((0,V.Z)({},r),{},{type:"json"}),t)},wi=function(r,t){var n=ii(r.url)||di;return n((0,V.Z)((0,V.Z)({},r),{},{type:"arrayBuffer"}),t)},ss=function(r,t){return di(_objectSpread(_objectSpread({},r),{},{method:"POST"}),t)},oa=function(r,t){return di((0,V.Z)((0,V.Z)({},r),{},{method:"GET"}),t)};function ka(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function yi(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Ci})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Ci}function Ri(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Da=function(r,t,n){var i=function(s,l){if(s)t(s);else if(l){var f=typeof createImageBitmap=="function",d=n?n(l):l;f?Ri(d,t):yi(d,t)}};return r.type==="json"?Ui(r,i):wi(r,i)},gu=function(r,t){var n=typeof createImageBitmap=="function";n?Ri(r,t):yi(r,t)},_a=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zl(e,r,t){var n=e.classList;for(var i in Ia)Ia.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var vs=B(37620);function Pa(e){return typeof e=="string"?!!d3.color(e):!1}function _i(e){var r=vs.ZP(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function La(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function fa(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ho(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var f=(e.positions[l]-a)/(s-a);i.addColorStop(f,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function ga(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1,console.log("colorRamp",t);for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-r[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var f=n.getImageData(0,0,256,1).data,d=ms(n,f);return t=null,n=null,d}function us(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=_i(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),r=null,t=null,n}function Qo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,s=ms(t,a);return r=null,t=null,s}function Lu(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=ms(n,s);return t=null,n=null,l}function ms(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function gc(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var wa={BACK:1029,FRONT:1028};function sa(e){switch(e){case"GAODE1.x":return wa.BACK;case"GAODE2.x":return wa.BACK;case"MAPBOX":return wa.FRONT;case"SIMPLE":return wa.FRONT;case"GLOBEL":return wa.BACK;case"DEBAULT":return wa.FRONT;default:return wa.FRONT}}var er=B(74902),Cn=B(97685),_e=B(74691),ke=B.n(_e),bt=B(50361),cr=B.n(bt),tn=B(23279),Bn=B.n(tn),Xi=B(27361),yo=B.n(Xi),Io=B(51584),vo=B.n(Io),Ds=B(18446),Ms=B.n(Ds),tp=B(14293),Tf=B.n(tp),Jo=B(81763),xl=B.n(Jo),El=B(68630),Bu=B.n(El),Fu=B(47037),Qu=B.n(Fu),Yc=B(36719),Ls=B.n(Yc),Ja=B(82492),Sl=B.n(Ja),Ju=B(30236),wf=B.n(Ju),rp=B(97019),Cf=B.n(rp),gh=B(23493),yh=B.n(gh),_h=B(44908),np=B.n(_h),ip=B(11700),Wp=B.n(ip),qc=B(23560),Nu=B.n(qc),ap=B(13218),es=B.n(ap),Vl=B(52353),Al=B.n(Vl),Ys=B(68929),Tl=B.n(Ys),hi={isNil:Tf(),merge:Sl(),throttle:yh(),isString:Qu(),debounce:Bn(),pull:Cf(),isTypedArray:Ls(),isPlainObject:Bu(),isNumber:xl(),isBoolean:vo(),isEqual:Ms(),cloneDeep:cr(),uniq:np(),clamp:ke(),upperFirst:Wp(),get:yo(),mergeWith:wf(),isFunction:Nu(),isObject:es(),isUndefined:Al(),camelCase:Tl()},el=hi.pull;function Bs(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function Uu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function tl(e){return Uu(e).split(/\s+/)}function op(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function ta(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Oi(e){var r=e.parentNode;r&&r.removeChild(e)}function uu(e,r){if(e.classList!==void 0)for(var t=tl(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!Rf(e,r)){var a=Mf(e);Wa(e,(a?a+" ":"")+r)}}function yu(e,r){if(e.classList!==void 0){var t=tl(r);t.forEach(function(n){e.classList.remove(n)})}else Wa(e,Uu((" "+Mf(e)+" ").replace(" "+r+" "," ")))}function Rf(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=Mf(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function Wa(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function bh(e,r,t){t===void 0?Rf(e,r)?yu(e,r):uu(e,r):t?uu(e,r):yu(e,r)}function Mf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Fs(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var rl=op(["transform","WebkitTransform"]);function _u(e,r){e.style[rl]=r}function jl(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function xh(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function yc(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),s=(0,Cn.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var ma=yc()<1?1:window.devicePixelRatio;function _c(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function nl(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function wl(e,r){var t,n=nl((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=nl(r),a=el.apply(void 0,[n].concat((0,er.Z)(i)));e.setAttribute("style",a.join(";"))}function Eh(e){return Object.entries(e).map(function(r){var t=(0,Cn.Z)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function Kc(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function ba(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Cl(e){e.innerHTML=""}function sp(e){e.setAttribute("draggable","false")}function il(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,(0,er.Z)(r)):e.append(r)}function Qc(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var Jc;function If(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function al(){return typeof importScripts=="function"}var Hl=al()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},zu=(Jc=navigator)===null||Jc===void 0?void 0:Jc.userAgent,ef=!!zu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),bc=zu.indexOf("Android")>-1||zu.indexOf("Adr")>-1;function Wl(){for(var e=zu,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}function Sh(e,r){e.forEach(function(t){r[t]&&(r[t]=r[t].bind(r))})}var xc=null;function Ns(e){var r=[1/0,1/0,-1/0,-1/0];return fe(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}Ns.default=Ns;var Ah=Ns;function tf(e){return typeof e=="number"}var Ec=2*Math.PI*6378137/2;function Rl(e,r){var t=(0,Cn.Z)(r,4),n=t[0],i=t[1],a=t[2],s=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function Zu(e){var r=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var n=t.coordinates;Gl(r,n)}),r}function Gl(e,r){return Array.isArray(r[0])?r.forEach(function(t){Gl(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function Pf(e,r){return ol(e,r)}function ol(e,r){return Array.isArray(e[0])?e.map(function(t){return ol(t,r)}):r(e)}function Th(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=up(e,r);var n=e[0],i=e[1],a=n*Ec/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*Ec/180,t.enable&&(a=Number(a.toFixed(t.decimal)),s=Number(s.toFixed(t.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function wh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/Ec*180,a=n/Ec*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function Ch(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Of(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function up(e,r){if(r===!1)return e;var t=Ch(e[0]),n=Of(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ga(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,s=t*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,f=.5,d=-.5/Math.PI;return i=.5,a=n*(l*a+f),s=n*(d*s+i),[Math.floor(a),Math.floor(s)]}function lp(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],f=s[1];l=(l/a-t)/r,f=(f/a-i)/n,f=(Math.atan(Math.pow(Math.E,f))-Math.PI/4)*2,i=Math.PI/180;var d=f/i,_=l/i;return[_,d]}function kf(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function cp(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function Xl(e,r,t){var n=ia(r[1]-e[1]),i=ia(r[0]-e[0]),a=ia(e[1]),s=ia(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Vn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function fp(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),s=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function Vu(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function Ea(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function $l(e){return[[e[0],e[1]],[e[2],e[3]]]}function ju(e){var r=sl(e,[0,0]);return[e[0]/r,e[1]/r]}function sl(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function zi(e,r){return e[0]*r[0]+e[1]*r[1]}function Sa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function lu(e,r){return Math.acos(zi(e,r)/(Sa(e)*Sa(r)))*180/Math.PI}function rf(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function nf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],f=sl(s,l);n+=f;var d=[s[0]-l[0],s[1]-l[1]],_=rf(t,d);if(a>0){var x=i[a-1].rotation;x-_>360-x+_&&(_=_+360)}i.push({start:s,end:l,dis:f,rotation:_,duration:0})}return i.map(function(A){A.duration=r*(A.dis/n)}),i}}function qs(e){if(tf(e[0]))return e;if(tf(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(tf(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(s){t+=s[0],n+=s[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function hp(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,s=0,l=0,f=0;f<e.length;f+=2){var d=e[f],_=e[f+1];d&&_&&(r=Math.max(d,r),t=Math.max(_,t),n=Math.min(d,n),i=Math.min(_,i),a+=d,s+=_,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function Df(e){return Ah(Or([Vr(e)]))}function Lf(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function Yl(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function Po(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var Xa=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function af(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*(a-1))/(a-1)),n?gs(e,r,l,n,i):gs(e,r,l,.314,i)}function Sc(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function so(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Rn(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=so(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(t),l=a+t,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function gs(e,r,t,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(r[0],r[1]),l=Rn(a,s,n),f=[a[0],l[0],s[0]],d=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(Sc(f,t),Sc(d,t))),[0])}else{var _=Rn(e,r,n),x=[e[0],_[0],r[0]],A=[e[1],_[1],r[1]];return[Sc(x,t),Sc(A,t),0]}}function Bf(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*29)/29),Ff(e,r,l,i)}function Ac(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=calDistance(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,s=n/2/Math.cos(a),l=i+a,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function ls(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function xa(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Ff(e,r,t,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(r[0]),degreesToRadians(r[1])];if(n==="GAODE2.x"){var s=Ac(i,a),l=[i[0],s[0],a[0]],f=[i[1],s[1],a[1]];return[ls(l,t),ls(f,t),0]}else{var d=xa(i,a);if(Math.abs(d-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var _=Math.sin((1-t)*d)/Math.sin(d),x=Math.sin(t*d)/Math.sin(d),A=[Math.sin(i[0]),Math.sin(i[1])],C=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],O=[Math.cos(a[0]),Math.cos(a[1])],Z=_*C[1]*C[0]+x*O[1]*O[0],Y=_*C[1]*A[0]+x*O[1]*I[0],ie=_*A[1]+x*I[1];return[radiansToDegrees(Math.atan2(Y,Z)),radiansToDegrees(Math.atan2(ie,Math.sqrt(Z*Z+Y*Y)))]}}function cn(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=of(a,s),f=t;t+=l,n.push({p1:a,p2:s,totalDistance:t,distance:l,lastTotalDistance:f})}for(var d=t*r,_,x,A=0,C=n;A<C.length;A++){var I=C[A],O=I.totalDistance;if(O>d){var Z=I.p1,Y=I.p2,ie=(d-I.lastTotalDistance)/I.distance,ge=ul(Y,Z,ie);_=ge[0],x=ge[1];break}}return{lng:_,lat:x,height:0}}function ul(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function of(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function sf(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=Us(i,r);return _objectSpread(_objectSpread({},i),a)})}function bu(e,r){return new Promise(function(t){e.inited?t(sf(e,r)):e.once("update",function(){t(sf(e,r))})})}function Us(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,s=r.segmentNumber,l=s===void 0?30:s,f=r.autoFit,d=f===void 0?!0:f,_=e.coordinates;if(n==="line")return pathLineAtOffset(_,t);var x=_[0],A=_[1],C=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=arcLineAtOffset;break;case"greatcircle":I=greatCircleLineAtOffset;break;default:I=arcLineAtOffset}var O=I(x,A,t,C,a,l,d),Z=_slicedToArray(O,3),Y=Z[0],ie=Z[1],ge=Z[2];return{lng:Y,lat:ie,height:ge}}var Nf=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,J.Z)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,j.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Uf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function ys(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function xu(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function pp(e){if(e.length===0)throw new Error("mean requires at least one data point");return xu(e)/e.length}function Tc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var wc={min:ys,max:Uf,mean:pp,sum:xu,mode:Tc};function zf(e,r){return e.map(function(t){return t[r]})}function Ks(e,r){return wc[e](r)}var Ut=B(15861),Me=B(97326),F=B(4942),Qs=B(64687),pe=B.n(Qs);function Ml(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,n],l=[t,a],f=[i,a],d=[i,n];return dr([[s,d,f,l,s]],r.properties,{bbox:e,id:r.id})}var eo=B(26729),zs=B.n(eo),Oo=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),_s=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Un=0,Pn=1,cs=2;function fs(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function Eu(e){e.forEach(function(r){r.properties.state=Un}),e.forEach(function(r){r.isCurrent&&!Js(r)&&Su(r)}),e.forEach(function(r){r.isVisible=!!(r.properties.state&cs)})}function Na(e){e.forEach(function(t){t.properties.state=Un}),e.forEach(function(t){t.isCurrent&&Js(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=!!(t.properties.state&cs),t.children.length&&(t.isVisible||t.properties.state&Pn)?t.children.forEach(function(n){n.properties.state=Pn}):t.isCurrent&&Su(t)})}function Js(e){for(;e;){if(e.isLoaded)return e.properties.state|=cs,!0;e=e.parent}return!1}function Su(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=cs:Su(r)})}var Au,da=256,_o=[-1/0,-1/0,1/0,1/0],Rh=.2,Il=5,Zf=(Au={},(0,F.Z)(Au,Oo.Realtime,fs),(0,F.Z)(Au,Oo.Overlap,Eu),(0,F.Z)(Au,Oo.Replace,Na),Au),ll=function(){};function bs(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function ql(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var Tu=function(r,t,n){var i=ql(r,t,n),a=(0,Cn.Z)(i,2),s=a[0],l=a[1],f=ql(r+1,t+1,n),d=(0,Cn.Z)(f,2),_=d[0],x=d[1];return[s,x,_,l]};function Vf(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,f=l===void 0?0:l,d=e.extent,_=d===void 0?_o:d,x=Math.ceil(r)+f;if(Number.isFinite(s)&&x<s)return[];Number.isFinite(i)&&x>i&&(x=i);for(var A=(0,Cn.Z)(t,4),C=A[0],I=A[1],O=A[2],Z=A[3],Y=[Math.max(C,_[0]),Math.max(I,_[1]),Math.min(O,_[2]),Math.min(Z,_[3])],ie=[],ge=bs(Y[0],Y[1],x),Ve=(0,Cn.Z)(ge,2),gt=Ve[0],lt=Ve[1],Qe=bs(Y[2],Y[3],x),Mt=(0,Cn.Z)(Qe,2),Vt=Mt[0],Sr=Mt[1],mr=gt;mr<=Vt;mr++)for(var Xr=Sr;Xr<=lt;Xr++)ie.push({x:mr,y:Xr,z:x});var mn=(Vt+gt)/2,Yn=(lt+Sr)/2,Ji=function(Ko,Vo){return Math.abs(Ko-mn)+Math.abs(Vo-Yn)};return ie.sort(function(Ma,Ko){return Ji(Ma.x,Ma.y)-Ji(Ko.x,Ko.y)}),ie}var Cc=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,f=r,d=t;return i&&(f<0?f=f+l:f>s&&(f=f%l)),{warpX:f,warpY:d}};function uf(e){var r=jf();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function jf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kl=function(e){(0,Ne.Z)(t,e);var r=uf(t);function t(n){var i;(0,J.Z)(this,t),i=r.call(this),(0,F.Z)((0,Me.Z)(i),"tileSize",256),(0,F.Z)((0,Me.Z)(i),"isVisible",!1),(0,F.Z)((0,Me.Z)(i),"isCurrent",!1),(0,F.Z)((0,Me.Z)(i),"isVisibleChange",!1),(0,F.Z)((0,Me.Z)(i),"loadedLayers",0),(0,F.Z)((0,Me.Z)(i),"isLayerLoaded",!1),(0,F.Z)((0,Me.Z)(i),"isLoad",!1),(0,F.Z)((0,Me.Z)(i),"isChildLoad",!1),(0,F.Z)((0,Me.Z)(i),"parent",null),(0,F.Z)((0,Me.Z)(i),"children",[]),(0,F.Z)((0,Me.Z)(i),"data",null),(0,F.Z)((0,Me.Z)(i),"properties",{}),(0,F.Z)((0,Me.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,f=n.tileSize,d=n.warp,_=d===void 0?!0:d;return i.x=a,i.y=s,i.z=l,i.warp=_||!0,i.tileSize=f,i}return(0,j.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===_s.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===_s.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===_s.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===_s.Cancelled}},{key:"isDone",get:function(){return[_s.Loaded,_s.Cancelled,_s.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Tu(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,Cn.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],f=i[3],d=[(l-a)/2,(f-s)/2],_=Ml(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:d,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l,f,d,_,x,A,C,I,O,Z,Y,ie,ge,Ve,gt,lt,Qe;return pe().wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:return l=s.getData,f=s.onLoad,d=s.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=_s.Loading,x=null,Vt.prev=7,C=this.x,I=this.y,O=this.z,Z=this.bounds,Y=this.tileSize,ie=this.warp,ge=Cc(C,I,O,ie),Ve=ge.warpX,gt=ge.warpY,lt=this.abortController.signal,Qe={x:Ve,y:gt,z:O,bounds:Z,tileSize:Y,signal:lt,warp:ie},Vt.next=14,l(Qe,this);case 14:x=Vt.sent,Vt.next=20;break;case 17:Vt.prev=17,Vt.t0=Vt.catch(7),A=Vt.t0;case 20:if(_===this.loadDataId){Vt.next=22;break}return Vt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){Vt.next=24;break}return Vt.abrupt("return");case 24:if(!(A||!x)){Vt.next=28;break}return this.loadStatus=_s.Failure,d(A,this),Vt.abrupt("return");case 28:this.loadStatus=_s.Loaded,this.data=x,f(this);case 31:case"end":return Vt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=_s.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(eo.EventEmitter),Ql=function(r,t){var n=$l(r),i=Vu(n,t),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},Mh=function(r,t){var n=$l(r),i=$l(t),a=Ea(n,i);return a};function hs(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=wu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function wu(e,r){if(e){if(typeof e=="string")return lf(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lf(e,r)}}function lf(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Pl(e){var r=cu();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ih=hi.throttle,Hu=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Hf=function(e){(0,Ne.Z)(t,e);var r=Pl(t);function t(n){var i;return(0,J.Z)(this,t),i=r.call(this),(0,F.Z)((0,Me.Z)(i),"currentTiles",[]),(0,F.Z)((0,Me.Z)(i),"cacheTiles",new Map),(0,F.Z)((0,Me.Z)(i),"throttleUpdate",Ih(function(a,s){i.update(a,s)},16)),(0,F.Z)((0,Me.Z)(i),"onTileLoad",function(a){i.emit(Hu.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Me.Z)(i),"onTileError",function(a,s){i.emit(Hu.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Me.Z)(i),"onTileUnload",function(a){i.emit(Hu.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:_o,getTileData:ll,warp:!0,updateStrategy:Oo.Replace},i.updateOptions(n),i}return(0,j.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,V.Z)((0,V.Z)((0,V.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Mh(this.lastViewStates.latLonBoundsBuffer,a))){var f=Ql(a,Rh);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:f},this.currentZoom=l;var d=!1,_=this.getTileIndices(l,f).filter(function(x){return s.options.warp||x.x>=0&&x.x<Math.pow(2,l)});this.emit(Hu.TilesLoadStart),this.currentTiles=_.map(function(x){var A=x.x,C=x.y,I=x.z,O=s.getTile(A,C,I);if(O){var Z,Y,ie=((Z=O)===null||Z===void 0?void 0:Z.isFailure)||((Y=O)===null||Y===void 0?void 0:Y.isCancelled);return ie&&O.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),O}return O=s.createTile(A,C,I),d=!0,O}),d&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=hs(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,Cn.Z)(a.value,2),l=s[0],f=s[1];if(!this.currentTiles.includes(f)){this.cacheTiles.delete(l),this.onTileUnload(f);return}this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(d){i.e(d)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(f){s.reloadTileById(f.z,f.x,f.y)})}},{key:"pruneRequests",value:function(){var i=[],a=hs(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(d){a.e(d)}finally{a.f()}for(;i.length>0;){var f=i.shift();f.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,f=Math.ceil(s)+l,d=bs(i,a,f),_=this.tiles.filter(function(x){return x.key==="".concat(d[0],"_").concat(d[1],"_").concat(f)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(f){return f.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=hs(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=hs(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var f=l.value;a.set(f.key,f.isVisible),f.isCurrent=!1,f.isVisible=!1}}catch(I){s.e(I)}finally{s.f()}var d=hs(this.currentTiles),_;try{for(d.s();!(_=d.n()).done;){var x=_.value;x.isCurrent=!0,x.isVisible=!0}}catch(I){d.e(I)}finally{d.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):Zf[i](A);var C=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,C=!0):I.isVisibleChange=!1}),C&&this.emit(Hu.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,f=s.extent,d=s.zoomOffset,_=Math.floor(this.options.maxZoom),x=Math.ceil(this.options.minZoom),A=Vf({maxZoom:_,minZoom:x,zoomOffset:d,tileSize:l,zoom:i,latLonBounds:a,extent:f});return A}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(Hu.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=this.cacheTiles.get(l);return f}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=new Kl({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),f}},{key:"resizeCacheTiles",value:function(){var i=Il*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=hs(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var f=(0,Cn.Z)(l.value,2),d=f[0],_=f[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(d),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(x){s.e(x)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=hs(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(x){i.e(x)}finally{i.f()}var l=hs(this.cacheTiles.values()),f;try{for(l.s();!(f=l.n()).done;){var d=f.value,_=this.getNearestAncestor(d.x,d.y,d.z);d.parent=_,_!=null&&_.children&&_.children.push(d)}}catch(x){l.e(x)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),t}(zs());function Ph(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function v(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=h(e),s=Math.abs(t+n)%a.length,l=ii(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Tu(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function p(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,s=r.version,l=s===void 0?"1.0.0":s,f=r.style,d=f===void 0?"default":f,_=r.format,x=r.service,A=x===void 0?"WMTS":x,C=r.tileMatrixset,I=h(e),O=Math.abs(t+n)%I.length,Z="".concat(I[O],"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(d,"&TILEMATRIXSET=").concat(C,"&FORMAT=").concat(_,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return Z}function g(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var S={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},w=S.self||S.window||{},R=S.window||S.self||{},P=S.self||S.window||{},X=S.document||{},te=typeof importScripts=="function",ye=typeof window!="undefined"&&typeof window.orientation!="undefined",Ee=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),Ce=Ee,Xe=new Map;function We(e){g(e.source&&!e.url||!e.source&&e.url);var r=Xe.get(e.source||e.url);return r||(e.url&&(r=ft(e.url),Xe.set(e.url,r)),e.source&&(r=Ue(e.source),Xe.set(e.source,r))),g(r),r}function ft(e){if(!e.startsWith("http"))return e;var r=ct(e);return Ue(r)}function Ue(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function ct(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Et(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(zt(e))n.add(e);else if(zt(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)Et(e[i],r,n)}}return t===void 0?Array.from(n):[]}function zt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var or=function(){},Qt=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;g(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=or,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=or,this.onError=or,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||Et(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=We({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),fr=Qt,Ar=function(){return Ar=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ar.apply(this,arguments)},Yr=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},zr=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},_n=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=Ar(Ar({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),Yr(this,void 0,void 0,function(){var i,a=this;return zr(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return Yr(this,void 0,void 0,function(){var r,t,n;return zr(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new Ce(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new fr({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return ye?this.maxMobileConcurrency:this.maxConcurrency},e}(),jn=_n,zn=function(){return zn=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},zn.apply(this,arguments)},Hn=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Wi={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},An=function(){function e(r){this.workerPools=new Map,this.props=zn({},Wi),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return fr.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=Hn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=zn(zn({},this.props),r);try{for(var i=Hn(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new jn({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),ui=null,gi=new Map,oi=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(vi(t)){var n=t.data,i=n.type,a=n.payload;r(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=gi.get(r);t||(t=function(n){if(vi(n)){var i=n.data,a=i.type,s=i.payload;r(a,s)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=gi.get(r);gi.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=Et(t);self.postMessage(n,i)}},e}(),ri=null;function vi(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function ni(e){return JSON.parse(Kn(e))}function Kn(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function ko(e){return""+e.name}function to(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var Do=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},bo=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};function $a(e,r){return WorkerFarm.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function ro(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Do(this,void 0,void 0,function(){var i,a,s,l,f,d,_,x;return bo(this,function(A){switch(A.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,t),s=WorkerFarm.getWorkerFarm(t),l=s.getWorkerPool({name:i,url:a}),f=t.jobName||e.name,[4,l.startJob(f,xs.bind(null,n))];case 1:return d=A.sent(),_=removeNontransferableOptions(t),d.postMessage("process",{input:r,options:_}),[4,d.result];case 2:return x=A.sent(),[2,x.result]}})})}function xs(e,r,t,n){return Do(this,void 0,void 0,function(){var i,a,s,l,f,d,_;return bo(this,function(x){switch(x.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,x.label=4;case 4:return x.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return f=x.sent(),r.postMessage("done",{id:a,result:f}),[3,7];case 6:return d=x.sent(),_=d instanceof Error?d.message:"unknown error",r.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),x.label=9;case 9:return[2]}})})}var Es=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),cl=null,Ss=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},fu=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Zs=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(s){return new Promise(function(l,f){s=e[a](s),i(l,f,s.done,s.value)})}}function i(a,s,l,f){Promise.resolve(f).then(function(d){a({value:d,done:l})},s)}},Rc=0,Wu,Cu;function Jl(e,r){var t=this;if(typeof self!="undefined"){var n={process:fl};WorkerBody.onmessage=function(i,a){return Ss(t,void 0,void 0,function(){var s,l,f,d,_,x,A,C,I,O,Z;return fu(this,function(Y){switch(Y.label){case 0:switch(Y.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=Y.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");Wu=new AsyncQueue,Cu=a.options||{},f=r(Wu,Cu,n),Y.label=4;case 4:Y.trys.push([4,9,10,15]),d=Zs(f),Y.label=5;case 5:return[4,d.next()];case 6:if(_=Y.sent(),!!_.done)return[3,8];x=_.value,WorkerBody.postMessage("output-batch",{result:x}),Y.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=Y.sent(),O={error:A},[3,15];case 10:return Y.trys.push([10,,13,14]),_&&!_.done&&(Z=d.return)?[4,Z.call(d)]:[3,12];case 11:Y.sent(),Y.label=12;case 12:return[3,14];case 13:if(O)throw O.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return Wu.push(a.input),[3,18];case 17:return Wu.close(),[3,18];case 18:return[3,20];case 19:return C=Y.sent(),I=C instanceof Error?C.message:"",WorkerBody.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function fl(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Rc++,a=function(l,f){if(f.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),t(f.result);break;case"error":WorkerBody.removeEventListener(a),n(f.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:r};WorkerBody.postMessage("process",s)})}var hu=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},hl=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Lo={};function uo(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),hu(this,void 0,void 0,function(){return hl(this,function(n){switch(n.label){case 0:return r&&(e=Is(e,r,t)),Lo[e]=Lo[e]||pu(e),[4,Lo[e]];case 1:return[2,n.sent()]}})})}function Is(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function pu(e){return hu(this,void 0,void 0,function(){var r,t,n;return hl(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,Ru(n,e)]}})})}function Ru(e,r){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Zi="0.0.3",ts={id:"null",name:"null",module:"web-worker-helper",options:{}};function lo(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function du(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Mc(e){var r=e.filter;return r?[1]:[0]}function Gu(e,r){return[r]}var Oh=B(9187),Bo=B.n(Oh),Br=B(31437),Vs=Br.Ue(),kh=Br.Ue(),Fo=Br.Ue(),eu=Br.Ue(),No=Br.Ue();function dp(e,r,t,n,i){Br.IH(e,t,n),Br.Fv(e,e),r=Br.al(-e[1],e[0]);var a=Br.al(-t[1],t[0]);return[i/Br.AK(r,a),r]}function ec(e,r){return Br.t8(e,-r[1],r[0])}function pl(e,r,t){return Br.lu(e,r,t),Br.Fv(e,e),e}function Gp(e,r){return e[0]===r[0]&&e[1]===r[1]}function sg(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Vv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,J.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Br.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],O=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.segment_gaode2(i,s,x,C,O,A,I,Z);s+=Y}if(this.dash)for(var ie=0;ie<i.positions.length/6;ie++)i.positions[ie*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],O=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.simpleSegment(i,s,x,C,O,A,I,Z);s+=Y}if(this.dash)for(var ie=0;ie<i.positions.length/6;ie++)i.positions[ie*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var _=0,x=t.indices,A=t.positions,C=t.normals,I=this.cap==="square",O=this.join==="bevel",Z=Ga([f[0],f[1]]),Y=Ga([l[0],l[1]]);pl(Fo,a,i);var ie=0;if(this.dash&&(ie=this.lineSegmentDistance(Z,Y),this.totalDistance+=ie),this.normal||(this.normal=Br.Ue(),ec(this.normal,Fo)),!this.started)if(this.started=!0,I){var ge=Br.Ue(),Ve=Br.Ue();Br.IH(ge,this.normal,Fo),Br.IH(Ve,this.normal,Fo),C.push(Ve[0],Ve[1],0),C.push(ge[0],ge[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-ie,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-ie,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,i,this.normal,this.thickness,this.totalDistance-ie);if(x.push(n+0,n+1,n+2),s){Gp(a,s)&&Br.IH(s,a,Br.Fv(s,Br.$X(s,a,i))),pl(eu,s,a);var Qe=dp(No,Br.Ue(),Fo,eu,this.thickness),Mt=(0,Cn.Z)(Qe,2),Vt=Mt[0],Sr=Mt[1],mr=Br.AK(No,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var mn=Vt;mn>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(Sr[0],Sr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,(0,er.Z)(this.lastFlip!==-mr?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),ec(Vs,eu),Br.JG(this.normal,Vs),C.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,C,a,Sr,Vt,this.totalDistance),x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),mr=-1,Br.JG(this.normal,Sr),_+=2),this.lastFlip=mr}else{if(ec(this.normal,Fo),I){var gt=Br.Ue(),lt=Br.Ue();Br.lu(lt,Fo,this.normal),Br.IH(gt,Fo,this.normal),C.push(lt[0],lt[1],0),C.push(gt[0],gt[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=Ga([a[0],a[1]]),A=Ga([i[0],i[1]]);pl(Fo,x,A);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,A),this.totalDistance+=C),this.normal||(this.normal=Br.Ue(),ec(this.normal,Fo)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-C)),f.push(n+0,n+1,n+2),!s)ec(this.normal,Fo),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ga([s[0],s[1]]);Gp(x,I)&&Br.IH(I,x,Br.Fv(I,Br.$X(I,x,A))),pl(eu,I,x);var O=dp(No,Br.Ue(),Fo,eu,this.thickness),Z=(0,Cn.Z)(O,2),Y=Z[0],ie=Z[1],ge=Br.AK(No,this.normal)<0?-1:1;this.extrusions(d,_,a,ie,Y,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ge=-1,Br.JG(this.normal,ie),l+=2,this.lastFlip=ge}return l}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",C=Ga([a[0],a[1]]),I=Ga([i[0],i[1]]);pl(Fo,C,I);var O=0;if(this.dash&&(O=this.lineSegmentDistance(C,I),this.totalDistance+=O),this.normal||(this.normal=Br.Ue(),ec(this.normal,Fo)),!this.started)if(this.started=!0,x){var Z=Br.Ue(),Y=Br.Ue();Br.IH(Z,this.normal,Fo),Br.IH(Y,this.normal,Fo),_.push(Y[0],Y[1],0),_.push(Z[0],Z[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-O,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-O,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-O);if(f.push(n+0,n+1,n+2),s){var Ve=Ga([s[0],s[1]]);Gp(C,Ve)&&Br.IH(Ve,C,Br.Fv(Ve,Br.$X(Ve,C,I))),pl(eu,Ve,C);var gt=dp(No,Br.Ue(),Fo,eu,this.thickness),lt=(0,Cn.Z)(gt,2),Qe=lt[0],Mt=lt[1],Vt=Br.AK(No,this.normal)<0?-1:1,Sr=A;if(!Sr&&this.join==="miter"){var mr=Qe;mr>this.miterLimit&&(Sr=!0)}Sr?(_.push(this.normal[0],this.normal[1],0),_.push(Mt[0],Mt[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,er.Z)(this.lastFlip!==-Vt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),ec(Vs,eu),Br.JG(this.normal,Vs),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,Mt,Qe,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Vt=-1,Br.JG(this.normal,Mt),l+=2),this.lastFlip=Vt}else{if(ec(this.normal,Fo),x){var ie=Br.Ue(),ge=Br.Ue();Br.lu(ge,Fo,this.normal),Br.IH(ie,Fo,this.normal),_.push(ge[0],ge[1],0),_.push(ie[0],ie[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function Wf(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Vv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function vp(e){var r=qs(e.coordinates);return{vertices:[].concat((0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Dh(e){var r=e.coordinates,t=Bo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,s=Bo()(n,a,i);return{indices:s,vertices:n,size:i}}var zd=function(){var e=(0,Ut.Z)(pe().mark(function r(t){var n,i,a,s,l,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.iconMap,l={a_Color:lo,a_Position:du,filter:Mc,a_vertexId:Gu,a_PickingColor:function(O){var Z=O.id;return a?fa(Z):[0,0,0]},a_DistanceAndIndex:function(O,Z,Y,ie,ge,Ve){return Ve===void 0?[Y[3],10]:[Y[3],Ve]},a_Total_Distance:function(O,Z,Y){return[Y[5]]},a_Size:function(O){var Z=O.size,Y=Z===void 0?1:Z;return Array.isArray(Y)?[Y[0],Y[1]]:[Y,0]},a_Normal:function(O,Z,Y,ie,ge){return ge},a_Miter:function(O,Z,Y){return[Y[4]]},a_iconMapUV:function(O){var Z=O.texture,Y=s[Z]||{x:0,y:0},ie=Y.x,ge=Y.y;return[ie,ge]}},f={sizePerElement:0,elements:[]},d=0,_=[],x=3,i.forEach(function(I,O){var Z=Wf(I),Y=Z.indices,ie=Z.vertices,ge=Z.normals,Ve=Z.size,gt=Z.indexes;Y.forEach(function(Vt){_.push(Vt+d)}),x=Ve;var lt=ie.length/Ve;f.sizePerElement=x,f.elements.push({featureIdx:O,vertices:ie,normals:ge,offset:d}),d+=lt;for(var Qe=function(Sr){var mr=(ge==null?void 0:ge.slice(Sr*3,Sr*3+3))||[],Xr=ie.slice(Sr*Ve,Sr*Ve+Ve),mn=0;gt&&gt[Sr]!==void 0&&(mn=gt[Sr]),n.forEach(function(Yn){if(Yn&&l[Yn.name]){var Ji;(Ji=Yn.buffer.data).push.apply(Ji,(0,er.Z)(l[Yn.name](I,O,Xr,Sr,mr,mn)))}})},Mt=0;Mt<lt;Mt++)Qe(Mt)}),C.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Ic=function(){var e=(0,Ut.Z)(pe().mark(function r(t){var n,i,a,s,l,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.shape2d,l={a_Color:lo,a_Position:du,filter:Mc,a_vertexId:Gu,a_PickingColor:function(O){var Z=O.id;return a?fa(Z):[0,0,0]},a_Shape:function(O){var Z=O.shape,Y=Z===void 0?2:Z,ie=s.indexOf(Y);return[ie]},a_Extrude:function(O,Z,Y,ie){var ge=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ve=ie%4*3;return[ge[Ve],ge[Ve+1],ge[Ve+2]]},a_Size:function(O){var Z=O.size,Y=Z===void 0?5:Z;return Array.isArray(Y)?[Y[0]]:[Y]}},f={sizePerElement:0,elements:[]},d=0,_=[],x=3,i.forEach(function(I,O){var Z=vp(I),Y=Z.indices,ie=Z.vertices,ge=Z.normals,Ve=Z.size,gt=Z.indexes;Y.forEach(function(Vt){_.push(Vt+d)}),x=Ve;var lt=ie.length/Ve;f.sizePerElement=x,f.elements.push({featureIdx:O,vertices:ie,normals:ge,offset:d}),d+=lt;for(var Qe=function(Sr){var mr=(ge==null?void 0:ge.slice(Sr*3,Sr*3+3))||[],Xr=ie.slice(Sr*Ve,Sr*Ve+Ve),mn=0;gt&&gt[Sr]!==void 0&&(mn=gt[Sr]),n.forEach(function(Yn){if(Yn&&l[Yn.name]){var Ji;(Ji=Yn.buffer.data).push.apply(Ji,(0,er.Z)(l[Yn.name](I,O,Xr,Sr,mr,mn)))}})},Mt=0;Mt<lt;Mt++)Qe(Mt)}),C.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Lh=function(){var e=(0,Ut.Z)(pe().mark(function r(t){var n,i,a,s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s={a_Color:lo,a_Position:du,filter:Mc,a_vertexId:Gu,a_PickingColor:function(I){var O=I.id;return a?fa(O):[0,0,0]}},l={sizePerElement:0,elements:[]},f=0,d=[],_=3,i.forEach(function(C,I){var O=Dh(C),Z=O.indices,Y=O.vertices,ie=O.normals,ge=O.size,Ve=O.indexes;Z.forEach(function(Mt){d.push(Mt+f)}),_=ge;var gt=Y.length/ge;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:Y,normals:ie,offset:f}),f+=gt;for(var lt=function(Vt){var Sr=(ie==null?void 0:ie.slice(Vt*3,Vt*3+3))||[],mr=Y.slice(Vt*ge,Vt*ge+ge),Xr=0;Ve&&Ve[Vt]!==void 0&&(Xr=Ve[Vt]),n.forEach(function(mn){if(mn&&s[mn.name]){var Yn;(Yn=mn.buffer.data).push.apply(Yn,(0,er.Z)(s[mn.name](C,I,mr,Vt,Sr,Xr)))}})},Qe=0;Qe<gt;Qe++)lt(Qe)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:d});case 8:case"end":return A.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),jv={pointFill:Ic,line:zd,polygonFill:Lh},Zd=(0,V.Z)({},jv);function ug(e){return Xp.apply(this,arguments)}function Xp(){return Xp=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!Zd[t]){a.next=3;break}return a.abrupt("return",Zd[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),Xp.apply(this,arguments)}var Vd=new Map;function jd(e,r){Vd.set(e,r)}function $p(e){var r=Vd.get(e);return r}var Ol="l7-worker",mp=3,Pc=!0;function Yp(e){registerWorkerSource(Ol,e)}function no(){var e=getWorkerSource(Ol);if(!e)throw new Error("get worker failed by workerName: ".concat(Ol,"."));return e}function Gf(e,r){return Xf.apply(this,arguments)}function Xf(){return Xf=_asyncToGenerator(_regeneratorRuntime.mark(function e(r,t){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=no(),i=WorkerFarm.getWorkerFarm({maxConcurrency:mp,reuseWorkers:Pc}),a=i.getWorkerPool({name:Ol,source:n}),d.next=5,a.startJob(Ol,function(_,x,A){return _.done(A)});case 5:return s=d.sent,s.postMessage("process",{input:{workerType:r,data:t}}),d.next=9,s.result;case 9:return l=d.sent,d.abrupt("return",l.result);case 11:case"end":return d.stop()}},e)})),Xf.apply(this,arguments)}function dl(e,r){return e==null?r:e}var cf=B(38163),Oc=B.n(cf);function $f(e,r){return e.map(function(t){return t[r]*1})}function Yf(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function kc(e){return Array.isArray(e)?e.length===0?!1:!!Yf(e[0]):!1}function Dc(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function tc(e){var r=Object.isFrozen(e)?hi.cloneDeep(e):e;return Oc()(r,!0),r}function qp(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,s=r.coordinates,l=r.geometry,f=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(Y){return Y[l]&&Y[l].type&&Y[l].coordinates&&Y[l].coordinates.length>0}).forEach(function(Y,ie){var ge=tc(Y[l]);yt(ge,function(Ve){var gt=Mo(Ve),lt=(0,V.Z)((0,V.Z)({},Y),{},{_id:ie,coordinates:gt});f.push(lt)})}),{dataArray:f};for(var d=0;d<e.length;d++){var _=e[d],x=[];if(s){var A="Polygon";Array.isArray(s[0])||(A="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(A="LineString");var C=tc({type:A,coordinates:_[s]});x=C.coordinates}else if(t&&n&&i&&a){var I=[parseFloat(_[t]),parseFloat(_[n])],O=[parseFloat(_[i]),parseFloat(_[a])];x=[I,O]}else t&&n&&(x=[parseFloat(_[t]),parseFloat(_[n])]);var Z=(0,V.Z)((0,V.Z)({},_),{},{_id:d,coordinates:x});f.push(Z)}return{dataArray:f}}function rc(e,r){var t=ut(e);return qp(t,r)}function ff(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function gp(e,r){return r===void 0?null:typeof(e.properties[r]*1)=="number"?e.properties[r]*1:e.properties&&e.properties[r]?ff(e.properties[r]+"")%1000019:null}function Kp(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=tc(e),e.features.length===0?{dataArray:[],featureKeys:n}:(yt(e,function(i,a){var s=gp(i,r==null?void 0:r.featureId);s===null&&(s=a);var l=s,f=Mo(i),d=(0,V.Z)((0,V.Z)({},i.properties),{},{coordinates:f,_id:l});t.push(d)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function Bh(e,r,t,n){for(var i=n,a=t-r>>1,s=t-r,l,f=e[r],d=e[r+1],_=e[t],x=e[t+1],A=r+3;A<t;A+=3){var C=Qp(e[A],e[A+1],f,d,_,x);if(C>i)l=A,i=C;else if(C===i){var I=Math.abs(A-a);I<s&&(l=A,s=I)}}i>n&&(l-r>3&&Bh(e,r,l,n),e[l+2]=i,t-l>3&&Bh(e,l,t,n))}function Qp(e,r,t,n,i,a){var s=i-t,l=a-n;if(s!==0||l!==0){var f=((e-t)*s+(r-n)*l)/(s*s+l*l);f>1?(t=i,n=a):f>0&&(t+=s*f,n+=l*f)}return s=e-t,l=r-n,s*s+l*l}function tu(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Lc(i),i}function Lc(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")yp(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)yp(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)yp(e,r[n][i])}function yp(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Hd(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Fh(t,e.features[n],r,n);else e.type==="Feature"?Fh(t,e,r):Fh(t,{geometry:e},r);return t}function Fh(e,r,t,n){if(r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,s=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],f=r.id;if(t.promoteId?f=r.properties[t.promoteId]:t.generateId&&(f=n||0),a==="Point")Jp(i,l);else if(a==="MultiPoint")for(var d=0;d<i.length;d++)Jp(i[d],l);else if(a==="LineString")nc(i,l,s,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(d=0;d<i.length;d++)l=[],nc(i[d],l,s,!1),e.push(tu(f,"LineString",l,r.properties));return}else ed(i,l,s,!1);else if(a==="Polygon")ed(i,l,s,!0);else if(a==="MultiPolygon")for(d=0;d<i.length;d++){var _=[];ed(i[d],_,s,!0),l.push(_)}else if(a==="GeometryCollection"){for(d=0;d<r.geometry.geometries.length;d++)Fh(e,{id:f,geometry:r.geometry.geometries[d],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(tu(f,a,l,r.properties))}}function Jp(e,r){r.push(vl(e[0])),r.push(_p(e[1])),r.push(0)}function nc(e,r,t,n){for(var i,a,s=0,l=0;l<e.length;l++){var f=vl(e[l][0]),d=_p(e[l][1]);r.push(f),r.push(d),r.push(0),l>0&&(n?s+=(i*d-f*a)/2:s+=Math.sqrt(Math.pow(f-i,2)+Math.pow(d-a,2))),i=f,a=d}var _=r.length-3;r[2]=1,Bh(r,0,_,t),r[_+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function ed(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];nc(e[i],a,t,n),r.push(a)}}function vl(e){return e/360+.5}function _p(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function ru(e,r,t,n,i,a,s,l){if(t/=r,n/=r,a>=t&&s<n)return e;if(s<t||a>=n)return null;for(var f=[],d=0;d<e.length;d++){var _=e[d],x=_.geometry,A=_.type,C=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(C>=t&&I<n){f.push(_);continue}else if(I<t||C>=n)continue;var O=[];if(A==="Point"||A==="MultiPoint")Bc(x,O,t,n,i);else if(A==="LineString")td(x,O,t,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")qf(x,O,t,n,i,!1);else if(A==="Polygon")qf(x,O,t,n,i,!0);else if(A==="MultiPolygon")for(var Z=0;Z<x.length;Z++){var Y=[];qf(x[Z],Y,t,n,i,!0),Y.length&&O.push(Y)}if(O.length){if(l.lineMetrics&&A==="LineString"){for(Z=0;Z<O.length;Z++)f.push(tu(_.id,A,O[Z],_.tags));continue}(A==="LineString"||A==="MultiLineString")&&(O.length===1?(A="LineString",O=O[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=O.length===3?"Point":"MultiPoint"),f.push(tu(_.id,A,O,_.tags))}}return f.length?f:null}function Bc(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=t&&s<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function td(e,r,t,n,i,a,s){for(var l=ic(e),f=i===0?Ps:As,d=e.start,_,x,A=0;A<e.length-3;A+=3){var C=e[A],I=e[A+1],O=e[A+2],Z=e[A+3],Y=e[A+4],ie=i===0?C:I,ge=i===0?Z:Y,Ve=!1;s&&(_=Math.sqrt(Math.pow(C-Z,2)+Math.pow(I-Y,2))),ie<t?ge>t&&(x=f(l,C,I,Z,Y,t),s&&(l.start=d+_*x)):ie>n?ge<n&&(x=f(l,C,I,Z,Y,n),s&&(l.start=d+_*x)):Kf(l,C,I,O),ge<t&&ie>=t&&(x=f(l,C,I,Z,Y,t),Ve=!0),ge>n&&ie<=n&&(x=f(l,C,I,Z,Y,n),Ve=!0),!a&&Ve&&(s&&(l.end=d+_*x),r.push(l),l=ic(e)),s&&(d+=_)}var gt=e.length-3;C=e[gt],I=e[gt+1],O=e[gt+2],ie=i===0?C:I,ie>=t&&ie<=n&&Kf(l,C,I,O),gt=l.length-3,a&&gt>=3&&(l[gt]!==l[0]||l[gt+1]!==l[1])&&Kf(l,l[0],l[1],l[2]),l.length&&r.push(l)}function ic(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function qf(e,r,t,n,i,a){for(var s=0;s<e.length;s++)td(e[s],r,t,n,i,a,!1)}function Kf(e,r,t,n){e.push(r),e.push(t),e.push(n)}function Ps(e,r,t,n,i,a){var s=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*s),e.push(1),s}function As(e,r,t,n,i,a){var s=(a-t)/(i-t);return e.push(r+(n-r)*s),e.push(a),e.push(1),s}function Uo(e,r){var t=r.buffer/r.extent,n=e,i=ru(e,1,-1-t,t,0,-1,2,r),a=ru(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=ru(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=nu(i,1).concat(n)),a&&(n=n.concat(nu(a,-1)))),n}function nu(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=bp(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(bp(i.geometry[l],r))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var f=[],d=0;d<i.geometry[l].length;d++)f.push(bp(i.geometry[l][d],r));s.push(f)}t.push(tu(i.id,a,s,i.tags))}return t}function bp(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function Qf(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var f=e.features[a],d=f.geometry,_=f.type;if(f.geometry=[],_===1)for(s=0;s<d.length;s+=2)f.geometry.push(rd(d[s],d[s+1],r,t,n,i));else for(s=0;s<d.length;s++){var x=[];for(l=0;l<d[s].length;l+=2)x.push(rd(d[s][l],d[s][l+1],r,t,n,i));f.geometry.push(x)}}return e.transformed=!0,e}function rd(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function Hv(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,Wv(s,e[l],a,i);var f=e[l].minX,d=e[l].minY,_=e[l].maxX,x=e[l].maxY;f<s.minX&&(s.minX=f),d<s.minY&&(s.minY=d),_>s.maxX&&(s.maxX=_),x>s.maxY&&(s.maxY=x)}return s}function Wv(e,r,t,n){var i=r.geometry,a=r.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")xp(s,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)xp(s,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var f=0;f<i.length;f++){var d=i[f];for(l=0;l<d.length;l++)xp(s,d[l],e,t,!0,l===0)}if(s.length){var _=r.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var x in r.tags)_[x]=r.tags[x];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var A={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};r.id!==null&&(A.id=r.id),e.features.push(A)}}function xp(e,r,t,n,i,a){var s=n*n;if(n>0&&r.size<(i?s:n)){t.numPoints+=r.length/3;return}for(var l=[],f=0;f<r.length;f+=3)(n===0||r[f+2]>s)&&(t.numSimplified++,l.push(r[f]),l.push(r[f+1])),t.numPoints++;i&&Gv(l,a),e.push(l)}function Gv(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Wd(e,r){return new rs(e,r)}function rs(e,r){r=this.options=Gd(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Hd(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Uo(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}rs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rs.prototype.splitTile=function(e,r,t,n,i,a,s){for(var l=[e,r,t,n],f=this.options,d=f.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var _=1<<r,x=nd(r,t,n),A=this.tiles[x];if(!A&&(d>1&&console.time("creation"),A=this.tiles[x]=Hv(e,r,t,n,f),this.tileCoords.push({z:r,x:t,y:n}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var C="z"+r;this.stats[C]=(this.stats[C]||0)+1,this.total++}if(A.source=e,i){if(r===f.maxZoom||r===i)continue;var I=1<<i-r;if(t!==Math.floor(a/I)||n!==Math.floor(s/I))continue}else if(r===f.indexMaxZoom||A.numPoints<=f.indexMaxPoints)continue;if(A.source=null,e.length!==0){d>1&&console.time("clipping");var O=.5*f.buffer/f.extent,Z=.5-O,Y=.5+O,ie=1+O,ge,Ve,gt,lt,Qe,Mt;ge=Ve=gt=lt=null,Qe=ru(e,_,t-O,t+Y,0,A.minX,A.maxX,f),Mt=ru(e,_,t+Z,t+ie,0,A.minX,A.maxX,f),e=null,Qe&&(ge=ru(Qe,_,n-O,n+Y,1,A.minY,A.maxY,f),Ve=ru(Qe,_,n+Z,n+ie,1,A.minY,A.maxY,f),Qe=null),Mt&&(gt=ru(Mt,_,n-O,n+Y,1,A.minY,A.maxY,f),lt=ru(Mt,_,n+Z,n+ie,1,A.minY,A.maxY,f),Mt=null),d>1&&console.timeEnd("clipping"),l.push(ge||[],r+1,t*2,n*2),l.push(Ve||[],r+1,t*2,n*2+1),l.push(gt||[],r+1,t*2+1,n*2),l.push(lt||[],r+1,t*2+1,n*2+1)}}},rs.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;r=(r%s+s)%s;var l=nd(e,r,t);if(this.tiles[l])return Qf(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var f=e,d=r,_=t,x;!x&&f>0;)f--,d=Math.floor(d/2),_=Math.floor(_/2),x=this.tiles[nd(f,d,_)];return!x||!x.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",f,d,_),a>1&&console.time("drilling down"),this.splitTile(x.source,f,d,_,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?Qf(this.tiles[l],i):null)};function nd(e,r,t){return((1<<e)*t+r)*32+e}function Gd(e,r){for(var t in r)e[t]=r[t];return e}var hf=function(){function e(r,t,n,i){(0,J.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return(0,j.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Xd={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function id(e){for(var r=0,t=0,n=e.length,i=n-1,a,s;t<n;i=t++)a=e[t],s=e[i],r+=(s.x-a.x)*(a.y+s.y);return r}function Xv(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var s=id(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var $v=["Unknown","Point","LineString","Polygon"];function $d(e,r,t,n,i){var a=i.geometry,s=i.type,l=i.tags,f=i.id,d=e*Math.pow(2,n),_=e*r,x=e*t,A=$v[s],C,I;function O(ie){for(var ge=0;ge<ie.length;ge++){var Ve=ie[ge];if(Ve[3])break;var gt=180-(Ve[1]+x)*360/d,lt=(Ve[0]+_)*360/d-180,Qe=360/Math.PI*Math.atan(Math.exp(gt*Math.PI/180))-90;ie[ge]=[lt,Qe,0,1]}}switch(s){case 1:var Z=[];for(C=0;C<a.length;C++)Z[C]=a[C][0];a=Z,O(a);break;case 2:for(C=0;C<a.length;C++)O(a[C]);break;case 3:for(a=Xv(a),C=0;C<a.length;C++)for(I=0;I<a[C].length;I++)O(a[C][I]);break}a.length===1?a=a[0]:A="Multi"+A;var Y={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:f,tileOrigin:[0,0],coord:""};return Y}var Yd=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f){var d=n.getTile(t.z,t.x,t.y),_=d?d.features.map(function(C){return $d(a,i.x,i.y,i.z,C)}):[],x={layers:{defaultLayer:{features:_}}},A=new hf(x,t.x,t.y,t.z);f(A)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function W(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:(0,V.Z)((0,V.Z)({},r),e.geojsonvtOptions)}function Ie(e,r){var t=W(r),n=t.extent||4096,i=Wd(e,t),a=function(f,d){return Yd(d,i,f,n)},s=(0,V.Z)((0,V.Z)((0,V.Z)({},Xd),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function et(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,s=new Promise(function(f){e instanceof HTMLImageElement||If(e)?f([e]):Jt(e,a,function(d){f(d)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function Jt(e,r,t){var n=[];if(typeof e=="string")Da((0,V.Z)((0,V.Z)({},r),{},{url:e}),function(s,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(s){Da((0,V.Z)((0,V.Z)({},r),{},{url:s}),function(l,f){a++,f&&n.push(f),a===i&&t(n)})})}return et}var yr=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a){var s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=v(t,s),d.abrupt("return",new Promise(function(_){a?a(s,function(x,A){if(x||!A){var C={layers:{defaultLayer:{features:[]}}},I=new hf(C,n.x,n.y,n.z);_(I)}else{var O={layers:{defaultLayer:{features:A.features}}},Z=new hf(O,n.x,n.y,n.z);_(Z)}}):oa((0,V.Z)((0,V.Z)({},i),{},{url:l}),function(x,A){if(x||!A){var C={layers:{defaultLayer:{features:[]}}},I=new hf(C,n.x,n.y,n.z);_(I)}else{var O=JSON.parse(A),Z={layers:{defaultLayer:{features:O}}},Y=new hf(Z,n.x,n.y,n.z);_(Y)}})}));case 3:case"end":return d.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function tr(e,r){var t=function(a,s){return yr(e,s,r==null?void 0:r.requestParameters,r.getCustomData)},n=(0,V.Z)((0,V.Z)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Xt=B(38929),Ur=B(3614),Dr=B.n(Ur),Jr=function(){function e(r,t,n,i){(0,J.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new Xt.VectorTile(new(Dr())(r))}return(0,j.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,V.Z)((0,V.Z)({},l),{},{properties:(0,V.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),jr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},qr=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a,s){var l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l=v(t,n),d.abrupt("return",new Promise(function(_){if(s)s({x:i.x,y:i.y,z:i.z},function(A,C){if(A||!C)_(void 0);else{var I=new Jr(C,i.x,i.y,i.z);_(I)}});else{var x=wi((0,V.Z)((0,V.Z)({},a),{},{url:l}),function(A,C){if(A||!C)_(void 0);else{var I=new Jr(C,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return x.cancel()}}}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function an(e,r){var t=Array.isArray(e)?e[0]:e,n=function(s,l){return qr(t,s,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=(0,V.Z)((0,V.Z)((0,V.Z)({},jr),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}var Mr=B(71002);function en(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Ft(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(C){return C.rasterData}),s=n*i,l=[],f=JSON.stringify(e),d=0;d<s;d++){var _=JSON.parse(f),x=ur(_,a,d);if(typeof x=="number")l.push(x);else{var A=dn(_);l.push(A)}}return l}function ur(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:ur(n,r,t)}})}function Zr(e){var r=(0,Cn.Z)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],s=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,s]}function dn(e){var r=Zr(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=dn(e[1])),Array.isArray(i)&&(i=dn(e[2])),en(t,n,i)}var Cr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:bn}};function bn(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(r==null?void 0:r.countCut)||[2,98],l=(0,Cn.Z)(s,2),f=l[0],d=l[1],_=(r==null?void 0:r.RMinMax)||kr(t,f,d),x=(r==null?void 0:r.GMinMax)||kr(n,f,d),A=(r==null?void 0:r.BMinMax)||kr(i,f,d),C=0;C<t.length;C++)a.push(Math.max(0,t[C]-_[0])),a.push(Math.max(0,n[C]-x[0])),a.push(Math.max(0,i[C]-A[0]));return{rasterData:a,rMinMax:_,gMinMax:x,bMinMax:A}}function kr(e,r,t){var n=e.slice().sort(function(l,f){return l-f}),i=n.length,a=n[Math.ceil(i*r/100)],s=n[Math.ceil(i*t/100)];return[a,s]}function vn(e,r,t){return wr.apply(this,arguments)}function wr(){return wr=(0,Ut.Z)(pe().mark(function e(r,t,n){var i,a,s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.length!==0){x.next=2;break}return x.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return x.next=4,Promise.all(r.map(function(A){var C=A.data,I=A.bands,O=I===void 0?[0]:I;return t(C,O)}));case 4:i=x.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,(0,er.Z)(A)):a.push(A)}),s=a[0],l=s.width,f=s.height,x.t0=(0,Mr.Z)(n),x.next=x.t0==="function"?11:x.t0==="object"?13:15;break;case 11:return d=n(a),x.abrupt("break",16);case 13:return Array.isArray(n)?d={rasterData:Ft(n,a)}:d=fn(n,a),x.abrupt("break",16);case 15:d={rasterData:a[0].rasterData};case 16:return x.abrupt("return",(0,V.Z)((0,V.Z)({},d),{},{width:l,height:f}));case 17:case"end":return x.stop()}},e)})),wr.apply(this,arguments)}function fn(e,r){var t=Cr[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?Xn(t.expression,r):{rasterData:Ft(t.expression,r)}}function Xn(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=Ft(e.r||["band",0],r),n=Ft(e.g||["band",0],r),i=Ft(e.b||["band",0],r);return[t,n,i]}function li(e,r,t,n){return ln.apply(this,arguments)}function ln(){return ln=(0,Ut.Z)(pe().mark(function e(r,t,n,i){var a;return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,vn(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),ln.apply(this,arguments)}function Fr(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,s=r.max,l=r.format,f=r.operation,d,_,x;if(l===void 0||Dc(e))d=Array.from(e),_=n,x=i;else{var A=Array.isArray(e)?e:[e];d=vn(A,l,f)}var C={_id:1,dataArray:[{_id:1,data:d,width:_,height:x,min:a,max:s,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return C}var Er=B(8520),rr=B(86700),Mi=B(84879),it={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Si=B(49296),pi=B.n(Si);function ei(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ra(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function ra(e,r){if(e){if(typeof e=="string")return mo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mo(e,r)}}function mo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var go=30;function Di(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,f=e.xOffset,d=f===void 0?0:f,_=e.yOffset,x=_===void 0?0:_,A=0,C=d;Array.from(r).forEach(function(O,Z){if(!l[O]){var Y=t(O,Z);C+go>a&&(C=0,A++),l[O]={x:C,y:x+A*go,width:go,height:go,advance:Y},C+=go}});var I=n+i*2;return{mapping:l,xOffset:C,yOffset:x+A*I,canvasHeight:Eo(x+(A+1)*I)}}function xo(e,r,t){var n=0,i=0,a=0,s=[],l={},f=ei(e),d;try{for(f.s();!(d=f.n()).done;){var _=d.value;if(!l[_.id]){var x=_.size;n+x+r>t&&(Ca(l,s,i),n=0,i=a+i+r,a=0,s=[]),s.push({icon:_,xOffset:n}),n=n+x+r,a=Math.max(a,x)}}}catch(C){f.e(C)}finally{f.f()}s.length>0&&Ca(l,s,i);var A=Eo(a+i+r);return{mapping:l,canvasHeight:A}}function Ca(e,r,t){var n=ei(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,V.Z)((0,V.Z)({},s),{},{x:l,y:t,image:s.image,width:s.width,height:s.height})}}catch(f){n.e(f)}finally{n.f()}}function Eo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var So,Ya;function zo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ts(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Ts(e,r){if(e){if(typeof e=="string")return Ao(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ao(e,r)}}function Ao(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ei(e){var r=ps();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ha=ve(),Qn="sans-serif",ki="normal",Ki=24,To=3,ml=.25,$e=8,ir=1024,Yt=1,xn=1,Ai=3,Aa=null;function ve(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Oe(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function tt(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var qt=(So=(0,rr.b2)(),So(Ya=function(e){(0,Ne.Z)(t,e);var r=Ei(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"fontAtlas",void 0),(0,F.Z)((0,Me.Z)(n),"iconFontMap",void 0),(0,F.Z)((0,Me.Z)(n),"iconFontGlyphs",{}),(0,F.Z)((0,Me.Z)(n),"fontOptions",void 0),(0,F.Z)((0,Me.Z)(n),"key",void 0),(0,F.Z)((0,Me.Z)(n),"cache",new Nf(Ai)),n}return(0,j.Z)(t,[{key:"scale",get:function(){return xn}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Qn,fontWeight:ki,characterSet:ha,fontSize:Ki,buffer:To,sdf:!0,cutoff:ml,radius:$e,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,V.Z)((0,V.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(f){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(f)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,f=l.fontFamily,d=l.fontWeight,_=l.fontSize,x=l.buffer,A=l.sdf,C=l.radius,I=l.cutoff,O=l.iconfont,Z=s&&s.data;Z||(Z=window.document.createElement("canvas"),Z.width=ir);var Y=Z.getContext("2d",{willReadFrequently:!0});Oe(Y,f,_,d);var ie=Di((0,V.Z)({getFontWidth:function($s){return Y.measureText($s).width},fontHeight:_*xn,buffer:x,characterSet:a,maxCanvasWidth:ir},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),ge=ie.mapping,Ve=ie.canvasHeight,gt=ie.xOffset,lt=ie.yOffset,Qe=Y.getImageData(0,0,Z.width,Z.height);if(Z.height=Ve,Y.putImageData(Qe,0,0),Oe(Y,f,_,d),A){var Mt=new(pi())(_,x,C,I,f,d),Vt=Y.getImageData(0,0,Mt.size,Mt.size),Sr=zo(a),mr;try{for(Sr.s();!(mr=Sr.n()).done;){var Xr=mr.value;if(O){var mn=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),Yn=Mt.draw(mn);tt(Yn,Vt)}else tt(Mt.draw(Xr),Vt);Y.putImageData(Vt,ge[Xr].x,ge[Xr].y)}}catch(Vo){Sr.e(Vo)}finally{Sr.f()}}else{var Ji=zo(a),Ma;try{for(Ji.s();!(Ma=Ji.n()).done;){var Ko=Ma.value;Y.fillText(Ko,ge[Ko].x,ge[Ko].y+_*Yt)}}catch(Vo){Ji.e(Vo)}finally{Ji.f()}}return{xOffset:gt,yOffset:lt,mapping:ge,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],f=s.mapping,d=new Set(Object.keys(f)),_=new Set(a);return _.forEach(function(x){d.has(x)||l.push(x)}),l}}]),t}(eo.EventEmitter))||Ya),Wt,ht;function xt(e){var r=wt();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qe=3,vt=1024,Pe=64,_t=(Wt=(0,rr.b2)(),Wt(ht=function(e){(0,Ne.Z)(t,e);var r=xt(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"canvasHeight",128),(0,F.Z)((0,Me.Z)(n),"texture",void 0),(0,F.Z)((0,Me.Z)(n),"canvas",void 0),(0,F.Z)((0,Me.Z)(n),"iconData",void 0),(0,F.Z)((0,Me.Z)(n),"iconMap",void 0),(0,F.Z)((0,Me.Z)(n),"ctx",void 0),(0,F.Z)((0,Me.Z)(n),"loadingImageCount",0),n}return(0,j.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s,l){var f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return f=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:Pe}),this.updateIconMap(),x.next=6,this.loadImage(l);case 6:f=x.sent,d=this.iconData.find(function(A){return A.id===s}),d&&(d.image=f,d.width=f.width,d.height=f.height),this.update();case 10:case"end":return x.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,f=s.getSceneConfig().canvas,d=f.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Pe}),this.updateIconMap(),this.loadImageMini(a,f).then(function(_){d=_;var x=l.iconData.find(function(A){return A.id===i});x&&(x.image=d,x.width=d.width,x.height=d.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=vt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,f=s.y,d=s.image,_=s.width,x=_===void 0?64:_,A=s.height,C=A===void 0?64:A,I=Math.max(x,C),O=I/Pe,Z=C/O,Y=x/O;d&&i.ctx.drawImage(d,l+(Pe-Y)/2,f+(Pe-Z)/2,Y,Z)})}},{key:"updateIconMap",value:function(){var i=xo(this.iconData,qe,vt),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var f=a.createImage();f.crossOrigin="anonymous",f.onload=function(){s(f)},f.onerror=function(){l(new Error("Could not load image at "+i))},f.src=i})}}]),t}(eo.EventEmitter))||ht),Lt=B(85975),hr,Pr,Tr=(hr=(0,rr.b2)(),hr(Pr=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"viewport",void 0),(0,F.Z)(this,"overridedViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredProjectionMatrix",void 0),(0,F.Z)(this,"viewMatrixInverse",void 0),(0,F.Z)(this,"cameraPosition",void 0)}return(0,j.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Lt.create(),Lt.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Cn.Z)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=Lt.fromTranslation(Lt.create(),[t,n,0]);this.jitteredProjectionMatrix=Lt.multiply(Lt.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Lt.multiply(Lt.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Pr),Ir=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Ln,Mn;function On(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Jn(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Jn(e,r){if(e){if(typeof e=="string")return si(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return si(e,r)}}function si(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var pa={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Zo=(Ln=(0,rr.b2)(),Ln(Mn=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"controlCorners",void 0),(0,F.Z)(this,"controlContainer",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"controls",[]),(0,F.Z)(this,"unAddControls",[])}return(0,j.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(it.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(it.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=On(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=ta("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=l.map(function(d){return n+d}).join(" ");t[l.filter(function(d){return!["row","column"].includes(d)}).join("")]=ta("div",f,i)}function s(l){var f=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,er.Z)(f),[pa[l]])}Object.values(Ir).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Oi(this.controlCorners[t]);this.controlContainer&&Oi(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(n)for(var i=function(){var f=s[a],d=f.match(/^(top|bottom)(left|right)$/);if(d){var _=(0,Cn.Z)(d,3),x=_[1],A=_[2],C=t.controlCorners["".concat(x).concat(A)],I=new n(function(O){var Z=(0,Cn.Z)(O,1),Y=Z[0].target;C&&(C.style[x]=Y.clientHeight+"px")});I.observe(t.controlCorners["".concat(A).concat(x)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||Mn),Xu,Ep,$u=(Xu=(0,rr.b2)(),Xu(Ep=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"markers",[]),(0,F.Z)(this,"markerLayers",[]),(0,F.Z)(this,"unAddMarkers",[]),(0,F.Z)(this,"unAddMarkerLayers",[])}return(0,j.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(it.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||Ep),ad,kl,od=(ad=(0,rr.b2)(),ad(kl=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"popups",[]),(0,F.Z)(this,"unAddPopups",[])}return(0,j.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,er.Z)(this.popups),(0,er.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(it.IMapService)}}]),e}())||kl),pf=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Jf=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),sd=function(e){return e.AND="and",e.OR="or",e}({}),ns=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Nh={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Yv=Nh,Uh,qv,Wo=hi.merge,qa={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},lg={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:sd.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},cg=(Uh=(0,rr.b2)(),Uh(qv=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"sceneConfigCache",{}),(0,F.Z)(this,"layerConfigCache",{}),(0,F.Z)(this,"layerAttributeConfigCache",{})}return(0,j.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Yv[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,V.Z)((0,V.Z)({},qa),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=(0,V.Z)({},Wo({},this.sceneConfigCache[t],lg,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,V.Z)((0,V.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||qv);function Ni(e,r,t,n){t&&Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Li(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(s,l){return l(e,r,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}var zh=B(98333),ud=Math.PI/180,Zh=512,eh=4003e4;function Kv(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,f=e.flipY,d=f===void 0?!1:f;a=a!==void 0?a:Math.pow(2,i);var _={},x=Zh*a,A=Math.cos(t*ud),C=x/360,I=C/A,O=x/eh/A;if(_.pixelsPerMeter=[O,-O,O],_.metersPerPixel=[1/O,-1/O,1/O],_.pixelsPerDegree=[C,-I,O],_.degreesPerPixel=[1/C,-1/I,1/O],l){var Z=ud*Math.tan(t*ud)/A,Y=C*Z/2,ie=x/eh*Z,ge=ie/I*O;_.pixelsPerDegree2=[0,-Y,ie],_.pixelsPerMeter2=[ge,0,ge],d&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return d&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var io=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),ac={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Fc,ld,cd,fd,Vh,df=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],fg=(Fc=(0,rr.b2)(),ld=(0,rr.f3)(it.ICameraService),Fc(cd=(fd=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"needRefresh",!0),Ni(this,"cameraService",Vh,this),(0,F.Z)(this,"coordinateSystem",void 0),(0,F.Z)(this,"viewportCenter",void 0),(0,F.Z)(this,"viewportCenterProjection",void 0),(0,F.Z)(this,"pixelsPerDegree",void 0),(0,F.Z)(this,"pixelsPerDegree2",void 0),(0,F.Z)(this,"pixelsPerMeter",void 0)}return(0,j.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),s=Kv({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,f=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===io.LNGLAT||this.coordinateSystem===io.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===io.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===io.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var s=Kv({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,f=s.pixelsPerDegree,d=s.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),x=this.cameraService.getProjectionMatrix(),A=Lt.multiply([],x,_),C=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=zh.fF([],[C[0],C[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=Lt.multiply([],x,_),A=Lt.multiply([],A,df),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=d}}]),e}(),Vh=Li(fd.prototype,"cameraService",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd))||cd),Qv,hg;function ds(e){var r=th();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function th(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pg=(Qv=(0,rr.b2)(),Qv(hg=function(e){(0,Ne.Z)(t,e);var r=ds(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"renderMap",new Map),(0,F.Z)((0,Me.Z)(n),"enable",!1),(0,F.Z)((0,Me.Z)(n),"renderEnable",!1),(0,F.Z)((0,Me.Z)(n),"cacheLogs",{}),n}return(0,j.Z)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(this.enable){var l=i.split("."),f=null;l.forEach(function(d,_){f!==null?(f[d]||(f[d]={}),_!==l.length-1&&(f=f[d])):(s.cacheLogs[d]||(s.cacheLogs[d]={}),_!==l.length-1&&(f=s.cacheLogs[d])),_===l.length-1&&(f[d]=(0,V.Z)((0,V.Z)({time:Date.now()},f[d]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,Mr.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Po():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,V.Z)((0,V.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,V.Z)((0,V.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(eo.EventEmitter))||hg),o=B(50840),u=B.n(o),c=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),m,b,E,T,M;function D(e){var r=H();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function H(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},K=(m=(0,rr.b2)(),b=(0,rr.f3)(it.IMapService),m(E=(T=function(e){(0,Ne.Z)(t,e);var r=D(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"indragging",!1),Ni((0,Me.Z)(n),"mapService",M,(0,Me.Z)(n)),(0,F.Z)((0,Me.Z)(n),"hammertime",void 0),(0,F.Z)((0,Me.Z)(n),"lastClickTime",0),(0,F.Z)((0,Me.Z)(n),"lastClickXY",[-1,-1]),(0,F.Z)((0,Me.Z)(n),"clickTimer",void 0),(0,F.Z)((0,Me.Z)(n),"$containter",void 0),(0,F.Z)((0,Me.Z)(n),"onDrag",function(l){var f=n.interactionEvent(l);f.type=q[f.type],f.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(c.Drag,f)}),(0,F.Z)((0,Me.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var f=n.interactionEvent(l);n.emit(c.Hover,f)}),(0,F.Z)((0,Me.Z)(n),"onTouch",function(l){var f=l.touches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchstart"})}),(0,F.Z)((0,Me.Z)(n),"onTouchEnd",function(l){if(l.changedTouches.length>0){var f=l.changedTouches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchend"})}}),(0,F.Z)((0,Me.Z)(n),"onTouchMove",function(l){var f=l.changedTouches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchmove"})}),(0,F.Z)((0,Me.Z)(n),"onHover",function(l){var f=l.clientX,d=l.clientY,_=f,x=d,A=l.type,C=n.mapService.getMapContainer();if(C){var I=C.getBoundingClientRect(),O=I.top,Z=I.left;_=_-Z-C.clientLeft,x=x-O-C.clientTop}var Y=n.mapService.containerToLngLat([_,x]);if(A==="click"){n.isDoubleTap(_,x,Y);return}if(A==="touch"){n.isDoubleTap(_,x,Y);return}A!=="click"&&A!=="dblclick"&&n.emit(c.Hover,{x:_,y:x,lngLat:Y,type:A,target:l})}),n}return(0,j.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(c.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(c.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(c.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(c.Active,{featureId:i})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(u()).Manager(i);a.add(new(u()).Tap({event:"dblclick",taps:2})),a.add(new(u()).Tap({event:"click"})),a.add(new(u()).Pan({threshold:0,pointers:0})),a.add(new(u()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("touchstart",this.onTouch),i.addEventListener("touchend",this.onTouchEnd),i.addEventListener("mousemove",this.onHover),i.addEventListener("touchmove",this.onTouchMove),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("touchstart",this.onTouch),i.removeEventListener("touchend",this.onTouchEnd),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,f;s==="touch"?(f=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(f=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var d=this.mapService.getMapContainer();if(d){var _=d.getBoundingClientRect(),x=_.top,A=_.left;l-=A,f-=x}var C=this.mapService.containerToLngLat([l,f]);return{x:l,y:f,lngLat:C,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,f=new Date().getTime(),d="click";f-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),d="dblclick",this.emit(c.Hover,{x:i,y:a,lngLat:s,type:d})):(this.lastClickTime=f,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){d="click",l.emit(c.Hover,{x:i,y:a,lngLat:s,type:d})},400))}}]),t}(zs()),M=Li(T.prototype,"mapService",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T))||E),he=0;function me(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(he++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function je(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var He=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({}),dt,ot,kt,jt,ar,sr,br,Nr,on,Zn,En,Wn,Sn;function Ii(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ai(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function ai(e,r){if(e){if(typeof e=="string")return Dn(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Dn(e,r)}}function Dn(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Bi=(dt=(0,rr.b2)(),ot=(0,rr.f3)(it.IMapService),kt=(0,rr.f3)(it.IRendererService),jt=(0,rr.f3)(it.IGlobalConfigService),ar=(0,rr.f3)(it.IInteractionService),sr=(0,rr.f3)(it.ILayerService),dt(br=(Nr=function(){function e(){var r=this;(0,J.Z)(this,e),(0,F.Z)(this,"pickedColors",void 0),(0,F.Z)(this,"pickedTileLayers",[]),Ni(this,"mapService",on,this),Ni(this,"rendererService",Zn,this),Ni(this,"configService",En,this),Ni(this,"interactionService",Wn,this),Ni(this,"layerService",Sn,this),(0,F.Z)(this,"pickingFBO",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0),(0,F.Z)(this,"alreadyInPicking",!1),(0,F.Z)(this,"pickBufferScale",1),(0,F.Z)(this,"pickFromPickingFBO",function(){var t=(0,Ut.Z)(pe().mark(function n(i,a){var s,l,f,d,_,x,A,C,I,O,Z,Y,ie,ge,Ve,gt,lt,Qe,Mt,Vt,Sr,mr,Xr;return pe().wrap(function(Yn){for(;;)switch(Yn.prev=Yn.next){case 0:if(s=a.x,l=a.y,f=a.lngLat,d=a.type,_=a.target,x=!1,A=r.rendererService,C=A.readPixelsAsync,I=A.getContainer,O=r.getContainerSize(I()),Z=O.width,Y=O.height,Z*=ma,Y*=ma,ie=i.getLayerConfig(),ge=ie.enableHighlight,Ve=ie.enableSelect,gt=s*ma,lt=l*ma,!(gt>Z-1*ma||gt<0||lt>Y-1*ma||lt<0)){Yn.next=11;break}return Yn.abrupt("return",!1);case 11:return Yn.next=13,C({x:Math.floor(gt/r.pickBufferScale),y:Math.floor((Y-(l+1)*ma)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO});case 13:return Qe=Yn.sent,r.pickedColors=Qe,Qe[0]!==0||Qe[1]!==0||Qe[2]!==0?(Mt=La(Qe),Vt=i.layerPickService.getFeatureById(Mt),Mt!==i.getCurrentPickId()&&d==="mousemove"&&(d="mouseenter"),Sr={x:s,y:l,type:d,lngLat:f,featureId:Mt,feature:Vt,target:_},Vt&&(x=!0,i.setCurrentPickId(Mt),r.triggerHoverOnLayer(i,Sr))):(mr={x:s,y:l,lngLat:f,type:i.getCurrentPickId()!==null&&d==="mousemove"?"mouseout":"un"+d,featureId:null,target:_,feature:null},r.triggerHoverOnLayer(i,(0,V.Z)((0,V.Z)({},mr),{},{type:"unpick"})),r.triggerHoverOnLayer(i,mr),i.setCurrentPickId(null)),ge&&i.layerPickService.highlightPickedFeature(Qe),Ve&&d==="click"&&(Qe==null?void 0:Qe.toString())!==[0,0,0,0].toString()&&(Xr=La(Qe),i.getCurrentSelectedId()===null||Xr!==i.getCurrentSelectedId()?(i.layerPickService.selectFeature(Qe),i.setCurrentSelectedId(Xr)):(i.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null))),Yn.abrupt("return",x);case 19:case"end":return Yn.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}())}return(0,j.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),f=l.width,d=l.height;f*=ma,d*=ma,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,f=Math.round(f/this.pickBufferScale),d=Math.round(d/this.pickBufferScale);var _=i({width:f,height:d,usage:He.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=a({color:_,depth:!0,width:f,height:d}),this.interactionService.on(c.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a,s){var l=this,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return f=this.rendererService,d=f.useFramebufferAsync,_=f.clear,this.resizePickingFBO(),i.hooks.beforePickingEncode.call(),C.next=5,d(this.pickingFBO,(0,Ut.Z)(pe().mark(function I(){return pe().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.renderModels({ispick:!0});case 2:case"end":return Z.stop()}},I)})));case 5:return i.hooks.afterPickingEncode.call(),C.next=8,this.pickBox(i,a);case 8:x=C.sent,s(x);case 10:case"end":return C.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){var s=this,l,f,d,_,x,A,C,I,O,Z,Y,ie,ge,Ve,gt,lt,Qe,Mt,Vt,Sr,mr;return pe().wrap(function(mn){for(;;)switch(mn.prev=mn.next){case 0:if(l=a.map(function(Yn){var Ji=Yn<0?0:Yn;return Math.floor(Ji*ma/s.pickBufferScale)}),f=(0,Cn.Z)(l,4),d=f[0],_=f[1],x=f[2],A=f[3],C=this.rendererService,I=C.readPixelsAsync,O=C.getContainer,Z=this.getContainerSize(O()),Y=Z.width,ie=Z.height,Y*=ma,ie*=ma,!(d>(Y-1)*ma/this.pickBufferScale||x<0||_>(ie-1)*ma/this.pickBufferScale||A<0)){mn.next=7;break}return mn.abrupt("return",[]);case 7:return ge=Math.min(Y/this.pickBufferScale,x)-d,Ve=Math.min(ie/this.pickBufferScale,A)-_,mn.next=11,I({x:d,y:Math.floor(ie/this.pickBufferScale-(A+1)),width:ge,height:Ve,data:new Uint8Array(ge*Ve*4),framebuffer:this.pickingFBO});case 11:for(gt=mn.sent,lt=[],Qe={},Mt=0;Mt<gt.length/4;Mt=Mt+1)Vt=gt.slice(Mt*4,Mt*4+4),Sr=La(Vt),Sr!==-1&&!Qe[Sr]&&(mr=i.layerPickService.getFeatureById(Sr),lt.push((0,V.Z)((0,V.Z)({},mr),{},{pickedFeatureIdx:Sr})),Qe[Sr]=!0);return mn.abrupt("return",lt);case 16:case"end":return mn.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var f=this.mapService.version,d=f==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=d==null?void 0:d.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?d==null||d.style.setProperty("cursor",""):n==="mousemove"&&(d==null||d.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/ma,height:t.height/ma}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=ma,a*=ma,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){var a=this,s,l,f,d,_,x,A;return pe().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:s=this.rendererService,l=s.clear,f=s.useFramebufferAsync,this.resizePickingFBO(),d=this.layerService.getRenderList(),_=Ii(d.filter(function(O){return O.needPick(i.type)}).reverse()),I.prev=4,A=pe().mark(function O(){var Z,Y;return pe().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return Z=x.value,ge.next=3,f(a.pickingFBO,(0,Ut.Z)(pe().mark(function Ve(){return pe().wrap(function(lt){for(;;)switch(lt.prev=lt.next){case 0:l({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Z.layerPickService.pickRender(i);case 2:case"end":return lt.stop()}},Ve)})));case 3:return ge.next=5,a.pickFromPickingFBO(Z,i);case 5:if(Y=ge.sent,a.layerService.pickedLayerId=Y?+Z.id:-1,!(Y&&!Z.getLayerConfig().enablePropagation)){ge.next=9;break}return ge.abrupt("return",1);case 9:case"end":return ge.stop()}},O)}),_.s();case 7:if((x=_.n()).done){I.next=13;break}return I.delegateYield(A(),"t0",9);case 9:if(!I.t0){I.next=11;break}return I.abrupt("break",13);case 11:I.next=7;break;case 13:I.next=18;break;case 15:I.prev=15,I.t1=I.catch(4),_.e(I.t1);case 18:return I.prev=18,_.f(),I.finish(18);case 21:case"end":return I.stop()}},n,this,[[4,15,18,21]])}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){je(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),on=Li(Nr.prototype,"mapService",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=Li(Nr.prototype,"rendererService",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En=Li(Nr.prototype,"configService",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wn=Li(Nr.prototype,"interactionService",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sn=Li(Nr.prototype,"layerService",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nr))||br),bi=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,J.Z)(this,e),(0,F.Z)(this,"autoStart",void 0),(0,F.Z)(this,"startTime",0),(0,F.Z)(this,"oldTime",0),(0,F.Z)(this,"running",!1),(0,F.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,j.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),$i,$n,ua,Ua,co,Ba,za,fo,Go;function wo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=js(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function js(e,r){if(e){if(typeof e=="string")return is(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return is(e,r)}}function is(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Hs(e){var r=Co();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var as=hi.throttle,Vi=($i=(0,rr.b2)(),$n=(0,rr.f3)(it.IRendererService),ua=(0,rr.f3)(it.IMapService),Ua=(0,rr.f3)(it.IDebugService),$i(co=(Ba=function(e){(0,Ne.Z)(t,e);var r=Hs(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"pickedLayerId",-1),(0,F.Z)((0,Me.Z)(n),"clock",new bi),(0,F.Z)((0,Me.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Me.Z)(n),"layers",[]),(0,F.Z)((0,Me.Z)(n),"layerList",[]),(0,F.Z)((0,Me.Z)(n),"layerRenderID",void 0),(0,F.Z)((0,Me.Z)(n),"sceneInited",!1),(0,F.Z)((0,Me.Z)(n),"animateInstanceCount",0),(0,F.Z)((0,Me.Z)(n),"shaderPicking",!0),(0,F.Z)((0,Me.Z)(n),"enableRender",!0),Ni((0,Me.Z)(n),"renderService",za,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"mapService",fo,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"debugService",Go,(0,Me.Z)(n)),(0,F.Z)((0,Me.Z)(n),"reRender",as(function(){n.renderLayers()},32)),(0,F.Z)((0,Me.Z)(n),"throttleRenderLayers",as(function(){n.renderLayers()},16)),n}return(0,j.Z)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s=this;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var d=(0,Ut.Z)(pe().mark(function _(x){return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(x.startInit){C.next=4;break}return C.next=3,x.init();case 3:s.updateLayerRenderList();case 4:case"end":return C.stop()}},_)}));return function(_){return d.apply(this,arguments)}}());case 2:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s,l){var f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:l?(f=l.layerChildren.indexOf(s),f>-1&&l.layerChildren.splice(f,1)):(d=this.layers.indexOf(s),d>-1&&this.layers.splice(d,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return x.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C,I;return pe().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){Z.next=2;break}return Z.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),l=wo(this.layerList);try{for(l.s();!(f=l.n()).done;)d=f.value,d.prerender()}catch(Y){l.e(Y)}finally{l.f()}this.renderService.beginFrame(),_=wo(this.layerList),Z.prev=11,_.s();case 13:if((x=_.n()).done){Z.next=25;break}if(A=x.value,C=A.getLayerConfig(),I=C.enableMask,A.masks.filter(function(Y){return Y.inited}).length>0&&I&&this.renderMask(A.masks),!A.getLayerConfig().enableMultiPassRenderer){Z.next=22;break}return Z.next=20,A.renderMultiPass();case 20:Z.next=23;break;case 22:A.render();case 23:Z.next=13;break;case 25:Z.next=30;break;case 27:Z.prev=27,Z.t0=Z.catch(11),_.e(Z.t0);case 30:return Z.prev=30,_.f(),Z.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 36:case"end":return Z.stop()}},a,this,[[11,27,30,33]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?Jf.MULTIPLE:Jf.SINGLE,l=wo(i),f;try{for(l.s();!(f=l.n()).done;){var d=f.value;d.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,s.hooks.beforeRenderData.promise();case 2:l=d.sent,l&&this.renderLayers();case 4:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,f=l===void 0?!0:l,d=i.tileMask?1:0,_=i.masks.filter(function(O){return O.inited});d=d+(f?_.length:1);var x=d>1?Jf.MULTIPLE:Jf.SINGLE;if((i.tileMask||_.length&&f)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&f){var A=wo(_),C;try{for(A.s();!(C=A.n()).done;){var I=C.value;I.render({isStencil:!0,stencilType:x,stencilIndex:a++})}}catch(O){A.e(O)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:x,stencilIndex:a++,stencilOperation:sd.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){f.next=6;break}return f.next=4,s.renderMultiPass();case 4:f.next=8;break;case 6:return f.next=8,s.render();case 8:case"end":return f.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=_i(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(eo.EventEmitter),za=Li(Ba.prototype,"renderService",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fo=Li(Ba.prototype,"mapService",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Go=Li(Ba.prototype,"debugService",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ba))||co),ji=B(91),G=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),na=hi.isNil,iu=function(){function e(r){var t=this;(0,J.Z)(this,e),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"type",void 0),(0,F.Z)(this,"scale",void 0),(0,F.Z)(this,"descriptor",void 0),(0,F.Z)(this,"featureBufferLayout",[]),(0,F.Z)(this,"needRescale",!1),(0,F.Z)(this,"needRemapping",!1),(0,F.Z)(this,"needRegenerateVertices",!1),(0,F.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,F.Z)(this,"vertexAttribute",void 0),(0,F.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,f=(l=t.scale)===null||l===void 0?void 0:l.scalers[s].func,d=f(a);return d})}),this.setProps(r)}return(0,j.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,er.Z)(t));if(!na(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Os=["buffer","update","name"],Za=["buffer","update","name"],ao,ws,la,oc,vu,sc,Ro=(ao={},(0,F.Z)(ao,G.FLOAT,4),(0,F.Z)(ao,G.UNSIGNED_BYTE,1),(0,F.Z)(ao,G.UNSIGNED_SHORT,2),ao),Nc=(ws=(0,rr.b2)(),la=(0,rr.f3)(it.IRendererService),ws(oc=(vu=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"attributesAndIndices",void 0),Ni(this,"rendererService",sc,this),(0,F.Z)(this,"attributes",[]),(0,F.Z)(this,"triangulation",void 0),(0,F.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,j.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new iu(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||s&&t[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,V.Z)((0,V.Z)({},n),{},{name:t})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(gt){return gt.name===t});if(l&&l.descriptor){var f=l.descriptor,d=f.update,_=f.buffer,x=f.size,A=x===void 0?0:x,C=Ro[_.type||G.FLOAT];if(d){var I=this.featureLayout,O=I.elements,Z=I.sizePerElement,Y=O.slice(i,a);if(!Y.length)return;var ie=Y[0].offset,ge=ie*A*C,Ve=Y.map(function(gt,lt){for(var Qe=gt.featureIdx,Mt=gt.vertices,Vt=gt.normals,Sr=Mt.length/Z,mr=[],Xr=0;Xr<Sr;Xr++){var mn=Vt?Vt.slice(Xr*3,Xr*3+3):[];mr.push.apply(mr,(0,er.Z)(d(n[Qe],Qe,Mt.slice(Xr*Z,Xr*Z+Z),lt,mn)))}return mr}).flat();l.vertexAttribute.updateBuffer({data:Ve,offset:ge}),s==null||s.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(Y){return Y.resetDescriptor(),Y.descriptor}),l=0,f=0,d=[],_=3;t.forEach(function(Y,ie){var ge=a.triangulation(Y,i),Ve=ge.indices,gt=ge.vertices,lt=ge.normals,Qe=ge.size,Mt=ge.indexes,Vt=ge.count;typeof Vt=="number"&&(f+=Vt),Ve.forEach(function(mn){d.push(mn+l)}),_=Qe;var Sr=gt.length/Qe;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:ie,vertices:gt,normals:lt,offset:l}),l+=Sr;for(var mr=function(Yn){var Ji=(lt==null?void 0:lt.slice(Yn*3,Yn*3+3))||[],Ma=gt.slice(Yn*Qe,Yn*Qe+Qe),Ko=0;Mt&&Mt[Yn]!==void 0&&(Ko=Mt[Yn]),s.forEach(function(Vo,$s){if(Vo&&Vo.update){var bl;(bl=Vo.buffer.data).push.apply(bl,(0,er.Z)(Vo.update(Y,ie,Ma,Yn,Ji,Ko)))}})},Xr=0;Xr<Sr;Xr++)mr(Xr)});var x=this.rendererService,A=x.createAttribute,C=x.createBuffer,I=x.createElements,O={};s.forEach(function(Y,ie){if(Y){var ge=Y.buffer,Ve=Y.update,gt=Y.name,lt=(0,ji.Z)(Y,Os),Qe=A((0,V.Z)({buffer:C(ge)},lt));O[Y.name||""]=Qe,a.attributes[ie].vertexAttribute=Qe}});var Z=I({data:d,type:G.UNSIGNED_INT,count:d.length});return this.attributesAndIndices={attributes:O,elements:Z,count:f},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(C){return C.resetDescriptor(),C.descriptor}),s=0,l=[],f=3;t.forEach(function(C,I){var O=i.triangulation(C),Z=O.indices,Y=O.vertices,ie=O.normals,ge=O.size,Ve=O.indexes;Z.forEach(function(Mt){l.push(Mt+s)}),f=ge;var gt=Y.length/ge;i.featureLayout.sizePerElement=f,i.featureLayout.elements.push({featureIdx:I,vertices:Y,normals:ie,offset:s}),s+=gt;for(var lt=function(Vt){var Sr=(ie==null?void 0:ie.slice(Vt*3,Vt*3+3))||[],mr=Y.slice(Vt*ge,Vt*ge+ge),Xr=0;Ve&&Ve[Vt]!==void 0&&(Xr=Ve[Vt]),a.forEach(function(mn,Yn){if(mn&&mn.update){var Ji;(Ji=mn.buffer.data).push.apply(Ji,(0,er.Z)(mn.update(C,I,mr,Vt,Sr,Xr)))}})},Qe=0;Qe<gt;Qe++)lt(Qe)});var d=this.rendererService,_=d.createAttribute,x=d.createBuffer,A={};return a.forEach(function(C,I){if(C){var O=C.buffer,Z=C.update,Y=C.name,ie=(0,ji.Z)(C,Za),ge=_((0,V.Z)({buffer:x(O)},ie));A[C.name||""]=ge,i.attributes[I].vertexAttribute=ge}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),sc=Li(vu.prototype,"rendererService",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu))||oc),Yu=B(34155);function rh(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})}function vf(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function mf(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],s;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return a}function Dl(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,a;n<i;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return e.concat(a||Array.prototype.slice.call(r))}function nh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Sp={exports:{}},gf={exports:{}},yf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=r.default})(yf,yf.exports);var au={},Ap={exports:{}},uc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default})(uc,uc.exports);var Ll={};Object.defineProperty(Ll,"__esModule",{value:!0}),Ll.fallback=hd,Ll.wrap=pd;var Tp=Ll.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,ih=Ll.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,wp=Ll.hasNextTick=typeof Yu=="object"&&typeof Yu.nextTick=="function";function hd(e){setTimeout(e,0)}function pd(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var _f;Tp?_f=queueMicrotask:ih?_f=setImmediate:wp?_f=Yu.nextTick:_f=hd,Ll.default=pd(_f),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=f;var t=uc.exports,n=l(t),i=Ll,a=l(i),s=au;function l(x){return x&&x.__esModule?x:{default:x}}function f(x){return(0,s.isAsync)(x)?function(){for(var A=[],C=arguments.length;C--;)A[C]=arguments[C];var I=A.pop(),O=x.apply(this,A);return d(O,I)}:(0,n.default)(function(A,C){var I;try{I=x.apply(this,A)}catch(O){return C(O)}if(I&&typeof I.then=="function")return d(I,C);C(null,I)})}function d(x,A){return x.then(function(C){_(A,null,C)},function(C){_(A,C&&C.message?C:new Error(C))})}function _(x,A,C){try{x(A,C)}catch(I){(0,a.default)(function(O){throw O},I)}}e.exports=r.default}(Ap,Ap.exports),Object.defineProperty(au,"__esModule",{value:!0}),au.isAsyncIterable=au.isAsyncGenerator=au.isAsync=void 0;var dd=Ap.exports,qd=vd(dd);function vd(e){return e&&e.__esModule?e:{default:e}}function Cp(e){return e[Symbol.toStringTag]==="AsyncFunction"}function md(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function Kd(e){return typeof e[Symbol.asyncIterator]=="function"}function Rp(e){if(typeof e!="function")throw new Error("expected a function");return Cp(e)?(0,qd.default)(e):e}au.default=Rp,au.isAsync=Cp,au.isAsyncGenerator=md,au.isAsyncIterable=Kd;var Uc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],f=arguments.length;f--;)l[f]=arguments[f];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(d,_){l[i-1]=function(x){for(var A=[],C=arguments.length-1;C-- >0;)A[C]=arguments[C+1];if(x)return _(x);d(A.length>1?A:A[0])},n.apply(s,l)})}return a}e.exports=r.default})(Uc,Uc.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=yf.exports,n=f(t),i=au,a=f(i),s=Uc.exports,l=f(s);function f(d){return d&&d.__esModule?d:{default:d}}r.default=(0,l.default)(function(d,_,x){var A=(0,n.default)(_)?[]:{};d(_,function(C,I,O){(0,a.default)(C)(function(Z){for(var Y,ie=[],ge=arguments.length-1;ge-- >0;)ie[ge]=arguments[ge+1];ie.length<2&&(Y=ie,ie=Y[0]),A[I]=ie,O(Z)})},function(C){return x(C,A)})},3),e.exports=r.default}(gf,gf.exports);var ah={exports:{}},oh={exports:{}},bf={exports:{}},xf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default})(xf,xf.exports);var sh={exports:{}},gd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(gd,gd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=_;var t=yf.exports,n=s(t),i=gd.exports,a=s(i);function s(x){return x&&x.__esModule?x:{default:x}}function l(x){var A=-1,C=x.length;return function(){return++A<C?{value:x[A],key:A}:null}}function f(x){var A=-1;return function(){var I=x.next();return I.done?null:(A++,{value:I.value,key:A})}}function d(x){var A=x?Object.keys(x):[],C=-1,I=A.length;return function O(){var Z=A[++C];return Z==="__proto__"?O():C<I?{value:x[Z],key:Z}:null}}function _(x){if((0,n.default)(x))return l(x);var A=(0,a.default)(x);return A?f(A):d(x)}e.exports=r.default}(sh,sh.exports);var Mp={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=r.default})(Mp,Mp.exports);var yd={exports:{}},Ip={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(Ip,Ip.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=Ip.exports,n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,f,d){var _=!1,x=!1,A=!1,C=0,I=0;function O(){C>=l||A||_||(A=!0,s.next().then(function(ie){var ge=ie.value,Ve=ie.done;if(!(x||_)){if(A=!1,Ve){_=!0,C<=0&&d(null);return}C++,f(ge,I,Z),I++,O()}}).catch(Y))}function Z(ie,ge){if(C-=1,!x){if(ie)return Y(ie);if(ie===!1){_=!0,x=!0;return}if(ge===n.default||_&&C<=0)return _=!0,d(null);O()}}function Y(ie){x||(A=!1,_=!0,d(ie))}O()}e.exports=r.default}(yd,yd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=xf.exports,n=C(t),i=sh.exports,a=C(i),s=Mp.exports,l=C(s),f=au,d=yd.exports,_=C(d),x=Ip.exports,A=C(x);function C(I){return I&&I.__esModule?I:{default:I}}r.default=function(I){return function(O,Z,Y){if(Y=(0,n.default)(Y),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!O)return Y(null);if((0,f.isAsyncGenerator)(O))return(0,_.default)(O,I,Z,Y);if((0,f.isAsyncIterable)(O))return(0,_.default)(O[Symbol.asyncIterator](),I,Z,Y);var ie=(0,a.default)(O),ge=!1,Ve=!1,gt=0,lt=!1;function Qe(Vt,Sr){if(!Ve)if(gt-=1,Vt)ge=!0,Y(Vt);else if(Vt===!1)ge=!0,Ve=!0;else{if(Sr===A.default||ge&&gt<=0)return ge=!0,Y(null);lt||Mt()}}function Mt(){for(lt=!0;gt<I&&!ge;){var Vt=ie();if(Vt===null){ge=!0,gt<=0&&Y(null);return}gt+=1,Z(Vt.value,Vt.key,(0,l.default)(Qe))}lt=!1}Mt()}},e.exports=r.default}(bf,bf.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=bf.exports,n=f(t),i=au,a=f(i),s=Uc.exports,l=f(s);function f(_){return _&&_.__esModule?_:{default:_}}function d(_,x,A,C){return(0,n.default)(x)(_,(0,a.default)(A),C)}r.default=(0,l.default)(d,4),e.exports=r.default}(oh,oh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=oh.exports,n=s(t),i=Uc.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d,_){return(0,n.default)(f,1,d,_)}r.default=(0,a.default)(l,3),e.exports=r.default}(ah,ah.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=gf.exports,n=s(t),i=ah.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,n.default)(a.default,f,d)}e.exports=r.default}(Sp,Sp.exports);var Pp=nh(Sp.exports),zc=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,Pp(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,Dl([],mf(n.args),!1)),i(null,r)})},e}(),jh={exports:{}},ho={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=yf.exports,n=Z(t),i=Ip.exports,a=Z(i),s=oh.exports,l=Z(s),f=xf.exports,d=Z(f),_=Mp.exports,x=Z(_),A=au,C=Z(A),I=Uc.exports,O=Z(I);function Z(Ve){return Ve&&Ve.__esModule?Ve:{default:Ve}}function Y(Ve,gt,lt){lt=(0,d.default)(lt);var Qe=0,Mt=0,Vt=Ve.length,Sr=!1;Vt===0&&lt(null);function mr(Xr,mn){Xr===!1&&(Sr=!0),Sr!==!0&&(Xr?lt(Xr):(++Mt===Vt||mn===a.default)&&lt(null))}for(;Qe<Vt;Qe++)gt(Ve[Qe],Qe,(0,x.default)(mr))}function ie(Ve,gt,lt){return(0,l.default)(Ve,1/0,gt,lt)}function ge(Ve,gt,lt){var Qe=(0,n.default)(Ve)?Y:ie;return Qe(Ve,(0,C.default)(gt),lt)}r.default=(0,O.default)(ge,3),e.exports=r.default})(ho,ho.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=ho.exports,n=s(t),i=gf.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,a.default)(n.default,f,d)}e.exports=r.default}(jh,jh.exports);var lc=nh(jh.exports),qy=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return lc(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return rh(n,void 0,void 0,function(){return vf(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Zc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=xf.exports,n=_(t),i=Mp.exports,a=_(i),s=au,l=_(s),f=Uc.exports,d=_(f);function _(A){return A&&A.__esModule?A:{default:A}}function x(A,C){if(C=(0,n.default)(C),!Array.isArray(A))return C(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return C();var I=0;function O(Y){var ie=(0,l.default)(A[I++]);ie.apply(void 0,Y.concat([(0,a.default)(Z)]))}function Z(Y){for(var ie=[],ge=arguments.length-1;ge-- >0;)ie[ge]=arguments[ge+1];if(Y!==!1){if(Y||I===A.length)return C.apply(void 0,[Y].concat(ie));O(ie)}}O([])}r.default=(0,d.default)(x),e.exports=r.default})(Zc,Zc.exports);var Qd=nh(Zc.exports),P0=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Qd(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t.apply(void 0,Dl([],mf(n),!1));i(a?null:!1,r)})},e}(),_d=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Pp(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),Vc=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,Pp(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return rh(n,void 0,void 0,function(){return vf(this,function(a){switch(a.label){case 0:return[4,t.apply(void 0,Dl([],mf(this.args),!1))];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Jd=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,Pp(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return rh(n,void 0,void 0,function(){var a;return vf(this,function(s){switch(s.label){case 0:return[4,t.apply(void 0,Dl([],mf(this.args),!1))];case 1:return a=s.sent(),i(a,r),[2]}})})})},e}(),bd=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Qd(this.tasks)},e.prototype.tapPromise=function(r,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){t(n).then(function(a){i(null,a)})})},e}(),ev=B(63844),tv=B.n(ev),rv,Jv,Op,em,tm,rm,nm,im,Mu,xd,am,cc,dg,om,uh,Hh,Wh,Gh,Xo,sm,um,lm,cm,nv,iv,jc,fm,av,ov,hm,sv,pm,dm,uv,vm;function Ed(e){var r=vg();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function vg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lv=(rv=(0,rr.b2)(),Jv=(0,rr.f3)(it.SceneID),Op=(0,rr.f3)(it.IIconService),em=(0,rr.f3)(it.IFontService),tm=(0,rr.f3)(it.IControlService),rm=(0,rr.f3)(it.IGlobalConfigService),nm=(0,rr.f3)(it.IMapService),im=(0,rr.f3)(it.ICoordinateSystemService),Mu=(0,rr.f3)(it.IRendererService),xd=(0,rr.f3)(it.ILayerService),am=(0,rr.f3)(it.IDebugService),cc=(0,rr.f3)(it.ICameraService),dg=(0,rr.f3)(it.IInteractionService),om=(0,rr.f3)(it.IPickingService),uh=(0,rr.f3)(it.IShaderModuleService),Hh=(0,rr.f3)(it.IMarkerService),Wh=(0,rr.f3)(it.IPopupService),rv(Gh=(Xo=function(e){(0,Ne.Z)(t,e);var r=Ed(t);function t(){var n;return(0,J.Z)(this,t),n=r.call(this),(0,F.Z)((0,Me.Z)(n),"destroyed",!1),(0,F.Z)((0,Me.Z)(n),"loaded",!1),Ni((0,Me.Z)(n),"id",sm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"iconService",um,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"fontService",lm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"controlService",cm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"configService",nv,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"map",iv,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"coordinateSystemService",jc,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"rendererService",fm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"layerService",av,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"debugService",ov,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"cameraService",hm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"interactionService",sv,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"pickingService",pm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"shaderModuleService",dm,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"markerService",uv,(0,Me.Z)(n)),Ni((0,Me.Z)(n),"popupService",vm,(0,Me.Z)(n)),(0,F.Z)((0,Me.Z)(n),"inited",!1),(0,F.Z)((0,Me.Z)(n),"rendering",!1),(0,F.Z)((0,Me.Z)(n),"$container",void 0),(0,F.Z)((0,Me.Z)(n),"canvas",void 0),(0,F.Z)((0,Me.Z)(n),"markerContainer",void 0),(0,F.Z)((0,Me.Z)(n),"resizeDetector",void 0),(0,F.Z)((0,Me.Z)(n),"hooks",void 0),(0,F.Z)((0,Me.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,F.Z)((0,Me.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new Vc},n}return(0,j.Z)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ut.Z)(pe().mark(function s(){return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),f.next=3,new Promise(function(d){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),d()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(c.Drag,a.addSceneEvent.bind(a));case 10:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Ut.Z)(pe().mark(function s(){var l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(f=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,f?a.$container=f:a.$container=me(a.configService.getSceneConfig(a.id).id||""),!a.$container){x.next=14;break}return a.canvas=ta("canvas","",a.$container),a.setCanvas(),x.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),a.resizeDetector=tv()({strategy:"scroll"}),a.resizeDetector.listenTo(a.$container,a.handleWindowResized),window.matchMedia&&((d=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||d===void 0||d.addListener(a.handleWindowResized.bind("screen"))),x.next=15;break;case 14:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 15:a.pickingService.init(a.id);case 16:case"end":return x.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return f=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],x.next=3,this.render();case 3:return d=s==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png"),x.abrupt("return",d);case 5:case"end":return x.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=ta("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var s;(s=i.$container)===null||s===void 0||s.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=ma,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d&&(d.width=l*s,d.height=f*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*f})}},{key:"setCanvas",value:function(){var i,a,s=ma,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d.width=l*s,d.height=f*s,d.style.width="100%",d.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(eo.EventEmitter),sm=Li(Xo.prototype,"id",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=Li(Xo.prototype,"iconService",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=Li(Xo.prototype,"fontService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=Li(Xo.prototype,"controlService",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=Li(Xo.prototype,"configService",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=Li(Xo.prototype,"map",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=Li(Xo.prototype,"coordinateSystemService",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=Li(Xo.prototype,"rendererService",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),av=Li(Xo.prototype,"layerService",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=Li(Xo.prototype,"debugService",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm=Li(Xo.prototype,"cameraService",[cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=Li(Xo.prototype,"interactionService",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm=Li(Xo.prototype,"pickingService",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=Li(Xo.prototype,"shaderModuleService",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv=Li(Xo.prototype,"markerService",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=Li(Xo.prototype,"popupService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo))||Gh);function O0(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var mm=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function mg(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(mm,function(n,i,a){var s=a.split(":"),l=s[0].trim(),f="";switch(s.length>1&&(f=s[1].trim()),i){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(d,_){return d.push(Number(_.trim())),d},[]):f=new Array(O0(i)).fill(0);break;default:}return t[l]=f,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function gm(e){var r=mg(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=mg(s),f=l.content,d=l.uniforms;return Object.assign(n,d),"".concat(a,`{
`).concat(f,`
};`)}),{content:t,uniforms:n}}function gg(e){var r={};return e.replace(mm,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var yg,_g,k0=hi.uniq,bg="#define PI 3.14159265359",D0=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,fc=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,Sd=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,xg=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ad=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,Eg=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,T2=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,w2=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ky=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,C2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,R2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Qy=/precision\s+(high|low|medium)p\s+float/,Jy=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,M2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,I2=/void\s+main\s*\([^)]*\)\s*\{\n?/,TF=/}\n?[^{}]*$/,P2=(yg=(0,rr.b2)(),yg(_g=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"moduleCache",{}),(0,F.Z)(this,"rawContentCache",{})}return(0,j.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:bg,fs:bg}),this.registerModule("decode",{vs:D0,fs:""}),this.registerModule("scene_uniforms",{vs:fc,fs:fc}),this.registerModule("picking_uniforms",{vs:Sd,fs:Sd}),this.registerModule("projection",{vs:Ky,fs:Ky}),this.registerModule("project",{vs:w2,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:R2}),this.registerModule("lighting",{vs:Ad,fs:""}),this.registerModule("light",{vs:xg,fs:""}),this.registerModule("picking",{vs:T2,fs:Eg}),this.registerModule("rotation_2d",{vs:C2,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,f=gm(i),d=f.content,_=f.uniforms,x=gm(a),A=x.content,C=x.uniforms;this.rawContentCache[t]={fs:A,inject:l,uniforms:(0,V.Z)((0,V.Z)((0,V.Z)({},_),C),s),vs:d}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,s=this.rawContentCache[t].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=gm(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(I2,function(Y){return Y+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var f=this.processModule(i,[],"vs"),d=f.content,_=f.includeList,x=this.processModule(a,[],"fs"),A=x.content,C=x.includeList,I="",O=k0(_.concat(C).concat(t)).reduce(function(Y,ie){return(0,V.Z)((0,V.Z)({},Y),n.rawContentCache[ie].uniforms)},(0,V.Z)({},l));Qy.test(A)||(I=I+Jy),I=I+A;var Z="";return Qy.test(d)||(Z=Z+Jy),Z=Z+d,this.moduleCache[t]={fs:I.trim(),uniforms:O,vs:Z.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,s=t.replace(M2,function(l,f){var d=f.split(" "),_=d[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var x=a.rawContentCache[_][i];n.push(_);var A=a.processModule(x,n,i),C=A.content;return C});return{content:s,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||_g);function O2(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=(0,Te.Z)(e),e!==null););return e}function Ra(){return typeof Reflect!="undefined"&&Reflect.get?Ra=Reflect.get.bind():Ra=function(r,t,n){var i=O2(r,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?r:n):a.value}},Ra.apply(this,arguments)}var cv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),e_,t_,Sg=(e_=(0,rr.b2)(),e_(t_=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"shaderModuleService",void 0),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"cameraService",void 0),(0,F.Z)(this,"mapService",void 0),(0,F.Z)(this,"interactionService",void 0),(0,F.Z)(this,"layerService",void 0),(0,F.Z)(this,"config",void 0)}return(0,j.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return cv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(it.IRendererService),this.cameraService=t.getContainer().get(it.ICameraService),this.mapService=t.getContainer().get(it.IMapService),this.interactionService=t.getContainer().get(it.IInteractionService),this.layerService=t.getContainer().get(it.ILayerService),this.shaderModuleService=t.getContainer().get(it.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||t_),r_,n_;function k2(e){var r=D2();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L2=(r_=(0,rr.b2)(),r_(n_=function(e){(0,Ne.Z)(t,e);var r=k2(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Ra((0,Te.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Sg))||n_),i_,a_,o_,L0,s_;function B2(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=F2(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function F2(e,r){if(e){if(typeof e=="string")return u_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u_(e,r)}}function u_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var N2=(i_=(0,rr.b2)(),a_=(0,rr.f3)(it.IPostProcessor),i_(o_=(L0=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"passes",[]),Ni(this,"postProcessor",s_,this),(0,F.Z)(this,"layer",void 0),(0,F.Z)(this,"renderFlag",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0)}return(0,j.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){var i,a,s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i=B2(this.passes),f.prev=1,i.s();case 3:if((a=i.n()).done){f.next=9;break}return s=a.value,f.next=7,s.render(this.layer);case 7:f.next=3;break;case 9:f.next=14;break;case 11:f.prev=11,f.t0=f.catch(1),i.e(f.t0);case 14:return f.prev=14,i.f(),f.finish(14);case 17:return f.next=19,this.postProcessor.render(this.layer);case 19:case"end":return f.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===cv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),s_=Li(L0.prototype,"postProcessor",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0))||o_),l_,c_;function U2(e){var r=z2();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=(l_=(0,rr.b2)(),l_(c_=function(e){(0,Ne.Z)(t,e);var r=U2(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"pickingFBO",void 0),(0,F.Z)((0,Me.Z)(n),"layer",void 0),(0,F.Z)((0,Me.Z)(n),"width",0),(0,F.Z)((0,Me.Z)(n),"height",0),(0,F.Z)((0,Me.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Me.Z)(n),"pickFromPickingFBO",function(l){var f=l.x,d=l.y,_=l.lngLat,x=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(x))){var A=n.rendererService,C=A.getViewportSize,I=A.readPixelsAsync,O=A.useFramebuffer,Z=C(),Y=Z.width,ie=Z.height,ge=n.layer.getLayerConfig(),Ve=ge.enableHighlight,gt=ge.enableSelect,lt=f*ma,Qe=d*ma;if(!(lt>Y||lt<0||Qe>ie||Qe<0)){var Mt;O(n.pickingFBO,(0,Ut.Z)(pe().mark(function Vt(){var Sr,mr,Xr,mn,Yn;return pe().wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:return Ma.next=2,I({x:Math.round(lt),y:Math.round(ie-(d+1)*ma),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO});case 2:Mt=Ma.sent,Mt[0]!==0||Mt[1]!==0||Mt[2]!==0?(mr=La(Mt),Xr=n.layer.getSource().getFeatureById(mr),mn={x:f,y:d,type:x,lngLat:_,featureId:mr,feature:Xr},Xr&&(n.layer.setCurrentPickId(mr),n.triggerHoverOnLayer(mn))):(Yn={x:f,y:d,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+x:"mouseout",featureId:null,feature:null},n.triggerHoverOnLayer((0,V.Z)((0,V.Z)({},Yn),{},{type:"unpick"})),n.triggerHoverOnLayer(Yn),n.layer.setCurrentPickId(null)),Ve&&n.highlightPickedFeature(Mt),gt&&x==="click"&&((Sr=Mt)===null||Sr===void 0?void 0:Sr.toString())!==[0,0,0,0].toString()&&n.selectFeature(Mt);case 6:case"end":return Ma.stop()}},Vt)})))}}}),n}return(0,j.Z)(t,[{key:"getType",value:function(){return cv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Ra((0,Te.Z)(t.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,f=s.createFramebuffer,d=s.getViewportSize,_=d(),x=_.width,A=_.height,C=l({width:x,height:A,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=f({color:C}),this.interactionService.on(c.Hover,this.pickFromPickingFBO),this.interactionService.on(c.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(c.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,f=s.useFramebuffer,d=s.clear,_=l(),x=_.width,A=_.height;this.alreadyInRendering=!0,(this.width!==x||this.height!==A)&&(this.pickingFBO.resize({width:x,height:A}),this.width=x,this.height=A),f(this.pickingFBO,function(){d({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var C=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(C),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,Cn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeHighlight.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,Cn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeSelect.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=fa(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=fa(a);this.highlightPickedFeature(new Uint8Array(s))}}]),t}(Sg))||c_),f_,h_,p_,B0,d_,V2=hi.camelCase,j2=hi.isNil,H2=hi.upperFirst,W2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xh=(f_=(0,rr.b2)(),h_=(0,rr.f3)(it.IShaderModuleService),f_(p_=(B0=function(){function e(){(0,J.Z)(this,e),Ni(this,"shaderModuleService",d_,this),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"config",void 0),(0,F.Z)(this,"quad",W2),(0,F.Z)(this,"enabled",!0),(0,F.Z)(this,"renderToScreen",!1),(0,F.Z)(this,"model",void 0),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"optionsToUpdate",{})}return(0,j.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return cv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(it.IRendererService),this.shaderModuleService=t.getContainer().get(it.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,f=this.setupShaders(),d=f.vs,_=f.fs,x=f.uniforms;this.model=l({vs:d,fs:_,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:(0,V.Z)((0,V.Z)({u_Texture:null},x),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,f=s.getViewportSize,d=s.clear,_=f(),x=_.width,A=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){d({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var C=(0,V.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[x,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(C.u_BloomFinal=1,C.u_Texture2=n),i.model.draw({uniforms:C})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,V.Z)((0,V.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){j2(t[i])||(n["u_".concat(H2(V2(i)))]=t[i])}),n}}]),e}(),d_=Li(B0.prototype,"shaderModuleService",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0))||p_),v_,m_;function G2(e){var r=X2();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Y2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,F0=hi.isNil,q2=(v_=(0,rr.b2)(),v_(m_=function(e){(0,Ne.Z)(t,e);var r=G2(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Y2,fs:$2});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return F0(i.bloomRadius)||(a.u_radius=i.bloomRadius),F0(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),F0(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Xh))||m_),g_,y_;function K2(e){var r=Q2();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,eA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tA=hi.isNil,rA=(g_=(0,rr.b2)(),g_(y_=function(e){(0,Ne.Z)(t,e);var r=K2(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:eA,fs:J2});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return tA(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Xh))||y_),__,b_;function nA(e){var r=iA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,oA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sA=hi.isNil,uA=(__=(0,rr.b2)(),__(b_=function(e){(0,Ne.Z)(t,e);var r=nA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:oA,fs:aA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return sA(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Xh))||b_),x_,E_;function lA(e){var r=cA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,hA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pA=(x_=(0,rr.b2)(),x_(E_=function(e){(0,Ne.Z)(t,e);var r=lA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:hA,fs:fA});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Xh))||E_),S_,A_;function dA(e){var r=vA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,gA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yA=(S_=(0,rr.b2)(),S_(A_=function(e){(0,Ne.Z)(t,e);var r=dA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:gA,fs:mA}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Xh))||A_),T_,w_;function _A(e){var r=bA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function bA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,EA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,SA=(T_=(0,rr.b2)(),T_(w_=function(e){(0,Ne.Z)(t,e);var r=_A(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:EA,fs:xA});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Xh))||w_),C_,R_;function AA(e){var r=TA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,CA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,RA=(C_=(0,rr.b2)(),C_(R_=function(e){(0,Ne.Z)(t,e);var r=AA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:CA,fs:wA});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,V.Z)((0,V.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Xh))||R_),M_,I_;function MA(e){var r=IA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,OA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,kA=(M_=(0,rr.b2)(),M_(I_=function(e){(0,Ne.Z)(t,e);var r=MA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:OA,fs:PA}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Xh))||I_),P_,O_;function DA(e){var r=LA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,FA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,NA=(P_=(0,rr.b2)(),P_(O_=function(e){(0,Ne.Z)(t,e);var r=DA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:BA,fs:FA}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Xh))||O_),k_,D_,L_,B_,fv,F_,UA=(k_=(0,rr.b2)(),D_=(0,rr.f3)(it.IRendererService),L_=(0,rr.zY)(),k_(B_=(fv=function(){function e(){(0,J.Z)(this,e),Ni(this,"rendererService",F_,this),(0,F.Z)(this,"passes",[]),(0,F.Z)(this,"readFBO",void 0),(0,F.Z)(this,"writeFBO",void 0)}return(0,j.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){var s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.getReadFBOTex();case 2:s=d.sent,l=0;case 4:if(!(l<4)){d.next=11;break}return d.next=7,a.render(i,s);case 7:this.swap(),l++,d.next=4;break;case 11:case"end":return d.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){var a,s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=0;case 1:if(!(a<this.passes.length)){f.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){f.next=9;break}return f.next=7,this.renderBloomPass(i,s);case 7:f.next=12;break;case 9:return f.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,f.next=1;break;case 15:case"end":return f.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),F_=Li(fv.prototype,"rendererService",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li(fv.prototype,"init",[L_],Object.getOwnPropertyDescriptor(fv.prototype,"init"),fv.prototype),fv))||B_),N_,U_;function zA(e){var r=ZA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VA=(N_=(0,rr.b2)(),N_(U_=function(e){(0,Ne.Z)(t,e);var r=zA(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getType",value:function(){return cv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Ra((0,Te.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,f=i.multiPassRenderer.getPostProcessor().getReadFBO();s(f,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:f}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(d){d.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Sg))||U_),z_,Z_,V_,N0,j_;function jA(e){var r=HA();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function HA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WA=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,H_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,GA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function W_(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var XA=1,$A=(z_=(0,rr.b2)(),Z_=(0,rr.f3)(it.IShaderModuleService),z_(V_=(N0=function(e){(0,Ne.Z)(t,e);var r=jA(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),Ni((0,Me.Z)(n),"shaderModuleService",j_,(0,Me.Z)(n)),(0,F.Z)((0,Me.Z)(n),"haltonSequence",[]),(0,F.Z)((0,Me.Z)(n),"accumulatingId",0),(0,F.Z)((0,Me.Z)(n),"frame",0),(0,F.Z)((0,Me.Z)(n),"timer",void 0),(0,F.Z)((0,Me.Z)(n),"sampleRenderTarget",void 0),(0,F.Z)((0,Me.Z)(n),"prevRenderTarget",void 0),(0,F.Z)((0,Me.Z)(n),"outputRenderTarget",void 0),(0,F.Z)((0,Me.Z)(n),"copyRenderTarget",void 0),(0,F.Z)((0,Me.Z)(n),"blendModel",void 0),(0,F.Z)((0,Me.Z)(n),"outputModel",void 0),(0,F.Z)((0,Me.Z)(n),"copyModel",void 0),n}return(0,j.Z)(t,[{key:"getType",value:function(){return cv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Ra((0,Te.Z)(t.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,f=s.createTexture2D;this.sampleRenderTarget=l({color:f({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:f({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:f({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:f({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})});for(var d=0;d<30;d++)this.haltonSequence.push([W_(d,2),W_(d,3)]);this.blendModel=this.createTriangleModel("blend-pass",WA),this.outputModel=this.createTriangleModel("copy-pass",H_,{blend:{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:G.ONE,dstAlpha:G.ONE_MINUS_SRC_ALPHA},equation:{rgb:G.FUNC_ADD,alpha:G.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",H_)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),x=_.width,A=_.height;this.sampleRenderTarget.resize({width:x,height:A}),this.prevRenderTarget.resize({width:x,height:A}),this.outputRenderTarget.resize({width:x,height:A}),this.copyRenderTarget.resize({width:x,height:A}),this.resetFrame(),this.stopAccumulating();var C=i.multiPassRenderer.getPostProcessor().getReadFBO();d(C,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:C}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function O(Z){!a.accumulatingId||Z!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){O(Z)}))};this.accumulatingId=XA++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),x=_.width,A=_.height,C=i.getLayerConfig(),I=C.jitterScale,O=I===void 0?1:I,Z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Z[0]*2-1)/x*O,(Z[1]*2-1)/A*O),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),d(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var Y=i.getLayerConfig();d(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:Y.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(d(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),d(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var ie=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ie,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:GA,fs:a});var l=this.shaderModuleService.getModule(i),f=l.vs,d=l.fs,_=l.uniforms,x=this.rendererService,A=x.createAttribute,C=x.createBuffer,I=x.createModel;return I((0,V.Z)({vs:f,fs:d,attributes:{a_Position:A({buffer:C({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:(0,V.Z)({},_),depth:{enable:!1},count:3},s))}}]),t}(Sg),j_=Li(N0.prototype,"shaderModuleService",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||V_),ym=new rr.W2;ym.bind(it.IGlobalConfigService).to(cg).inSingletonScope(),(0,rr.GW)((0,rr.b2)(),eo.EventEmitter),ym.bind(it.IEventEmitter).to(eo.EventEmitter);var G_=(0,Mi.Z)(ym,!1),U0=function(r){var t=G_.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},wF=function(r){var t=G_.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Bl=ym,YA=0;function qA(){var e=new rr.W2;return e.parent=ym,e.bind(it.SceneID).toConstantValue("".concat(YA++)),e.bind(it.IShaderModuleService).to(P2).inSingletonScope(),e.bind(it.ILayerService).to(Vi).inSingletonScope(),e.bind(it.IDebugService).to(pg).inSingletonScope(),e.bind(it.ISceneService).to(lv).inSingletonScope(),e.bind(it.ICameraService).to(Tr).inSingletonScope(),e.bind(it.ICoordinateSystemService).to(fg).inSingletonScope(),e.bind(it.IInteractionService).to(K).inSingletonScope(),e.bind(it.IPickingService).to(Bi).inSingletonScope(),e.bind(it.IControlService).to(Zo).inSingletonScope(),e.bind(it.IMarkerService).to($u).inSingletonScope(),e.bind(it.IIconService).to(_t).inSingletonScope(),e.bind(it.IFontService).to(qt).inSingletonScope(),e.bind(it.IPopupService).to(od).inSingletonScope(),e.bind(it.INormalPass).to(L2).whenTargetNamed("clear"),e.bind(it.INormalPass).to(Z2).whenTargetNamed("pixelPicking"),e.bind(it.INormalPass).to(VA).whenTargetNamed("render"),e.bind(it.INormalPass).to($A).whenTargetNamed("taa"),e.bind(it.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(it.INormalPass,t)}}),e.bind(it.IPostProcessingPass).to(yA).whenTargetNamed("copy"),e.bind(it.IPostProcessingPass).to(q2).whenTargetNamed("bloom"),e.bind(it.IPostProcessingPass).to(rA).whenTargetNamed("blurH"),e.bind(it.IPostProcessingPass).to(uA).whenTargetNamed("blurV"),e.bind(it.IPostProcessingPass).to(kA).whenTargetNamed("noise"),e.bind(it.IPostProcessingPass).to(NA).whenTargetNamed("sepia"),e.bind(it.IPostProcessingPass).to(pA).whenTargetNamed("colorHalftone"),e.bind(it.IPostProcessingPass).to(SA).whenTargetNamed("hexagonalPixelate"),e.bind(it.IPostProcessingPass).to(RA).whenTargetNamed("ink"),e.bind(it.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(it.IPostProcessingPass,t);return n.setName(t),n}}),e}function _m(e){var r=new rr.W2;return r.parent=e,r.bind(it.IStyleAttributeService).to(Nc).inSingletonScope(),r.bind(it.IMultiPassRenderer).to(N2).inSingletonScope(),r.bind(it.IPostProcessor).to(UA).inSingletonScope(),r}var KA=null;function CF(e){return KA.indexOf(e)}var X_=hi.clamp,QA=2,RF=4,JA=64,MF=128,eT=256,tT=512,IF=8192,PF=16384,OF=32768,rT=null,$_=131072,kF=262144,nT=524288,DF=1048576,iT=2097152,LF=4194304,aT=8388608,oT=16777216,sT=null;function Ag(e,r){return e=X_(Math.floor(e),0,255),r=X_(Math.floor(r),0,255),256*e+r}function BF(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,f=e.strokeWidth,d=e.strokeOpacity,_=[],x=[],A=[],C=[Ag(r[0],r[1]),Ag(r[2],r[3])],I=[Ag(l[0],l[1]),Ag(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(O){var Z=_slicedToArray(O,2),Y=Z[0],ie=Z[1];_.push([].concat(C,[(Y+1)*aT+(ie+1)*iT+getShapeIndex(a)*$_+t,(n+512)*nT+(i+512)*JA])),x.push([].concat(I,[f,d])),A.push([s,0,0,0])}),{packedBuffer:_,packedBuffer2:x,packedBuffer3:A}}function FF(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*sT+t*oT+n*$_+t*rT+n*tT+t*eT+n*QA+t}var Td={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},ks={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Ka=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),hv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Fn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),uT=["mapload","mapchange","mapAfterFrameChange"],Tg=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Iu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),lT=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f,d){n({x:t.x,y:t.y,z:t.z},function(_,x){if(_||x.length===0){d(_);return}x&&li([{data:x,bands:[0]}],i,a,function(A,C){A?d(A):C&&f(C)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),cT=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n){return pe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(f,d){if(f||!d){l(f);return}d instanceof ArrayBuffer?gu(d,function(_,x){_&&l(_),s(x)}):d instanceof HTMLImageElement?s(d):l(f)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function fT(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return v(t,r)}):e.map(function(t){return{url:v(t.url,r),bands:t.bands||[0]}}):v(e,r)}function hT(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function Y_(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var pT=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a,s){var l,f,d,_,x,A;return pe().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=hT(n.url),!(l.length>1)){I.next=15;break}return I.next=4,dT(l,n);case 4:if(f=I.sent,d=f.rasterFiles,_=f.xhrList,x=f.errList,Y_(t,_),!(x.length>0)){I.next=12;break}return i(x,null),I.abrupt("return");case 12:li(d,a,s,i),I.next=17;break;case 15:A=wi(n,function(O,Z){if(O)i(O);else if(Z){var Y=[{data:Z,bands:l[0].bands}];li(Y,a,s,i)}}),Y_(t,[A]);case 17:case"end":return I.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function dT(e,r){return z0.apply(this,arguments)}function z0(){return z0=(0,Ut.Z)(pe().mark(function e(r,t){var n,i,a,s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<r.length)){O.next=20;break}return l=r[s],f=(0,V.Z)((0,V.Z)({},t),{},{url:l.url}),d=l.bands,O.next=10,Gi((0,V.Z)((0,V.Z)({},f),{},{type:"arrayBuffer"}));case 10:_=O.sent,x=_.err,A=_.data,C=_.xhr,x&&a.push(x),i.push(C),n.push({data:A,bands:d});case 17:s++,O.next=4;break;case 20:return O.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return O.stop()}},e)})),z0.apply(this,arguments)}var vT=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a,s){var l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l={url:fT(t,n)},d.abrupt("return",new Promise(function(_,x){pT(i,l,function(A,C){A?x(A):C&&_(C)},a,s)}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}(),q_=function(){var e=(0,Ut.Z)(pe().mark(function r(t,n,i,a){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(f=(a==null?void 0:a.getURLFromTemplate)||p,s=f(l,(0,V.Z)((0,V.Z)({},n),a.wmtsOptions))):(d=(a==null?void 0:a.getURLFromTemplate)||v,s=d(l,n)),x.abrupt("return",new Promise(function(A,C){var I,O=Da({url:s,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(Z,Y){Z?C(Z):Y&&A(Y)},a.transformResponse);i.xhrCancel=function(){return O.cancel()}}));case 3:case"end":return x.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),K_=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},mT={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},NF=[Iu.ARRAYBUFFER,Iu.RGB];function gT(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function yT(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(gT(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Iu.IMAGE;t===Iu.RGB&&(t=Iu.ARRAYBUFFER);var n=function(s,l){switch(t){case Iu.IMAGE:return q_(e,s,l,r);case Iu.CUSTOMIMAGE:case Iu.CUSTOMTERRAINRGB:return cT(l,r==null?void 0:r.getCustomData);case Iu.ARRAYBUFFER:return vT(e,s,l,(r==null?void 0:r.format)||K_,r==null?void 0:r.operation);case Iu.CUSTOMARRAYBUFFER:case Iu.CUSTOMRGB:return lT(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||K_,r==null?void 0:r.operation);default:return q_(e,s,l,r)}},i=(0,V.Z)((0,V.Z)((0,V.Z)({},mT),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var _T=["extent","min","max","width","height","format","operation"];function bT(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,s=r.height,l=r.format,f=r.operation,d=(0,ji.Z)(r,_T),_;if(l===void 0||Dc(e))_=Array.from(e);else{var x=Array.isArray(e)?e:[e];_=vn(x,l,f)}var A={_id:1,dataArray:[(0,V.Z)((0,V.Z)({_id:1,data:_,width:a,height:s},d),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return A}var xT={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},ET=function(){var e=(0,Ut.Z)(pe().mark(function r(t){return pe().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,Cn.Z)(t.bounds,4),l=s[0],f=s[1],d=s[2],_=s[3],x={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+d)/2,y:(f+_)/2},geometry:{type:"LineString",coordinates:[[d,_],[d,f],[l,f],[l,f]]}}]}}};a(x)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function ST(e,r){var t=function(a){return ET(a)},n=(0,V.Z)((0,V.Z)((0,V.Z)({},xT),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var AT=["extent","width","height"];function TT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,ji.Z)(r,AT);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1,2],l=(0,Cn.Z)(s,3),f=l[0],d=l[1],_=l[2],x=[e[f],e[d],e[_]],A=[],C=(a==null?void 0:a.countCut)||[2,98],I=(0,Cn.Z)(C,2),O=I[0],Z=I[1],Y=(a==null?void 0:a.RMinMax)||kr(x[0],O,Z),ie=(a==null?void 0:a.GMinMax)||kr(x[1],O,Z),ge=(a==null?void 0:a.BMinMax)||kr(x[2],O,Z),Ve=0;Ve<x[0].length;Ve++)A.push(Math.max(0,x[0][Ve]-Y[0])),A.push(Math.max(0,x[1][Ve]-ie[0])),A.push(Math.max(0,x[2][Ve]-ge[0]));var gt={_id:1,dataArray:[(0,V.Z)((0,V.Z)({_id:1,data:A,width:n,height:i,rMinMax:Y,gMinMax:ie,bMinMax:ge},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return gt}var wT=["extent","width","height"];function CT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,ji.Z)(r,wT);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1],l=(0,Cn.Z)(s,2),f=l[0],d=l[1],_=[e[f],e[d]],x=[],A=0;A<_[0].length;A++)x.push((_[1][A]-_[0][A])/(_[1][A]+_[0][A]));var C={_id:1,dataArray:[(0,V.Z)((0,V.Z)({_id:1,data:x,width:n,height:i},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return C}var RT=B(69848),MT=B.n(RT);function Q_(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,s=r.minZoom,l=s===void 0?0:s,f=r.zoom,d=f===void 0?2:f;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(d));return e.dataArray=IT(_),e}var x=new(MT())({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(C){return{type:"Feature",geometry:{type:"Point",coordinates:C.coordinates},properties:(0,V.Z)({},C)}}),x.load(A.features),x}function IT(e){return e.map(function(r,t){return(0,V.Z)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function PT(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function OT(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function J_(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function kT(e){if(e.length===0)throw new Error("mean requires at least one data point");return J_(e)/e.length}var DT={min:OT,max:PT,mean:kT,sum:J_};function LT(e){var r=BT();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function BT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=hi.cloneDeep,e1=hi.isFunction,NT=hi.isString,UT=hi.mergeWith;function zT(e,r){if(Array.isArray(r))return r}var ZT=function(e){(0,Ne.Z)(t,e);var r=LT(t);function t(n,i){var a;return(0,J.Z)(this,t),a=r.call(this),(0,F.Z)((0,Me.Z)(a),"type","source"),(0,F.Z)((0,Me.Z)(a),"isTile",!1),(0,F.Z)((0,Me.Z)(a),"inited",!1),(0,F.Z)((0,Me.Z)(a),"hooks",{init:new zc}),(0,F.Z)((0,Me.Z)(a),"parser",{type:"geojson"}),(0,F.Z)((0,Me.Z)(a),"transforms",[]),(0,F.Z)((0,Me.Z)(a),"cluster",!1),(0,F.Z)((0,Me.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,F.Z)((0,Me.Z)(a),"invalidExtent",!1),(0,F.Z)((0,Me.Z)(a),"dataArrayChanged",!1),(0,F.Z)((0,Me.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,j.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,f=l===void 0?"sum":l,d=s.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(x){x.id||(x.properties.point_count=1)}),(d||e1(f))&&(_=_.map(function(x){var A=x.id;if(A){var C=a.clusterIndex.getLeaves(A,1/0),I=C.map(function(Y){return Y.properties}),O;if(NT(f)&&d){var Z=$f(I,d);O=DT[f](Z)}e1(f)&&(O=f(I)),x.properties.stat=O}else x.properties.point_count=1;return x})),this.data=ue("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,f=a.geometry;if(l==="geojson"&&!this.cluster){var d=i<this.originData.features.length?this.originData.features[i]:"null",_=FT(d);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var x=this.data.dataArray.find(function(A){return A._id===i});_.properties=x}return _}else return l==="json"&&f?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,V.Z)((0,V.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s=this;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(d,_){try{s.excuteParser(),s.initCluster(),s.executeTrans(),d({})}catch(x){_(x)}}));case 1:case"end":return f.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=UT(this.cfg,i,zT);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,V.Z)((0,V.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=ue(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Zu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Hf((0,V.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,f=Be(l)(i.data,s);Object.assign(i.data,f)})}},{key:"initCluster",value:function(){if(this.cluster){var i=this.clusterOptions||{};this.clusterIndex=Q_(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(a=Vu($l(this.extent),i)),a[0].concat(a[1])}}]),t}(eo.EventEmitter);function VT(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function t1(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=jT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function jT(e,r){if(e){if(typeof e=="string")return r1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r1(e,r)}}function r1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Z0=6378e3;function HT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*Z0)*(256<<20)/2,s=WT(t,i),l=s.gridHash,f=s.gridOffset,d=YT(l,f,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:d}}function WT(e,r){var t=1/0,n=-1/0,i,a=t1(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ge){a.e(ge)}finally{a.f()}var f=(t+n)/2,d=GT(r,f);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};var _={},x=t1(e),A;try{for(x.s();!(A=x.n()).done;){var C=A.value,I=C.coordinates[1],O=C.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(O)){var Z=Math.floor((I+90)/d.yOffset),Y=Math.floor((O+180)/d.xOffset),ie="".concat(Z,"-").concat(Y);_[ie]=_[ie]||{count:0,points:[]},_[ie].count+=1,_[ie].points.push(C)}}}catch(ge){x.e(ge)}finally{x.f()}return{gridHash:_,gridOffset:d}}function GT(e,r){var t=XT(e),n=$T(r,e);return{yOffset:t,xOffset:n}}function XT(e){return e/Z0*(180/Math.PI)}function $T(e,r){return r/Z0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function YT(e,r,t){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),f=parseInt(s[1],10),d={};if(t.field&&t.method){var _=zf(e[i].points,t.field);d[t.method]=wc[t.method](_)}return Object.assign(d,{_id:a,coordinates:Ga([-180+r.xOffset*(f+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(d),n},[])}var pv=Math.PI/3,qT=[0,pv,2*pv,3*pv,4*pv,5*pv];function KT(e){return e[0]}function QT(e){return e[1]}function JT(){var e=0,r=0,t=1,n=1,i=KT,a=QT,s,l,f;function d(x){var A={},C=[],I,O=x.length;for(I=0;I<O;++I)if(!(isNaN(Y=+i.call(null,Z=x[I],I,x))||isNaN(ie=+a.call(null,Z,I,x)))){var Z,Y,ie,ge=Math.round(ie=ie/f),Ve=Math.round(Y=Y/l-(ge&1)/2),gt=ie-ge;if(Math.abs(gt)*3>1){var lt=Y-Ve,Qe=Ve+(Y<Ve?-1:1)/2,Mt=ge+(ie<ge?-1:1),Vt=Y-Qe,Sr=ie-Mt;lt*lt+gt*gt>Vt*Vt+Sr*Sr&&(Ve=Qe+(ge&1?1:-1)/2,ge=Mt)}var mr=Ve+"-"+ge,Xr=A[mr];Xr?Xr.push(Z):(C.push(Xr=A[mr]=[Z]),Xr.x=(Ve+(ge&1)/2)*l,Xr.y=ge*f)}return C}function _(x){var A=0,C=0;return qT.map(function(I){var O=Math.sin(I)*x,Z=-Math.cos(I)*x,Y=O-A,ie=Z-C;return A=O,C=Z,[Y,ie]})}return d.hexagon=function(x){return"m"+_(x==null?s:+x).join("l")+"z"},d.centers=function(){for(var x=[],A=Math.round(r/f),C=Math.round(e/l),I=A*f;I<n+s;I+=f,++A)for(var O=C*l+(A&1)*l/2;O<t+l/2;O+=l)x.push([O,I]);return x},d.mesh=function(){var x=_(s).slice(0,4).join("l");return d.centers().map(function(A){return"M"+A+"m"+x}).join("")},d.x=function(x){return arguments.length?(i=x,d):i},d.y=function(x){return arguments.length?(a=x,d):a},d.radius=function(x){return arguments.length?(s=+x,l=s*2*Math.sin(pv),f=s*1.5,d):s},d.size=function(x){return arguments.length?(e=r=0,t=+x[0],n=+x[1],d):[t-e,n-r]},d.extent=function(x){return arguments.length?(e=+x[0][0],r=+x[0][1],t=+x[1][0],n=+x[1][1],d):[[e,r],[t,n]]},d.radius(1)}var ew=6378e3;function tw(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*ew)*(256<<20)/2,f=t.map(function(A){var C=Ga(A.coordinates),I=(0,Cn.Z)(C,2),O=I[0],Z=I[1];return(0,V.Z)((0,V.Z)({},A),{},{coordinates:[O,Z]})}),d=JT().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),_=d(f),x={dataArray:_.map(function(A,C){var I;if(r.field&&s){var O=zf(A,r.field);A[s]=wc[s](O)}return I={},(0,F.Z)(I,r.method,A[s]),(0,F.Z)(I,"count",A.length),(0,F.Z)(I,"rawData",A),(0,F.Z)(I,"coordinates",[A.x,A.y]),(0,F.Z)(I,"_id",C),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return x}function rw(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(s){a[s[t]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,V.Z)((0,V.Z)({},s),a[l])}),e}function nw(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}oe("rasterTile",yT),oe("mvt",an),oe("geojsonvt",Ie),oe("testTile",ST),oe("geojson",Kp),oe("jsonTile",tr),oe("image",et),oe("csv",rc),oe("json",qp),oe("raster",Fr),oe("rasterRgb",bT),oe("rgb",TT),oe("ndi",CT),se("cluster",Q_),se("filter",VT),se("join",rw),se("map",nw),se("grid",HT),se("hexagon",tw);var n1=ZT;function iw(e){var r=aw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=function(e){(0,Ne.Z)(t,e);var r=iw(t);function t(n){var i;return(0,J.Z)(this,t),i=r.call(this),(0,F.Z)((0,Me.Z)(i),"added",!1),(0,F.Z)((0,Me.Z)(i),"preLngLat",{lng:0,lat:0}),(0,F.Z)((0,Me.Z)(i),"onMarkerDragStart",function(a){var s=i.mapsService.getContainer();if(s){i.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});var l=s.getClientRects()[0],f=l.left,d=l.top,_=a.x,x=a.y;i.preLngLat=i.mapsService.containerToLngLat([_-f,x-d]),i.mapsService.on("mousemove",i.onMarkerDragMove),document.addEventListener("mouseup",i.onMarkerDragEnd),i.emit("dragstart",i.lngLat)}}),(0,F.Z)((0,Me.Z)(i),"onMarkerDragMove",function(a){var s=i.preLngLat,l=s.lng,f=s.lat,d=a.lnglat,_=d.lng,x=d.lat,A={lng:i.lngLat.lng+_-l,lat:i.lngLat.lat+x-f};i.setLnglat(A),i.preLngLat=a.lnglat,i.emit("dragging",A)}),(0,F.Z)((0,Me.Z)(i),"onMarkerDragEnd",function(a){i.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),i.mapsService.off("mousemove",i.onMarkerDragMove),document.removeEventListener("mouseup",i.onMarkerDragEnd),i.emit("dragend",i.lngLat)}),(0,F.Z)((0,Me.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,V.Z)((0,V.Z)({},i.getDefault()),n),Sh(["update","onMove","onMapClick","updatePositionWhenZoom"],(0,Me.Z)(i)),i.init(),i}return(0,j.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:_a.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(it.IMapService),this.sceneSerive=i.get(it.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Oi(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&Oi(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.updateDraggable(),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){this.markerOption.draggable=i,this.updateDraggable()}},{key:"getDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),_u(a,"".concat(Ia[s]))}}},{key:"updatePositionWhenZoom",value:function(i){if(this.mapsService){var a=this.markerOption,s=a.element,l=a.offsets,f=this.lngLat,d=f.lng,_=f.lat;if(s){s.style.display="block",s.style.whiteSpace="nowrap";var x=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=x.containerHeight,C=x.containerWidth,I=x.bounds;if(!I)return;var O=i.map,Z=i.center,Y=i.zoom,ie=O.DE(this.lngLat,Y,Z);if(ie.x=Math.round(ie.x+l[0]),ie.y=Math.round(ie.y-l[1]),Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(ie.x>C){var ge=this.mapsService.lngLatToContainer([d-360,_]);ie.x=ge.x}if(ie.x<0){var Ve=this.mapsService.lngLatToContainer([d+360,_]);ie.x=Ve.x}}(ie.x>C||ie.x<0||ie.y>A||ie.y<0)&&(s.style.display="none"),s.style.left=ie.x+"px",s.style.top=ie.y+"px",s.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updateDraggable",value:function(){var i=this.markerOption.element;i==null||i.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(i==null||i.addEventListener("mousedown",this.onMarkerDragStart))}},{key:"updatePosition",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,f=l.lng,d=l.lat,_=this.mapsService.lngLatToContainer([f,d]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var x=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=x.containerHeight,C=x.containerWidth,I=x.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>C){var O=this.mapsService.lngLatToContainer([f-360,d]);_.x=O.x}if(_.x<0){var Z=this.mapsService.lngLatToContainer([f+360,d]);_.x=Z.x}}(_.x>C||_.x<0||_.y>A||_.y<0)&&(a.style.display="none"),a.style.left=_.x+s[0]+"px",a.style.top=_.y-s[1]+"px",console.log(a.style.left)}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,f=s.anchor;if(!a){this.defaultMarker=!0,a=ta("div"),this.markerOption.element=a;var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height","48px"),d.setAttributeNS(null,"width","48px"),d.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),d.appendChild(_),a.appendChild(d)}uu(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(x){var A,C,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((C=i.markerOption)===null||C===void 0?void 0:C.style[x]);a&&(a.style[x]=I)}),Zl(a,f,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Wl()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(eo.EventEmitter);function UF(e){var r=sw();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zF=hi.merge,ZF=null,VF=B(4157);function uw(e){var r=lw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dv=function(e){(0,Ne.Z)(t,e);var r=uw(t);function t(n){var i;return(0,J.Z)(this,t),i=r.call(this),t.controlCount++,i.controlOption=(0,V.Z)((0,V.Z)({},i.getDefault(n)),n||{}),i}return(0,j.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,Cn.Z)(s,2),f=l[0],d=l[1];d===void 0&&(i[f]=a[f])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,V.Z)((0,V.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(it.IMapService),this.renderService=i.get(it.IRendererService),this.layerService=i.get(it.ILayerService),this.controlService=i.get(it.IControlService),this.configService=i.get(it.IGlobalConfigService),this.scene=i.get(it.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),uu(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Oi(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return ta("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;yu(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;uu(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:Ir.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ir.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&yu(a,s),i&&uu(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(zs());(0,F.Z)(dv,"controlCount",0);function cw(e){var r=fw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wg=function(e){(0,Ne.Z)(t,e);var r=cw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"isDisable",!1),n}return(0,j.Z)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ta("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Oi(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var f;(f=this.button)===null||f===void 0||f.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(this.button)if(yu(this.button,"l7-button-control--row"),yu(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=ta("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,uu(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Oi(this.buttonText),this.buttonText=void 0)}}]),t}(dv);function hw(e){var r=pw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i1=function(e){(0,Ne.Z)(t,e);var r=hw(t);function t(n,i){var a;return(0,J.Z)(this,t),a=r.call(this),(0,F.Z)((0,Me.Z)(a),"isShow",!1),(0,F.Z)((0,Me.Z)(a),"timeout",null),(0,F.Z)((0,Me.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),yu(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(s){s!==(0,Me.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,Me.Z)(a)}),(0,F.Z)((0,Me.Z)(a),"hide",function(){return a.isShow&&(uu(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,Me.Z)(a)}),(0,F.Z)((0,Me.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){a.isShow&&(a.hide(),a.timeout=null)},300))}),(0,F.Z)((0,Me.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,F.Z)((0,Me.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,F.Z)((0,Me.Z)(a),"onPopperUnClick",function(s){Qc(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,F.Z)((0,Me.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,F.Z)((0,Me.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push((0,Me.Z)(a)),a}return(0,j.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(Cl(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Oi(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,f=l===void 0?[0,0]:l,d=a.placement,_=(0,Cn.Z)(f,2),x=_[0],A=_[1],C=this.button.getBoundingClientRect(),I=s.getBoundingClientRect(),O=Kc(C,I),Z=O.left,Y=O.right,ie=O.top,ge=O.bottom,Ve=!1,gt=!1;/^(left|right)/.test(d)?(d.includes("left")?i.right="".concat(C.width+Y,"px"):d.includes("right")&&(i.left="".concat(C.width+Z,"px")),d.includes("start")?i.top="".concat(ie,"px"):d.includes("end")?i.bottom="".concat(ge,"px"):(i.top="".concat(ie+C.height/2,"px"),gt=!0,i.transform="translate(".concat(x,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(d)&&(d.includes("top")?i.bottom="".concat(C.height+ge,"px"):d.includes("bottom")&&(i.top="".concat(C.height+ie,"px")),d.includes("start")?i.left="".concat(Z,"px"):d.includes("end")?i.right="".concat(Y,"px"):(i.left="".concat(Z+C.width/2,"px"),Ve=!0,i.transform="translate(calc(".concat(x,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(x,"px - ").concat(Ve?"50%":"0%","), calc(").concat(A,"px - ").concat(gt?"50%":"0%",")");var lt=d.split("-");lt.length&&uu(this.popperDOM,lt.map(function(Qe){return"l7-popper-".concat(Qe)}).join(" ")),_c(this.popperDOM,Eh(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,f=i.content,d=ta("div","l7-popper l7-popper-hide ".concat(l)),_=ta("div","l7-popper-content"),x=ta("div","l7-popper-arrow");return d.appendChild(_),d.appendChild(x),a.appendChild(d),this.popperDOM=d,this.contentDOM=_,f&&this.setContent(f),d}}]),t}(eo.EventEmitter);(0,F.Z)(i1,"conflictPopperList",[]);function dw(e){var r=vw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},gw=function(e){(0,Ne.Z)(t,e);var r=dw(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Ra((0,Te.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":mw[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,f=a.popperTrigger,d=this.mapsService.getMapContainer();return this.popper=new i1(this.button,{className:s,placement:l,trigger:f,container:d,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(wg);function yw(e){var r=_w();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wd=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(wd||{}),a1=function(e){(0,Ne.Z)(t,e);var r=yw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"selectValue",[]),(0,F.Z)((0,Me.Z)(n),"createNormalOption",function(l){var f=n.selectValue.includes(l.value),d=ta("div","l7-select-control-item ".concat(f?wd.ActiveOptionClassName:""));n.getIsMultiple()?d.appendChild(n.createCheckbox(f)):d.appendChild(n.createRadio(f)),l.icon&&d.appendChild(l.icon);var _=ta("span");return _.innerText=l.text,d.appendChild(_),d}),(0,F.Z)((0,Me.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var f=n.selectValue.findIndex(function(d){return d===l.value});f>-1?n.selectValue.splice(f,1):n.selectValue=[].concat((0,er.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,j.Z)(t,[{key:"setOptions",value:function(i){Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=this.transSelectValue(i);this.optionDOMList.forEach(function(l){var f=l.getAttribute(wd.OptionValueAttrKey),d=l.querySelector("input[type=checkbox]"),_=l.querySelector("input[type=radio]"),x=s.includes(f),A=function(I,O){bh(l,wd.ActiveOptionClassName,O),I&&ba(I,O)};A(d,x),A(_,x)}),this.selectValue=s,a&&this.emit("selectChange",this.getIsMultiple()?s:s[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=ta("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&uu(l,"l7-select-control--multiple");var f=i.map(function(d,_){var x=s?a.createImageOption(d):a.createNormalOption(d);return x.setAttribute(wd.OptionValueAttrKey,d.value),x.setAttribute(wd.OptionIndexAttrKey,window.String(_)),x.addEventListener("click",a.onItemClick.bind(a,d)),x});return l.append.apply(l,(0,er.Z)(f)),this.optionDOMList=f,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=ta("div","l7-select-control-item ".concat(a?wd.ActiveOptionClassName:"")),l=ta("img");l.setAttribute("src",i.img),sp(l),s.appendChild(l);var f=ta("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var d=ta("span");return d.innerText=i.text,f.appendChild(d),s.appendChild(f),s}},{key:"createCheckbox",value:function(i){var a=ta("input");return a.setAttribute("type","checkbox"),i&&ba(a,!0),a}},{key:"createRadio",value:function(i){var a=ta("input");return a.setAttribute("type","radio"),i&&ba(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(gw),$h=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function bw(e){var r=xw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ew=function(e){(0,Ne.Z)(t,e);var r=bw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"onClick",(0,Ut.Z)(pe().mark(function l(){var f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=n.controlOption.onExport,_.t0=f==null,_.t0){_.next=8;break}return _.t1=f,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),(0,F.Z)((0,Me.Z)(n),"mergeImage",(0,Ut.Z)(pe().mark(function l(){var f,d,_,x,A,C,I,O,Z,Y,ie,ge,Ve,gt,lt=arguments;return pe().wrap(function(Mt){for(;;)switch(Mt.prev=Mt.next){case 0:for(_=n.controlOption.imageType,x=(f=(d=n.mapsService.getContainer())===null||d===void 0?void 0:d.getBoundingClientRect())!==null&&f!==void 0?f:{},A=x.width,C=A===void 0?0:A,I=x.height,O=I===void 0?0:I,Z=document.createElement("canvas"),Z.width=C,Z.height=O,Y=Z.getContext("2d"),ie=lt.length,ge=new Array(ie),Ve=0;Ve<ie;Ve++)ge[Ve]=lt[Ve];return Mt.next=9,Promise.all(ge.map(function(Vt){return new Promise(function(Sr){var mr=new Image;mr.onload=function(){Sr(mr)},mr.src=Vt})}));case 9:return gt=Mt.sent,gt.forEach(function(Vt){Y==null||Y.drawImage(Vt,0,0,C,O)}),Mt.abrupt("return",Z.toDataURL("image/".concat(_)));case 12:case"end":return Mt.stop()}},l)}))),n}return(0,j.Z)(t,[{key:"onAdd",value:function(){var i=Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:$h("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.mapsService.exportMap("png");case 2:return s=d.sent,d.next=5,this.scene.exportPng("png");case 5:return l=d.sent,d.abrupt("return",this.mergeImage.apply(this,(0,er.Z)([s,l].filter(function(_){return _}))));case 7:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(wg);function Sw(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Aw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Aw(e,r){if(e){if(typeof e=="string")return o1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o1(e,r)}}function o1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var s1=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Yh=function(){if(typeof document=="undefined")return!1;for(var e=s1[0],r={},t=0,n=s1;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var s=Sw(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var f=(0,Cn.Z)(l.value,2),d=f[0],_=f[1];r[e[d]]=_}}catch(x){s.e(x)}finally{s.f()}return r}}return!1}(),u1={change:Yh.fullscreenchange,error:Yh.fullscreenerror},hc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){hc.off("change",l),n()};hc.on("change",a);var s=r[Yh.requestFullscreen](t);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!hc.isFullscreen){r();return}var n=function a(){hc.off("change",a),r()};hc.on("change",n);var i=document[Yh.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return hc.isFullscreen?hc.exit():hc.request(r,t)},onchange:function(r){hc.on("change",r)},onerror:function(r){hc.on("error",r)},on:function(r,t){var n=u1[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=u1[r];n&&document.removeEventListener(n,t,!1)},raw:Yh};Object.defineProperties(hc,{isFullscreen:{get:function(){return!!document[Yh.fullscreenElement]}},element:{enumerable:!0,get:function(){var r;return(r=document[Yh.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[Yh.fullscreenEnabled]}}}),Yh||(hc={isEnabled:!1});var V0=hc;function Tw(e){var r=ww();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cw=function(e){(0,Ne.Z)(t,e);var r=Tw(t);function t(n){var i;return(0,J.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Me.Z)(i),"isFullscreen",!1),(0,F.Z)((0,Me.Z)(i),"toggleFullscreen",(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!V0.isEnabled){l.next=3;break}return l.next=3,V0.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,F.Z)((0,Me.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,F.Z)((0,Me.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,f=a.title,d=a.exitBtnText,_=a.exitBtnIcon,x=a.exitTitle;i.isFullscreen?(i.setBtnTitle(x),i.setBtnText(d),i.setBtnIcon(_)):(i.setBtnTitle(f),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),V0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,j.Z)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Bs(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){Ra((0,Te.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:$h("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:$h("l7-icon-exit-fullscreen")})}}]),t}(wg);function Rw(e){var r=Mw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iw=function(e){(0,Ne.Z)(t,e);var r=Rw(t);function t(n){var i;return(0,J.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Me.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var f=l.coords,d=f!=null?f:{},_=d.longitude,x=d.latitude;!isNaN(_)&&!isNaN(x)?a([_,x]):s()},function(l){s(l)})})}),(0,F.Z)((0,Me.Z)(i),"onClick",(0,Ut.Z)(pe().mark(function a(){var s,l,f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return s=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,f=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=f>15?f:15,!s){_.next=15;break}return _.next=12,s(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:$h("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(wg);function Pw(e){var r=Ow();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function l1(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var c1=function(e){(0,Ne.Z)(t,e);var r=Pw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,F.Z)((0,Me.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,F.Z)((0,Me.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var f=n.selectValue.includes(l.name),d=l.isVisible();f&&!d&&l.show(),!f&&d&&l.hide()})}),n}return(0,j.Z)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(l1(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var f=i.getLayer(l)||i.getLayerByName(l);f&&s.push(f)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){var a;return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:$h("l7-icon-layer"),options:[],multiple:(a=i==null?void 0:i.multiple)!==null&&a!==void 0?a:!0})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(l1(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var f=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:f==null?void 0:f.name,value:f==null?void 0:f.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers","multiple"]);Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i),a&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelection",value:function(){this.layers.forEach(function(i,a){a===0?i.show():i.hide()})}},{key:"onAdd",value:function(){var i;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),t}(a1);function kw(e){var r=Dw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f1=function(e){(0,Ne.Z)(t,e);var r=kw(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefault",value:function(){return{position:Ir.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=ta("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(Cl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,f=ta("img");if(f.setAttribute("src",l),f.setAttribute("aria-label","AntV logo"),sp(f),s){var d=ta("a","l7-control-logo-link");d.target="_blank",d.href=s,d.rel="noopener nofollow",d.setAttribute("rel","noopener nofollow"),d.appendChild(f),i.appendChild(d)}else i.appendChild(f)}}]),t}(dv),Lw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},Bw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function Fw(e){var r=Nw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=function(e){(0,Ne.Z)(t,e);var r=Fw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:$h("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?Bw:Lw;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,Cn.Z)(a,2),l=s[0],f=s[1];return typeof f=="string"&&l!=="blank"}).map(function(a){var s,l=(0,Cn.Z)(a,2),f=l[0],d=l[1],_=(s=i[f])!==null&&s!==void 0?s:{},x=_.text,A=_.img;return{text:x!=null?x:f,value:d,img:A,key:f}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,f=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(_){return _.key===f}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:f}else{var d=this.getMapStyle();d?this.controlOption.defaultValue=d:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),Ra((0,Te.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(a1);function zw(e){var r=Zw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vw=function(e){(0,Ne.Z)(t,e);var r=zw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"location",[0,0]),(0,F.Z)((0,Me.Z)(n),"onMouseMove",function(l){var f=n.location,d=l.lngLat||l.lnglat,_=n.controlOption.transform;d&&(f=[d.lng,d.lat]),n.location=f,_&&(f=_(f)),n.insertLocation2HTML(f),n.emit("locationChange",f)}),n}return(0,j.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:Ir.BOTTOMLEFT,transform:function(s){var l=(0,Cn.Z)(s,2),f=l[0],d=l[1];return[+(+f).toFixed(6),+(+d).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=ta("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(dv);function jw(e){var r=Hw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ww=function(e){(0,Ne.Z)(t,e);var r=jw(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"update",function(){var l=n.mapsService,f=n.controlOption.maxWidth,d=l.getSize()[1]/2,_=l.containerToLngLat([0,d]),x=l.containerToLngLat([f,d]),A=Xl([_.lng,_.lat],[x.lng,x.lat]);n.updateScales(A)}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:Ir.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=ta("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){Cl(i);var a=this.controlOption,s=a.metric,l=a.imperial,f=a.maxWidth,d=a.lockWidth;d&&_c(i,"width: ".concat(f,"px")),s&&(this.mScale=ta("div","l7-control-scale-line",i)),l&&(this.iScale=ta("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,f;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(f=this.getRoundNum(a),this.updateScale(this.iScale,f+" ft",f/a))}}]),t}(dv),kp,h1=(kp={},(0,F.Z)(kp,pf.additive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(kp,pf.none,{enable:!1}),(0,F.Z)(kp,pf.normal,{enable:!0,func:{srcRGB:G.SRC_ALPHA,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(kp,pf.subtractive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:G.ZERO,dstAlpha:G.ONE_MINUS_SRC_COLOR},equation:{rgb:G.FUNC_SUBTRACT,alpha:G.FUNC_SUBTRACT}}),(0,F.Z)(kp,pf.max,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MAX_EXT}}),(0,F.Z)(kp,pf.min,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MIN_EXT}}),kp);function p1(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function d1(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),p1(r).forEach(function(l){var f=(0,Cn.Z)(l,2),d=f[0],_=f[1];i.add(t(d),_)}),i.add(t("copy")),i}var Gw=function(){function e(r){(0,J.Z)(this,e),this.layer=r}return(0,j.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(it.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){var s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=this.layer.getContainer(),l=s.get(it.IPickingService),i.type!=="RasterLayer"){d.next=4;break}return d.abrupt("return",this.pickRasterLayer(i,a));case 4:return this.pickRender(a),d.abrupt("return",l.pickFromPickingFBO(i,a));case 6:case"end":return d.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),s=a.get(it.IPickingService),l=a.get(it.IMapService),f=this.layer.getSource().extent,d=Rl(n.lngLat,f),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},x=i||t;if(d){var A=this.readRasterValue(t,f,l,n.x,n.y);return _.rasterValue=A,s.triggerHoverOnLayer(x,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(x,(0,V.Z)((0,V.Z)({},_),{},{type:"unpick"})),s.triggerHoverOnLayer(x,_),!1}},{key:"readRasterValue",value:function(t,n,i,a,s){var l=t.getSource().data.dataArray[0],f=(0,Cn.Z)(n,4),d=f[0],_=d===void 0?0:d,x=f[1],A=x===void 0?0:x,C=f[2],I=C===void 0?10:C,O=f[3],Z=O===void 0?-10:O,Y=i.lngLatToContainer([_,A]),ie=i.lngLatToContainer([I,Z]),ge=ie.x-Y.x,Ve=Y.y-ie.y,gt=[(a-Y.x)/ge,(s-ie.y)/Ve],lt=l.width||1,Qe=l.height||1,Mt=Math.floor(gt[0]*lt),Vt=Math.floor(gt[1]*Qe),Sr=Math.max(0,Vt-1)*lt+Mt,mr=l.data[Sr];return mr}},{key:"selectFeature",value:function(t){var n=this.layer,i=(0,Cn.Z)(t,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,Cn.Z)(t,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),Xw=function(){function e(r){(0,J.Z)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(it.IRendererService)}return(0,j.Z)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1,unorm:!0});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return us(t);case"quantize":return Qo(t);case"custom":return Lu(t,n);case"linear":return ga(t,n);default:return Ho(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),$w=["passes"],Yw=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"],v1,j0,m1;function qw(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Kw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Kw(e,r){if(e){if(typeof e=="string")return g1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g1(e,r)}}function g1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Qw(e){var r=Jw();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H0=hi.isEqual,y1=hi.isFunction,_1=hi.isNumber,Pu=hi.isObject,eC=hi.isPlainObject,tC=hi.isUndefined,b1=0,Dp=(v1=U0(it.IGlobalConfigService),j0=function(e){(0,Ne.Z)(t,e);var r=Qw(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,J.Z)(this,t),n=r.call(this),(0,F.Z)((0,Me.Z)(n),"id","".concat(b1++)),(0,F.Z)((0,Me.Z)(n),"name","".concat(b1)),(0,F.Z)((0,Me.Z)(n),"visible",!0),(0,F.Z)((0,Me.Z)(n),"zIndex",0),(0,F.Z)((0,Me.Z)(n),"inited",!1),(0,F.Z)((0,Me.Z)(n),"layerModelNeedUpdate",!1),(0,F.Z)((0,Me.Z)(n),"pickedFeatureID",null),(0,F.Z)((0,Me.Z)(n),"selectedFeatureID",null),(0,F.Z)((0,Me.Z)(n),"styleNeedUpdate",!1),(0,F.Z)((0,Me.Z)(n),"forceRender",!1),(0,F.Z)((0,Me.Z)(n),"clusterZoom",0),(0,F.Z)((0,Me.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,F.Z)((0,Me.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,F.Z)((0,Me.Z)(n),"hooks",{init:new Jd,afterInit:new _d,beforeRender:new _d,beforeRenderData:new bd,afterRender:new zc,beforePickingEncode:new zc,afterPickingEncode:new zc,beforeHighlight:new zc(["pickedColor"]),afterHighlight:new zc,beforeSelect:new zc(["pickedColor"]),afterSelect:new zc,beforeDestroy:new zc,afterDestroy:new zc}),(0,F.Z)((0,Me.Z)(n),"models",[]),(0,F.Z)((0,Me.Z)(n),"startInit",!1),(0,F.Z)((0,Me.Z)(n),"layerChildren",[]),(0,F.Z)((0,Me.Z)(n),"masks",[]),Ni((0,Me.Z)(n),"configService",m1,(0,Me.Z)(n)),(0,F.Z)((0,Me.Z)(n),"animateOptions",{enable:!1}),(0,F.Z)((0,Me.Z)(n),"currentPickId",null),(0,F.Z)((0,Me.Z)(n),"encodeStyleAttribute",{}),(0,F.Z)((0,Me.Z)(n),"enableShaderEncodeStyles",[]),(0,F.Z)((0,Me.Z)(n),"enableDataEncodeStyles",[]),(0,F.Z)((0,Me.Z)(n),"pendingStyleAttributes",[]),(0,F.Z)((0,Me.Z)(n),"scaleOptions",{}),(0,F.Z)((0,Me.Z)(n),"animateStatus",!1),(0,F.Z)((0,Me.Z)(n),"isDestroyed",!1),(0,F.Z)((0,Me.Z)(n),"uniformBuffers",[]),(0,F.Z)((0,Me.Z)(n),"encodeDataLength",0),(0,F.Z)((0,Me.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,j.Z)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,V.Z)((0,V.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(it.SceneID);this.configService.setLayerConfig(s,this.id,(0,V.Z)((0,V.Z)((0,V.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s=this,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:l=this.container.get(it.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(it.IIconService),this.fontService=this.container.get(it.IFontService),this.rendererService=this.container.get(it.IRendererService),this.layerService=this.container.get(it.ILayerService),this.debugService=this.container.get(it.IDebugService),this.interactionService=this.container.get(it.IInteractionService),this.pickingService=this.container.get(it.IPickingService),this.mapService=this.container.get(it.IMapService),f=this.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,d&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(it.ICameraService),this.coordinateService=this.container.get(it.ICoordinateSystemService),this.shaderModuleService=this.container.get(it.IShaderModuleService),this.postProcessingPassFactory=this.container.get(it.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(it.IFactoryNormalPass),this.styleAttributeService=this.container.get(it.IStyleAttributeService),d&&(this.multiPassRenderer=this.container.get(it.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(Z){var Y=Z.attributeName,ie=Z.attributeField,ge=Z.attributeValues,Ve=Z.updateOptions;s.styleAttributeService.updateStyleAttribute(Y,{scale:(0,V.Z)({field:ie},s.splitValuesAndCallbackInAttribute(ge,ie?void 0:s.getLayerConfig()[Y]))},Ve)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(it.ILayerPlugin),x=qw(this.plugins);try{for(x.s();!(A=x.n()).done;)C=A.value,C.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(Z){x.e(Z)}finally{x.f()}return this.layerPickService=new Gw(this),this.textureService=new Xw(this),this.log(ks.LayerInitStart),O.next=31,this.hooks.init.promise();case 31:this.log(ks.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),f={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,f)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Pu(i)?(a.enable=!0,a=(0,V.Z)((0,V.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(ks.SourceInitStart,ns.UPDATE),this.layerSource.setData(i,a),this.log(ks.SourceInitEnd,ns.UPDATE)):this.on("inited",function(){s.log(ks.SourceInitStart,ns.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new n1(i,a)),s.layerSource.once("update",function(){s.log(ks.SourceInitEnd,ns.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,ji.Z)(i,$w);s&&p1(s).forEach(function(d){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(d[0]);_&&_.updateOptions(d[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var f=l;return Object.keys(l).forEach(function(d){var _=l[d];Array.isArray(_)&&_.length===2&&!_1(_[0])&&!_1(_[1])&&(f[d]={field:_[0],value:_[1]})}),this.encodeStyle(f),this.updateLayerConfig(f),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,er.Z)(a.enableShaderEncodeStyles),(0,er.Z)(a.enableDataEncodeStyles)).includes(s)&&eC(i[s])&&(i[s].field||i[s].value)&&!H0(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,V.Z)({},this.scaleOptions);if(Pu(i)?this.scaleOptions=(0,V.Z)((0,V.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!H0(s,this.scaleOptions)){var l=Pu(i)?i:(0,F.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Pu(i)?!0:i,Pu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Pu(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({highlightColor:Pu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Pu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Pu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Pu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(fa(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Pu(i)?!0:i,Pu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Pu(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({selectColor:Pu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Pu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Pu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Pu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(fa(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,f=l===void 0?-1/0:l,d=a.maxZoom,_=d===void 0?1/0:d;return!!s&&i>=f&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,f=l===void 0?[]:l;this.multiPassRenderer=d1(this,f,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var d=this.rendererService.getViewportSize(),_=d.width,x=d.height;this.multiPassRenderer.resize(_,x)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(f){return Math.abs(f)===1/0});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,f,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),x=_.maskfence;x&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(d),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var f=l.type;if(a.coordCenter===void 0){var d,_=a.layerSource.center;a.coordCenter=_,(d=a.mapService)!==null&&d!==void 0&&d.setCoordCenter&&a.mapService.setCoordCenter(_)}if(f==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,f=this.styleAttributeService.getLayerStyleAttribute(i),d=(f==null||(a=f.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=d[0].option)===null||s===void 0?void 0:s.type,field:f==null||(l=f.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(d){return(0,F.Z)({value:a.invertExtent(d)},i,d)});return s}else if(a.ticks){var l=a.ticks().map(function(d){return(0,F.Z)({value:d},i,a(d))});return l}else if(a!=null&&a.domain){var f=a.domain().filter(function(d){return!tC(d)}).map(function(d){return(0,F.Z)({value:d},i,a(d))});return f}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l=this,f,d,_,x,A,C,I,O,Z,Y,ie,ge,Ve,gt;return pe().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return f=s.moduleName,d=s.vertexShader,_=s.fragmentShader,x=s.inject,A=s.triangulation,C=s.styleOption,I=s.pickingEnabled,O=I===void 0?!0:I,Z=(0,ji.Z)(s,Yw),this.shaderModuleService.registerModule(f,{vs:d,fs:_,inject:x}),Y=this.shaderModuleService.getModule(f),ie=Y.vs,ge=Y.fs,Ve=Y.uniforms,gt=this.rendererService.createModel,Qe.abrupt("return",new Promise(function(Mt){var Vt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,C),Sr=Vt.attributes,mr=Vt.elements,Xr=Vt.count,mn=[].concat((0,er.Z)(l.layerModel.uniformBuffers),(0,er.Z)(l.rendererService.uniformBuffers),[l.getLayerUniformBuffer()]);O&&mn.push(l.getPickingUniformBuffer());var Yn=(0,V.Z)({attributes:Sr,uniforms:Ve,fs:ge,vs:ie,elements:mr,blend:h1[pf.normal],uniformBuffers:mn,textures:l.layerModel.textures},Z);Xr&&(Yn.count=Xr);var Ji=gt(Yn);Mt(Ji)}));case 5:case"end":return Qe.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,f=a.enableSelect,d=f===void 0?!0:f,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&d&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.render();case 2:case"end":return f.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a),textures:i.layerModel.textures},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var f=this.configService.getAttributeConfig(this.id)||{};return H0(f[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,F.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,V.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.models.forEach(function(_){return _.destroy()}),this.models=[],this.uniformBuffers.forEach(function(_){_.destroy()}),this.uniformBuffers=[],s=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(s),l=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(l),d.next=10,this.layerModel.initModels();case 10:this.models=d.sent;case 11:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:y1(i)?void 0:i,callback:y1(i)?i:void 0}}}]),t}(eo.EventEmitter),m1=Li(j0.prototype,"configService",[v1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0);function rC(e,r){return{enable:e,mask:255,func:{cmp:G.EQUAL,ref:r?1:0,mask:1}}}function x1(e){return e.maskOperation===sd.OR?{enable:!0,mask:255,func:{cmp:G.ALWAYS,ref:1,mask:255},opFront:{fail:G.KEEP,zfail:G.REPLACE,zpass:G.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Jf.SINGLE||e.stencilIndex===0?G.ALWAYS:G.LESS,ref:e.stencilType===Jf.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:G.KEEP,zfail:G.REPLACE,zpass:G.REPLACE}}}var qn=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function nC(e){switch(e){case"rotation":return{name:"Rotation",type:Fn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:qn.ROTATION,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Fn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:qn.STROKE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Fn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:qn.OPACITY,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Fn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:qn.EXTRUSION_BASE,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Fn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:qn.OFFSETS,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Fn.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var iC={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},Cg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function jF(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function E1(e){return Math.max(Math.ceil(e/4)*4,4)}var S1,W0,A1,G0={opacity:qn.OPACITY,stroke:qn.STROKE,offsets:qn.OFFSETS,rotation:qn.ROTATION,extrusionBase:qn.EXTRUSION_BASE,thetaOffset:15},Va=(S1=U0(it.IGlobalConfigService),W0=function(){function e(r){(0,J.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"textures",[]),(0,F.Z)(this,"preStyleAttribute",{}),(0,F.Z)(this,"encodeStyleAttribute",{}),Ni(this,"configService",A1,this),this.layer=r,this.rendererService=r.getContainer().get(it.IRendererService),this.pickingService=r.getContainer().get(it.IPickingService),this.shaderModuleService=r.getContainer().get(it.IShaderModuleService),this.styleAttributeService=r.getContainer().get(it.IStyleAttributeService),this.mapService=r.getContainer().get(it.IMapService),this.iconService=r.getContainer().get(it.IIconService),this.fontService=r.getContainer().get(it.IFontService),this.cameraService=r.getContainer().get(it.ICameraService),this.layerService=r.getContainer().get(it.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return(0,j.Z)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return h1[pf[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,f=n.enableMask,d=n.maskOperation,_=d===void 0?sd.AND:d;if(this.layer.type==="MaskLayer")return x1({isStencil:!0,stencilType:Jf.SINGLE});if(t.isStencil)return x1((0,V.Z)((0,V.Z)({},t),{},{maskOperation:_}));var x=a||f&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return rC(x,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var i=(0,V.Z)((0,V.Z)({},n.uniformsOption),t.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){return pe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){return pe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){return pe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(Cg[l]," u_").concat(l,";"));var f=G0[l];!f&&l==="THETA_OFFSET"&&(f=15),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(G0[l],") in ").concat(Cg[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(Cg[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(Cg[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],s=typeof a=="undefined"?iC[i]:a;i==="stroke"&&(s=_i(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=nC(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=G0[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(E1(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),n.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(E1(n.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,er.Z)(a)),n+=a.length):typeof a=="number"?(i.push(a),n+=1):typeof a=="boolean"&&(i.push(Number(a)),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t,n,i=this.getUniformsBufferInfo(this.getStyleAttribute()),a=i.uniformsArray,s=this.getCommonUniformsInfo(),l=s.uniformsArray;(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)}),(n=this.commonUnifoms)===null||n===void 0||n.subData({offset:0,data:new Uint8Array(new Float32Array(l).buffer)})}}]),e}(),A1=Li(W0.prototype,"configService",[S1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0),T1=100,HF=36,WF=40;function w1(e){return e/180*Math.acos(-1)}function C1(e){var r=w1(e[0])+Math.PI/2,t=w1(e[1]),n=T1+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),s=n*Math.sin(t);return[a,s,i]}function GF(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var s=typeof r.segments!="undefined"?r.segments:32,l=2+s,f=2*l,d=[],_=[],x=[],A=[],C=[],I=[],O=0;O<=l;O++){for(var Z=O/l,Y=Z*Math.PI,ie=0;ie<=f;ie++){var ge=ie/f,Ve=ge*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Y),mat4.identity(t),mat4.rotateY(t,t,Ve),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,t),vec3.scale(a,a,-e),x.push(a.slice()),A.push.apply(A,_toConsumableArray(a.slice())),vec3.normalize(a,a),C.push.apply(C,_toConsumableArray(a.slice())),I.push([ge,1-Z]),A.push(ge,1-Z)}if(O>0)for(var gt=x.length,lt=gt-2*(f+1);lt+f+2<gt;lt++)d.push([lt,lt+1,lt+f+1]),_.push(lt,lt+1,lt+f+1),d.push([lt+f+1,lt+1,lt+f+2]),_.push(lt+f+1,lt+1,lt+f+2)}return{cells:d,positions:x,uvs:I,positionsArr:A,indicesArr:_,normalArr:C}}var Rg=Br.Ue(),XF=Br.Ue(),Ws=Br.Ue(),Lp=Br.Ue(),vv=Br.Ue();function X0(e,r,t,n,i){Br.IH(e,t,n),Br.Fv(e,e),r=Br.al(-e[1],e[0]);var a=Br.al(-t[1],t[0]);return[i/Br.AK(r,a),r]}function Bp(e,r){return Br.t8(e,-r[1],r[0])}function mv(e,r,t){return Br.lu(e,r,t),Br.Fv(e,e),e}function $0(e,r){return e[0]===r[0]&&e[1]===r[1]}function $F(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var aC=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,J.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Br.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],O=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.simpleSegment(i,s,x,C,O,A,I,Z);s+=Y}if(this.dash)for(var ie=0;ie<i.positions.length/6;ie++)i.positions[ie*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],O=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,Y=this.segment_gaode2(i,s,x,C,O,A,I,Z);s+=Y}if(this.dash)for(var ie=0;ie<i.positions.length/6;ie++)i.positions[ie*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=Ga([a[0],a[1]]),A=Ga([i[0],i[1]]);mv(Ws,x,A);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,A),this.totalDistance+=C),this.normal||(this.normal=Br.Ue(),Bp(this.normal,Ws)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-C)),f.push(n+0,n+1,n+2),!s)Bp(this.normal,Ws),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ga([s[0],s[1]]);$0(x,I)&&Br.IH(I,x,Br.Fv(I,Br.$X(I,x,A))),mv(Lp,I,x);var O=X0(vv,Br.Ue(),Ws,Lp,this.thickness),Z=(0,Cn.Z)(O,2),Y=Z[0],ie=Z[1],ge=Br.AK(vv,this.normal)<0?-1:1;this.extrusions(d,_,a,ie,Y,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ge=-1,Br.JG(this.normal,ie),l+=2,this.lastFlip=ge}return l}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var _=0,x=t.indices,A=t.positions,C=t.normals,I=this.cap==="square",O=this.join==="bevel",Z=Ga([f[0],f[1]]),Y=Ga([l[0],l[1]]);mv(Ws,a,i);var ie=0;if(this.dash&&(ie=this.lineSegmentDistance(Z,Y),this.totalDistance+=ie),this.normal||(this.normal=Br.Ue(),Bp(this.normal,Ws)),!this.started)if(this.started=!0,I){var ge=Br.Ue(),Ve=Br.Ue();Br.IH(ge,this.normal,Ws),Br.IH(Ve,this.normal,Ws),C.push(Ve[0],Ve[1],0),C.push(ge[0],ge[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-ie,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-ie,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,i,this.normal,this.thickness,this.totalDistance-ie);if(x.push(n+0,n+1,n+2),s){$0(a,s)&&Br.IH(s,a,Br.Fv(s,Br.$X(s,a,i))),mv(Lp,s,a);var Qe=X0(vv,Br.Ue(),Ws,Lp,this.thickness),Mt=(0,Cn.Z)(Qe,2),Vt=Mt[0],Sr=Mt[1],mr=Br.AK(vv,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var mn=Vt;mn>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(Sr[0],Sr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,(0,er.Z)(this.lastFlip!==-mr?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),Bp(Rg,Lp),Br.JG(this.normal,Rg),C.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,C,a,Sr,Vt,this.totalDistance),x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),mr=-1,Br.JG(this.normal,Sr),_+=2),this.lastFlip=mr}else{if(Bp(this.normal,Ws),I){var gt=Br.Ue(),lt=Br.Ue();Br.lu(lt,Ws,this.normal),Br.IH(gt,Ws,this.normal),C.push(lt[0],lt[1],0),C.push(gt[0],gt[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",C=Ga([a[0],a[1]]),I=Ga([i[0],i[1]]);mv(Ws,C,I);var O=0;if(this.dash&&(O=this.lineSegmentDistance(C,I),this.totalDistance+=O),this.normal||(this.normal=Br.Ue(),Bp(this.normal,Ws)),!this.started)if(this.started=!0,x){var Z=Br.Ue(),Y=Br.Ue();Br.IH(Z,this.normal,Ws),Br.IH(Y,this.normal,Ws),_.push(Y[0],Y[1],0),_.push(Z[0],Z[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-O,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-O,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-O);if(f.push(n+0,n+1,n+2),s){var Ve=Ga([s[0],s[1]]);$0(C,Ve)&&Br.IH(Ve,C,Br.Fv(Ve,Br.$X(Ve,C,I))),mv(Lp,Ve,C);var gt=X0(vv,Br.Ue(),Ws,Lp,this.thickness),lt=(0,Cn.Z)(gt,2),Qe=lt[0],Mt=lt[1],Vt=Br.AK(vv,this.normal)<0?-1:1,Sr=A;if(!Sr&&this.join==="miter"){var mr=Qe;mr>this.miterLimit&&(Sr=!0)}Sr?(_.push(this.normal[0],this.normal[1],0),_.push(Mt[0],Mt[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,er.Z)(this.lastFlip!==-Vt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Bp(Rg,Lp),Br.JG(this.normal,Rg),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Vt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,Mt,Qe,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Vt=-1,Br.JG(this.normal,Mt),l+=2),this.lastFlip=Vt}else{if(Bp(this.normal,Ws),x){var ie=Br.Ue(),ge=Br.Ue();Br.lu(ge,Ws,this.normal),Br.IH(ie,Ws,this.normal),_.push(ge[0],ge[1],0),_.push(ie[0],ie[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}(),Fa=B(77160);function oC(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Bo().flatten(e),a=i.vertices,s=i.dimensions,l=[],f=[],d=0;d<a.length/s;d++)s===2?l.push(a[d*2],a[d*2+1],1):l.push(a[d*3],a[d*3+1],1);var _=Bo()(i.vertices,i.holes,i.dimensions);f.push.apply(f,(0,er.Z)(_));for(var x=function(){var I=i.vertices.slice(A*s,(A+1)*s),O=i.vertices.slice((A+1)*s,(A+2)*s);O.length===0&&(O=i.vertices.slice(0,s));var Z=l.length/3;l.push(I[0],I[1],1,O[0],O[1],1,I[0],I[1],0,O[0],O[1],0),f.push.apply(f,(0,er.Z)([0,2,1,2,3,1].map(function(Y){return Y+Z})))},A=0;A<n;A++)x();return{positions:l,index:f}}function sC(e){var r=Bo().flatten(e),t=Bo()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function R1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Bo().flatten(e),s=a.vertices,l=a.dimensions,f=[],d=[],_=[],x=0;x<s.length/l;x++)f.push(s[x*l],s[x*l+1],1,-1,-1),_.push(0,0,1);var A=Bo()(a.vertices,a.holes,a.dimensions);d.push.apply(d,(0,er.Z)(A));for(var C=function(){var Z=a.vertices.slice(I*l,(I+1)*l),Y=a.vertices.slice((I+1)*l,(I+2)*l);Y.length===0&&(Y=a.vertices.slice(0,l));var ie=f.length/5;f.push(Z[0],Z[1],1,0,0,Y[0],Y[1],1,.1,0,Z[0],Z[1],0,0,.8,Y[0],Y[1],0,.1,.8);var ge=uC([Y[0],Y[1],1],[Z[0],Z[1],0],[Z[0],Z[1],1],r);_.push.apply(_,(0,er.Z)(ge).concat((0,er.Z)(ge),(0,er.Z)(ge),(0,er.Z)(ge))),d.push.apply(d,(0,er.Z)([1,2,0,3,2,1].map(function(Ve){return Ve+ie})))},I=0;I<i;I++)C();return{positions:f,index:d,normals:_}}function uC(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=Fa.create(),a=Fa.create(),s=Fa.create();n&&(e=Th(e),r=Th(r),t=Th(t));var l=Fa.fromValues.apply(Fa,(0,er.Z)(e)),f=Fa.fromValues.apply(Fa,(0,er.Z)(r)),d=Fa.fromValues.apply(Fa,(0,er.Z)(t));Fa.sub(i,d,f),Fa.sub(a,l,f),Fa.cross(s,i,a);var _=Fa.create();return Fa.normalize(_,s),_}var Hc,bm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),xm=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Em(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),f=Math.cos(s+Math.PI/4);return[l,f,0]});return a}function Y0(){return Em(30)}function M1(){return Em(4)}function I1(){return Em(3)}function P1(){return Em(6,1)}function O1(){return Em(5)}var gv=(Hc={},(0,F.Z)(Hc,xm.CIRCLE,Y0),(0,F.Z)(Hc,xm.HEXAGON,P1),(0,F.Z)(Hc,xm.TRIANGLE,I1),(0,F.Z)(Hc,xm.SQUARE,M1),(0,F.Z)(Hc,xm.PENTAGON,O1),(0,F.Z)(Hc,bm.CYLINDER,Y0),(0,F.Z)(Hc,bm.HEXAGONCOLUMN,P1),(0,F.Z)(Hc,bm.TRIANGLECOLUMN,I1),(0,F.Z)(Hc,bm.SQUARECOLUMN,M1),(0,F.Z)(Hc,bm.PENTAGONCOLUMN,O1),Hc),Mg={};function Ig(e){var r=qs(e.coordinates);return{vertices:[].concat((0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function k1(e){var r=qs(e.coordinates),t=C1(r);return{vertices:[].concat((0,er.Z)(t),(0,er.Z)(t),(0,er.Z)(t),(0,er.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function q0(e){var r=e.shape,t=mC(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function lC(e){var r=qs(e.coordinates);return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}function cC(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new aC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function YF(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r),[1,0,0],_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function fC(e){var r=e.coordinates,t=e.originCoordinates,n=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=hC(r,t),a=i.results,s=i.totalDistance;return a.map(function(l){n.push(l[0],l[1],l[2],l[3],0,s)}),{vertices:n,indices:[],normals:[],size:6,count:a.length}}function qF(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=pC(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function D1(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function yv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function hC(e,r){var t=e,n=r||e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat(),n=r.flat());var i=0;if(t.length<2)return{results:t,totalDistance:0};var a=[],s=yv(t[0],i);a.push(s);for(var l=1;l<t.length-1;l++){var f=D1(Ga(n[l-1]),Ga(n[l]));i+=f;var d=yv(t[l],i);a.push(d),a.push(d)}var _=D1(Ga(n[n.length-2]),Ga(n[n.length-1]));return i+=_,a.push(yv(t[t.length-1],i)),{results:a,totalDistance:i}}function pC(e){if(e.length<2)return{results:e};var r=[],t=yv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=yv(e[n]);r.push(i),r.push(i)}return r.push(yv(e[e.length-1])),{results:r}}function K0(e){var r=e.coordinates,t=Bo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Bo()(n,a,i),vertices:n,size:i}}function dC(e){var r=e.coordinates,t=Bo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Bo()(n,a,i),vertices:vC(n),size:i+4}}function vC(e){for(var r=[],t=hp(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];r.push.apply(r,[s,l,0].concat((0,er.Z)(n),[i]))}return r}function Q0(e){var r=e.coordinates,t=R1(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function L1(e){var r=e.shape,t=yC(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function Pg(e){var r=e.coordinates,t=[].concat((0,er.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,er.Z)(r[1]),[0,1,0],(0,er.Z)(r[0]),[0,0,1],(0,er.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function J0(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],s=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&s.push.apply(s,(0,er.Z)([0,1,2,1,3,2].map(function(x){return _*2+x})))},f=0;f<n;f++)l(f);return{vertices:a,indices:s,size:7}}function B1(e){var r=e.coordinates;r.length===2&&r.push(0);var t=Og(-1,1),n=Og(1,1),i=Og(-1,-1),a=Og(1,-1),s=[].concat((0,er.Z)(r),(0,er.Z)(t),(0,er.Z)(r),(0,er.Z)(i),(0,er.Z)(r),(0,er.Z)(a),(0,er.Z)(r),(0,er.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function mC(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Mg&&Mg[e])return Mg[e];var t=gv[e]?gv[e]():gv.cylinder(),n=R1([t],r);return Mg[e]=n,n}function KF(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,s,l,f=vec3.create(),d=vec3.create(),_=vec3.create(),x=0,A=r.length;x<A;x+=3){a=r[x+0]*3,s=r[x+1]*3,l=r[x+2]*3;var C=[e[a],e[a+1]],I=[e[s],e[s+1]],O=[e[l],e[l+1]];n&&(C=lngLatToMeters(C),I=lngLatToMeters(I),O=lngLatToMeters(O));var Z=C,Y=_slicedToArray(Z,2),ie=Y[0],ge=Y[1],Ve=vec3.fromValues(ie,ge,e[a+2]),gt=I,lt=_slicedToArray(gt,2),Qe=lt[0],Mt=lt[1],Vt=vec3.fromValues(Qe,Mt,e[s+2]),Sr=O,mr=_slicedToArray(Sr,2),Xr=mr[0],mn=mr[1],Yn=vec3.fromValues(Xr,mn,e[l+2]);vec3.sub(f,Yn,Vt),vec3.sub(d,Ve,Vt),vec3.cross(_,f,d),i[a]+=f[0],i[a+1]+=f[1],i[a+2]+=f[2],i[s]+=f[0],i[s+1]+=f[1],i[s+2]+=f[2],i[l]+=f[0],i[l+1]+=f[1],i[l+2]+=f[2]}return gC(i),i}function gC(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function QF(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function yC(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=gv[e]?gv[e]():gv.circle(),n=r.indexOf(e)===-1?sC([t]):oC([t]);return n}function Og(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function JF(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function eN(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function _C(e){var r=bC();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,EC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,SC=function(e){(0,Ne.Z)(t,e);var r=_C(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,f=l===void 0?"rgb(16,16,16)":l,d=i.brightColor,_=d===void 0?"rgb(255,176,38)":d,x=i.windowColor,A=x===void 0?"rgb(30,60,89)":x,C=i.time,I=C===void 0?0:C,O=i.sweep,Z=O===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:O,Y={u_baseColor:_i(f),u_brightColor:_i(_),u_windowColor:_i(A),u_circleSweepColor:[].concat((0,er.Z)(_i(Z.sweepColor).slice(0,3)),[1]),u_cityCenter:Z.sweepCenter||this.cityCenter,u_circleSweep:Z.enable?1:0,u_cityMinSize:this.cityMinSize*Z.sweepRadius,u_circleSweepSpeed:Z.sweepSpeed,u_opacity:s,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||I},ie=this.getUniformsBufferInfo(Y);return ie}},{key:"calCityGeo",value:function(){var i=(0,Cn.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],f=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(f+s)/2]);var d=this.mapService.lngLatToCoord([l,f]),_=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(d[0]-_[0],2)+Math.pow(d[1]-_[1],2))/4}else{var x=l-a,A=f-s;this.cityCenter=[(l+a)/2,(f+s)/2],this.cityMinSize=Math.sqrt(Math.pow(x,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:EC,fragmentShader:xC,triangulation:Q0,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:G.BACK}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Va);function AC(e){var r=TC();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=function(e){(0,Ne.Z)(t,e);var r=AC(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","CityBuildingLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new SC(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Dp);function CC(e){var r=RC();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,IC=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,PC=function(e){(0,Ne.Z)(t,e);var r=CC(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:IC,fragmentShader:MC,triangulation:L1,primitive:G.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Va);function OC(e){var r=kC();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,LC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  setPickingColor(a_PickingColor);
}
`,BC=function(e){(0,Ne.Z)(t,e);var r=OC(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:LC,fragmentShader:DC,triangulation:q0,primitive:G.TRIANGLES,depth:{enable:!0}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{shaderLocation:qn.SIZE,name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Va),tN=B(83557);function FC(e,r){for(var t=[],n=[],i=[],a=e+1,s=r+1,l=e/2,f=r/2,d=0;d<s;d++)for(var _=d-f,x=0;x<a;x++){var A=x-l;n.push(A/l,-_/f,0),i.push(x/e),i.push(1-d/r)}for(var C=0;C<r;C++)for(var I=0;I<e;I++){var O=I+a*C,Z=I+a*(C+1),Y=I+1+a*(C+1),ie=I+1+a*C;t.push(O,Z,ie),t.push(Z,Y,ie)}return{vertices:n,indices:t,uvs:i}}var F1,N1;function NC(e){var r=UC();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ZC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,VC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,jC=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,HC=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,WC=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"
#pragma include "picking"

void main(){
    vec3 picking_color_placeholder = u_PickingColor;

    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,GC=hi.isEqual,U1=(F1=(0,rr.b2)(),F1(N1=function(e){(0,Ne.Z)(t,e);var r=NC(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"colorModelUniformBuffer",[]),(0,F.Z)((0,Me.Z)(n),"heat3DModelUniformBuffer",[]),n}return(0,j.Z)(t,[{key:"prerender",value:function(){var i=this,a=this.rendererService,s=a.clear,l=a.useFramebuffer;l(this.heatmapFramerBuffer,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()})}},{key:"render",value:function(i){var a=this.layer.getLayerConfig(),s=a.rampColors;GC(this.preRampColors,s)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C,I,O;return pe().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return l=this.rendererService,f=l.createFramebuffer,d=l.getViewportSize,_=l.createTexture2D,x=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(x==null||(s=x.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=A,Y.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=Y.sent,this.colorModel=A==="heatmap"?this.buildHeatmap():this.build3dHeatMap(),C=d(),I=C.width,O=C.height,this.heatmapTexture=_({width:Math.floor(I/4),height:Math.floor(O/4),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR,usage:He.RENDER_TARGET}),this.heatmapFramerBuffer=f({color:this.heatmapTexture,depth:!0,width:Math.floor(I/4),height:Math.floor(O/4)}),this.updateColorTexture(),Y.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return Y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Fn.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=B1,f.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:WC,fragmentShader:HC,triangulation:B1,depth:{enable:!1},cull:{enable:!0,face:sa(this.mapService.version)}});case 4:return s=f.sent,f.abrupt("return",s);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:jC,fs:VC}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService,d=f.createAttribute,_=f.createElements,x=f.createBuffer,A=f.createModel;return A({vs:a,fs:s,uniformBuffers:[].concat((0,er.Z)(this.colorModelUniformBuffer),(0,er.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:d({shaderLocation:qn.POSITION,buffer:x({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:G.FLOAT}),size:3}),a_Uv:d({shaderLocation:qn.UV,buffer:x({data:[0,1,1,1,0,0,1,0],type:G.FLOAT}),size:2})},uniforms:(0,V.Z)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:G.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.intensity,l=s===void 0?10:s,f=a.radius,d=f===void 0?5:f,_={u_radius:d,u_intensity:l};this.uniformBuffers[0].subData({offset:0,data:[d,l]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:_,blend:{enable:!0,func:{srcRGB:G.ONE,srcAlpha:1,dstRGB:G.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},_=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[f]}),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:d,textures:_,blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d=Lt.create();Lt.invert(d,this.cameraService.getViewProjectionMatrixUncentered());var _={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,er.Z)(d)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,er.Z)(_.u_ViewProjectionMatrixUncentered),(0,er.Z)(_.u_InverseViewProjectionMatrix),[f])});var x=[this.heatmapTexture,this.colorTexture];(a=this.colorModel)===null||a===void 0||a.draw({uniforms:_,textures:x,blend:{enable:!0,func:{srcRGB:G.SRC_ALPHA,srcAlpha:1,dstRGB:G.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,f=FC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:ZC,fs:zC}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];var d=this.shaderModuleService.getModule("heatmap3dColor"),_=d.vs,x=d.fs,A=d.uniforms,C=this.rendererService,I=C.createAttribute,O=C.createElements,Z=C.createBuffer,Y=C.createModel;return Y({vs:_,fs:x,attributes:{a_Position:I({shaderLocation:qn.POSITION,buffer:Z({data:f.vertices,type:G.FLOAT}),size:3}),a_Uv:I({shaderLocation:qn.UV,buffer:Z({data:f.uvs,type:G.FLOAT}),size:2})},primitive:G.TRIANGLES,uniformBuffers:[].concat((0,er.Z)(this.heat3DModelUniformBuffer),(0,er.Z)(this.rendererService.uniformBuffers)),uniforms:(0,V.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:G.SRC_ALPHA,srcAlpha:1,dstRGB:G.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:O({data:f.indices,type:G.UNSIGNED_INT,count:f.indices.length})})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=Ho(s);this.colorTexture=i({data:l.data,usage:He.SAMPLED,width:l.width,height:l.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=s}}]),t}(Va))||N1);function XC(e){var r=$C();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,qC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,KC=function(e){(0,Ne.Z)(t,e);var r=XC(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:qC,fragmentShader:YC,triangulation:L1,depth:{enable:!1},primitive:G.TRIANGLES});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Va),QC={heatmap:U1,heatmap3d:U1,grid:PC,grid3d:BC,hexagon:KC},JC=QC;function z1(e,r){return{type:e.type,field:"value",items:e.positions.map(function(t,n){var i;return i={},(0,F.Z)(i,r,n>=e.colors.length?null:e.colors[n]),(0,F.Z)(i,"value",t),i})}}function e3(e){var r=t3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function t3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r3=function(e){(0,Ne.Z)(t,e);var r=e3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","HeatMapLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new JC[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"prerender",value:function(){var i=this.getModelType();i==="heatmap"&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,f=this.getSource(),d=f.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":d==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":d==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}},{key:"getLegend",value:function(i){if(this.getModelType()==="heatmap"){if(i!=="color")return{type:void 0,field:void 0,items:[]};var a=this.getLayerConfig().rampColors;return z1(a,i)}else return Ra((0,Te.Z)(t.prototype),"getLegend",this).call(this,i)}}]),t}(Dp);function n3(e){var r=i3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a3=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,o3=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,s3=function(e){(0,Ne.Z)(t,e);var r=n3(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.brightness,l=i.contrast,f=i.saturation,d=i.gamma,_={u_opacity:dl(a,1),u_brightness:dl(s,1),u_contrast:dl(l,1),u_saturation:dl(f,1),u_gamma:dl(d,1)};this.textures=[this.texture];var x=this.getUniformsBufferInfo(_);return x}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"loadTexture",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=this.rendererService.createTexture2D,this.texture=s({height:1,width:1}),l=this.layer.getSource(),_.next=5,l.data.images;case 5:f=_.sent,this.texture=s({data:f[0],width:f[0].width,height:f[0].height,mag:G.LINEAR,min:G.LINEAR});case 7:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:o3,fragmentShader:a3,triangulation:Pg,primitive:G.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Va),u3={image:s3},l3=u3;function c3(e){var r=f3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function f3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z1=function(e){(0,Ne.Z)(t,e);var r=c3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","ImageLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new l3[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Dp);function h3(e){var r=p3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v3=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,m3=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,g3={solid:0,dash:1},rN=hi.isNumber,y3=function(e){(0,Ne.Z)(t,e);var r=h3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.forward,I=C===void 0?!0:C,O=i.lineTexture,Z=O===void 0?!1:O,Y=i.iconStep,ie=Y===void 0?100:Y,ge=i.segmentNumber,Ve=ge===void 0?30:ge,gt=this.layer.getLayerConfig(),lt=gt.animateOption,Qe=A;_!=="dash"&&(Qe=[0,0]),Qe.length===2&&Qe.push(0,0);var Mt=0,Vt=[0,0,0,0],Sr=[0,0,0,0];a&&s&&(Vt=_i(a),Sr=_i(s),Mt=1),this.rendererService.getDirty()&&this.texture.bind();var mr={u_animate:this.animateOption2Array(lt),u_dash_array:Qe,u_sourceColor:Vt,u_targetColor:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:Ve,u_lineDir:I?1:-1,u_icon_step:ie,u_line_texture:Z?1:0,u_textureBlend:f==="normal"?0:1,u_blur:.9,u_line_type:g3[_||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:Mt},Xr=this.getUniformsBufferInfo(mr);return Xr}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:v3,vert:m3,type:""}}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return this.initUniformsBuffer(),s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,O.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:J0,depth:{enable:!1},styleOption:{segmentNumber:f}});case 5:return C=O.sent,O.abrupt("return",[C]);case 7:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va);function _3(e){var r=b3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function b3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,E3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,S3={solid:0,dash:1},V1=function(e){(0,Ne.Z)(t,e);var r=_3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,O=i.iconStep,Z=O===void 0?100:O,Y=i.segmentNumber,ie=Y===void 0?30:Y,ge=i.globalArcHeight,Ve=ge===void 0?10:ge,gt=this.layer.getLayerConfig(),lt=gt.animateOption;A.length===2&&A.push(0,0);var Qe=0,Mt=[0,0,0,0],Vt=[0,0,0,0];a&&s&&(Mt=_i(a),Vt=_i(s),Qe=1),this.rendererService.getDirty()&&this.texture.bind();var Sr={u_animate:this.animateOption2Array(lt),u_dash_array:A,u_sourceColor:Mt,u_targetColor:Vt,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:T1,u_global_height:Ve,segmentNumber:ie,u_line_type:S3[_]||0,u_icon_step:Z,u_line_texture:I?1:0,u_textureBlend:f==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:Qe},mr=this.getUniformsBufferInfo(Sr);return mr}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:x3,vert:E3,type:""}}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,O.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:J0,styleOption:{segmentNumber:f}});case 4:return C=O.sent,O.abrupt("return",[C]);case 6:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va),j1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},Fl=1/2;function A3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,Fl*e,1*e*n,-(a+Fl)*e,1*e*n,(a-Fl)*e,0,Fl*e,1*e*n,-(a+Fl)*e,1*e*n,(a-Fl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function T3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function w3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function C3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function R3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function M3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,s=Y0(),l=Bo().flatten([s]),f=Bo()(l.vertices,l.holes,l.dimensions),d=s.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat((0,er.Z)(d),(0,er.Z)(d)),dimensions:2,indices:f.map(function(_){return _+s.length}),outLineIndices:f,normals:[].concat((0,er.Z)(s.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),(0,er.Z)(new Array(s.length*3).fill(0)))}}function I3(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=(0,Mr.Z)(t.source)==="object"?t.source.type:t.source,i=(0,Mr.Z)(t.target)==="object"?t.target.type:t.target,a=(0,Mr.Z)(t.source)==="object"?t.source:{},s=a.width,l=s===void 0?n?j1[n]:0:s,f=a.height,d=f===void 0?2:f,_=(0,Mr.Z)(t.target)==="object"?t.target:{},x=_.width,A=x===void 0?i?j1[i]:0:x,C=_.height,I=C===void 0?2:C;return{vertices:[0,Fl,1*l].concat((0,er.Z)(e),[1,Fl,-1*A],(0,er.Z)(e),[1,-Fl,-1*A],(0,er.Z)(e),[0,-Fl,1*l],(0,er.Z)(e),[0,Fl,1*l],(0,er.Z)(e),[1,Fl,-1*A],(0,er.Z)(e),[1,-Fl,-1*A],(0,er.Z)(e),[0,-Fl,1*l],(0,er.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(O){return O+r}),indices:[4,5,6,4,6,7].map(function(O){return O+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function H1(e,r){var t=(0,Mr.Z)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=(0,Mr.Z)(e)==="object"?e:{};switch(t){case"circle":return M3(n,i);case"triangle":return T3(n,i);case"diamond":return C3(n,i);case"rect":return w3(n,i);case"classic":return R3(n,i);case"halfTriangle":return A3(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function P3(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat((0,er.Z)(r),[1,2,-3],(0,er.Z)(r),[1,1,-3],(0,er.Z)(r),[0,1,0],(0,er.Z)(r),[0,0,0],(0,er.Z)(r),[1,0,0],(0,er.Z)(r),[1,2,-3],(0,er.Z)(r),[1,1,-3],(0,er.Z)(r),[0,1,0],(0,er.Z)(r),[0,0,0],(0,er.Z)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function O3(e,r){return r?k3(e,r):P3(e)}function k3(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,f=W1(H1(l,"source"),t,0,0),d=I3(t,f.vertices.length/7,r),_=W1(H1(a,"target"),t,1,f.vertices.length/7+d.vertices.length/7),x={vertices:[].concat((0,er.Z)(f.vertices),(0,er.Z)(d.vertices),(0,er.Z)(_.vertices)),indices:[].concat((0,er.Z)(f.outLineIndices),(0,er.Z)(d.outLineIndices),(0,er.Z)(_.outLineIndices),(0,er.Z)(f.indices),(0,er.Z)(d.indices),(0,er.Z)(_.indices)),normals:[].concat((0,er.Z)(f.normals),(0,er.Z)(d.normals),(0,er.Z)(_.normals)),size:7};return x}function W1(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,f=e.outLineIndices,d=0;d<a.length;d+=l)i.push.apply(i,[t,a[d+1],a[d]].concat((0,er.Z)(r)));return(0,V.Z)((0,V.Z)({},e),{},{vertices:i,indices:s.map(function(_){return _+n}),outLineIndices:f.map(function(_){return _+n})})}function D3(e){var r=L3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function L3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B3=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,F3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,N3=function(e){(0,Ne.Z)(t,e);var r=D3(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,f=l===void 0?1:l,d=i.strokeOpacity,_=d===void 0?1:d,x={u_gap_width:s,u_stroke_width:f,u_stroke_opacity:_},A=this.getUniformsBufferInfo(x);return A}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:F3,fragmentShader:B3,inject:this.getInject(),triangulation:O3,styleOption:this.layer.getLayerConfig().symbol,primitive:G.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}})}}]),t}(Va);function U3(e){var r=z3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,V3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,j3={solid:0,dash:1},H3=function(e){(0,Ne.Z)(t,e);var r=U3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,O=i.iconStep,Z=O===void 0?100:O,Y=i.segmentNumber,ie=Y===void 0?30:Y,ge=this.layer.getLayerConfig(),Ve=ge.animateOption;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gt=0,lt=[0,0,0,0],Qe=[0,0,0,0];a&&s&&(lt=_i(a),Qe=_i(s),gt=1);var Mt=this.layer.getLayerAnimateTime();isNaN(Mt)&&(Mt=0);var Vt={u_animate:this.animateOption2Array(Ve),u_dash_array:A,u_sourceColor:lt,u_targetColor:Qe,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:ie,u_line_type:j3[_]||0,u_icon_step:Z,u_line_texture:I?1:0,u_textureBlend:f==="normal"?0:1,u_time:Mt,u_linearColor:gt},Sr=this.getUniformsBufferInfo(Vt);return Sr}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,x.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:V3,fragmentShader:Z3,triangulation:J0,styleOption:{segmentNumber:f},inject:this.getInject(),depth:{enable:!1}});case 3:return d=x.sent,x.abrupt("return",[d]);case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Fn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va),nN=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),G1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),W3=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),ey=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),iN=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function G3(e){var r=X3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function X3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $3=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,Y3=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in vec3 a_DistanceAndIndexAndMiter;
layout(location = 13) in vec4 a_Normal_Total_Distance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};


out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,aN={solid:0,dash:1},X1=function(e){(0,Ne.Z)(t,e);var r=G3(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"textureEventFlag",!1),(0,F.Z)((0,Me.Z)(n),"texture",n.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.textures.length===0&&(n.textures=[n.texture]),n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5,0,0]:x,C=i.lineTexture,I=C===void 0?!1:C,O=i.iconStep,Z=O===void 0?100:O,Y=i.vertexHeightScale,ie=Y===void 0?20:Y,ge=i.strokeWidth,Ve=ge===void 0?0:ge,gt=i.raisingHeight,lt=gt===void 0?0:gt,Qe=i.heightfixed,Mt=Qe===void 0?!1:Qe,Vt=i.linearDir,Sr=Vt===void 0?G1.VERTICAL:Vt,mr=i.blur,Xr=mr===void 0?[1,1,1,0]:mr,mn=A;_!=="dash"&&(mn=[0,0,0,0]),mn.length===2&&mn.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Yn=this.layer.getLayerConfig(),Ji=Yn.animateOption,Ma=0,Ko=[0,0,0,0],Vo=[0,0,0,0];a&&s&&(Ko=_i(a),Vo=_i(s),Ma=1);var $s={u_animate:this.animateOption2Array(Ji),u_dash_array:mn,u_blur:Xr,u_sourceColor:Ko,u_targetColor:Vo,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:Z,u_heightfixed:Number(Mt),u_vertexScale:ie,u_raisingHeight:Number(lt),u_strokeWidth:Ve,u_textureBlend:f===W3.NORMAL?0:1,u_line_texture:I?1:0,u_linearDir:Sr===G1.VERTICAL?1:0,u_linearColor:Ma,u_time:this.layer.getLayerAnimateTime()||0},bl=this.getUniformsBufferInfo($s);return bl}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,this.layer.triangulation=Wf,O.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:x,fragmentShader:_,triangulation:Wf,inject:this.getInject(),depth:{enable:f}});case 5:return C=O.sent,O.abrupt("return",[C]);case 7:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:$3,vert:Y3,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Fn.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,l,f,d,_,x){return x===void 0?[f[3],10,f[4]]:[f[3],x,f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Fn.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,l,f,d,_){return[].concat((0,er.Z)(_),[f[5]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va);function q3(e){var r=K3();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q3=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,J3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,oN=hi.isNumber,eR=function(e){(0,Ne.Z)(t,e);var r=q3(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType,f=l===void 0?"solid":l,d=i.dashArray,_=d===void 0?[10,5,0,0]:d,x=i.vertexHeightScale,A=x===void 0?20:x,C=_;f!=="dash"&&(C=[0,0,0,0]),C.length===2&&C.push(0,0);var I=0,O=[0,0,0,0],Z=[0,0,0,0];a&&s&&(O=_i(a),Z=_i(s),I=1);var Y={u_sourceColor:O,u_targetColor:Z,u_dash_array:C,u_vertexScale:A,u_linearColor:I},ie=this.getUniformsBufferInfo(Y);return ie}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:Q3,vert:J3,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.initUniformsBuffer(),s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,triangulation:fC,inject:this.getInject(),primitive:G.LINES,depth:{enable:!1},pick:!1});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Fn.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:qn.SIZE,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(a,s,l){var f=a.size,d=f===void 0?1:f,_=Array.isArray(d)?[d[0],d[1]]:[d,0];return[_[0],_[1],l[3],l[5]]}}})}}]),t}(Va);function tR(e){var r=rR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function rR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nR=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,iR=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,aR=function(e){(0,Ne.Z)(t,e);var r=tR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.heightfixed,_=d===void 0?!1:d,x=i.lineTexture,A=x===void 0?!1:x,C=i.iconStep,I=C===void 0?100:C,O=i.iconStepCount,Z=O===void 0?1:O,Y=this.layer.getLayerConfig(),ie=Y.animateOption;this.rendererService.getDirty()&&this.texture.bind();var ge=0,Ve=[0,0,0,0],gt=[0,0,0,0];a&&s&&(Ve=_i(a),gt=_i(s),ge=1);var lt={u_animate:this.animateOption2Array(ie),u_sourceColor:Ve,u_targetColor:gt,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:I,u_heightfixed:Number(_),u_linearColor:ge,u_line_texture:A?1:0,u_textureBlend:f==="normal"?0:1,u_iconStepCount:Z,u_time:this.layer.getLayerAnimateTime()||0},Qe=this.getUniformsBufferInfo(lt);return Qe}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:iR,fragmentShader:nR,triangulation:cC,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Fn.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,l,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Fn.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,l,f,d,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Fn.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va),oR={arc:y3,arc3d:V1,greatcircle:H3,wall:aR,line:X1,simple:eR,flowline:N3,earthArc3d:V1},sR=oR;function uR(e){var r=lR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function lR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=function(e){(0,Ne.Z)(t,e);var r=uR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","LineLayer"),(0,F.Z)((0,Me.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,F.Z)((0,Me.Z)(n),"arrowInsertCount",0),(0,F.Z)((0,Me.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new sR[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,V.Z)({},s);s.coordinates.map(function(f){a.push((0,V.Z)((0,V.Z)({},l),{},{coordinates:f}))})}else a.push(s)}),a}}]),t}(Dp);function cR(e){var r=fR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function fR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hR=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,pR=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function $1(e){var r=e.coordinates;return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}var dR=function(e){(0,Ne.Z)(t,e);var r=cR(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.strokeOpacity,l=s===void 0?1:s,f=i.strokeWidth,d=f===void 0?0:f,_=i.stroke,x=_===void 0?"#fff":_,A={u_stroke_color:_i(x),u_additive:a==="additive"?1:0,u_stroke_opacity:l,u_stroke_width:d},C=this.getUniformsBufferInfo(A);return C}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=$1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:pR,fragmentShader:hR,inject:this.getInject(),triangulation:$1,depth:{enable:!1},primitive:G.POINTS});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Va);function vR(e){var r=mR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function mR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gR=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,yR=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,_R=hi.isNumber,bR=function(e){(0,Ne.Z)(t,e);var r=vR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"raiseCount",0),(0,F.Z)((0,Me.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,f=l===void 0?1:l,d=i.sourceColor,_=i.targetColor,x=i.pickLight,A=x===void 0?!1:x,C=i.heightfixed,I=C===void 0?!0:C,O=i.opacityLinear,Z=O===void 0?{enable:!1,dir:"up"}:O,Y=i.lightEnable,ie=Y===void 0?!0:Y,ge=0,Ve=[0,0,0,0],gt=[0,0,0,0];if(d&&_&&(Ve=_i(d),gt=_i(_),ge=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var lt=s.speed,Qe=lt===void 0?.01:lt;this.raiseCount+=Qe,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var Mt={u_sourceColor:Ve,u_targetColor:gt,u_linearColor:ge,u_pickLight:Number(A),u_heightfixed:Number(I),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:_R(f)?f:1,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(ie)},Vt=this.getUniformsBufferInfo(Mt);return Vt}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,f=l===void 0?1:l,this.raiseRepeat=f,x.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:yR,fragmentShader:gR,triangulation:q0,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)},blend:this.getBlend()});case 4:return d=x.sent,x.abrupt("return",[d]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Fn.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=qs(a.coordinates);return C1([s[0],s[1]])}}})}}]),t}(Va);function xR(e){var r=ER();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function ER(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SR=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,AR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`,TR=function(e){(0,Ne.Z)(t,e);var r=xR(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,_=i.blur,x=_===void 0?0:_;this.layer.getLayerConfig();var A={u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:f,u_blur:x},C=this.getUniformsBufferInfo(A);return C}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=k1,f.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:AR,fragmentShader:SR,triangulation:k1,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,l,f,d){var _=(0,Cn.Z)(f,3),x=_[0],A=_[1],C=_[2],I=Fa.fromValues(0,0,1),O=Fa.fromValues(x,0,C),Z=x>=0?Fa.angle(I,O):Math.PI*2-Fa.angle(I,O),Y=Math.PI*2-Math.asin(A/100),ie=Lt.create();Lt.rotateY(ie,ie,Z),Lt.rotateX(ie,ie,Y);var ge=Fa.fromValues(1,1,0);Fa.transformMat4(ge,ge,ie),Fa.normalize(ge,ge);var Ve=Fa.fromValues(-1,1,0);Fa.transformMat4(Ve,Ve,ie),Fa.normalize(Ve,Ve);var gt=Fa.fromValues(-1,-1,0);Fa.transformMat4(gt,gt,ie),Fa.normalize(gt,gt);var lt=Fa.fromValues(1,-1,0);Fa.transformMat4(lt,lt,ie),Fa.normalize(lt,lt);var Qe=[].concat((0,er.Z)(ge),(0,er.Z)(Ve),(0,er.Z)(gt),(0,er.Z)(lt)),Mt=d%4*3;return[Qe[Mt],Qe[Mt+1],Qe[Mt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",shaderLocation:qn.SHAPE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.layer.getLayerConfig().shape2d,_=d.indexOf(f);return[_]}}})}}]),t}(Va);function wR(e){var r=CR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function CR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RR=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,MR=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,Y1=function(e){(0,Ne.Z)(t,e);var r=wR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"raiseCount",0),(0,F.Z)((0,Me.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,f=i.targetColor,d=i.pickLight,_=d===void 0?!1:d,x=i.heightfixed,A=x===void 0?!1:x,C=i.opacityLinear,I=C===void 0?{enable:!1,dir:"up"}:C,O=i.lightEnable,Z=O===void 0?!0:O,Y=0,ie=[0,0,0,0],ge=[0,0,0,0];if(l&&f&&(ie=_i(l),ge=_i(f),Y=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Ve=s.speed,gt=Ve===void 0?.01:Ve;this.raiseCount+=gt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var lt={u_pickLight:Number(_),u_heightfixed:Number(A),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:Y,u_sourceColor:ie,u_targetColor:ge,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(Z)},Qe=this.getUniformsBufferInfo(lt);return Qe}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!0:l,d=s.animateOption.repeat,_=d===void 0?1:d,this.raiseRepeat=_,this.initUniformsBuffer(),C.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:MR,fragmentShader:RR,triangulation:q0,inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)},depth:{enable:f}});case 5:return x=C.sent,C.abrupt("return",[x]);case 7:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a){var s=qs(a.coordinates);return[s[0],s[1],0]}}})}}]),t}(Va);function IR(e){var r=PR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function PR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OR=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,kR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,q1=function(e){(0,Ne.Z)(t,e);var r=IR(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,_=i.blur,x=_===void 0?0:_,A=i.raisingHeight,C=A===void 0?0:A,I=i.heightfixed,O=I===void 0?!1:I,Z=i.unit,Y=Z===void 0?"pixel":Z,ie=this.getAnimateUniforms().u_time;isNaN(ie)&&(ie=-1);var ge={u_blur_height_fixed:[x,Number(C),Number(O)],u_stroke_width:f,u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_size_unit:ey[Y],u_time:ie,u_animate:this.getAnimateUniforms().u_animate},Ve=this.getUniformsBufferInfo(ge);return Ve}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vp)}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,f=l===void 0?{enable:!1}:l,d=this.getShaders(f),_=d.frag,x=d.vert,A=d.type,this.layer.triangulation=vp,this.initUniformsBuffer(),O.next=6,this.layer.buildLayerModel({moduleName:A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:vp,depth:{enable:!1}});case 6:return C=O.sent,O.abrupt("return",[C]);case 8:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){return{frag:OR,vert:kR,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=d%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Fn.Attribute,descriptor:{name:"a_Shape",shaderLocation:qn.SHAPE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.indexOf(f);return[d]}}})}}]),t}(Va);function DR(e){var r=LR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function LR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BR=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,FR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,NR=function(e){(0,Ne.Z)(t,e);var r=DR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"meter2coord",1),(0,F.Z)((0,Me.Z)(n),"isMeter",!1),(0,F.Z)((0,Me.Z)(n),"radian",0),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d=i.unit,_=d===void 0?"pixel":d;this.rendererService.getDirty()&&this.texture.bind();var x={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(f),u_raisingHeight:Number(s),u_size_unit:ey[_]},A=this.getUniformsBufferInfo(x);return A}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ig)}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:FR,fragmentShader:BR,triangulation:Ig,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,x=d.y;return[_,x]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=d%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}})}}]),t}(Va);function UR(e){var r=zR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function zR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZR=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,VR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,K1=function(e){(0,Ne.Z)(t,e);var r=UR(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(s),u_heightfixed:Number(f),u_texture:this.texture};this.textures=[this.texture];var _=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:VR,fragmentShader:ZR,triangulation:lC,inject:this.getInject(),depth:{enable:!1},primitive:G.POINTS});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Va);function jR(e){var r=HR();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function HR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WR=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,GR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function Q1(e){var r=e.coordinates;return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}var J1=function(e){(0,Ne.Z)(t,e);var r=jR(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i={u_size_scale:.5},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=Q1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:GR,fragmentShader:WR,triangulation:Q1,inject:this.getInject(),depth:{enable:!1},primitive:G.POINTS,pick:!1});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Va);function XR(e){var r=$R();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function $R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YR=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,qR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,KR=function(e){(0,Ne.Z)(t,e);var r=XR(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.speed,l=s===void 0?1:s,f=i.unit,d=f===void 0?"pixel":f,_={u_additive:a==="additive"?1:0,u_size_unit:ey[d],u_speed:l,u_time:this.layer.getLayerAnimateTime()},x=this.getUniformsBufferInfo(_);return x}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ig)}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:qR,fragmentShader:YR,triangulation:Ig,inject:this.getInject(),depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Fn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f){var d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=f%4*3;return[d[_],d[_+1],d[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{shaderLocation:qn.SIZE,name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?5:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Va);function QR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=JR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function JR(e,r){if(e){if(typeof e=="string")return eb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return eb(e,r)}}function eb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var eM=function(){function e(r,t,n){(0,J.Z)(this,e),(0,F.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,j.Z)(e,[{key:"insert",value:function(t,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!1,s)}},{key:"hitTest",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(t,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,s,l){if(i<0||t>this.width||a<0||n>this.height)return s?!1:[];var f=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var d=0;d<this.boxKeys.length;d++)f.push({key:this.boxKeys[d],x1:this.bboxes[d*4],y1:this.bboxes[d*4+1],x2:this.bboxes[d*4+2],y2:this.bboxes[d*4+3]});return l?f.filter(l):f}var _={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,f,_,l),s?f.length>0:f}},{key:"queryCell",value:function(t,n,i,a,s,l,f,d){var _=f.seenUids,x=this.boxCells[s];if(x!==null){var A=this.bboxes,C=QR(x),I;try{for(C.s();!(I=C.n()).done;){var O=I.value;if(!_.box[O]){_.box[O]=!0;var Z=O*4;if(t<=A[Z+2]&&n<=A[Z+3]&&i>=A[Z+0]&&a>=A[Z+1]&&(!d||d(this.boxKeys[O]))){if(f.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[O],x1:A[Z],y1:A[Z+1],x2:A[Z+2],y2:A[Z+3]})}}}}catch(Y){C.e(Y)}finally{C.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,s,l,f,d){for(var _=this.convertToXCellCoord(t),x=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),C=this.convertToYCellCoord(a),I=_;I<=A;I++)for(var O=x;O<=C;O++){var Z=this.xCellCount*O+I;if(s.call(this,t,n,i,a,Z,l,f,d))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),tM=eM,rM=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new tM(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,j.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,s=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=zh.al(n,i,0,1),s=zh.Ue(),l=Lt.fromValues.apply(Lt,(0,er.Z)(t));return zh.fF(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function tb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function nM(e,r){if(e){if(typeof e=="string")return rb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rb(e,r)}}function rb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function nb(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function ib(e,r,t,n,i){if(i){var a=e[n],s=a.glyph;if(s)for(var l=r[s].advance*a.scale,f=(e[n].x+l)*i,d=t;d<=n;d++)e[d].x-=f}}function ab(e,r,t,n,i,a,s){var l=(r-t)*i,f=(-n*s+.5)*a,d=tb(e),_;try{for(d.s();!(_=d.n()).done;){var x=_.value;x.x+=l,x.y+=f}}catch(A){d.e(A)}finally{d.f()}}function iM(e,r,t,n,i,a,s){var l=-8,f=0,d=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ie){if(ie.split("").forEach(function(Ve){var gt=r[Ve],lt=0;gt&&(x.push({glyph:Ve,x:f,y:d+lt,vertical:!1,scale:1,metrics:gt}),f+=gt.advance+s)}),x.length!==C){var ge=f-s;_=Math.max(ge,_),ib(x,r,C,x.length-1,A)}f=0,d-=n+5});var I=nb(i),O=I.horizontalAlign,Z=I.verticalAlign;ab(x,A,O,Z,_,n,t.length);var Y=d-l;e.top+=-Z*Y,e.bottom=e.top-Y,e.left+=-O*_,e.right=e.left+_}function aM(e,r,t,n,i,a,s){var l=-8,f=0,d=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ie){var ge=r[ie],Ve=0;if(ge&&(x.push({glyph:ie,x:ge.advance/2,y:d+Ve,vertical:!1,scale:1,metrics:ge}),f+=ge.advance+s),x.length!==C){var gt=f-s;_=Math.max(gt,_),ib(x,r,C,x.length-1,A)}f=0,d-=n+5});var I=nb(i),O=I.horizontalAlign,Z=I.verticalAlign;ab(x,A,O,Z,_,n,t.length);var Y=d-l;e.top+=-Z*Y,e.bottom=e.top-Y,e.left+=-O*_,e.right=e.left+_}function oM(e,r,t,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,f=e.split(`
`),d=[],_={positionedGlyphs:d,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:f.length,text:e};return l?aM(_,r,f,t,n,i,a):iM(_,r,f,t,n,i,a),d.length?_:!1}function sM(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=tb(i),l;try{for(s.s();!(l=s.n()).done;){var f=l.value,d=f.metrics,_=4,x=d.advance*f.scale/2,A=t?[f.x+x,f.y]:[0,0],C=t?[0,0]:[f.x+x+r[0],f.y+r[1]],I=(0-_)*f.scale-x+C[0],O=(0-_)*f.scale+C[1],Z=I+d.width*f.scale,Y=O+d.height*f.scale,ie={x:I,y:O},ge={x:Z,y:O},Ve={x:I,y:Y},gt={x:Z,y:Y};a.push({tl:ie,tr:ge,bl:Ve,br:gt,tex:d,glyphOffset:A})}}catch(lt){s.e(lt)}finally{s.f()}return a}function uM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function lM(e,r){if(e){if(typeof e=="string")return ob(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ob(e,r)}}function ob(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function cM(e){var r=fM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,ub=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_textOffsets;
layout(location = 14) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,Sm=hi.isEqual;function lb(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,s=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,f){n.push.apply(n,(0,er.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,er.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,er.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,er.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+f*4,1+f*4,2+f*4,2+f*4,3+f*4,0+f*4)}),{vertices:n,indices:i,size:7}}var cb=function(e){(0,Ne.Z)(t,e);var r=cM(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"glyphInfoMap",{}),(0,F.Z)((0,Me.Z)(n),"currentZoom",-1),(0,F.Z)((0,Me.Z)(n),"textureHeight",0),(0,F.Z)((0,Me.Z)(n),"textCount",0),(0,F.Z)((0,Me.Z)(n),"preTextStyle",{}),(0,F.Z)((0,Me.Z)(n),"mapping",(0,Ut.Z)(pe().mark(function l(){return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n.initGlyph(),n.updateTexture(),d.next=4,n.reBuildModel();case 4:case"end":return d.stop()}},l)}))),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,f=l===void 0?0:l,d=i.halo,_=d===void 0?.5:d,x=i.gamma,A=x===void 0?2:x,C=i.raisingHeight,I=C===void 0?0:C,O=this.getFontServiceMapping(),Z=this.getFontServiceCanvas();O&&Object.keys(O).length!==this.textCount&&Z&&(this.updateTexture(),this.textCount=Object.keys(O).length),this.preTextStyle=this.getTextStyle();var Y={u_stroke_color:_i(s),u_sdf_map_size:[(Z==null?void 0:Z.width)||1,(Z==null?void 0:Z.height)||1],u_raisingHeight:Number(I),u_stroke_width:f,u_gamma_scale:A,u_halo_blur:_},ie=this.getUniformsBufferInfo(Y);return ie}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 6:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,f=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),f||this.filterGlyphs(),x.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ub,fragmentShader:sb,inject:this.getInject(),triangulation:lb.bind(this),depth:{enable:!1}});case 6:return d=x.sent,x.abrupt("return",[d]);case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C,I,O,Z,Y;return pe().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,f=l===void 0?!1:l,d=s.textAnchor,_=d===void 0?"center":d,x=s.textOffset,A=s.padding,C=s.fontFamily,I=s.fontWeight,!(!Sm(A,this.preTextStyle.padding)||!Sm(x,this.preTextStyle.textOffset)||!Sm(_,this.preTextStyle.textAnchor)||!Sm(C,this.preTextStyle.fontFamily)||!Sm(I,this.preTextStyle.fontWeight))){ge.next=5;break}return ge.next=4,this.mapping();case 4:return ge.abrupt("return",!0);case 5:if(!f){ge.next=7;break}return ge.abrupt("return",!1);case 7:if(O=this.mapService.getZoom(),Z=this.mapService.getBounds(),Y=Ea(this.extent,Z),!(Math.abs(this.currentZoom-O)>.5||!Y||f!==this.preTextStyle.textAllowOverlap)){ge.next=14;break}return ge.next=13,this.reBuildModel();case 13:return ge.abrupt("return",!0);case 14:return ge.abrupt("return",!1);case 15:case"end":return ge.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Fn.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Fn.Attribute,descriptor:{name:"a_tex",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Vu(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,x=_===void 0?"":_;x=x.toString();var A=uM(x),C;try{for(A.s();!(C=A.n()).done;){var I=C.value;f.indexOf(I)===-1&&f.push(I)}}catch(O){A.e(O)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,x=_===void 0?"":_;x="".concat(x),f.indexOf(x)===-1&&f.push(x)}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l,d=i.textAllowOverlap,_=d===void 0?!1:d,x=i.padding,A=x===void 0?[0,0]:x,C=i.textAnchor,I=C===void 0?"center":C,O=i.textOffset,Z=O===void 0?[0,0]:O,Y=i.opacity,ie=Y===void 0?1:Y,ge=i.strokeOpacity,Ve=ge===void 0?1:ge,gt=i.strokeWidth,lt=gt===void 0?0:gt,Qe=i.stroke,Mt=Qe===void 0?"#000":Qe;return{fontWeight:s,fontFamily:f,textAllowOverlap:_,padding:A,textAnchor:I,textOffset:Z,opacity:ie,strokeOpacity:Ve,strokeWidth:lt,stroke:Mt}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),f=l.spacing,d=f===void 0?2:f,_=l.textAnchor,x=_===void 0?"center":_,A=l.textOffset,C=this.rawEncodeData;this.glyphInfo=C.map(function(I){var O=I.shape,Z=O===void 0?"":O,Y=I.id,ie=I.size,ge=ie===void 0?1:ie,Ve=I.textOffset?I.textOffset:A||[0,0],gt=I.textAnchor?I.textAnchor:x||"center",lt=oM(Z.toString(),s,ge,gt,"left",d,Ve,i),Qe=sM(lt,Ve,!1);return I.shaping=lt,I.glyphQuads=Qe,I.centroid=qs(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?qs(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[Y]={shaping:lt,glyphQuads:Qe,centroid:qs(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(f,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(f,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,f=a.textAllowOverlap,d=f===void 0?!1:f;if(!d){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),x=_.width,A=_.height,C=new rM(x,A),I=this.glyphInfo.filter(function(O){var Z=O.shaping,Y=O.id,ie=Y===void 0?0:Y,ge=O.version==="GAODE2.x"?O.originCentroid:O.centroid,Ve=O.size,gt=Ve/16,lt=i.mapService.lngLatToContainer(ge),Qe=C.placeCollisionBox({x1:Z.left*gt-l[0],x2:Z.right*gt+l[0],y1:Z.top*gt-l[1],y2:Z.bottom*gt+l[1],anchorPointX:lt.x,anchorPointY:lt.y}),Mt=Qe.box;return Mt&&Mt.length?(C.insertCollisionBox(Mt,ie),!0):!1});I.forEach(function(O){i.glyphInfoMap[O.id]=O})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:G.LINEAR,min:G.LINEAR,width:a.width,height:a.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.filterGlyphs(),f.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ub,fragmentShader:sb,triangulation:lb.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=f.sent,this.layer.models=[s];case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Va),hM={fillImage:NR,fill:q1,radar:KR,image:K1,normal:J1,simplePoint:dR,extrude:Y1,text:cb,earthFill:TR,earthExtrude:bR},pM=hM;function dM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function vM(e,r){if(e){if(typeof e=="string")return fb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fb(e,r)}}function fb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function mM(e){var r=gM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kg=function(e){(0,Ne.Z)(t,e);var r=mM(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","PointLayer"),(0,F.Z)((0,Me.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,F.Z)((0,Me.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,F.Z)((0,Me.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new pM[s](this),f.next=5,this.initLayerModels();case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),f=l.shape2d,d=this.iconService.getIconMap();if(a&&(f==null?void 0:f.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var _=dM(s),x;try{for(_.s();!(x=_.n()).done;){var A=x.value;if(typeof A=="string"&&d.hasOwnProperty(A))return"image"}}catch(C){_.e(C)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=a.billboard,d=f===void 0?!0:f,_=this.iconService.getIconMap(),x=i.find(function(C){return C.hasOwnProperty("shape")});if(x){var A=x.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||d===!1?"fillImage":(s==null?void 0:s.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Dp);function yM(e){return ry.apply(this,arguments)}function ry(){return ry=(0,Ut.Z)(pe().mark(function e(r){var t,n,i;return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!window.createImageBitmap){s.next=14;break}return s.next=3,fetch(r);case 3:return t=s.sent,s.t0=createImageBitmap,s.next=7,t.blob();case 7:return s.t1=s.sent,s.next=10,(0,s.t0)(s.t1);case 10:return n=s.sent,s.abrupt("return",n);case 14:return i=new window.Image,s.abrupt("return",new Promise(function(l){i.onload=function(){return l(i)},i.src=r,i.crossOrigin="Anonymous"}));case 16:case"end":return s.stop()}},e)})),ry.apply(this,arguments)}function _M(e){var r=bM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xM=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,EM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,SM=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,AM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,TM=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,wM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,CM=function(e){(0,Ne.Z)(t,e);var r=_M(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.mapTexture,s=i.heightfixed,l=s===void 0?!1:s,f=i.raisingHeight,d=f===void 0?0:f,_=i.topsurface,x=_===void 0?!0:_,A=i.sidesurface,C=A===void 0?!0:A,I=i.sourceColor,O=i.targetColor,Z=0,Y=[1,1,1,1],ie=[1,1,1,1];I&&O&&(Y=_i(I),ie=_i(O),Z=1);var ge={u_sourceColor:Y,u_targetColor:ie,u_linearColor:Z,u_topsurface:Number(x),u_sidesurface:Number(C),u_heightfixed:Number(l),u_raisingHeight:Number(d)};a&&this.texture&&(ge.u_texture=this.texture,this.textures=[this.texture]);var Ve=this.getUniformsBufferInfo(ge);return Ve}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,depth:{enable:!0},inject:this.getInject(),triangulation:Q0});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:SM,vert:AM,type:"polygonExtrudeTexture"}:a?{frag:TM,vert:wM,type:"polygonExtrudePickLight"}:{frag:xM,vert:EM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],f=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var d=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),_=(0,Cn.Z)(d,2),x=_[0],A=_[1],C=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),I=(0,Cn.Z)(C,2),O=I[0],Z=I[1];l=O-x,f=Z-A,a=[x,A,O,Z]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Fn.Attribute,descriptor:{name:"a_uvs",shaderLocation:qn.UV,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(ie,ge,Ve){var gt=Ve[0],lt=Ve[1];return[(gt-a[0])/l,(lt-a[1])/f,Ve[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(ie,ge,Ve,gt,lt){return lt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(ie){var ge=ie.size,Ve=ge===void 0?10:ge;return Array.isArray(Ve)?[Ve[0]]:[Ve]}}})}},{key:"loadTexture",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(s=this.layer.getLayerConfig(),l=s.mapTexture,f=this.rendererService.createTexture2D,this.texture=f({height:1,width:1}),!l){x.next=8;break}return x.next=6,yM(l);case 6:d=x.sent,this.texture=f({data:d,width:d.width,height:d.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR});case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Va);function RM(e){var r=MM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function MM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IM=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,PM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,OM=function(e){(0,Ne.Z)(t,e);var r=RM(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i={},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:Q0,depth:{enable:!0}});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:IM,vert:PM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Fn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Fn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Va);function kM(e){var r=DM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function DM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LM=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,BM=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,FM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,NM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,UM=function(e){(0,Ne.Z)(t,e);var r=kM(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,f=l===void 0?{enable:!1,dir:"in"}:l,d={u_raisingHeight:Number(s),u_opacitylinear:Number(f.enable),u_dir:f.dir==="in"?1:0},_=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=this.getModelParams(),l=s.frag,f=s.vert,d=s.triangulation,_=s.type,this.initUniformsBuffer(),this.layer.triangulation=d,C.next=5,this.layer.buildLayerModel({moduleName:_,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:d,primitive:G.TRIANGLES,depth:{enable:!1}});case 5:return x=C.sent,C.abrupt("return",[x]);case 7:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Fn.Attribute,descriptor:{name:"a_linear",shaderLocation:qn.LINEAR,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,d,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:BM,vert:FM,type:"polygonLinear",triangulation:dC}:{frag:LM,vert:NM,type:"polygonFill",triangulation:Dh}}}]),t}(Va);function zM(e){var r=ZM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function ZM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VM=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,jM=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,sN=hi.isNumber,HM=function(e){(0,Ne.Z)(t,e);var r=zM(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.watercolor,s=a===void 0?"#6D99A8":a,l=i.watercolor2,f=l===void 0?"#0F121C":l,d={u_watercolor:_i(s),u_watercolor2:_i(f),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];var _=this.getUniformsBufferInfo(d);return _}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:jM,fragmentShader:VM,inject:this.getInject(),triangulation:K0,primitive:G.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Cn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,x=d-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Fn.Attribute,descriptor:{name:"a_uv",shaderLocation:qn.UV,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(C,I,O,Z){var Y=C.version==="GAODE2.x"?C.originCoordinates[0][Z]:O,ie=(0,Cn.Z)(Y,2),ge=ie[0],Ve=ie[1];return[(ge-s)/_,(Ve-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(d){i.texture1=f(d[0]),i.texture2=f(d[1]),i.texture3=f(d[2]),i.layerService.reRender()});function l(d){var _=0,x=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(C){var I=new Image;I.crossOrigin="",I.src=C,x.push(I),I.onload=function(){_++,_===3&&d(x)}})}function f(d){return a({data:d,width:d.width,height:d.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR})}}}]),t}(Va);function WM(e){var r=GM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XM=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,$M=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,uN=hi.isNumber,YM=function(e){(0,Ne.Z)(t,e);var r=WM(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.speed,s=a===void 0?.5:a,l={u_speed:s,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];var f=this.getUniformsBufferInfo(l);return f}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:$M,fragmentShader:XM,triangulation:K0,inject:this.getInject(),primitive:G.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Cn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,x=d-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Fn.Attribute,descriptor:{name:"a_uv",shaderLocation:qn.UV,buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(C,I,O,Z){var Y=C.version==="GAODE2.x"?C.originCoordinates[0][Z]:O,ie=(0,Cn.Z)(Y,2),ge=ie[0],Ve=ie[1];return[(ge-s)/_,(Ve-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:1,width:1});var f=new Image;f.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),f.src=s):f.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",f.onload=function(){i.texture=l({data:f,width:f.width,height:f.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR}),i.layerService.reRender()}}}]),t}(Va),qM={fill:UM,line:X1,extrude:CM,text:cb,point_fill:q1,point_image:K1,point_normal:J1,point_extrude:Y1,water:YM,ocean:HM,extrusion:OM},KM=qM;function QM(e){var r=JM();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function JM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dg=function(e){(0,Ne.Z)(t,e);var r=QM(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","PolygonLayer"),(0,F.Z)((0,Me.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new KM[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=this.iconService.getIconMap(),d=i.find(function(x){return x.hasOwnProperty("shape")});if(d){var _=d.shape;return _==="dot"?"point_normal":(s==null?void 0:s.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":f.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),t}(Dp);function eI(e){var r=tI();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function tI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rI=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,nI=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,hb=function(e){(0,Ne.Z)(t,e);var r=eI(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,f=l===void 0?!0:l,d=i.clampHigh,_=d===void 0?!0:d,x=i.noDataValue,A=x===void 0?-9999999:x,C=i.domain,I=i.rampColors,O=C||gc(I);this.colorTexture=this.layer.textureService.getColorTexture(I,O);var Z={u_domain:O,u_opacity:s||1,u_noDataValue:A,u_clampLow:f?1:0,u_clampHigh:(typeof _!="undefined"?_:f)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];var Y=this.getUniformsBufferInfo(Z);return Y}},{key:"getRasterData",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(s.data)){A.next=4;break}return A.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return A.next=6,s.data;case 6:return l=A.sent,f=l.rasterData,d=l.width,_=l.height,A.abrupt("return",{data:Array.from(f),width:d,height:_});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C,I,O;return pe().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService,f=l.createTexture2D,d=l.queryVerdorInfo,_=s.data.dataArray[0],Y.next=6,this.getRasterData(_);case 6:return x=Y.sent,A=x.data,C=x.width,I=x.height,this.texture=f({data:new Float32Array(A),width:C,height:I,format:d()==="WebGL1"?G.LUMINANCE:G.RED,type:G.FLOAT,alignment:1}),Y.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:nI,fragmentShader:rI,triangulation:Pg,primitive:G.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return O=Y.sent,Y.abrupt("return",[O]);case 15:case"end":return Y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{shaderLocation:qn.UV,name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Va),iI=["data"],aI=["rasterData"];function oI(e){var r=sI();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uI=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,lI=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,cI=function(e){(0,Ne.Z)(t,e);var r=oI(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"dataOption",{}),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,f=l===void 0?0:l,d=this.dataOption,_=d.rMinMax,x=_===void 0?[0,255]:_,A=d.gMinMax,C=A===void 0?[0,255]:A,I=d.bMinMax,O=I===void 0?[0,255]:I,Z={u_rminmax:x,u_gminmax:C,u_bminmax:O,u_opacity:s||1,u_noDataValue:f,u_texture:this.texture};this.textures=[this.texture];var Y=this.getUniformsBufferInfo(Z);return Y}},{key:"getRasterData",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l,f,d,_,x;return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!Array.isArray(s.data)){C.next=4;break}return l=s.data,f=(0,ji.Z)(s,iI),this.dataOption=f,C.abrupt("return",(0,V.Z)({data:l},f));case 4:return C.next=6,s.data;case 6:if(d=C.sent,_=d.rasterData,x=(0,ji.Z)(d,aI),this.dataOption=x,!Array.isArray(_)){C.next=14;break}return C.abrupt("return",(0,V.Z)({data:_},x));case 14:return C.abrupt("return",(0,V.Z)({data:Array.from(_)},x));case 15:case"end":return C.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A,C;return pe().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],O.next=6,this.getRasterData(f);case 6:return d=O.sent,_=d.data,x=d.width,A=d.height,this.texture=l({data:new Float32Array(_),width:x,height:A,format:G.RGB,type:G.FLOAT}),O.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:lI,fragmentShader:uI,triangulation:Pg,primitive:G.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return C=O.sent,O.abrupt("return",[C]);case 15:case"end":return O.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Va);function fI(e){var r=hI();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function hI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pI=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,dI=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
   vec4 u_unpack;
   vec2 u_domain;
   float u_opacity;
   float u_noDataValue;
   float u_clampLow;
   float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,vI=function(e){(0,Ne.Z)(t,e);var r=fI(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,f=i.clampHigh,d=f===void 0?!0:f,_=i.noDataValue,x=_===void 0?-9999999:_,A=i.domain,C=i.rampColors,I=i.colorTexture,O=i.rScaler,Z=O===void 0?6553.6:O,Y=i.gScaler,ie=Y===void 0?25.6:Y,ge=i.bScaler,Ve=ge===void 0?.1:ge,gt=i.offset,lt=gt===void 0?1e4:gt,Qe=A||gc(C),Mt=I;I?this.layer.textureService.setColorTexture(I,C,Qe):Mt=this.layer.textureService.getColorTexture(C,Qe);var Vt={u_unpack:[Z,ie,Ve,lt],u_domain:Qe,u_opacity:a||1,u_noDataValue:x,u_clampLow:l,u_clampHigh:typeof d!="undefined"?d:l,u_texture:this.texture,u_colorTexture:Mt};this.textures=[this.texture,Mt];var Sr=this.getUniformsBufferInfo(Vt);return Sr}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,x.next=5,s.data.images;case 5:return f=x.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,min:G.LINEAR,mag:G.LINEAR}),x.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:dI,fragmentShader:pI,triangulation:Pg,primitive:G.TRIANGLES,depth:{enable:!1}});case 9:return d=x.sent,x.abrupt("return",[d]);case 11:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Fn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Va),mI={raster:hb,rasterRgb:cI,raster3d:hb,rasterTerrainRgb:vI},gI=mI;function yI(e){var r=_I();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function _I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=function(e){(0,Ne.Z)(t,e);var r=yI(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","RasterLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new gI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}},{key:"getLegend",value:function(i){if(i!=="color")return{type:void 0,field:void 0,items:[]};var a=this.getLayerConfig().rampColors;return z1(a,i)}}]),t}(Dp);function bI(e){var r=xI();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function xI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EI=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,SI=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,AI=function(e){(0,Ne.Z)(t,e);var r=bI(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,V.Z)((0,V.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,f=l===void 0?"#000":l,d={u_color:_i(f),u_opacity:s||1},_=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:SI,fragmentShader:EI,triangulation:K0,depth:{enable:!1},pick:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Va),TI={fill:AI},wI=TI;function CI(e){var r=RI();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function RI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pb=function(e){(0,Ne.Z)(t,e);var r=CI(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"type","MaskLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new wI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Dp),db,vb,mb,gb,Bg,yb,_b,MI=hi.cloneDeep,II=(db=(0,rr.b2)(),vb=(0,rr.f3)(it.IMapService),mb=(0,rr.f3)(it.IFontService),db(gb=(Bg=function(){function e(){(0,J.Z)(this,e),Ni(this,"mapService",yb,this),Ni(this,"fontService",_b,this)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Ut.Z)(pe().mark(function s(){return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t.log(ks.MappingStart,ns.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(ks.MappingEnd,ns.INIT);case 3:case"end":return f.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Ut.Z)(pe().mark(function l(f){var d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(f){x.next=2;break}return x.abrupt("return",f);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(ks.MappingStart,ns.UPDATE),d=i.generateMaping(t,{styleAttributeService:a}),t.log(ks.MappingEnd,ns.UPDATE),x.abrupt("return",d);case 7:case"end":return x.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=t.getSource();if(!(t.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),d=s.data.dataArray;if(!(Array.isArray(d)&&d.length===0)){var _=l.filter(function(C){return C.needRemapping}),x=d;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(x=d.filter(function(C){return i.applyAttributeMapping(f,C)[0]})),_.length){var A=i.mapping(t,_,x,t.getEncodedData());t.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),f=t.getSource().data.dataArray,d=f;l!=null&&l.scale&&(d=f.filter(function(x){return i.applyAttributeMapping(l,x)[0]})),d=t.processData(d);var _=this.mapping(t,s,d,void 0);return t.setEncodedData(_),t.emit("dataUpdate",null),!0}},{key:"mapping",value:function(t,n,i,a){var s=this,l=n.filter(function(d){return d.scale!==void 0}).filter(function(d){return d.name!=="filter"}),f=i.map(function(d,_){var x=a?a[_]:{},A=(0,V.Z)({id:d._id,coordinates:d.coordinates},x);return l.forEach(function(C){var I=s.applyAttributeMapping(C,d);(C.name==="color"||C.name==="stroke")&&(I=I.map(function(O){return _i(O)})),A[C.name]=Array.isArray(I)&&I.length===1?I[0]:I,C.name==="shape"&&(A.shape=s.fontService.getIconFontKey(A[C.name]))}),A});return n.forEach(function(d){d.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,t),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=MI(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(s){var l=[];s.map(function(f){l.push(n.mapService.simpleMapCoord.unproject(f))}),i.push(l)}),i}else{var a=[];return t.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(f){var d,_=f.field;(n.hasOwnProperty(_)||((d=t.scale)===null||d===void 0?void 0:d.type)==="variable")&&s.push(n[_])});var l=t.mapping?t.mapping(s):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=ju(i),s=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return s}}]),e}(),yb=Li(Bg.prototype,"mapService",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=Li(Bg.prototype,"fontService",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg))||gb),bb,xb,PI=(bb=(0,rr.b2)(),bb(xb=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(it.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Ut.Z)(pe().mark(function i(){var a,s,l,f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.log(ks.SourceInitStart,ns.INIT),a=t.getSource(),a||(s=t.sourceOption||t.defaultSourceConfig,l=s.data,f=s.options,a=new n1(l,f),t.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(t),t.log(ks.SourceInitEnd,ns.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(x){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(t),t.log(ks.SourceInitEnd,ns.INIT)),x(null)})});case 10:case"end":return _.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Ut.Z)(pe().mark(function i(){var a,s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||s,d.abrupt("return",l);case 5:case"end":return d.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,f=t.dataState.dataSourceNeedUpdate;return i&&f&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||xb);function Eb(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function OI(e){return e.length===1&&(e=kI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function kI(e){return function(r,t){return Eb(e(r),t)}}var Sb=OI(Eb),lN=Sb.right,cN=Sb.left,fN=null;function Ab(e,r){var t=e.length,n=-1,i,a,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var Tb=Array.prototype,hN=Tb.slice,pN=Tb.map,ny=Math.sqrt(50),iy=Math.sqrt(10),ay=Math.sqrt(2);function dN(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=DI(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function DI(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=ny?10:a>=iy?5:a>=ay?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=ny?10:a>=iy?5:a>=ay?2:1)}function vN(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=ny?i*=10:a>=iy?i*=5:a>=ay&&(i*=2),r<e?-i:i}function mN(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=r(f),_=d[0],x=d[1],A=t(f,_,x);Array.isArray(A)||(A=tickStep(_,x,A),A=range(Math.ceil(_/A)*A,x,A));for(var C=A.length;A[0]<=_;)A.shift(),--C;for(;A[C-1]>x;)A.pop(),--C;var I=new Array(C+1),O;for(a=0;a<=C;++a)O=I[a]=[],O.x0=a>0?A[a-1]:_,O.x1=a<C?A[a]:x;for(a=0;a<s;++a)l=f[a],_<=l&&l<=x&&I[bisect(A,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function gN(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function wb(e,r,t,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*r+(4-6*a+3*s)*t+(1+3*e+3*a-3*s)*n+s*i)/6}function LI(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return wb((t-n/r)*r,s,i,a,l)}}function BI(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],s=e[(n+1)%r],l=e[(n+2)%r];return wb((t-n/r)*r,i,a,s,l)}}function oy(e){return function(){return e}}function Cb(e,r){return function(t){return e+t*r}}function FI(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function yN(e,r){var t=r-e;return t?Cb(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function NI(e){return(e=+e)==1?Rb:function(r,t){return t-r?FI(r,t,e):oy(isNaN(r)?t:r)}}function Rb(e,r){var t=r-e;return t?Cb(e,t):oy(isNaN(e)?r:e)}var Mb=function e(r){var t=NI(r);function n(i,a){var s=t((i=(0,vs.B8)(i)).r,(a=(0,vs.B8)(a)).r),l=t(i.g,a.g),f=t(i.b,a.b),d=Rb(i.opacity,a.opacity);return function(_){return i.r=s(_),i.g=l(_),i.b=f(_),i.opacity=d(_),i+""}}return n.gamma=e,n}(1);function Ib(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),s,l;for(s=0;s<t;++s)l=(0,vs.B8)(r[s]),n[s]=l.r||0,i[s]=l.g||0,a[s]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(f){return l.r=n(f),l.g=i(f),l.b=a(f),l+""}}}var UI=Ib(LI),_N=Ib(BI);function sy(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function Pb(e){return e.length===1&&(e=zI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function zI(e){return function(r,t){return sy(e(r),t)}}var Ob=Pb(sy),ZI=Ob.right,bN=Ob.left,Fg=ZI,kb=Array.prototype,xN=kb.slice,EN=kb.map,uy=Math.sqrt(50),ly=Math.sqrt(10),cy=Math.sqrt(2);function Db(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=Ng(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function Ng(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=uy?10:a>=ly?5:a>=cy?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=uy?10:a>=ly?5:a>=cy?2:1)}function fy(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=uy?i*=10:a>=ly?i*=5:a>=cy&&(i*=2),r<e?-i:i}function SN(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=r(f),_=d[0],x=d[1],A=t(f,_,x);Array.isArray(A)||(A=tickStep(_,x,A),A=range(Math.ceil(_/A)*A,x,A));for(var C=A.length;A[0]<=_;)A.shift(),--C;for(;A[C-1]>x;)A.pop(),--C;var I=new Array(C+1),O;for(a=0;a<=C;++a)O=I[a]=[],O.x0=a>0?A[a-1]:_,O.x1=a<C?A[a]:x;for(a=0;a<s;++a)l=f[a],_<=l&&l<=x&&I[bisect(A,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function AN(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function VI(e){return e===null?NaN:+e}function jI(e,r,t){if(t==null&&(t=VI),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),s=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return s+(l-s)*(i-a)}}var Wc="$";function Ug(){}Ug.prototype=Lb.prototype={constructor:Ug,has:function(e){return Wc+e in this},get:function(e){return this[Wc+e]},set:function(e,r){return this[Wc+e]=r,this},remove:function(e){var r=Wc+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===Wc&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===Wc&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===Wc&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===Wc&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===Wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Wc)return!1;return!0},each:function(e){for(var r in this)r[0]===Wc&&e(this[r],r.slice(1),this)}};function Lb(e,r){var t=new Ug;if(e instanceof Ug)e.each(function(l,f){t.set(f,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var s in e)t.set(s,e[s]);return t}var hy=Lb;function TN(){var e=[],r=[],t,n,i;function a(l,f,d,_){if(f>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var x=-1,A=l.length,C=e[f++],I,O,Z=map(),Y,ie=d();++x<A;)(Y=Z.get(I=C(O=l[x])+""))?Y.push(O):Z.set(I,[O]);return Z.each(function(ge,Ve){_(ie,Ve,a(ge,f,d,_))}),ie}function s(l,f){if(++f>e.length)return l;var d,_=r[f-1];return n!=null&&f>=e.length?d=l.entries():(d=[],l.each(function(x,A){d.push({key:A,values:s(x,f)})})),_!=null?d.sort(function(x,A){return _(x.key,A.key)}):d}return i={object:function(l){return a(l,0,HI,WI)},map:function(l){return a(l,0,Bb,Fb)},entries:function(l){return s(a(l,0,Bb,Fb),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return r[e.length-1]=l,i},sortValues:function(l){return t=l,i},rollup:function(l){return n=l,i}}}function HI(){return{}}function WI(e,r,t){e[r]=t}function Bb(){return map()}function Fb(e,r,t){e.set(r,t)}function zg(){}var Cd=hy.prototype;zg.prototype=GI.prototype={constructor:zg,has:Cd.has,add:function(e){return e+="",this[Wc+e]=e,this},remove:Cd.remove,clear:Cd.clear,values:Cd.keys,size:Cd.size,empty:Cd.empty,each:Cd.each};function GI(e,r){var t=new zg;if(e instanceof zg)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var wN=null,Nb=Array.prototype,Ub=Nb.map,Rd=Nb.slice;function Fp(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function zb(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Zb={name:"implicit"};function Zg(){var e=hy(),r=[],t=[],n=Zb;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Zb)return n;e.set(s,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=hy();for(var s=-1,l=a.length,f,d;++s<l;)e.has(d=(f=a[s])+"")||e.set(d,r.push(f));return i},i.range=function(a){return arguments.length?(t=Rd.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return Zg(r,t).unknown(n)},Fp.apply(i,arguments),i}function Vb(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,s=!1,l=0,f=0,d=.5;delete e.unknown;function _(){var x=r().length,A=n[1]<n[0],C=n[A-0],I=n[1-A];i=(I-C)/Math.max(1,x-l+f*2),s&&(i=Math.floor(i)),C+=(I-C-i*(x-l))*d,a=i*(1-l),s&&(C=Math.round(C),a=Math.round(a));var O=sequence(x).map(function(Z){return C+i*Z});return t(A?O.reverse():O)}return e.domain=function(x){return arguments.length?(r(x),_()):r()},e.range=function(x){return arguments.length?(n=[+x[0],+x[1]],_()):n.slice()},e.rangeRound=function(x){return n=[+x[0],+x[1]],s=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(x){return arguments.length?(s=!!x,_()):s},e.padding=function(x){return arguments.length?(l=Math.min(1,f=+x),_()):l},e.paddingInner=function(x){return arguments.length?(l=Math.min(1,x),_()):l},e.paddingOuter=function(x){return arguments.length?(f=+x,_()):f},e.align=function(x){return arguments.length?(d=Math.max(0,Math.min(1,x)),_()):d},e.copy=function(){return Vb(r(),n).round(s).paddingInner(l).paddingOuter(f).align(d)},initRange.apply(_(),arguments)}function jb(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return jb(r())},e}function CN(){return jb(Vb.apply(null,arguments).paddingInner(1))}function RN(e,r){return(isNumberArray(r)?numberArray:Hb)(e,r)}function Hb(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),s;for(s=0;s<n;++s)i[s]=vy(e[s],r[s]);for(;s<t;++s)a[s]=r[s];return function(l){for(s=0;s<n;++s)a[s]=i[s](l);return a}}function XI(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function Vg(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function $I(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=vy(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}}var py=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dy=new RegExp(py.source,"g");function YI(e){return function(){return e}}function qI(e){return function(r){return e(r)+""}}function KI(e,r){var t=py.lastIndex=dy.lastIndex=0,n,i,a,s=-1,l=[],f=[];for(e=e+"",r=r+"";(n=py.exec(e))&&(i=dy.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[s]?l[s]+=a:l[++s]=a),(n=n[0])===(i=i[0])?l[s]?l[s]+=i:l[++s]=i:(l[++s]=null,f.push({i:s,x:Vg(n,i)})),t=dy.lastIndex;return t<r.length&&(a=r.slice(t),l[s]?l[s]+=a:l[++s]=a),l.length<2?f[0]?qI(f[0].x):YI(r):(r=f.length,function(d){for(var _=0,x;_<r;++_)l[(x=f[_]).i]=x.x(d);return l.join("")})}function QI(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}}function JI(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function vy(e,r){var t=typeof r,n;return r==null||t==="boolean"?oy(r):(t==="number"?Vg:t==="string"?(n=(0,vs.ZP)(r))?(r=n,Mb):KI:r instanceof vs.ZP?Mb:r instanceof Date?XI:JI(r)?QI:Array.isArray(r)?Hb:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?$I:Vg)(e,r)}function eP(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function tP(e){return function(){return e}}function rP(e){return+e}var Wb=[0,1];function qu(e){return e}function gy(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:tP(isNaN(r)?NaN:.5)}function Gb(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function nP(e,r,t){var n=e[0],i=e[1],a=r[0],s=r[1];return i<n?(n=gy(i,n),a=t(s,a)):(n=gy(n,i),a=t(a,s)),function(l){return a(n(l))}}function iP(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++s<n;)i[s]=gy(e[s],e[s+1]),a[s]=t(r[s],r[s+1]);return function(l){var f=Fg(e,l,1,n)-1;return a[f](i[f](l))}}function jg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yy(){var e=Wb,r=Wb,t=vy,n,i,a,s=qu,l,f,d;function _(){return l=Math.min(e.length,r.length)>2?iP:nP,f=d=null,x}function x(A){return isNaN(A=+A)?a:(f||(f=l(e.map(n),r,t)))(n(s(A)))}return x.invert=function(A){return s(i((d||(d=l(r,e.map(n),Vg)))(A)))},x.domain=function(A){return arguments.length?(e=Ub.call(A,rP),s===qu||(s=Gb(e)),_()):e.slice()},x.range=function(A){return arguments.length?(r=Rd.call(A),_()):r.slice()},x.rangeRound=function(A){return r=Rd.call(A),t=eP,_()},x.clamp=function(A){return arguments.length?(s=A?Gb(e):qu,x):s!==qu},x.interpolate=function(A){return arguments.length?(t=A,_()):t},x.unknown=function(A){return arguments.length?(a=A,x):a},function(A,C){return n=A,i=C,_()}}function Xb(e,r){return yy()(e,r)}var aP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hg(e){if(!(r=aP.exec(e)))throw new Error("invalid format: "+e);var r;return new _y({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Hg.prototype=_y.prototype;function _y(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}_y.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function oP(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Wg(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function _v(e){return e=Wg(Math.abs(e)),e?e[1]:NaN}function sP(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_v(r)/3)))*3-_v(Math.abs(e)))}function uP(e,r){return function(t,n){for(var i=t.length,a=[],s=0,l=e[0],f=0;i>0&&l>0&&(f+l+1>n&&(l=Math.max(1,n-f)),a.push(t.substring(i-=l,i+l)),!((f+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(r)}}function lP(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function cP(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var $b;function fP(e,r){var t=Wg(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-($b=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Wg(e,Math.max(0,r+a-1))[0]}function Yb(e,r){var t=Wg(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var qb={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:oP,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return Yb(e*100,r)},r:Yb,s:fP,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Kb(e){return e}var Qb=Array.prototype.map,Jb=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function hP(e){var r=e.grouping===void 0||e.thousands===void 0?Kb:uP(Qb.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Kb:lP(Qb.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",f=e.nan===void 0?"NaN":e.nan+"";function d(x){x=Hg(x);var A=x.fill,C=x.align,I=x.sign,O=x.symbol,Z=x.zero,Y=x.width,ie=x.comma,ge=x.precision,Ve=x.trim,gt=x.type;gt==="n"?(ie=!0,gt="g"):qb[gt]||(ge===void 0&&(ge=12),Ve=!0,gt="g"),(Z||A==="0"&&C==="=")&&(Z=!0,A="0",C="=");var lt=O==="$"?t:O==="#"&&/[boxX]/.test(gt)?"0"+gt.toLowerCase():"",Qe=O==="$"?n:/[%p]/.test(gt)?s:"",Mt=qb[gt],Vt=/[defgprs%]/.test(gt);ge=ge===void 0?6:/[gprs]/.test(gt)?Math.max(1,Math.min(21,ge)):Math.max(0,Math.min(20,ge));function Sr(mr){var Xr=lt,mn=Qe,Yn,Ji,Ma;if(gt==="c")mn=Mt(mr)+mn,mr="";else{mr=+mr;var Ko=mr<0||1/mr<0;if(mr=isNaN(mr)?f:Mt(Math.abs(mr),ge),Ve&&(mr=cP(mr)),Ko&&+mr==0&&I!=="+"&&(Ko=!1),Xr=(Ko?I==="("?I:l:I==="-"||I==="("?"":I)+Xr,mn=(gt==="s"?Jb[8+$b/3]:"")+mn+(Ko&&I==="("?")":""),Vt){for(Yn=-1,Ji=mr.length;++Yn<Ji;)if(Ma=mr.charCodeAt(Yn),48>Ma||Ma>57){mn=(Ma===46?i+mr.slice(Yn+1):mr.slice(Yn))+mn,mr=mr.slice(0,Yn);break}}}ie&&!Z&&(mr=r(mr,1/0));var Vo=Xr.length+mr.length+mn.length,$s=Vo<Y?new Array(Y-Vo+1).join(A):"";switch(ie&&Z&&(mr=r($s+mr,$s.length?Y-mn.length:1/0),$s=""),C){case"<":mr=Xr+mr+mn+$s;break;case"=":mr=Xr+$s+mr+mn;break;case"^":mr=$s.slice(0,Vo=$s.length>>1)+Xr+mr+mn+$s.slice(Vo);break;default:mr=$s+Xr+mr+mn;break}return a(mr)}return Sr.toString=function(){return x+""},Sr}function _(x,A){var C=d((x=Hg(x),x.type="f",x)),I=Math.max(-8,Math.min(8,Math.floor(_v(A)/3)))*3,O=Math.pow(10,-I),Z=Jb[8+I/3];return function(Y){return C(O*Y)+Z}}return{format:d,formatPrefix:_}}var Gg,by,ex;pP({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function pP(e){return Gg=hP(e),by=Gg.format,ex=Gg.formatPrefix,Gg}function dP(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,_v(r)-_v(e))+1}function vP(e){return Math.max(0,-_v(Math.abs(e)))}function mP(e,r,t,n){var i=fy(e,r,t),a;switch(n=Hg(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=sP(i,s))&&(n.precision=a),ex(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=dP(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=vP(i))&&(n.precision=a-(n.type==="%")*2);break}}return by(n)}function Am(e){var r=e.domain;return e.ticks=function(t){var n=r();return Db(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return mP(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,s=n[i],l=n[a],f;return l<s&&(f=s,s=l,l=f,f=i,i=a,a=f),f=Ng(s,l,t),f>0?(s=Math.floor(s/f)*f,l=Math.ceil(l/f)*f,f=Ng(s,l,t)):f<0&&(s=Math.ceil(s*f)/f,l=Math.floor(l*f)/f,f=Ng(s,l,t)),f>0?(n[i]=Math.floor(s/f)*f,n[a]=Math.ceil(l/f)*f,r(n)):f<0&&(n[i]=Math.ceil(s*f)/f,n[a]=Math.floor(l*f)/f,r(n)),e},e}function tx(){var e=Xb(qu,qu);return e.copy=function(){return jg(e,tx())},Fp.apply(e,arguments),Am(e)}function gP(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return gP(e).unknown(r)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function rx(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],s;return a<i&&(s=t,t=n,n=s,s=i,i=a,a=s),e[t]=r.floor(i),e[n]=r.ceil(a),e}function nx(e){return Math.log(e)}function ix(e){return Math.exp(e)}function yP(e){return-Math.log(-e)}function _P(e){return-Math.exp(-e)}function bP(e){return isFinite(e)?+("1e"+e):e<0?0:e}function xP(e){return e===10?bP:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function EP(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function ax(e){return function(r){return-e(-r)}}function SP(e){var r=e(nx,ix),t=r.domain,n=10,i,a;function s(){return i=EP(n),a=xP(n),t()[0]<0?(i=ax(i),a=ax(a),e(yP,_P)):e(nx,ix),r}return r.base=function(l){return arguments.length?(n=+l,s()):n},r.domain=function(l){return arguments.length?(t(l),s()):t()},r.ticks=function(l){var f=t(),d=f[0],_=f[f.length-1],x;(x=_<d)&&(A=d,d=_,_=A);var A=i(d),C=i(_),I,O,Z,Y=l==null?10:+l,ie=[];if(!(n%1)&&C-A<Y){if(A=Math.round(A)-1,C=Math.round(C)+1,d>0){for(;A<C;++A)for(O=1,I=a(A);O<n;++O)if(Z=I*O,!(Z<d)){if(Z>_)break;ie.push(Z)}}else for(;A<C;++A)for(O=n-1,I=a(A);O>=1;--O)if(Z=I*O,!(Z<d)){if(Z>_)break;ie.push(Z)}}else ie=Db(A,C,Math.min(C-A,Y)).map(a);return x?ie.reverse():ie},r.tickFormat=function(l,f){if(f==null&&(f=n===10?".0e":","),typeof f!="function"&&(f=by(f)),l===1/0)return f;l==null&&(l=10);var d=Math.max(1,n*l/r.ticks().length);return function(_){var x=_/a(Math.round(i(_)));return x*n<n-.5&&(x*=n),x<=d?f(_):""}},r.nice=function(){return t(rx(t(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},r}function ox(){var e=SP(yy()).domain([1,10]);return e.copy=function(){return jg(e,ox()).base(e.base())},Fp.apply(e,arguments),e}function sx(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function ux(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function AP(e){var r=1,t=e(sx(r),ux(r));return t.constant=function(n){return arguments.length?e(sx(r=+n),ux(r)):r},linearish(t)}function TP(){var e=AP(transformer());return e.copy=function(){return copy(e,TP()).constant(e.constant())},initRange.apply(e,arguments)}function lx(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function wP(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function CP(e){return e<0?-e*e:e*e}function RP(e){var r=e(qu,qu),t=1;function n(){return t===1?e(qu,qu):t===.5?e(wP,CP):e(lx(t),lx(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},Am(r)}function xy(){var e=RP(yy());return e.copy=function(){return jg(e,xy()).exponent(e.exponent())},Fp.apply(e,arguments),e}function MN(){return xy.apply(null,arguments).exponent(.5)}function cx(){var e=[],r=[],t=[],n;function i(){var s=0,l=Math.max(1,r.length);for(t=new Array(l-1);++s<l;)t[s-1]=jI(e,s/l);return a}function a(s){return isNaN(s=+s)?n:r[Fg(t,s)]}return a.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,f=s.length,d;l<f;++l)d=s[l],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(sy),i()},a.range=function(s){return arguments.length?(r=Rd.call(s),i()):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return cx().domain(e).range(r).unknown(n)},Fp.apply(a,arguments)}function fx(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function s(f){return f<=f?i[Fg(n,f,0,t)]:a}function l(){var f=-1;for(n=new Array(t);++f<t;)n[f]=((f+1)*r-(f-t)*e)/(t+1);return s}return s.domain=function(f){return arguments.length?(e=+f[0],r=+f[1],l()):[e,r]},s.range=function(f){return arguments.length?(t=(i=Rd.call(f)).length-1,l()):i.slice()},s.invertExtent=function(f){var d=i.indexOf(f);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=t?[n[t-1],r]:[n[d-1],n[d]]},s.unknown=function(f){return arguments.length&&(a=f),s},s.thresholds=function(){return n.slice()},s.copy=function(){return fx().domain([e,r]).range(i).unknown(a)},Fp.apply(Am(s),arguments)}function hx(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[Fg(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=Rd.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=Rd.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var s=r.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return hx().domain(e).range(r).unknown(t)},Fp.apply(i,arguments)}var Ey=new Date,Sy=new Date;function gl(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return r(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var f=[],d;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return f;do f.push(d=new Date(+a)),r(a,l),e(a);while(d<a&&a<s);return f},i.filter=function(a){return gl(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!a(s););else for(;--l>=0;)for(;r(s,1),!a(s););})},t&&(i.count=function(a,s){return Ey.setTime(+a),Sy.setTime(+s),e(Ey),e(Sy),Math.floor(t(Ey,Sy))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a===0}:function(s){return i.count(0,s)%a===0}):i}),i}var Ay=gl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ay.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gl(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var bv=Ay,IN=Ay.range,px=gl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),MP=px,PN=px.range,Xg=1e3,Tm=6e4,dx=36e5,vx=864e5,mx=6048e5;function Md(e){return gl(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*Tm)/mx})}var Ty=Md(0),$g=Md(1),IP=Md(2),PP=Md(3),xv=Md(4),OP=Md(5),kP=Md(6),ON=Ty.range,kN=$g.range,DN=IP.range,LN=PP.range,BN=xv.range,FN=OP.range,NN=kP.range,gx=gl(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Tm)/vx},function(e){return e.getDate()-1}),wy=gx,UN=gx.range,yx=gl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Xg-e.getMinutes()*Tm)},function(e,r){e.setTime(+e+r*dx)},function(e,r){return(r-e)/dx},function(e){return e.getHours()}),DP=yx,zN=yx.range,_x=gl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Xg)},function(e,r){e.setTime(+e+r*Tm)},function(e,r){return(r-e)/Tm},function(e){return e.getMinutes()}),LP=_x,ZN=_x.range,bx=gl(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*Xg)},function(e,r){return(r-e)/Xg},function(e){return e.getUTCSeconds()}),BP=bx,VN=bx.range,Yg=gl(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});Yg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?gl(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):Yg};var FP=Yg,jN=Yg.range;function Id(e){return gl(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/mx})}var xx=Id(0),qg=Id(1),NP=Id(2),UP=Id(3),Ev=Id(4),zP=Id(5),ZP=Id(6),HN=xx.range,WN=qg.range,GN=NP.range,XN=UP.range,$N=Ev.range,YN=zP.range,qN=ZP.range,Ex=gl(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/vx},function(e){return e.getUTCDate()-1}),Sx=Ex,KN=Ex.range,Cy=gl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Cy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gl(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var wm=Cy,QN=Cy.range;function Ry(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function My(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Cm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function VP(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,f=e.shortMonths,d=Rm(i),_=Mm(i),x=Rm(a),A=Mm(a),C=Rm(s),I=Mm(s),O=Rm(l),Z=Mm(l),Y=Rm(f),ie=Mm(f),ge={a:Ko,A:Vo,b:$s,B:bl,c:null,d:Ix,e:Ix,f:fO,g:xO,G:SO,H:uO,I:lO,j:cO,L:Px,m:hO,M:pO,p:gF,q:yF,Q:Fx,s:Nx,S:dO,u:vO,U:mO,V:gO,w:yO,W:_O,x:null,X:null,y:bO,Y:EO,Z:AO,"%":Bx},Ve={a:_F,A:bF,b:xF,B:EF,c:null,d:kx,e:kx,f:RO,g:NO,G:zO,H:TO,I:wO,j:CO,L:Dx,m:MO,M:IO,p:SF,q:AF,Q:Fx,s:Nx,S:PO,u:OO,U:kO,V:DO,w:LO,W:BO,x:null,X:null,y:FO,Y:UO,Z:ZO,"%":Bx},gt={a:Sr,A:mr,b:Xr,B:mn,c:Yn,d:Rx,e:Rx,f:iO,g:Cx,G:Tx,H:Mx,I:Mx,j:eO,L:nO,m:JP,M:tO,p:Vt,q:QP,Q:oO,s:sO,S:rO,u:XP,U:$P,V:YP,w:GP,W:qP,x:Ji,X:Ma,y:Cx,Y:Tx,Z:KP,"%":aO};ge.x=lt(t,ge),ge.X=lt(n,ge),ge.c=lt(r,ge),Ve.x=lt(t,Ve),Ve.X=lt(n,Ve),Ve.c=lt(r,Ve);function lt(ci,Ta){return function(Ha){var wn=[],zl=-1,jo=0,vc=ci.length,mc,Ud,A2;for(Ha instanceof Date||(Ha=new Date(+Ha));++zl<vc;)ci.charCodeAt(zl)===37&&(wn.push(ci.slice(jo,zl)),(Ud=Ax[mc=ci.charAt(++zl)])!=null?mc=ci.charAt(++zl):Ud=mc==="e"?" ":"0",(A2=Ta[mc])&&(mc=A2(Ha,Ud)),wn.push(mc),jo=zl+1);return wn.push(ci.slice(jo,zl)),wn.join("")}}function Qe(ci,Ta){return function(Ha){var wn=Cm(1900,void 0,1),zl=Mt(wn,ci,Ha+="",0),jo,vc;if(zl!=Ha.length)return null;if("Q"in wn)return new Date(wn.Q);if("s"in wn)return new Date(wn.s*1e3+("L"in wn?wn.L:0));if(Ta&&!("Z"in wn)&&(wn.Z=0),"p"in wn&&(wn.H=wn.H%12+wn.p*12),wn.m===void 0&&(wn.m="q"in wn?wn.q:0),"V"in wn){if(wn.V<1||wn.V>53)return null;"w"in wn||(wn.w=1),"Z"in wn?(jo=My(Cm(wn.y,0,1)),vc=jo.getUTCDay(),jo=vc>4||vc===0?qg.ceil(jo):qg(jo),jo=Sx.offset(jo,(wn.V-1)*7),wn.y=jo.getUTCFullYear(),wn.m=jo.getUTCMonth(),wn.d=jo.getUTCDate()+(wn.w+6)%7):(jo=Ry(Cm(wn.y,0,1)),vc=jo.getDay(),jo=vc>4||vc===0?$g.ceil(jo):$g(jo),jo=wy.offset(jo,(wn.V-1)*7),wn.y=jo.getFullYear(),wn.m=jo.getMonth(),wn.d=jo.getDate()+(wn.w+6)%7)}else("W"in wn||"U"in wn)&&("w"in wn||(wn.w="u"in wn?wn.u%7:"W"in wn?1:0),vc="Z"in wn?My(Cm(wn.y,0,1)).getUTCDay():Ry(Cm(wn.y,0,1)).getDay(),wn.m=0,wn.d="W"in wn?(wn.w+6)%7+wn.W*7-(vc+5)%7:wn.w+wn.U*7-(vc+6)%7);return"Z"in wn?(wn.H+=wn.Z/100|0,wn.M+=wn.Z%100,My(wn)):Ry(wn)}}function Mt(ci,Ta,Ha,wn){for(var zl=0,jo=Ta.length,vc=Ha.length,mc,Ud;zl<jo;){if(wn>=vc)return-1;if(mc=Ta.charCodeAt(zl++),mc===37){if(mc=Ta.charAt(zl++),Ud=gt[mc in Ax?Ta.charAt(zl++):mc],!Ud||(wn=Ud(ci,Ha,wn))<0)return-1}else if(mc!=Ha.charCodeAt(wn++))return-1}return wn}function Vt(ci,Ta,Ha){var wn=d.exec(Ta.slice(Ha));return wn?(ci.p=_[wn[0].toLowerCase()],Ha+wn[0].length):-1}function Sr(ci,Ta,Ha){var wn=C.exec(Ta.slice(Ha));return wn?(ci.w=I[wn[0].toLowerCase()],Ha+wn[0].length):-1}function mr(ci,Ta,Ha){var wn=x.exec(Ta.slice(Ha));return wn?(ci.w=A[wn[0].toLowerCase()],Ha+wn[0].length):-1}function Xr(ci,Ta,Ha){var wn=Y.exec(Ta.slice(Ha));return wn?(ci.m=ie[wn[0].toLowerCase()],Ha+wn[0].length):-1}function mn(ci,Ta,Ha){var wn=O.exec(Ta.slice(Ha));return wn?(ci.m=Z[wn[0].toLowerCase()],Ha+wn[0].length):-1}function Yn(ci,Ta,Ha){return Mt(ci,r,Ta,Ha)}function Ji(ci,Ta,Ha){return Mt(ci,t,Ta,Ha)}function Ma(ci,Ta,Ha){return Mt(ci,n,Ta,Ha)}function Ko(ci){return s[ci.getDay()]}function Vo(ci){return a[ci.getDay()]}function $s(ci){return f[ci.getMonth()]}function bl(ci){return l[ci.getMonth()]}function gF(ci){return i[+(ci.getHours()>=12)]}function yF(ci){return 1+~~(ci.getMonth()/3)}function _F(ci){return s[ci.getUTCDay()]}function bF(ci){return a[ci.getUTCDay()]}function xF(ci){return f[ci.getUTCMonth()]}function EF(ci){return l[ci.getUTCMonth()]}function SF(ci){return i[+(ci.getUTCHours()>=12)]}function AF(ci){return 1+~~(ci.getUTCMonth()/3)}return{format:function(ci){var Ta=lt(ci+="",ge);return Ta.toString=function(){return ci},Ta},parse:function(ci){var Ta=Qe(ci+="",!1);return Ta.toString=function(){return ci},Ta},utcFormat:function(ci){var Ta=lt(ci+="",Ve);return Ta.toString=function(){return ci},Ta},utcParse:function(ci){var Ta=Qe(ci+="",!0);return Ta.toString=function(){return ci},Ta}}}var Ax={"-":"",_:" ",0:"0"},mu=/^\s*\d+/,jP=/^%/,HP=/[\\^$*+?|[\]().{}]/g;function ja(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function WP(e){return e.replace(HP,"\\$&")}function Rm(e){return new RegExp("^(?:"+e.map(WP).join("|")+")","i")}function Mm(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function GP(e,r,t){var n=mu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function XP(e,r,t){var n=mu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function $P(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function YP(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function qP(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function Tx(e,r,t){var n=mu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function Cx(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function KP(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function QP(e,r,t){var n=mu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function JP(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function Rx(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function eO(e,r,t){var n=mu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function Mx(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function tO(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function rO(e,r,t){var n=mu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function nO(e,r,t){var n=mu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function iO(e,r,t){var n=mu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function aO(e,r,t){var n=jP.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function oO(e,r,t){var n=mu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function sO(e,r,t){var n=mu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function Ix(e,r){return ja(e.getDate(),r,2)}function uO(e,r){return ja(e.getHours(),r,2)}function lO(e,r){return ja(e.getHours()%12||12,r,2)}function cO(e,r){return ja(1+wy.count(bv(e),e),r,3)}function Px(e,r){return ja(e.getMilliseconds(),r,3)}function fO(e,r){return Px(e,r)+"000"}function hO(e,r){return ja(e.getMonth()+1,r,2)}function pO(e,r){return ja(e.getMinutes(),r,2)}function dO(e,r){return ja(e.getSeconds(),r,2)}function vO(e){var r=e.getDay();return r===0?7:r}function mO(e,r){return ja(Ty.count(bv(e)-1,e),r,2)}function Ox(e){var r=e.getDay();return r>=4||r===0?xv(e):xv.ceil(e)}function gO(e,r){return e=Ox(e),ja(xv.count(bv(e),e)+(bv(e).getDay()===4),r,2)}function yO(e){return e.getDay()}function _O(e,r){return ja($g.count(bv(e)-1,e),r,2)}function bO(e,r){return ja(e.getFullYear()%100,r,2)}function xO(e,r){return e=Ox(e),ja(e.getFullYear()%100,r,2)}function EO(e,r){return ja(e.getFullYear()%1e4,r,4)}function SO(e,r){var t=e.getDay();return e=t>=4||t===0?xv(e):xv.ceil(e),ja(e.getFullYear()%1e4,r,4)}function AO(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+ja(r/60|0,"0",2)+ja(r%60,"0",2)}function kx(e,r){return ja(e.getUTCDate(),r,2)}function TO(e,r){return ja(e.getUTCHours(),r,2)}function wO(e,r){return ja(e.getUTCHours()%12||12,r,2)}function CO(e,r){return ja(1+Sx.count(wm(e),e),r,3)}function Dx(e,r){return ja(e.getUTCMilliseconds(),r,3)}function RO(e,r){return Dx(e,r)+"000"}function MO(e,r){return ja(e.getUTCMonth()+1,r,2)}function IO(e,r){return ja(e.getUTCMinutes(),r,2)}function PO(e,r){return ja(e.getUTCSeconds(),r,2)}function OO(e){var r=e.getUTCDay();return r===0?7:r}function kO(e,r){return ja(xx.count(wm(e)-1,e),r,2)}function Lx(e){var r=e.getUTCDay();return r>=4||r===0?Ev(e):Ev.ceil(e)}function DO(e,r){return e=Lx(e),ja(Ev.count(wm(e),e)+(wm(e).getUTCDay()===4),r,2)}function LO(e){return e.getUTCDay()}function BO(e,r){return ja(qg.count(wm(e)-1,e),r,2)}function FO(e,r){return ja(e.getUTCFullYear()%100,r,2)}function NO(e,r){return e=Lx(e),ja(e.getUTCFullYear()%100,r,2)}function UO(e,r){return ja(e.getUTCFullYear()%1e4,r,4)}function zO(e,r){var t=e.getUTCDay();return e=t>=4||t===0?Ev(e):Ev.ceil(e),ja(e.getUTCFullYear()%1e4,r,4)}function ZO(){return"+0000"}function Bx(){return"%"}function Fx(e){return+e}function Nx(e){return Math.floor(+e/1e3)}var Sv,Ux,VO,jO,HO;WO({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function WO(e){return Sv=VP(e),Ux=Sv.format,VO=Sv.parse,jO=Sv.utcFormat,HO=Sv.utcParse,Sv}var Im=1e3,Pm=Im*60,Om=Pm*60,km=Om*24,GO=km*7,zx=km*30,Iy=km*365;function XO(e){return new Date(e)}function $O(e){return e instanceof Date?+e:+new Date(+e)}function Zx(e,r,t,n,i,a,s,l,f){var d=Xb(qu,qu),_=d.invert,x=d.domain,A=f(".%L"),C=f(":%S"),I=f("%I:%M"),O=f("%I %p"),Z=f("%a %d"),Y=f("%b %d"),ie=f("%B"),ge=f("%Y"),Ve=[[s,1,Im],[s,5,5*Im],[s,15,15*Im],[s,30,30*Im],[a,1,Pm],[a,5,5*Pm],[a,15,15*Pm],[a,30,30*Pm],[i,1,Om],[i,3,3*Om],[i,6,6*Om],[i,12,12*Om],[n,1,km],[n,2,2*km],[t,1,GO],[r,1,zx],[r,3,3*zx],[e,1,Iy]];function gt(Qe){return(s(Qe)<Qe?A:a(Qe)<Qe?C:i(Qe)<Qe?I:n(Qe)<Qe?O:r(Qe)<Qe?t(Qe)<Qe?Z:Y:e(Qe)<Qe?ie:ge)(Qe)}function lt(Qe,Mt,Vt,Sr){if(Qe==null&&(Qe=10),typeof Qe=="number"){var mr=Math.abs(Vt-Mt)/Qe,Xr=Pb(function(mn){return mn[2]}).right(Ve,mr);Xr===Ve.length?(Sr=fy(Mt/Iy,Vt/Iy,Qe),Qe=e):Xr?(Xr=Ve[mr/Ve[Xr-1][2]<Ve[Xr][2]/mr?Xr-1:Xr],Sr=Xr[1],Qe=Xr[0]):(Sr=Math.max(fy(Mt,Vt,Qe),1),Qe=l)}return Sr==null?Qe:Qe.every(Sr)}return d.invert=function(Qe){return new Date(_(Qe))},d.domain=function(Qe){return arguments.length?x(Ub.call(Qe,$O)):x().map(XO)},d.ticks=function(Qe,Mt){var Vt=x(),Sr=Vt[0],mr=Vt[Vt.length-1],Xr=mr<Sr,mn;return Xr&&(mn=Sr,Sr=mr,mr=mn),mn=lt(Qe,Sr,mr,Mt),mn=mn?mn.range(Sr,mr+1):[],Xr?mn.reverse():mn},d.tickFormat=function(Qe,Mt){return Mt==null?gt:f(Mt)},d.nice=function(Qe,Mt){var Vt=x();return(Qe=lt(Qe,Vt[0],Vt[Vt.length-1],Mt))?x(rx(Vt,Qe)):d},d.copy=function(){return jg(d,Zx(e,r,t,n,i,a,s,l,f))},d}function YO(){return Fp.apply(Zx(bv,MP,Ty,wy,DP,LP,BP,FP,Ux).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function JN(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Kg(){var e=0,r=1,t,n,i,a,s=qu,l=!1,f;function d(_){return isNaN(_=+_)?f:s(i===0?.5:(_=(a(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}return d.domain=function(_){return arguments.length?(t=a(e=+_[0]),n=a(r=+_[1]),i=t===n?0:1/(n-t),d):[e,r]},d.clamp=function(_){return arguments.length?(l=!!_,d):l},d.interpolator=function(_){return arguments.length?(s=_,d):s},d.unknown=function(_){return arguments.length?(f=_,d):f},function(_){return a=_,t=_(e),n=_(r),i=t===n?0:1/(n-t),d}}function Dm(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Vx(){var e=Am(Kg()(qu));return e.copy=function(){return Dm(e,Vx())},zb.apply(e,arguments)}function qO(){var e=loggish(Kg()).domain([1,10]);return e.copy=function(){return Dm(e,qO()).base(e.base())},initInterpolator.apply(e,arguments)}function KO(){var e=symlogish(Kg());return e.copy=function(){return Dm(e,KO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function jx(){var e=powish(Kg());return e.copy=function(){return Dm(e,jx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function e6(){return jx.apply(null,arguments).exponent(.5)}function QO(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return QO(r).domain(e)},initInterpolator.apply(t,arguments)}function Qg(){var e=0,r=.5,t=1,n,i,a,s,l,f=qu,d,_=!1,x;function A(C){return isNaN(C=+C)?x:(C=.5+((C=+d(C))-i)*(C<i?s:l),f(_?Math.max(0,Math.min(1,C)):C))}return A.domain=function(C){return arguments.length?(n=d(e=+C[0]),i=d(r=+C[1]),a=d(t=+C[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,r,t]},A.clamp=function(C){return arguments.length?(_=!!C,A):_},A.interpolator=function(C){return arguments.length?(f=C,A):f},A.unknown=function(C){return arguments.length?(x=C,A):x},function(C){return d=C,n=C(e),i=C(r),a=C(t),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function Hx(){var e=Am(Qg()(qu));return e.copy=function(){return Dm(e,Hx())},zb.apply(e,arguments)}function JO(){var e=loggish(Qg()).domain([.1,1,10]);return e.copy=function(){return copy(e,JO()).base(e.base())},initInterpolator.apply(e,arguments)}function ek(){var e=symlogish(Qg());return e.copy=function(){return copy(e,ek()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Wx(){var e=powish(Qg());return e.copy=function(){return copy(e,Wx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function t6(){return Wx.apply(null,arguments).exponent(.5)}function Gx(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return Gx(e).unknown(r)},n}var pc,Xx,$x,Py=hi.isNil,tk=hi.isString,rk=hi.uniq,nk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ik=(pc={},(0,F.Z)(pc,Ka.LINEAR,tx),(0,F.Z)(pc,Ka.POWER,xy),(0,F.Z)(pc,Ka.LOG,ox),(0,F.Z)(pc,Ka.IDENTITY,Gx),(0,F.Z)(pc,Ka.SEQUENTIAL,Vx),(0,F.Z)(pc,Ka.TIME,YO),(0,F.Z)(pc,Ka.QUANTILE,cx),(0,F.Z)(pc,Ka.QUANTIZE,fx),(0,F.Z)(pc,Ka.THRESHOLD,hx),(0,F.Z)(pc,Ka.CAT,Zg),(0,F.Z)(pc,Ka.DIVERGING,Hx),pc),ak=(Xx=(0,rr.b2)(),Xx($x=function(){function e(){(0,J.Z)(this,e),(0,F.Z)(this,"scaleOptions",{})}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Ut.Z)(pe().mark(function s(){var l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(t.log(ks.ScaleInitStart,ns.INIT),i.scaleOptions=t.getScaleOptions(),f=a.getLayerStyleAttributes(),d=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(d)&&d.length===0)){x.next=8;break}return x.abrupt("return");case 8:i.caculateScalesForAttributes(f||[],d);case 9:t.log(ks.ScaleInitEnd,ns.INIT);case 10:case"end":return x.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Ut.Z)(pe().mark(function l(f){var d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(f){A.next=2;break}return A.abrupt("return",f);case 2:if(t.log(ks.ScaleInitStart,ns.UPDATE),i.scaleOptions=t.getScaleOptions(),d=a.getLayerStyleAttributes(),_=t.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(d||[],_),t.log(ks.ScaleInitEnd,ns.UPDATE),t.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var s=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var f=s.filter(function(d){return d.needRescale});f.length&&i.caculateScalesForAttributes(f,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(Py(l)?[]:l);var f=[];s.names.forEach(function(d){var _;f.push(i.createScale(d,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),f.some(function(d){return d.type===hv.VARIABLE})?(s.type=hv.VARIABLE,f.forEach(function(d){if(!s.callback&&s.values!=="text"){var _;switch((_=d.option)===null||_===void 0?void 0:_.type){case Ka.LOG:case Ka.LINEAR:case Ka.POWER:if(s.values&&s.values.length>2){var x=d.scale.ticks(s.values.length);d.scale.domain(x)}s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case Ka.QUANTILE:case Ka.QUANTIZE:case Ka.THRESHOLD:d.scale.range(s.values);break;case Ka.IDENTITY:break;case Ka.CAT:s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case Ka.DIVERGING:case Ka.SEQUENTIAL:d.scale.interpolator(UI(s.values));break}}if(s.values==="text"){var A;d.scale.range((A=d.option)===null||A===void 0?void 0:A.domain)}})):(s.type=hv.CONSTANT,s.defaultValues=f.map(function(d,_){return d.scale(s.names[_])})),s.scalers=f.map(function(d){return{field:d.field,func:d.scale,option:d.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:tk(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var s,l,f=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===t?this.scaleOptions[n]:this.scaleOptions[t],d={field:t,scale:void 0,type:hv.VARIABLE,option:f};if(!a||!a.length)return f&&f.type?d.scale=this.createDefaultScale(f):(d.scale=Zg([t]),d.type=hv.CONSTANT),d;var _=(l=a.find(function(C){return!Py(C[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||Py(_)&&!f)d.scale=Zg([t]),d.type=hv.CONSTANT;else{var x=f&&f.type||this.getDefaultType(_);i==="text"&&(x=Ka.CAT),i===void 0&&(x=Ka.IDENTITY);var A=this.createScaleConfig(x,t,f,a);d.scale=this.createDefaultScale(A),d.option=A}return d}},{key:"getDefaultType",value:function(t){var n=Ka.LINEAR;return typeof t=="string"&&(n=nk.test(t)?Ka.TIME:Ka.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var s={type:t},l=[];if(t===Ka.QUANTILE){var f=new Map;a==null||a.forEach(function(x){f.set(x._id,x[n])}),l=Array.from(f.values())}else l=(a==null?void 0:a.map(function(x){return x[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(t===Ka.CAT||t===Ka.IDENTITY)s.domain=rk(l);else if(t===Ka.QUANTILE)s.domain=l;else if(t===Ka.DIVERGING){var d=Ab(l),_=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(d[0]+d[1])/2;s.domain=[d[0],_,d[1]]}else s.domain=Ab(l);return(0,V.Z)((0,V.Z)({},s),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,s=t.clamp,l=t.nice,f=ik[n]();return i&&f.domain&&f.domain(i),a&&f.unknown(a),s!==void 0&&f.clamp&&f.clamp(s),l!==void 0&&f.nice&&f.nice(l),f}}]),e}())||$x),Yx,qx,ok=(Yx=(0,rr.b2)(),Yx(qx=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms((0,V.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||qx),Kx,Qx,sk=(Kx=(0,rr.b2)(),Kx(Qx=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var s;(s=t.masks).push.apply(s,(0,er.Z)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||Qx),uk=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;(0,J.Z)(this,e),(0,F.Z)(this,"tileResource",new Map),(0,F.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return(0,j.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){var i=this,a,s;return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var d=(0,Ut.Z)(pe().mark(function _(x){return pe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,i.layerService.renderTileLayer(x);case 2:case"end":return C.stop()}},_)}));return function(_){return d.apply(this,arguments)}}()),f.next=4,Promise.all(s);case 4:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,er.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,er.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),lk=B(32676);function ck(e,r,t){t===void 0&&(t={});var n=yn(e),i=yn(r),a=lk.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?dr(a[0],t.properties):nn(a,t.properties)}var fk=ck,hk=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var s=dr(a.coordinates);n===null?n=s:n=fk(n,s)}),i&&(n.properties=(0,V.Z)({},i)),n}}]),e}(),Lm="select",Bm="active",pk=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;(0,J.Z)(this,e),(0,F.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new hk}return(0,j.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(s=this.parent.getContainer(),l=s.get(it.IPickingService),i.type!=="RasterLayer"){x.next=8;break}if(f=this.tileLayerService.getVisibleTileBylngLat(a.lngLat),!(f&&f.getMainLayer()!==void 0)){x.next=7;break}return d=f.getMainLayer(),x.abrupt("return",d.layerPickService.pickRasterLayer(d,a,this.parent));case 7:return x.abrupt("return",!1);case 8:return this.pickRender(a),x.abrupt("return",l.pickFromPickingFBO(i,a));case 10:case"end":return x.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"selectFeature",value:function(t){var n=(0,Cn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Lm,l),this.updateHighLight(i,a,s,Lm)}},{key:"highlightPickedFeature",value:function(t){var n=(0,Cn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Bm,l),this.updateHighLight(i,a,s,Bm)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case Lm:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case Bm:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Lm),n=this.tilePickID.get(Bm);if(t){var i=this.pickId2Color(t),a=(0,Cn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.updateHighLight(s,l,f,Lm);return}if(n){var d=this.pickId2Color(n),_=(0,Cn.Z)(d,3),x=_[0],A=_[1],C=_[2];this.updateHighLight(x,A,C,Bm);return}}},{key:"color2PickId",value:function(t,n,i){return La(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return fa(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,er.Z)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function dk(e){return e==="PolygonLayer"?Dg:e==="LineLayer"?ty:kg}function vk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function mk(e){var r=gk();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function gk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pd=function(e){(0,Ne.Z)(t,e);var r=mk(t);function t(n,i){var a;return(0,J.Z)(this,t),a=r.call(this),(0,F.Z)((0,Me.Z)(a),"visible",!0),(0,F.Z)((0,Me.Z)(a),"layers",[]),(0,F.Z)((0,Me.Z)(a),"isLoaded",!1),(0,F.Z)((0,Me.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,j.Z)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,Cn.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],f=a[2],d=a[3],_=i.lng,x=i.lat;return _>=s&&_<=f&&x>=l&&x<=d}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,V.Z)((0,V.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:vk(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(f){if(!f.tileLayer)return l.push(f),f;var d=f.tileLayer,_=d.getTile(i.sourceTile.key),x=_==null?void 0:_.getLayers()[0];x&&l.push(x)}),l}},{key:"addTileMask",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=new Dg({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),l=_m(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),_.next=5,s.init();case 5:return this.tileMask=s,f=this.getMainLayer(),f!==void 0&&(f.tileMask=s),_.abrupt("return",s);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s,l){var f;return pe().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return f=_m(this.parent.sceneContainer),l.setContainer(f,this.parent.sceneContainer),_.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(s){var l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s.isTileLayer=!0,l=_m(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),d.next=6,s.init();case 6:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,F.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(eo.EventEmitter);function yk(e){var r=_k();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function _k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bk=function(e){(0,Ne.Z)(t,e);var r=yk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,f=new ty().source(s.data,s.options).size(1).shape("line").color("red"),d=new kg({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),x.next=6,this.addLayer(f);case 6:return x.next=8,this.addLayer(d);case 8:this.isLoaded=!0;case 9:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(Pd);function xk(e){var r=Ek();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Ek(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sk=function(e){(0,Ne.Z)(t,e);var r=xk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Z1((0,V.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,O=A;d[O]((C=s[O])===null||C===void 0?void 0:C.field,(I=s[O])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Pd);function Ak(e){var r=Tk();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Tk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wk=function(e){(0,Ne.Z)(t,e);var r=Ak(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new pb((0,V.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,O=A;d[O]((C=s[O])===null||C===void 0?void 0:C.field,(I=s[O])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,f=this.getFeatures(s);return{data:{type:"FeatureCollection",features:f},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(Pd),Ck=["rasterData"];function Rk(e){var r=Mk();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Mk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ik=function(e){(0,Ne.Z)(t,e);var r=Rk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Lg((0,V.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,O=A;d[O]((C=s[O])===null||C===void 0?void 0:C.field,(I=s[O])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,ji.Z)(a,Ck);return{data:s,options:{parser:(0,V.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(Pd);function Pk(e){var r=Ok();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Ok(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kk=function(e){(0,Ne.Z)(t,e);var r=Pk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Lg((0,V.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,O=A;d[O]((C=s[O])===null||C===void 0?void 0:C.field,(I=s[O])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Pd),Dk=["rasterData"];function Lk(e){var r=Bk();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function Bk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fk={positions:[0,1],colors:["#000","#fff"]},Nk=function(e){(0,Ne.Z)(t,e);var r=Lk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_,x,A;return pe().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=this.getLayerOptions(),_=d.rampColors,x=d.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,x),A=new Lg((0,V.Z)((0,V.Z)({},l),{},{colorTexture:this.colorTexture})).source(f.data,f.options),s&&Object.keys(s).forEach(function(O){var Z,Y,ie=O;A[ie]((Z=s[ie])===null||Z===void 0?void 0:Z.field,(Y=s[ie])===null||Y===void 0?void 0:Y.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,ji.Z)(a,Dk);return{data:s,options:{parser:(0,V.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var f=s,d=f.rampColors,_=d===void 0?Fk:d,x=f.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,x||gc(_)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(Pd);function Uk(e){var r=zk();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function zk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jg=function(e){(0,Ne.Z)(t,e);var r=Uk(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=dk(this.parent.type),d=this.getSourceOption(),d){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return _=new f((0,V.Z)({},l)).source(d.data,d.options),Object.keys(s).forEach(function(C){var I,O,Z=C;_[Z]((I=s[Z])===null||I===void 0?void 0:I.field,(O=s[Z])===null||O===void 0?void 0:O.values)}),A.next=12,this.addLayer(_);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,f=a.featureId,d=f===void 0?"id":f,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:d},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),t}(Pd);function Zk(e){var r=e.type;switch(r){case"PolygonLayer":return Jg;case"LineLayer":return Jg;case"PointLayer":return Jg;case"TileDebugLayer":return bk;case"MaskLayer":return wk;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Iu.RGB:case Iu.CUSTOMRGB:return Ik;case Iu.ARRAYBUFFER:case Iu.CUSTOMARRAYBUFFER:return Nk;case Iu.TERRAINRGB:case Iu.CUSTOMTERRAINRGB:return kk;default:return Sk}default:return Jg}}var Vk=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],jk=hi.debounce,Jx=function(){function e(r){var t=this;(0,J.Z)(this,e),(0,F.Z)(this,"initedTileset",!1),(0,F.Z)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var f=t.parent.getLayerConfig(),d=f.visible;l<2&&d?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!d&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===s.toString()||(t.lastViewStates={zoom:l,latLonBounds:s},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,F.Z)(this,"viewchange",jk(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(it.IRendererService),this.layerService=n.get(it.ILayerService),this.mapService=n.get(it.IMapService),this.pickingService=n.get(it.IPickingService),this.tileLayerService=new uk({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new pk({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return(0,j.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(s,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){var i=this,a,s,l;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.tilesetManager){d.next=2;break}return d.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),l=this.tilesetManager.tiles.filter(function(_){return _.isLoaded}).filter(function(_){return _.isVisibleChange}).filter(function(_){return _.data}).filter(function(_){return _.z>=a&&_.z<s}),d.next=7,Promise.all(l.map(function(){var _=(0,Ut.Z)(pe().mark(function x(A){var C,I;return pe().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(i.tileLayerService.hasTile(A.key)){Z.next=9;break}return C=Zk(i.parent),I=new C(A,i.parent),Z.next=5,I.initTileLayer();case 5:i.tilePickService.setPickState(),I.getLayers().length!==0&&(i.tileLayerService.addTile(I),i.tileLayerService.updateTileVisible(A),i.layerService.reRender()),Z.next=12;break;case 9:i.tileLayerService.updateTileVisible(A),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return Z.stop()}},x)}));return function(x){return _.apply(this,arguments)}}()));case 7:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 8:case"end":return d.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;Vk.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return a.apply(void 0,l),n.getLayers().map(function(d){d[i].apply(d,l)}),i==="style"&&n.getTiles().forEach(function(d){return d.styleUpdate.apply(d,l)}),t}})}}]),e}(),eE,tE,Hk=(eE=(0,rr.b2)(),eE(tE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"build",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Ut.Z)(pe().mark(function i(){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.getSource().isTile){s.next=4;break}return t.prepareBuildModel(),t.tileLayer=new Jx(t),s.abrupt("return");case 4:return t.log(ks.BuildModelStart,ns.INIT),s.next=7,n.initLayerModel(t);case 7:t.log(ks.BuildModelEnd,ns.INIT);case 8:case"end":return s.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Ut.Z)(pe().mark(function a(s){return pe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",!1);case 2:if(!t.getSource().isTile){f.next=5;break}return t.tileLayer=new Jx(t),f.abrupt("return",!1);case 5:return t.log(ks.BuildModelStart,ns.UPDATE),f.next=8,n.prepareLayerModel(t);case 8:return t.log(ks.BuildModelEnd,ns.UPDATE),f.abrupt("return",!0);case 10:case"end":return f.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||tE),rE,nE,Wk=(rE=(0,rr.b2)(),rE(nE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||nE),iE,aE,Gk=["type"],oE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Xk={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},$k={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Yk={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function qk(e){var r={u_DirectionalLights:new Array(3).fill((0,V.Z)({},$k)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,V.Z)({},Yk)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[Xk]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=(0,ji.Z)(t,Gk),s=oE[i].lights,l=oE[i].num,f=r[l];r[s][f]=(0,V.Z)((0,V.Z)({},r[s][f]),a),r[l]++}),r}var Kk=(iE=(0,rr.b2)(),iE(aE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms((0,V.Z)({},qk()))})})}}]),e}())||aE),sE,uE,Qk=(sE=(0,rr.b2)(),sE(uE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var f=t.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,x=_===void 0?[]:_;i.enabled=!!d&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=d1(t,x,s,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var f=a.getViewportSize(),d=f.width,_=f.height;t.multiPassRenderer.resize(d,_)}})}}]),e}())||uE),lE,cE,Jk=hi.isNumber,Av={NONE:0,ENCODE:1,HIGHLIGHT:2},e4=(lE=(0,rr.b2)(),lE(cE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"pickOption2Array",value:function(){var t=[];return this.pickingUniformMap.forEach(function(n,i){Jk(n)?t.push(n):t.push.apply(t,(0,er.Z)(n))}),t}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(f){i.pickingUniformMap.set(f,t[f])});var a=n.getLayerConfig().pickingBuffer||0,s=Number(n.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",a),this.pickingUniformMap.set("u_shaderPick",s);var l=n.getPickingUniformBuffer();l.subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.styleAttributeService,l;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:Fn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:qn.PICKING_COLOR,buffer:{data:[],type:G.FLOAT},size:3,update:function(x){var A=x.id;return d?fa(A):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:Av.ENCODE},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:Av.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:Av.HIGHLIGHT},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:Av.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),_=d.highlightColor,x=d.activeMix,A=x===void 0?0:x,C=typeof _=="string"?_i(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:La(new Uint8Array(f))});var I={u_PickingStage:Av.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:C.map(function(O){return O*255}),u_activeMix:A};i.updatePickOption(I,t),t.models.forEach(function(O){return O.addUniforms(I)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),_=d.selectColor,x=d.selectMix,A=x===void 0?0:x,C=typeof _=="string"?_i(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:La(new Uint8Array(f))});var I={u_PickingStage:Av.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:C.map(function(O){return O*255}),u_activeMix:A,u_CurrentSelectedId:f,u_SelectColor:C.map(function(O){return O*255}),u_EnableSelect:1};i.updatePickOption(I,t),t.models.forEach(function(O){return O.addUniforms(I)})})}}]),e}())||cE),t4=["mvt","geojsonvt","testTile"];function r4(e){var r=e.getSource();return t4.includes(r.parser.type)}function r6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var fE,hE,n4=(fE=(0,rr.b2)(),fE(hE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){r4(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Fn.Attribute,descriptor:{name:"a_Position",shaderLocation:qn.POSITION,buffer:{data:[],type:G.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Fn.Attribute,descriptor:{name:"a_Color",shaderLocation:qn.COLOR,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Fn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:qn.VERTEX_ID,buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||hE),pE,dE,vE,mE,gE,yE,_E,Od,bE,xE,EE,SE,AE,i4=(pE=(0,rr.b2)(),dE=(0,rr.f3)(it.ICameraService),vE=(0,rr.f3)(it.ICoordinateSystemService),mE=(0,rr.f3)(it.IRendererService),gE=(0,rr.f3)(it.IMapService),yE=(0,rr.f3)(it.ILayerService),pE(_E=(Od=function(){function e(){(0,J.Z)(this,e),Ni(this,"cameraService",bE,this),Ni(this,"coordinateSystemService",xE,this),Ni(this,"rendererService",EE,this),Ni(this,"mapService",SE,this),Ni(this,"layerService",AE,this)}return(0,j.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(f),i==="GAODE2.x"){n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter();var d=t.getLayerUniformBuffer();d.subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,er.Z)(a),(0,er.Z)(s))).buffer)})}var _=n.rendererService.getViewportSize(),x=_.width,A=_.height,C=n.generateUBO(a,s,x,A),I=C.data,O=C.uniforms;if(n.layerService.alreadyInRendering&&n.rendererService.uniformBuffers[0]){var Z=n.rendererService.uniformBuffers[0];Z.subData({offset:0,data:I})}var Y=n.rendererService.queryVerdorInfo();Y==="WebGL1"&&t.models.forEach(function(ie){ie.addUniforms((0,V.Z)((0,V.Z)({},O),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),f=this.cameraService.getViewMatrix(),d=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),x=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),C=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),O=this.cameraService.getZoomScale(),Z=this.coordinateSystemService.getPixelsPerMeter(),Y=this.coordinateSystemService.getCoordinateSystem(),ie=this.cameraService.getCameraPosition(),ge=window.devicePixelRatio,Ve=this.coordinateSystemService.getViewportCenter(),gt=[i,a],lt=this.cameraService.getFocalDistance(),Qe=[].concat((0,er.Z)(f),(0,er.Z)(l),(0,er.Z)(d),(0,er.Z)(_),(0,er.Z)(x),(0,er.Z)(A),[C],(0,er.Z)(I),[O],(0,er.Z)(Z),[Y],(0,er.Z)(ie),[ge],(0,er.Z)(Ve),gt,[lt,0,0,0]);return{data:Qe,uniforms:(s={},(0,F.Z)(s,Td.ProjectionMatrix,l),(0,F.Z)(s,Td.ViewMatrix,f),(0,F.Z)(s,Td.ViewProjectionMatrix,d),(0,F.Z)(s,Td.Zoom,C),(0,F.Z)(s,Td.ZoomScale,O),(0,F.Z)(s,Td.FocalDistance,lt),(0,F.Z)(s,Td.CameraPosition,ie),(0,F.Z)(s,ac.CoordinateSystem,Y),(0,F.Z)(s,ac.ViewportCenter,Ve),(0,F.Z)(s,ac.ViewportCenterProjection,x),(0,F.Z)(s,ac.PixelsPerDegree,A),(0,F.Z)(s,ac.PixelsPerDegree2,I),(0,F.Z)(s,ac.PixelsPerMeter,Z),(0,F.Z)(s,ac.Mvp,t),(0,F.Z)(s,"u_sceneCenterMercator",n),(0,F.Z)(s,"u_ViewportSize",gt),(0,F.Z)(s,"u_ModelMatrix",_),(0,F.Z)(s,"u_DevicePixelRatio",ge),s)}}}]),e}(),bE=Li(Od.prototype,"cameraService",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=Li(Od.prototype,"coordinateSystemService",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=Li(Od.prototype,"rendererService",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=Li(Od.prototype,"mapService",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=Li(Od.prototype,"layerService",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od))||_E),TE,wE,a4=(TE=(0,rr.b2)(),TE(wE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||wE),CE,RE,o4=(CE=(0,rr.b2)(),CE(RE=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||RE);Bl.bind(it.ILayerPlugin).to(PI).inRequestScope(),Bl.bind(it.ILayerPlugin).to(n4).inRequestScope(),Bl.bind(it.ILayerPlugin).to(ak).inRequestScope(),Bl.bind(it.ILayerPlugin).to(II).inRequestScope(),Bl.bind(it.ILayerPlugin).to(Wk).inRequestScope(),Bl.bind(it.ILayerPlugin).to(sk).inRequestScope(),Bl.bind(it.ILayerPlugin).to(o4).inRequestScope(),Bl.bind(it.ILayerPlugin).to(a4).inRequestScope(),Bl.bind(it.ILayerPlugin).to(Qk).inRequestScope(),Bl.bind(it.ILayerPlugin).to(i4).inRequestScope(),Bl.bind(it.ILayerPlugin).to(ok).inRequestScope(),Bl.bind(it.ILayerPlugin).to(Kk).inRequestScope(),Bl.bind(it.ILayerPlugin).to(e4).inRequestScope(),Bl.bind(it.ILayerPlugin).to(Hk).inRequestScope();function n6(e){var r=s4();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function s4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i6=null;function u4(e){var r=l4();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function l4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c4=function(e){(0,Ne.Z)(t,e);var r=u4(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,F.Z)((0,Me.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,F.Z)((0,Me.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,V.Z)((0,V.Z)({},Ra((0,Te.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:Ir.BOTTOMRIGHT,name:"zoom",zoomInText:$h("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:$h("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){Ra((0,Te.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=ta("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){Cl(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,f){var d=ta("button",s,l);return typeof i=="string"?d.innerHTML=i:d.append(i),d.title=a,f&&d.addEventListener("click",f),d}}]),t}(dv);function f4(e){var r=h4();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ME=function(e){(0,Ne.Z)(t,e);var r=f4(t);function t(n){var i;(0,J.Z)(this,t),i=r.call(this),(0,F.Z)((0,Me.Z)(i),"isShow",!0),(0,F.Z)((0,Me.Z)(i),"onMouseMove",function(s){var l,f=i.mapsService.getMapContainer(),d=(l=f==null?void 0:f.getBoundingClientRect())!==null&&l!==void 0?l:{},_=d.left,x=_===void 0?0:_,A=d.top,C=A===void 0?0:A;i.setPopupPosition(s.clientX-x,s.clientY-C)}),(0,F.Z)((0,Me.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,f=s.lat,d=i.mapsService.lngLatToContainer([l,f]),_=d.x,x=d.y;i.setPopupPosition(_,x)}}),(0,F.Z)((0,Me.Z)(i),"updateLngLatPositionWhenZoom",function(s){if(!(!i.mapsService||i.popupOption.followCursor)){var l=i.lngLat,f=l.lng,d=l.lat,_=i.mapsService.lngLatToContainer([f,d]),x=_.x,A=_.y,C=s.map,I=C.getSize();I.x=I.x/2,I.y=I.y/2;var O=s.center,Z=s.zoom,Y=C.DE(i.lngLat,Z,O);Y.x=Math.round(Y.x),Y.y=Math.round(Y.y),i.setPopupPosition(Y.x,Y.y,!0)}}),(0,F.Z)((0,Me.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,F.Z)((0,Me.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,F.Z)((0,Me.Z)(i),"updatePosition",function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,f=!!i.lngLat,d=i.popupOption,_=d.className,x=d.style,A=d.maxWidth,C=d.anchor,I=d.stopPropagation;if(!(!i.mapsService||!f||!i.content)){var O=i.mapsService.getMarkerContainer();if(!i.container&&O&&(i.container=ta("div","l7-popup ".concat(_!=null?_:""," ").concat(i.isShow?"":"l7-popup-hide"),O),x&&i.container.setAttribute("style",x),i.tip=ta("div","l7-popup-tip",i.container),i.container.appendChild(i.content),I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ie){i.container.addEventListener(ie,function(ge){ge.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),l?i.updateLngLatPositionWhenZoom(s):i.updateLngLatPosition(),_u(i.container,"".concat(Ia[C])),Zl(i.container,C,"popup"),A){var Z=i.container.getBoundingClientRect(),Y=Z.width;Y>parseFloat(A)&&(i.container.style.width=A)}else i.container.style.removeProperty("width")}}),(0,F.Z)((0,Me.Z)(i),"updateWhenZoom",function(s){i.updatePosition(s,!0)}),(0,F.Z)((0,Me.Z)(i),"update",function(){i.updatePosition(null,!1)}),i.popupOption=(0,V.Z)((0,V.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,j.Z)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(it.IMapService),this.sceneService=i.get(it.ISceneService),this.layerService=i.get(it.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,f=a.title;return s?this.setHTML(s):l&&this.setText(l),f&&this.setTitle(f),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&Oi(this.content),this.container&&(Oi(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,V.Z)((0,V.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Oi(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&yu(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&uu(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=ta("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Cl(this.contentTitle),il(this.contentTitle,i)):this.contentTitle&&(Oi(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:_a.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),il(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Oi(this.content),this.contentTitle=void 0,this.content=ta("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=$h("l7-icon-guanbi");uu(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=ta("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.container){var l=this.popupOption.offsets;this.container.style.left=i+l[0]+"px",this.container.style.top=a-l[1]+"px",s?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(eo.EventEmitter);function a6(e){var r=p4();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function p4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o6=hi.get,s6=null;function d4(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}d4(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item input[type='radio'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -ms-touch-action: none;
      touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var v4=B(81550),m4=B.n(v4),g4=function(){function e(r,t){(0,J.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),qh,Fm,Np,Gc,Nm,Up,Um,e0,lh,kd,Ou,ch,fh,t0,y4=(qh={},(0,F.Z)(qh,G.POINTS,"points"),(0,F.Z)(qh,G.LINES,"lines"),(0,F.Z)(qh,G.LINE_LOOP,"line loop"),(0,F.Z)(qh,G.LINE_STRIP,"line strip"),(0,F.Z)(qh,G.TRIANGLES,"triangles"),(0,F.Z)(qh,G.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(qh,G.TRIANGLE_STRIP,"triangle strip"),qh),IE=(Fm={},(0,F.Z)(Fm,G.STATIC_DRAW,"static"),(0,F.Z)(Fm,G.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Fm,G.STREAM_DRAW,"stream"),Fm),Oy=(Np={},(0,F.Z)(Np,G.BYTE,"int8"),(0,F.Z)(Np,G.INT,"int32"),(0,F.Z)(Np,G.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Np,G.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Np,G.UNSIGNED_INT,"uint32"),(0,F.Z)(Np,G.FLOAT,"float"),Np),_4=(Gc={},(0,F.Z)(Gc,G.ALPHA,"alpha"),(0,F.Z)(Gc,G.LUMINANCE,"luminance"),(0,F.Z)(Gc,G.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(Gc,G.RGB,"rgb"),(0,F.Z)(Gc,G.RGBA,"rgba"),(0,F.Z)(Gc,G.RGBA4,"rgba4"),(0,F.Z)(Gc,G.RGB5_A1,"rgb5 a1"),(0,F.Z)(Gc,G.RGB565,"rgb565"),(0,F.Z)(Gc,G.DEPTH_COMPONENT,"depth"),(0,F.Z)(Gc,G.DEPTH_STENCIL,"depth stencil"),Gc),b4=(Nm={},(0,F.Z)(Nm,G.DONT_CARE,"dont care"),(0,F.Z)(Nm,G.NICEST,"nice"),(0,F.Z)(Nm,G.FASTEST,"fast"),Nm),PE=(Up={},(0,F.Z)(Up,G.NEAREST,"nearest"),(0,F.Z)(Up,G.LINEAR,"linear"),(0,F.Z)(Up,G.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(Up,G.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(Up,G.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(Up,G.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Up),OE=(Um={},(0,F.Z)(Um,G.REPEAT,"repeat"),(0,F.Z)(Um,G.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(Um,G.MIRRORED_REPEAT,"mirror"),Um),x4=(e0={},(0,F.Z)(e0,G.NONE,"none"),(0,F.Z)(e0,G.BROWSER_DEFAULT_WEBGL,"browser"),e0),E4=(lh={},(0,F.Z)(lh,G.NEVER,"never"),(0,F.Z)(lh,G.ALWAYS,"always"),(0,F.Z)(lh,G.LESS,"less"),(0,F.Z)(lh,G.LEQUAL,"lequal"),(0,F.Z)(lh,G.GREATER,"greater"),(0,F.Z)(lh,G.GEQUAL,"gequal"),(0,F.Z)(lh,G.EQUAL,"equal"),(0,F.Z)(lh,G.NOTEQUAL,"notequal"),lh),kE=(kd={},(0,F.Z)(kd,G.FUNC_ADD,"add"),(0,F.Z)(kd,G.MIN_EXT,"min"),(0,F.Z)(kd,G.MAX_EXT,"max"),(0,F.Z)(kd,G.FUNC_SUBTRACT,"subtract"),(0,F.Z)(kd,G.FUNC_REVERSE_SUBTRACT,"reverse subtract"),kd),r0=(Ou={},(0,F.Z)(Ou,G.ZERO,"zero"),(0,F.Z)(Ou,G.ONE,"one"),(0,F.Z)(Ou,G.SRC_COLOR,"src color"),(0,F.Z)(Ou,G.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(Ou,G.SRC_ALPHA,"src alpha"),(0,F.Z)(Ou,G.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(Ou,G.DST_COLOR,"dst color"),(0,F.Z)(Ou,G.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(Ou,G.DST_ALPHA,"dst alpha"),(0,F.Z)(Ou,G.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(Ou,G.CONSTANT_COLOR,"constant color"),(0,F.Z)(Ou,G.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(Ou,G.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(Ou,G.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(Ou,G.SRC_ALPHA_SATURATE,"src alpha saturate"),Ou),S4=(ch={},(0,F.Z)(ch,G.NEVER,"never"),(0,F.Z)(ch,G.ALWAYS,"always"),(0,F.Z)(ch,G.LESS,"less"),(0,F.Z)(ch,G.LEQUAL,"lequal"),(0,F.Z)(ch,G.GREATER,"greater"),(0,F.Z)(ch,G.GEQUAL,"gequal"),(0,F.Z)(ch,G.EQUAL,"equal"),(0,F.Z)(ch,G.NOTEQUAL,"notequal"),ch),Tv=(fh={},(0,F.Z)(fh,G.ZERO,"zero"),(0,F.Z)(fh,G.KEEP,"keep"),(0,F.Z)(fh,G.REPLACE,"replace"),(0,F.Z)(fh,G.INVERT,"invert"),(0,F.Z)(fh,G.INCR,"increment"),(0,F.Z)(fh,G.DECR,"decrement"),(0,F.Z)(fh,G.INCR_WRAP,"increment wrap"),(0,F.Z)(fh,G.DECR_WRAP,"decrement wrap"),fh),A4=(t0={},(0,F.Z)(t0,G.FRONT,"front"),(0,F.Z)(t0,G.BACK,"back"),t0),T4=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:IE[i||G.STATIC_DRAW],type:Oy[a||G.UNSIGNED_BYTE]})}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),w4=function(){function e(r,t){(0,J.Z)(this,e);var n=t.data,i=t.usage,a=t.type,s=t.count;this.elements=r.elements({data:n,usage:IE[i||G.STATIC_DRAW],type:Oy[a||G.UNSIGNED_BYTE],count:s})}return(0,j.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),C4=function(){function e(r,t){(0,J.Z)(this,e);var n=t.width,i=t.height,a=t.color,s=t.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(f){return f.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),Xc=B(95147),wv=B(25897),R4=B(81957),kn=B(97582),M4=B(90857),DE=M4,Je;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(Je||(Je={}));var ya;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(ya||(ya={}));var Hi;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Hi||(Hi={}));var zm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(zm||(zm={}));var Nl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Nl||(Nl={}));var Qi;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Qi||(Qi={}));var ou;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(ou||(ou={}));var yl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(yl||(yl={}));var os;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(os||(os={}));var Gs;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Gs||(Gs={}));var Cs;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(Cs||(Cs={}));var Qa;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Qa||(Qa={}));var Ef;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(Ef||(Ef={}));var Dd;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Dd||(Dd={}));var LE;(function(e){e.LOADED="loaded"})(LE||(LE={}));var Yi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Yi||(Yi={}));var ku;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(ku||(ku={}));var su;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(su||(su={}));var $o;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})($o||($o={}));function u6(e,r,t,n){var i=Yi.TEXTURE_2D,a=1,s=ku.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var Yo;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})(Yo||(Yo={}));var hh;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(hh||(hh={}));var Cv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Cv||(Cv={}));var n0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(n0||(n0={}));var Rr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Rr||(Rr={}));var Nn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Nn||(Nn={}));function l6(e){return e}var Tn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(Tn||(Tn={}));function ti(e,r,t){return e<<16|r<<8|t}var It;(function(e){e[e.ALPHA=ti(Rr.U8,Nn.A,Tn.None)]="ALPHA",e[e.U8_LUMINANCE=ti(Rr.U8,Nn.A,Tn.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=ti(Rr.F16,Nn.A,Tn.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=ti(Rr.F32,Nn.A,Tn.Luminance)]="F32_LUMINANCE",e[e.F16_R=ti(Rr.F16,Nn.R,Tn.None)]="F16_R",e[e.F16_RG=ti(Rr.F16,Nn.RG,Tn.None)]="F16_RG",e[e.F16_RGB=ti(Rr.F16,Nn.RGB,Tn.None)]="F16_RGB",e[e.F16_RGBA=ti(Rr.F16,Nn.RGBA,Tn.None)]="F16_RGBA",e[e.F32_R=ti(Rr.F32,Nn.R,Tn.None)]="F32_R",e[e.F32_RG=ti(Rr.F32,Nn.RG,Tn.None)]="F32_RG",e[e.F32_RGB=ti(Rr.F32,Nn.RGB,Tn.None)]="F32_RGB",e[e.F32_RGBA=ti(Rr.F32,Nn.RGBA,Tn.None)]="F32_RGBA",e[e.U8_R=ti(Rr.U8,Nn.R,Tn.None)]="U8_R",e[e.U8_R_NORM=ti(Rr.U8,Nn.R,Tn.Normalized)]="U8_R_NORM",e[e.U8_RG=ti(Rr.U8,Nn.RG,Tn.None)]="U8_RG",e[e.U8_RG_NORM=ti(Rr.U8,Nn.RG,Tn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=ti(Rr.U8,Nn.RGB,Tn.None)]="U8_RGB",e[e.U8_RGB_NORM=ti(Rr.U8,Nn.RGB,Tn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=ti(Rr.U8,Nn.RGB,Tn.sRGB|Tn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=ti(Rr.U8,Nn.RGBA,Tn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=ti(Rr.U8,Nn.RGBA,Tn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=ti(Rr.U8,Nn.RGBA,Tn.sRGB|Tn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=ti(Rr.U16,Nn.R,Tn.None)]="U16_R",e[e.U16_R_NORM=ti(Rr.U16,Nn.R,Tn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=ti(Rr.U16,Nn.RG,Tn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=ti(Rr.U16,Nn.RGBA,Tn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=ti(Rr.U16,Nn.RGBA,Tn.None)]="U16_RGBA",e[e.U16_RGB=ti(Rr.U16,Nn.RGB,Tn.None)]="U16_RGB",e[e.U16_RG=ti(Rr.U16,Nn.RG,Tn.None)]="U16_RG",e[e.U32_R=ti(Rr.U32,Nn.R,Tn.None)]="U32_R",e[e.U32_RG=ti(Rr.U32,Nn.RG,Tn.None)]="U32_RG",e[e.U32_RGB=ti(Rr.U32,Nn.RGB,Tn.None)]="U32_RGB",e[e.U32_RGBA=ti(Rr.U32,Nn.RGBA,Tn.None)]="U32_RGBA",e[e.S8_R=ti(Rr.S8,Nn.R,Tn.None)]="S8_R",e[e.S8_R_NORM=ti(Rr.S8,Nn.R,Tn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=ti(Rr.S8,Nn.RG,Tn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=ti(Rr.S8,Nn.RGB,Tn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=ti(Rr.S8,Nn.RGBA,Tn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=ti(Rr.S16,Nn.R,Tn.None)]="S16_R",e[e.S16_RG=ti(Rr.S16,Nn.RG,Tn.None)]="S16_RG",e[e.S16_RG_NORM=ti(Rr.S16,Nn.RG,Tn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=ti(Rr.S16,Nn.RGB,Tn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=ti(Rr.S16,Nn.RGBA,Tn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=ti(Rr.S16,Nn.RGBA,Tn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=ti(Rr.S32,Nn.R,Tn.None)]="S32_R",e[e.S32_RG=ti(Rr.S32,Nn.RG,Tn.None)]="S32_RG",e[e.S32_RGB=ti(Rr.S32,Nn.RGB,Tn.None)]="S32_RGB",e[e.S32_RGBA=ti(Rr.S32,Nn.RGBA,Tn.None)]="S32_RGBA",e[e.U16_RGBA_5551=ti(Rr.U16_PACKED_5551,Nn.RGBA,Tn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=ti(Rr.U16_PACKED_565,Nn.RGB,Tn.Normalized)]="U16_RGB_565",e[e.BC1=ti(Rr.BC1,Nn.RGBA,Tn.Normalized)]="BC1",e[e.BC1_SRGB=ti(Rr.BC1,Nn.RGBA,Tn.Normalized|Tn.sRGB)]="BC1_SRGB",e[e.BC2=ti(Rr.BC2,Nn.RGBA,Tn.Normalized)]="BC2",e[e.BC2_SRGB=ti(Rr.BC2,Nn.RGBA,Tn.Normalized|Tn.sRGB)]="BC2_SRGB",e[e.BC3=ti(Rr.BC3,Nn.RGBA,Tn.Normalized)]="BC3",e[e.BC3_SRGB=ti(Rr.BC3,Nn.RGBA,Tn.Normalized|Tn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=ti(Rr.BC4_UNORM,Nn.R,Tn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=ti(Rr.BC4_SNORM,Nn.R,Tn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=ti(Rr.BC5_UNORM,Nn.RG,Tn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=ti(Rr.BC5_SNORM,Nn.RG,Tn.Normalized)]="BC5_SNORM",e[e.D24=ti(Rr.D24,Nn.R,Tn.Depth)]="D24",e[e.D24_S8=ti(Rr.D24S8,Nn.RG,Tn.Depth|Tn.Stencil)]="D24_S8",e[e.D32F=ti(Rr.D32F,Nn.R,Tn.Depth)]="D32F",e[e.D32F_S8=ti(Rr.D32FS8,Nn.RG,Tn.Depth|Tn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=ti(Rr.U8,Nn.RGB,Tn.RenderTarget|Tn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=ti(Rr.U8,Nn.RGBA,Tn.RenderTarget|Tn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=ti(Rr.U8,Nn.RGBA,Tn.RenderTarget|Tn.Normalized|Tn.sRGB)]="U8_RGBA_RT_SRGB"})(It||(It={}));function i0(e){return e>>>8&255}function ph(e){return e>>>16&255}function Rv(e){return e&255}function BE(e){switch(e){case Rr.F32:case Rr.U32:case Rr.S32:return 4;case Rr.U16:case Rr.S16:case Rr.F16:return 2;case Rr.U8:case Rr.S8:return 1;default:throw new Error("whoops")}}function FE(e){return BE(ph(e))}function c6(e){return i0(e)}function I4(e){var r=BE(ph(e)),t=i0(e);return r*t}function f6(e,r){return e&4294967040|r}function h6(e,r){return e&4294902015|r<<8}function NE(e){var r=Rv(e);if(r&Tn.Depth)return Yo.Depth;if(r&Tn.Normalized)return Yo.Float;var t=ph(e);if(t===Rr.F16||t===Rr.F32)return Yo.Float;if(t===Rr.U8||t===Rr.U16||t===Rr.U32)return Yo.Uint;if(t===Rr.S8||t===Rr.S16||t===Rr.S32)return Yo.Sint;throw new Error("whoops")}function Pi(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function Ld(e){if(e!=null)return e;throw new Error("Missing object")}function UE(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function zE(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function ZE(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function Zm(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var a0=Zm(0,0,0,0),p6=Zm(0,0,0,1),P4=Zm(1,1,1,0),d6=Zm(1,1,1,1),Mv=!0;function v6(e,r){r===void 0&&(r=Mv),r&&(e[10]=-e[10],e[14]=-e[14])}function m6(e,r){r===void 0&&(r=Mv),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function O4(e,r){if(r===void 0&&(r=Mv),r)switch(e){case Hi.LESS:return Hi.GREATER;case Hi.LEQUAL:return Hi.GEQUAL;case Hi.GEQUAL:return Hi.LEQUAL;case Hi.GREATER:return Hi.LESS;default:return e}else return e}function g6(e,r){return r===void 0&&(r=Mv),r?1-e:e}function y6(e,r){return r===void 0&&(r=Mv),r?-e:e}function _6(e,r,t,n){if(n===void 0&&(n=Mv),t=O4(t,n),t===Hi.LESS)return e<r;if(t===Hi.LEQUAL)return e<=r;if(t===Hi.GREATER)return e>r;if(t===Hi.GEQUAL)return e>=r;throw new Error("whoops")}function o0(e){return!!(e&&!(e&e-1))}function Iv(e,r){return e!=null?e:r}function k4(e){return e===void 0?null:e}function b6(e,r,t){e.length=r,e.fill(t)}function s0(e,r){var t=r-1;return e+t&~t}function x6(e,r){return((e+r-1)/r|0)*r}function D4(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=t(r,e[a]);s<0?i=a:n=a+1}return n}function E6(e,r,t){var n=D4(e,r,t);e.splice(n,0,r)}function S6(e,r,t){return t?e|=r:e&=~r,e}function L4(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function B4(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(F4(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function F4(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function A6(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function VE(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function u0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e.mask=r.mask,e}function jE(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),VE(e.rgbBlendState,r.rgbBlendState),VE(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function ky(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=jE(e[t],r[t])}function N4(e,r){r.attachmentsState!==void 0&&ky(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&zE(e.blendConstant,r.blendConstant),e.depthCompare=Iv(r.depthCompare,e.depthCompare),e.depthWrite=Iv(r.depthWrite,e.depthWrite),e.stencilWrite=Iv(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&u0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&u0(e.stencilBack,r.stencilBack),e.cullMode=Iv(r.cullMode,e.cullMode),e.frontFace=Iv(r.frontFace,e.frontFace),e.polygonOffset=Iv(r.polygonOffset,e.polygonOffset)}function Pv(e){var r=Object.assign({},e);return r.attachmentsState=[],ky(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&ZE(r.blendConstant),r.stencilFront=u0(void 0,e.stencilFront),r.stencilBack=u0(void 0,e.stencilBack),r}function U4(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var HE={blendMode:ou.ADD,blendSrcFactor:Qi.ONE,blendDstFactor:Qi.ZERO},Bd={attachmentsState:[{channelWriteMask:su.ALL,rgbBlendState:HE,alphaBlendState:HE}],blendConstant:ZE(a0),depthWrite:!0,depthCompare:Hi.LEQUAL,stencilWrite:!1,stencilFront:{compare:Hi.ALWAYS,passOp:$o.KEEP,depthFailOp:$o.KEEP,failOp:$o.KEEP},stencilBack:{compare:Hi.ALWAYS,passOp:$o.KEEP,depthFailOp:$o.KEEP,failOp:$o.KEEP},cullMode:Nl.NONE,frontFace:zm.CCW,polygonOffset:!1};function z4(e,r){e===void 0&&(e=null),r===void 0&&(r=Bd);var t=Pv(r);return e!==null&&N4(t,e),t}var T6=z4({depthCompare:Hi.ALWAYS,depthWrite:!1},Bd);function w6(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],ky(e.attachmentsState,Bd.attachmentsState)),U4(e.attachmentsState[0],r),e}var WE={texture:null,sampler:null,formatKind:Yo.Float,dimension:Yi.TEXTURE_2D};function zp(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Ov(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function Z4(e,r){return e.texture===r.texture&&e.binding===r.binding}function GE(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function V4(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function j4(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],r.storageBufferBindings=r.storageBufferBindings||[],r.storageTextureBindings=r.storageTextureBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!zp(e.samplerBindings,r.samplerBindings,V4)||!zp(e.uniformBufferBindings,r.uniformBufferBindings,GE)||!zp(e.storageBufferBindings,r.storageBufferBindings,GE)||!zp(e.storageTextureBindings,r.storageTextureBindings,Z4))}function XE(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function H4(e,r){return!(!XE(e.rgbBlendState,r.rgbBlendState)||!XE(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function l0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp&&e.mask===r.mask}function W4(e,r){return!zp(e.attachmentsState,r.attachmentsState,H4)||e.blendConstant&&r.blendConstant&&!UE(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!l0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!l0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function $E(e,r){return e.id===r.id}function G4(e,r){return e===r}function X4(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!W4(e.megaStateDescriptor,r.megaStateDescriptor)||!$E(e.program,r.program)||!zp(e.colorAttachmentFormats,r.colorAttachmentFormats,G4)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function $4(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function Y4(e,r){return(0,Xc.Z)(e)?(0,Xc.Z)(r):(0,Xc.Z)(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&zp(e.attributes,r.attributes,$4)}function q4(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!zp(e.vertexBufferDescriptors,r.vertexBufferDescriptors,Y4)||!$E(e.program,r.program))}function C6(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function K4(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function YE(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function Q4(e){var r=e.binding,t=e.texture;return{binding:r,texture:t}}function J4(e){var r=e.samplerBindings&&Ov(e.samplerBindings,K4),t=e.uniformBufferBindings&&Ov(e.uniformBufferBindings,YE),n=e.storageBufferBindings&&Ov(e.storageBufferBindings,YE),i=e.storageTextureBindings&&Ov(e.storageTextureBindings,Q4);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function e5(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&Pv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function t5(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function r5(e){if((0,Xc.Z)(e))return e;var r=e.arrayStride,t=e.stepMode,n=Ov(e.attributes,t5);return{arrayStride:r,stepMode:t,attributes:n}}function n5(e){var r=Ov(e.vertexBufferDescriptors,r5),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var ca,i5=/([^[]*)(\[[0-9]+\])?/;function a5(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(i5);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:!!r[2]}}function _l(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function qo(e,r,t,n){var i=null,a=null;return function(s,l,f){var d=r(f,t),_=d.length,x=!1;if(i===null)i=new Float32Array(_),a=_,x=!0;else{Pi(a===_,"Uniform length cannot change.");for(var A=0;A<_;++A)if(d[A]!==i[A]){x=!0;break}}return x&&(n(s,e,l,d),i.set(d)),x}}function Ku(e,r,t,n){e[r](t,n)}function Kh(e,r,t,n){e[r](t,!1,n)}var o5={},s5={},u5={},qE=[0];function Dy(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(qE[0]=e,e=qE);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function dc(e,r){return Dy(e,r,Float32Array,o5)}function Zp(e,r){return Dy(e,r,Int32Array,s5)}function c0(e,r){return Dy(e,r,Uint32Array,u5)}var l5=(ca={},ca[Je.FLOAT]=qo.bind(null,"uniform1fv",dc,1,Ku),ca[Je.FLOAT_VEC2]=qo.bind(null,"uniform2fv",dc,2,Ku),ca[Je.FLOAT_VEC3]=qo.bind(null,"uniform3fv",dc,3,Ku),ca[Je.FLOAT_VEC4]=qo.bind(null,"uniform4fv",dc,4,Ku),ca[Je.INT]=qo.bind(null,"uniform1iv",Zp,1,Ku),ca[Je.INT_VEC2]=qo.bind(null,"uniform2iv",Zp,2,Ku),ca[Je.INT_VEC3]=qo.bind(null,"uniform3iv",Zp,3,Ku),ca[Je.INT_VEC4]=qo.bind(null,"uniform4iv",Zp,4,Ku),ca[Je.BOOL]=qo.bind(null,"uniform1iv",Zp,1,Ku),ca[Je.BOOL_VEC2]=qo.bind(null,"uniform2iv",Zp,2,Ku),ca[Je.BOOL_VEC3]=qo.bind(null,"uniform3iv",Zp,3,Ku),ca[Je.BOOL_VEC4]=qo.bind(null,"uniform4iv",Zp,4,Ku),ca[Je.FLOAT_MAT2]=qo.bind(null,"uniformMatrix2fv",dc,4,Kh),ca[Je.FLOAT_MAT3]=qo.bind(null,"uniformMatrix3fv",dc,9,Kh),ca[Je.FLOAT_MAT4]=qo.bind(null,"uniformMatrix4fv",dc,16,Kh),ca[Je.UNSIGNED_INT]=qo.bind(null,"uniform1uiv",c0,1,Ku),ca[Je.UNSIGNED_INT_VEC2]=qo.bind(null,"uniform2uiv",c0,2,Ku),ca[Je.UNSIGNED_INT_VEC3]=qo.bind(null,"uniform3uiv",c0,3,Ku),ca[Je.UNSIGNED_INT_VEC4]=qo.bind(null,"uniform4uiv",c0,4,Ku),ca[Je.FLOAT_MAT2x3]=qo.bind(null,"uniformMatrix2x3fv",dc,6,Kh),ca[Je.FLOAT_MAT2x4]=qo.bind(null,"uniformMatrix2x4fv",dc,8,Kh),ca[Je.FLOAT_MAT3x2]=qo.bind(null,"uniformMatrix3x2fv",dc,6,Kh),ca[Je.FLOAT_MAT3x4]=qo.bind(null,"uniformMatrix3x4fv",dc,12,Kh),ca[Je.FLOAT_MAT4x2]=qo.bind(null,"uniformMatrix4x2fv",dc,8,Kh),ca[Je.FLOAT_MAT4x3]=qo.bind(null,"uniformMatrix4x3fv",dc,12,Kh),ca[Je.SAMPLER_2D]=_l,ca[Je.SAMPLER_CUBE]=_l,ca[Je.SAMPLER_3D]=_l,ca[Je.SAMPLER_2D_SHADOW]=_l,ca[Je.SAMPLER_2D_ARRAY]=_l,ca[Je.SAMPLER_2D_ARRAY_SHADOW]=_l,ca[Je.SAMPLER_CUBE_SHADOW]=_l,ca[Je.INT_SAMPLER_2D]=_l,ca[Je.INT_SAMPLER_3D]=_l,ca[Je.INT_SAMPLER_CUBE]=_l,ca[Je.INT_SAMPLER_2D_ARRAY]=_l,ca[Je.UNSIGNED_INT_SAMPLER_2D]=_l,ca[Je.UNSIGNED_INT_SAMPLER_3D]=_l,ca[Je.UNSIGNED_INT_SAMPLER_CUBE]=_l,ca[Je.UNSIGNED_INT_SAMPLER_2D_ARRAY]=_l,ca);function KE(e,r,t){var n=l5[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var c5={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function f5(e){return Object.prototype.toString.call(e)in c5}function Vm(e,r){return"#define ".concat(e," ").concat(r)}function h5(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function p5(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return t.push({location:isNaN(s)?r[i]:s,name:a}),""}),t}function R6(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var f=__read(l.trim().split(/\s+/),2),d=f[0],_=f[1];s.push({type:d.trim(),name:_.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",f=s[1]||"",d=f.indexOf("[")>-1;if(f=f.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=t.find(function(C){return l===C.type});if(_)if(d)for(var x=function(C){_.uniforms.forEach(function(I){r.push("".concat(f,"[").concat(C,"].").concat(I.name))})},A=0;A<5;A++)x(A);else _.uniforms.forEach(function(C){r.push("".concat(f,".").concat(C.name))})}f&&r.push(f)}}),""}),r}function QE(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function d5(e){var r="",t=e;return[t,r]}function Vp(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,f=t.replace(`\r
`,`
`).split(`
`).map(function(lt){return lt.replace(/[/][/].*$/,"")}).filter(function(lt){var Qe=!lt||/^\s+$/.test(lt);return!Qe}),d="";n!==null&&(d=Object.keys(n).map(function(lt){return Vm(lt,n[lt])}).join(`
`));var _=f.find(function(lt){return lt.startsWith("precision")})||"precision mediump float;",x=i?f.filter(function(lt){return!lt.startsWith("precision")}).join(`
`):f.join(`
`),A="";if(e.viewportOrigin===hh.UPPER_LEFT&&(A+="".concat(Vm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Cv.ZERO&&(A+="".concat(Vm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var C=0,I=0,O=0;x=x.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(lt,Qe,Mt,Vt){var Sr=Mt?"".concat(Mt,", "):"";return"layout(".concat(Sr,"set = ").concat(C,", binding = ").concat(I++,") uniform ").concat(Vt)}),C++,I=0,Pi(e.separateSamplerTextures),x=x.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(lt,Qe,Mt,Vt,Sr){var mr=QE(Mt);mr===null&&(mr=I++);var Xr=(0,kn.CR)(d5(Vt),2),mn=Xr[0],Yn=Xr[1];return r==="frag"?`
layout(set = `.concat(C,", binding = ").concat(mr*2+0,") uniform texture").concat(mn," T_").concat(Sr,`;
layout(set = `).concat(C,", binding = ").concat(mr*2+1,") uniform sampler").concat(Yn," S_").concat(Sr,";").trim():""}),x=x.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(lt,Qe){return"layout(location = ".concat(O++,") ").concat(Qe)}),A+="".concat(Vm("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Vm("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var Z=0;x=x.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(lt,Qe,Mt,Vt,Sr){var mr=QE(Mt);return mr===null&&(mr=Z++),"uniform sampler".concat(Vt," ").concat(Sr,"; // BINDING=").concat(mr)})}if(e.separateSamplerTextures)x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(lt,Qe,Mt){return"sampler".concat(Qe,"(T_").concat(Mt,", S_").concat(Mt,")")}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(lt,Qe){return"T_".concat(Qe)});else{var Y=[];x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(lt,Qe,Mt){return Y.push([Mt,Qe]),Mt}),s&&Y.forEach(function(lt){var Qe=(0,kn.CR)(lt,2),Mt=Qe[0],Vt=Qe[1];x=x.replace(new RegExp("texture\\(".concat(Mt),"g"),function(){return"texture".concat(Vt,"(").concat(Mt)})}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(lt,Qe){return Qe})}var ie="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(A||"").concat(d?d+`
`:"",`
`).concat(x,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(ie=ie.replace(/^\b(out)\b/g,function(lt,Qe){return"layout(location = 0) ".concat(Qe)})),s){if(r==="frag"&&(ie=ie.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(lt,Qe,Mt){return"varying ".concat(Qe," ").concat(Mt,`;
`)})),r==="vert"&&(ie=ie.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(lt,Qe,Mt){return"varying ".concat(Qe," ").concat(Mt,`;
`)}),ie=ie.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(lt,Qe,Mt){return"attribute ".concat(Qe," ").concat(Mt,`;
`)})),ie=ie.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(lt,Qe){return Qe.trim().replace(/^.*$/gm,function(Mt){var Vt=Mt.trim();return Vt.startsWith("#")?Vt:Mt?"uniform ".concat(Vt):""})}),r==="frag")if(l){var ge=[];ie=ie.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(lt,Qe){return ge.push(Qe),"vec4 ".concat(Qe,`;
`)});var Ve=ie.lastIndexOf("}");ie=ie.substring(0,Ve)+`
    `.concat(ge.map(function(lt,Qe){return"gl_FragData[".concat(Qe,"] = ").concat(lt,`;
    `)}).join(`
`))+ie.substring(Ve)}else{var gt;if(ie=ie.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(lt,Qe,Mt){return gt=Mt,"".concat(Qe," ").concat(Mt,`;
`)}),gt){var Ve=ie.lastIndexOf("}");ie=ie.substring(0,Ve)+`
  gl_FragColor = vec4(`.concat(gt,`);
`)+ie.substring(Ve)}}ie=ie.replace(/^\s*layout\((.*)\)/gm,"")}return ie}function M6(e,r,t,n){n===void 0&&(n=null);var i=Vp(e,"vert",r,n),a=Vp(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var $c=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(DE),v5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Bindings;var l=a.uniformBufferBindings,f=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=f||[],s.bindingLayouts=s.createBindingLayouts(),s}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:s}),t+=a,n+=s,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}($c);function Gn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function JE(e){var r=ph(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_UNORM:case Rr.BC4_SNORM:case Rr.BC5_UNORM:case Rr.BC5_SNORM:return!0;default:return!1}}function eS(e){var r=Rv(e);if(r&Tn.Normalized)return!1;var t=ph(e);return t===Rr.S8||t===Rr.S16||t===Rr.S32||t===Rr.U8||t===Rr.U16||t===Rr.U32}function m5(e){switch(e){case Ef.STATIC:return Je.STATIC_DRAW;case Ef.DYNAMIC:return Je.DYNAMIC_DRAW}}function tS(e){if(e&Qa.INDEX)return Je.ELEMENT_ARRAY_BUFFER;if(e&Qa.VERTEX)return Je.ARRAY_BUFFER;if(e&Qa.UNIFORM)return Je.UNIFORM_BUFFER}function g5(e){switch(e){case Cs.TRIANGLES:return Je.TRIANGLES;case Cs.POINTS:return Je.POINTS;case Cs.TRIANGLE_STRIP:return Je.TRIANGLE_STRIP;case Cs.LINES:return Je.LINES;case Cs.LINE_STRIP:return Je.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function y5(e){switch(e){case Rr.U8:return Je.UNSIGNED_BYTE;case Rr.U16:return Je.UNSIGNED_SHORT;case Rr.U32:return Je.UNSIGNED_INT;case Rr.S8:return Je.BYTE;case Rr.S16:return Je.SHORT;case Rr.S32:return Je.INT;case Rr.F16:return Je.HALF_FLOAT;case Rr.F32:return Je.FLOAT;default:throw new Error("whoops")}}function _5(e){switch(e){case Nn.R:return 1;case Nn.RG:return 2;case Nn.RGB:return 3;case Nn.RGBA:return 4;default:return 1}}function b5(e){var r=ph(e),t=i0(e),n=Rv(e),i=y5(r),a=_5(t),s=!!(n&Tn.Normalized);return{size:a,type:i,normalized:s}}function x5(e){switch(e){case It.U8_R:return Je.UNSIGNED_BYTE;case It.U16_R:return Je.UNSIGNED_SHORT;case It.U32_R:return Je.UNSIGNED_INT;default:throw new Error("whoops")}}function jm(e){switch(e){case yl.CLAMP_TO_EDGE:return Je.CLAMP_TO_EDGE;case yl.REPEAT:return Je.REPEAT;case yl.MIRRORED_REPEAT:return Je.MIRRORED_REPEAT;default:throw new Error("whoops")}}function f0(e,r){if(r===Gs.LINEAR&&e===os.BILINEAR)return Je.LINEAR_MIPMAP_LINEAR;if(r===Gs.LINEAR&&e===os.POINT)return Je.NEAREST_MIPMAP_LINEAR;if(r===Gs.NEAREST&&e===os.BILINEAR)return Je.LINEAR_MIPMAP_NEAREST;if(r===Gs.NEAREST&&e===os.POINT)return Je.NEAREST_MIPMAP_NEAREST;if(r===Gs.NO_MIP&&e===os.BILINEAR)return Je.LINEAR;if(r===Gs.NO_MIP&&e===os.POINT)return Je.NEAREST;throw new Error("Unknown texture filter mode")}function kv(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function Dv(e){var r=e;return r.gl_texture}function Ly(e){var r=e;return r.gl_sampler}function Hm(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function rS(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function jp(e){return e.blendMode==ou.ADD&&e.blendSrcFactor==Qi.ONE&&e.blendDstFactor===Qi.ZERO}function E5(e){switch(e){case n0.OcclusionConservative:return Je.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function S5(e){if(e===Yi.TEXTURE_2D)return Je.TEXTURE_2D;if(e===Yi.TEXTURE_2D_ARRAY)return Je.TEXTURE_2D_ARRAY;if(e===Yi.TEXTURE_CUBE_MAP)return Je.TEXTURE_CUBE_MAP;if(e===Yi.TEXTURE_3D)return Je.TEXTURE_3D;throw new Error("whoops")}function By(e,r,t,n){return!(e%t!==0||r%n!==0)}var A5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=a.viewOrSize,f=a.usage,d=a.hint,_=d===void 0?Ef.STATIC:d,x=i.uniformBufferMaxPageByteSize,A=i.gl,C=f&Qa.UNIFORM;C||(Gn(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=(0,wv.Z)(l)?s0(l,4):s0(l.byteLength,4);s.gl_buffer_pages=[];var O;if(C){for(var Z=I;Z>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(Z,x),f,_)),Z-=x;O=x}else s.gl_buffer_pages.push(s.createBufferPage(I,f,_)),O=I;return s.pageByteSize=O,s.byteSize=I,s.usage=f,s.gl_target=tS(f),(0,wv.Z)(l)||s.setSubData(0,new Uint8Array(l.buffer)),C||(Gn(A)?A.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,f=t+a,d=t,_=t%l;d<f;){var x=Gn(s)?s.COPY_WRITE_BUFFER:this.gl_target,A=kv(this,d);if(A.ubo)return;s.bindBuffer(x,A),Gn(s)?s.bufferSubData(x,_,n,i,Math.min(f-d,l)):s.bufferSubData(x,_,n),d+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,s=n&Qa.UNIFORM;if(!Gn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),f=tS(n),d=m5(i);return a.bindBuffer(f,l),a.bufferData(f,t,d),l},r}($c),T5=function(e){(0,kn.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,_,x=e.call(this,{id:l,device:f})||this;x.type=ya.InputLayout;var A=d.vertexBufferDescriptors,C=d.indexBufferFormat,I=d.program;Pi(C===It.U16_R||C===It.U32_R||C===null);var O=C!==null?x5(C):null,Z=C!==null?FE(C):null,Y=x.device.gl,ie=x.device.ensureResourceExists(Gn(Y)?Y.createVertexArray():f.OES_vertex_array_object.createVertexArrayOES());Gn(Y)?Y.bindVertexArray(ie):f.OES_vertex_array_object.bindVertexArrayOES(ie),Y.bindBuffer(Y.ARRAY_BUFFER,kv(x.device.fallbackVertexBuffer));try{for(var ge=(0,kn.XA)(d.vertexBufferDescriptors),Ve=ge.next();!Ve.done;Ve=ge.next()){var gt=Ve.value,lt=gt.stepMode,Qe=gt.attributes;try{for(var Mt=(a=void 0,(0,kn.XA)(Qe)),Vt=Mt.next();!Vt.done;Vt=Mt.next()){var Sr=Vt.value,mr=Sr.shaderLocation,Xr=Sr.format,mn=Sr.divisor,Yn=mn===void 0?1:mn,Ji=Gn(Y)?mr:(_=I.attributes[mr])===null||_===void 0?void 0:_.location,Ma=b5(Xr);if(Sr.vertexFormat=Ma,!(0,Xc.Z)(Ji)){eS(Xr);var Ko=Ma.size,Vo=Ma.type,$s=Ma.normalized;Y.vertexAttribPointer(Ji,Ko,Vo,$s,0,0),lt===Dd.INSTANCE&&(Gn(Y)?Y.vertexAttribDivisor(Ji,Yn):f.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Ji,Yn)),Y.enableVertexAttribArray(Ji)}}}catch(bl){a={error:bl}}finally{try{Vt&&!Vt.done&&(s=Mt.return)&&s.call(Mt)}finally{if(a)throw a.error}}}}catch(bl){n={error:bl}}finally{try{Ve&&!Ve.done&&(i=ge.return)&&i.call(ge)}finally{if(n)throw n.error}}return Gn(Y)?Y.bindVertexArray(null):f.OES_vertex_array_object.bindVertexArrayOES(null),x.vertexBufferDescriptors=A,x.vao=ie,x.indexBufferFormat=C,x.indexBufferType=O,x.indexBufferCompByteSize=Z,x.program=I,x}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Gn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}($c),Fy=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=ya.Texture,a=(0,kn.pi)({dimension:Yi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var f=l.device.gl,d,_,x=l.clampmipLevelCount(a);if(l.immutable=a.usage===ku.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=NE(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=x>=1,!s){_=l.device.ensureResourceExists(f.createTexture());var A=l.device.translateTextureType(a.format),C=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(f.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===Yi.TEXTURE_2D){if(d=Je.TEXTURE_2D,f.bindTexture(d,_),l.immutable)if(Gn(f))f.texStorage2D(d,x,C,a.width,a.height);else{var I=(C===Je.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===It.D32F||l.format===It.D24_S8)&&!Gn(f)&&!i.WEBGL_depth_texture||(f.texImage2D(d,I,C,a.width,a.height,0,C,A,null),l.mipmaps&&(l.mipmaps=!1,f.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_MIN_FILTER,Je.LINEAR),f.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_S,Je.CLAMP_TO_EDGE),f.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_T,Je.CLAMP_TO_EDGE)))}Pi(a.depthOrArrayLayers===1)}else if(a.dimension===Yi.TEXTURE_2D_ARRAY)d=Je.TEXTURE_2D_ARRAY,f.bindTexture(d,_),l.immutable&&Gn(f)&&f.texStorage3D(d,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Yi.TEXTURE_3D)d=Je.TEXTURE_3D,f.bindTexture(d,_),l.immutable&&Gn(f)&&f.texStorage3D(d,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Yi.TEXTURE_CUBE_MAP)d=Je.TEXTURE_CUBE_MAP,f.bindTexture(d,_),l.immutable&&Gn(f)&&f.texStorage2D(d,x,C,a.width,a.height),Pi(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=d,l.mipLevelCount=x,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;JE(this.format);var a=this.gl_target===Je.TEXTURE_3D||this.gl_target===Je.TEXTURE_2D_ARRAY,s=this.gl_target===Je.TEXTURE_CUBE_MAP,l=f5(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var f=t[0],d,_;l?(d=this.width,_=this.height):(d=f.width,_=f.height,this.width=d,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var x=this.device.translateTextureFormat(this.format),A=Gn(i)?this.device.translateInternalTextureFormat(this.format):x,C=this.device.translateTextureType(this.format);this.preprocessImage();for(var I=0;I<this.depthOrArrayLayers;I++){var O=t[I],Z=this.gl_target;s&&(Z=Je.TEXTURE_CUBE_MAP_POSITIVE_X+I%6),this.immutable?i.texSubImage2D(Z,n,0,0,d,_,x,C,O):Gn(i)?a?i.texImage3D(Z,n,A,d,_,this.depthOrArrayLayers,0,x,C,O):i.texImage2D(Z,n,A,d,_,0,x,C,O):l?i.texImage2D(Z,n,x,d,_,0,x,C,O):i.texImage2D(Z,n,x,x,C,O)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Dv(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===Yi.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=ph(t.format);if(n===Rr.BC1)for(var i=t.width,a=t.height,s=0;s<t.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(Je.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(Je.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(Je.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!Gn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,Je.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,Je.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,Je.TEXTURE_MIN_FILTER,Je.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,Je.TEXTURE_MAG_FILTER,Je.LINEAR)):n.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_MIN_FILTER,Je.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return Gn(t)?!1:!o0(this.width)||!o0(this.height)},r}($c),w5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,f=a.format,d=a.width,_=a.height,x=a.sampleCount,A=x===void 0?1:x,C=a.texture,I=!1;if((f===It.D32F||f===It.D24_S8)&&C&&!Gn(l)&&!i.WEBGL_depth_texture&&(C.destroy(),s.texture=null,I=!0),!I&&C)s.texture=C;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var O=s.device.translateTextureInternalFormat(f,!0);Gn(l)&&A>1?l.renderbufferStorageMultisample(Je.RENDERBUFFER,A,O,d,_):l.renderbufferStorage(Je.RENDERBUFFER,O,d,_)}return s.format=f,s.width=d,s.height=_,s.sampleCount=A,s}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}($c),Ul;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Ul||(Ul={}));var C5=function(e){(0,kn.ZT)(r,e);function r(t,n){var i=t.id,a=t.device,s=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=ya.Program,l.uniformSetters={},l.attributes=[];var f=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(f.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Ul.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){Pi(this.compileState===Ul.NeedsCompile);var t=this.descriptor,n=t.vertex,i=t.fragment,a=this.device.gl;n!=null&&n.glsl&&(i!=null&&i.glsl)&&(this.gl_shader_vert=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Ul.Compiling,Gn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=h5(this.descriptor.vertex.glsl),s=p5(this.rawVertexGLSL,a),l=function(_){var x=n.getActiveAttrib(f.gl_program,_),A=x.name,C=x.type,I=x.size,O=n.getAttribLocation(f.gl_program,A),Z=(t=s.find(function(Y){return Y.name===A}))===null||t===void 0?void 0:t.location;O>=0&&!(0,Xc.Z)(Z)&&(f.attributes[Z]={name:A,location:O,type:C,size:I})},f=this,d=0;d<i;d++)l(d)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),s=a5(a.name).name,l=t.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=KE(t,l,a),a&&a.size>1)for(var f=0;f<a.size;f++)l=t.getUniformLocation(this.gl_program,"".concat(s,"[").concat(f,"]")),this.uniformSetters["".concat(s,"[").concat(f,"]")]=KE(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!Gn(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var s=t[a],l=this.uniformSetters[a];if(l){var f=s;f instanceof Fy&&(f=f.textureIndex),l(f)}}}return this},r}($c),R5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=s.device.gl;if(Gn(l)){var f=a.elemCount,d=a.type;s.gl_query=L4(f,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=E5(d)}return s}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(Gn(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Gn(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}($c),M5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function f(){var d=a.clientWaitSync(t,n,0);if(d==a.WAIT_FAILED){l();return}if(d==a.TIMEOUT_EXPIRED){setTimeout(f,(0,R4.Z)(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}f()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,s,l){return(0,kn.mG)(this,void 0,void 0,function(){var f;return(0,kn.Jh)(this,function(d){switch(d.label){case 0:return f=this.device.gl,Gn(f)?(this.gl_sync=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0),f.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return d.sent(),f.bindBuffer(t,n),f.getBufferSubData(t,i,a,s,l),f.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),d===void 0&&(d=l.byteLength||0),(0,kn.mG)(this,void 0,void 0,function(){var _,x,A,C,I;return(0,kn.Jh)(this,function(O){return _=this.device.gl,x=t,A=this.device.translateTextureFormat(x.format),C=this.device.translateTextureType(x.format),I=I4(x.format),Gn(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,d,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer(Je.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(Je.READ_FRAMEBUFFER,Je.COLOR_ATTACHMENT0,Je.TEXTURE_2D,x.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,s,A,C,f*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,f,0)]):[2,this.readTextureSync(t,n,i,a,s,l,f,d)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){d===void 0&&(d=l.byteLength||0);var _=this.device.gl,x=t,A=this.device.translateTextureType(x.format);return _.bindFramebuffer(Je.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(Je.FRAMEBUFFER,Je.COLOR_ATTACHMENT0,Je.TEXTURE_2D,x.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,s,_.RGBA,A,l),l},r.prototype.readBuffer=function(t,n,i,a,s){return(0,kn.mG)(this,void 0,void 0,function(){var l;return(0,kn.Jh)(this,function(f){return l=this.device.gl,Gn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,kv(t,n),n,i,a,s)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),Gn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}($c),I5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;return f.type=ya.RenderPipeline,f.drawMode=g5((s=a.topology)!==null&&s!==void 0?s:Cs.TRIANGLES),f.program=a.program,f.inputLayout=a.inputLayout,f.megaState=(0,kn.pi)((0,kn.pi)({},Pv(Bd)),a.megaStateDescriptor),f.colorAttachmentFormats=a.colorAttachmentFormats.slice(),f.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,f.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,f}return r}($c),P5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.ComputePipeline,s.descriptor=a,s}return r}($c),O5=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=(0,kn.XA)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),k5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var d=f.device.gl;if(Gn(d)){var _=f.device.ensureResourceExists(d.createSampler());d.samplerParameteri(_,Je.TEXTURE_WRAP_S,jm(a.addressModeU)),d.samplerParameteri(_,Je.TEXTURE_WRAP_T,jm(a.addressModeV)),d.samplerParameteri(_,Je.TEXTURE_WRAP_R,jm((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),d.samplerParameteri(_,Je.TEXTURE_MIN_FILTER,f0(a.minFilter,a.mipmapFilter)),d.samplerParameteri(_,Je.TEXTURE_MAG_FILTER,f0(a.magFilter,Gs.NO_MIP)),a.lodMinClamp!==void 0&&d.samplerParameterf(_,Je.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&d.samplerParameterf(_,Je.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(d.samplerParameteri(_,d.TEXTURE_COMPARE_MODE,d.COMPARE_REF_TO_TEXTURE),d.samplerParameteri(_,d.TEXTURE_COMPARE_FUNC,a.compareFunction));var x=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;x>1&&f.device.EXT_texture_filter_anisotropic!==null&&(Pi(a.minFilter===os.BILINEAR&&a.magFilter===os.BILINEAR&&a.mipmapFilter===Gs.LINEAR),d.samplerParameterf(_,f.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x)),f.gl_sampler=_}else f.descriptor=a;return f}return r.prototype.setTextureParameters=function(t,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_MIN_FILTER,Je.LINEAR):s.texParameteri(t,Je.TEXTURE_MIN_FILTER,f0(l.minFilter,l.mipmapFilter)),s.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_S,jm(l.addressModeU)),s.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_T,jm(l.addressModeV)),s.texParameteri(t,Je.TEXTURE_MAG_FILTER,f0(l.magFilter,Gs.NO_MIP));var f=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Pi(l.minFilter===os.BILINEAR&&l.magFilter===os.BILINEAR&&l.mipmapFilter===Gs.LINEAR),s.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},r.prototype.destroy=function(){e.prototype.destroy.call(this),Gn(this.device.gl)&&this.device.gl.deleteSampler(Ly(this))},r.prototype.isNPOT=function(t,n){return!o0(t)||!o0(n)},r}($c),D5=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),L5=function(e){(0,kn.ZT)(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=ya.RenderBundle,t.commands=[],t}return r.prototype.push=function(t){this.commands.push(t)},r.prototype.replay=function(){this.commands.forEach(function(t){return t()})},r}($c),nS=65536,B5=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,F5=function(){function e(r,t){t===void 0&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Pv(Bd),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=hh.LOWER_LEFT,this.clipSpaceNearZ=Cv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=Ld(r.getContextAttributes()),Gn(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),Gn(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Fy({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Yi.TEXTURE_2D,mipLevelCount:1,usage:ku.RENDER_TARGET,format:this.contextAttributes.alpha===!1?It.U8_RGB_RT:It.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Yo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Qa.VERTEX,hint:Ef.STATIC}),Gn(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Yi.TEXTURE_2D_ARRAY,Yo.Float),this.fallbackTexture3D=this.createFallbackTexture(Yi.TEXTURE_3D,Yo.Float),this.fallbackTextureCube=this.createFallbackTexture(Yi.TEXTURE_CUBE_MAP,Yo.Float)),this.currentMegaState.depthCompare=Hi.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=su.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new O5)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===Yi.TEXTURE_CUBE_MAP?6:1,i=t===Yo.Depth?It.D32F:It.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:ku.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===Yo.Float&&a.setImageData([new Uint8Array(4*n)]),Dv(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(Je.MAX_VERTEX_ATTRIBS),Gn(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(Je.MAX_UNIFORM_BLOCK_SIZE),nS),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?(0,kn.ev)([],(0,kn.CR)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=nS;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=k4(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case It.ALPHA:return Je.ALPHA;case It.U8_LUMINANCE:case It.F16_LUMINANCE:case It.F32_LUMINANCE:return Je.LUMINANCE;case It.F16_R:return Je.R16F;case It.F16_RG:return Je.RG16F;case It.F16_RGB:return Je.RGB16F;case It.F16_RGBA:return Je.RGBA16F;case It.F32_R:return Je.R32F;case It.F32_RG:return Je.RG32F;case It.F32_RGB:return Je.RGB32F;case It.F32_RGBA:return Gn(this.gl)?Je.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:Je.RGBA;case It.U8_R_NORM:return Je.R8;case It.U8_RG_NORM:return Je.RG8;case It.U8_RGB_NORM:case It.U8_RGB_RT:return Je.RGB8;case It.U8_RGB_SRGB:return Je.SRGB8;case It.U8_RGBA_NORM:case It.U8_RGBA_RT:return Gn(this.gl)?Je.RGBA8:t?Je.RGBA4:Je.RGBA;case It.U8_RGBA:return Je.RGBA;case It.U8_RGBA_SRGB:case It.U8_RGBA_RT_SRGB:return Je.SRGB8_ALPHA8;case It.U16_R:return Je.R16UI;case It.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case It.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case It.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case It.U16_RGBA_5551:return Je.RGB5_A1;case It.U16_RGB_565:return Je.RGB565;case It.U32_R:return Je.R32UI;case It.S8_RGBA_NORM:return Je.RGBA8_SNORM;case It.S8_RG_NORM:return Je.RG8_SNORM;case It.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case It.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case It.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case It.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case It.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case It.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case It.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case It.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case It.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case It.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case It.D32F_S8:return Gn(this.gl)?Je.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Je.DEPTH_STENCIL:Je.DEPTH_COMPONENT16;case It.D24_S8:return Gn(this.gl)?Je.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Je.DEPTH_STENCIL:Je.DEPTH_COMPONENT16;case It.D32F:return Gn(this.gl)?Je.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Je.DEPTH_COMPONENT:Je.DEPTH_COMPONENT16;case It.D24:return Gn(this.gl)?Je.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Je.DEPTH_COMPONENT:Je.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=ph(r);switch(t){case Rr.U8:return Je.UNSIGNED_BYTE;case Rr.U16:return Je.UNSIGNED_SHORT;case Rr.U32:return Je.UNSIGNED_INT;case Rr.S8:return Je.BYTE;case Rr.F16:return Je.HALF_FLOAT;case Rr.F32:return Je.FLOAT;case Rr.U16_PACKED_5551:return Je.UNSIGNED_SHORT_5_5_5_1;case Rr.D32F:return Gn(this.gl)?Je.FLOAT:this.WEBGL_depth_texture?Je.UNSIGNED_INT:Je.UNSIGNED_BYTE;case Rr.D24:return Gn(this.gl)?Je.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Je.UNSIGNED_SHORT:Je.UNSIGNED_BYTE;case Rr.D24S8:return Gn(this.gl)?Je.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Je.UNSIGNED_INT_24_8_WEBGL:Je.UNSIGNED_BYTE;case Rr.D32FS8:return Je.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(r){switch(r){case It.F32_R:return Je.R32F;case It.F32_RG:return Je.RG32F;case It.F32_RGB:return Je.RGB32F;case It.F32_RGBA:return Je.RGBA32F;case It.F16_R:return Je.R16F;case It.F16_RG:return Je.RG16F;case It.F16_RGB:return Je.RGB16F;case It.F16_RGBA:return Je.RGBA16F}return this.translateTextureFormat(r)},e.prototype.translateTextureFormat=function(r){if(JE(r)||r===It.F32_LUMINANCE||r===It.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=Gn(this.gl)||!Gn(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case It.D24_S8:case It.D32F_S8:return t?Je.DEPTH_STENCIL:Je.RGBA;case It.D24:case It.D32F:return t?Je.DEPTH_COMPONENT:Je.RGBA}var n=eS(r),i=i0(r);switch(i){case Nn.A:return Je.ALPHA;case Nn.R:return n?Je.RED_INTEGER:Je.RED;case Nn.RG:return n?Je.RG_INTEGER:Je.RG;case Nn.RGB:return n?Je.RGB_INTEGER:Je.RGB;case Nn.RGBA:return Je.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(Gn(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Pi(r.compileState!==Ul.NeedsCompile),r.compileState===Ul.Compiling&&(r.compileState=Ul.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new A5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new Fy({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new k5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new w5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.mipLevelCount;return Pi(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return!((n=r.vertex)===null||n===void 0)&&n.glsl&&(r.vertex.glsl=Vp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((i=r.fragment)===null||i===void 0)&&i.glsl&&(r.fragment.glsl=Vp(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new C5({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new v5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new T5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new I5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new D5},e.prototype.createComputePipeline=function(r){return new P5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new M5({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new R5({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,s,l,f=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var d=0;d<f.length;d++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[d]=(i=r.colorAttachmentLevel[d])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[d]=(a=r.colorResolveToLevel[d])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[d]=(s=r.colorClearColor[d])!==null&&s!==void 0?s:"load",r.colorStore||(r.colorStore=[]),r.colorStore[d]=(l=r.colorStore[d])!==null&&l!==void 0?l:!1},e.prototype.createRenderBundle=function(){return new L5({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(r){this.renderBundle=r},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(r){r.forEach(function(t){t.replay()})},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,s=r.colorResolveToLevel,l=r.depthStencilAttachment,f=r.depthClearValue,d=r.stencilClearValue,_=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var x=0;x<t.length;x++)this.setRenderPassParametersColor(x,t[x],n[x],a[x],s[x]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var x=0;x<t.length;x++){var A=i[x];A!=="load"&&this.setRenderPassParametersClearColor(x,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(f,d),this},e.prototype.submitPass=function(r){Pi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s){var l=this.gl,f=r,d=i;if(Pi(d.mipLevelCount===1),Pi(f.mipLevelCount===1),Gn(l))f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,d,0),l.blitFramebuffer(a,s,a+d.width,s+d.height,t,n,t+d.width,n+d.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(f===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,f)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case It.BC1_SRGB:case It.BC2_SRGB:case It.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?By(t,n,4,4):!1;case It.BC1:case It.BC2:case It.BC3:return this.WEBGL_compressed_texture_s3tc!==null?By(t,n,4,4):!1;case It.BC4_UNORM:case It.BC4_SNORM:case It.BC5_UNORM:case It.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?By(t,n,4,4):!1;case It.U16_R_NORM:case It.U16_RG_NORM:case It.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case It.F32_R:case It.F32_RG:case It.F32_RGB:case It.F32_RGBA:return this.OES_texture_float_linear!==null;case It.F16_R:case It.F16_RG:case It.F16_RGB:case It.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Ul.NeedsCompile)throw new Error("whoops");if(r.compileState===Ul.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Ul.NeedsBind||r.compileState===Ul.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)Hm(n[i],"".concat(t," Page ").concat(i));else if(r.type===ya.Texture)Hm(Dv(r),t);else if(r.type===ya.Sampler)Hm(Ly(r),t);else if(r.type===ya.RenderTarget){var a=r.gl_renderbuffer;a!==null&&Hm(a,t)}else r.type===ya.InputLayout&&Hm(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Pi(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;Gn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,kv(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(B4(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if((0,Xc.Z)(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===ya.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,Je.TEXTURE_2D,Dv(n.texture),i);else if(n.type===ya.Texture){var s=Dv(n);n.dimension===Yi.TEXTURE_2D?a.framebufferTexture2D(r,t,Je.TEXTURE_2D,s,i):Gn(a)&&(n.dimension,Yi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=(0,Xc.Z)(t)?Tn.Depth|Tn.Stencil:Rv(t.format),a=!!(i&Tn.Depth),s=!!(i&Tn.Stencil);if(a&&s){var l=Gn(this.gl)||!Gn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(Pi(r===a.sampleCount),Pi(t===a.width),Pi(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Pi(r===this.currentDepthStencilAttachment.sampleCount),Pi(t===this.currentDepthStencilAttachment.width),Pi(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(Gn(t)?t.bindFramebuffer(Je.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(Je.FRAMEBUFFER,this.renderPassDrawFramebuffer),Gn(t)?t.drawBuffers([Je.COLOR_ATTACHMENT0,Je.COLOR_ATTACHMENT1,Je.COLOR_ATTACHMENT2,Je.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Je.COLOR_ATTACHMENT0_WEBGL,Je.COLOR_ATTACHMENT1_WEBGL,Je.COLOR_ATTACHMENT2_WEBGL,Je.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=Gn(t)?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,a=Gn(t)?Je.COLOR_ATTACHMENT0:Je.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,Je.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,Je.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var s=this.gl,l=Gn(s);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,(l?Je.COLOR_ATTACHMENT0:Je.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Gn(n)?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==su.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=su.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==su.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=su.ALL)}this.setScissorRectEnabled(!1),Gn(s)?s.clearBufferfv(s.COLOR,r,[t,n,i,a]):(s.clearColor(t,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Pi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Gn(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Pi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Gn(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t=this,n;if(this.renderBundle){this.renderBundle.push(function(){return t.setBindings(r)});return}var i=this.gl,a=r,s=a.uniformBufferBindings,l=a.samplerBindings,f=a.bindingLayouts;Pi(0<f.bindingLayoutTables.length);var d=f.bindingLayoutTables[0];Pi(s.length>=d.numUniformBuffers),Pi(l.length>=d.numSamplers);for(var _=0;_<s.length;_++){var x=s[_];if(x.size!==0){var A=d.firstUniformBuffer+_,C=x.buffer,I=x.offset||0,O=x.size||C.byteSize;if(C!==this.currentUniformBuffers[A]||I!==this.currentUniformBufferByteOffsets[A]||O!==this.currentUniformBufferByteSizes[A]){var Z=I%C.pageByteSize,Y=C.gl_buffer_pages[I/C.pageByteSize|0];Pi(Z+O<=C.pageByteSize),Gn(i)&&i.bindBufferRange(i.UNIFORM_BUFFER,A,Y,Z,O),this.currentUniformBuffers[A]=C,this.currentUniformBufferByteOffsets[A]=I,this.currentUniformBufferByteSizes[A]=O}}}for(var _=0;_<d.numSamplers;_++){var x=l[_],ie=d.firstSampler+_,ge=x!==null&&x.sampler!==null?Ly(x.sampler):null,Ve=x!==null&&x.texture!==null?Dv(x.texture):null;if(this.currentSamplers[ie]!==ge&&(Gn(i)&&i.bindSampler(ie,ge),this.currentSamplers[ie]=ge),this.currentTextures[ie]!==Ve){if(this.setActiveTexture(i.TEXTURE0+ie),Ve!==null){var gt=Ld(x).texture,lt=gt.gl_target,Qe=gt.width,Mt=gt.height;x.texture.textureIndex=ie,i.bindTexture(lt,Ve),Gn(i)||(n=x.sampler)===null||n===void 0||n.setTextureParameters(lt,Qe,Mt),this.debugGroupStatisticsTextureBind()}else{var Vt=(0,kn.pi)((0,kn.pi)({},x),WE),Sr=Vt.dimension,mr=Vt.formatKind,lt=S5(Sr);i.bindTexture(lt,this.getFallbackTexture((0,kn.pi)({gl_target:lt,formatKind:mr},Vt)))}this.currentTextures[ie]=Ve}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&su.RED),!!(n.channelWriteMask&su.GREEN),!!(n.channelWriteMask&su.BLUE),!!(n.channelWriteMask&su.ALPHA)),t.channelWriteMask=n.channelWriteMask);var s=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(jp(t.rgbBlendState)&&jp(t.alphaBlendState)?a.enableiOES(r,i.BLEND):jp(n.rgbBlendState)&&jp(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),s&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&su.RED),!!(t.channelWriteMask&su.GREEN),!!(t.channelWriteMask&su.BLUE),!!(t.channelWriteMask&su.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(jp(r.rgbBlendState)&&jp(r.alphaBlendState)?n.enable(n.BLEND):jp(t.rgbBlendState)&&jp(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Pi(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(UE(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),zE(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!l0(n.stencilFront,r.stencilFront)){var a=r.stencilFront,s=a.passOp,l=a.failOp,f=a.depthFailOp,d=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==f)&&(t.stencilOpSeparate(t.FRONT,l,f,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=f),n.stencilFront.compare!==d&&(this.setStencilReference(0),n.stencilFront.compare=d)}if(!l0(n.stencilBack,r.stencilBack)){var _=r.stencilBack,s=_.passOp,l=_.failOp,f=_.depthFailOp,d=_.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==f)&&(t.stencilOpSeparate(t.BACK,l,f,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=f),n.stencilBack.compare!==d&&(this.setStencilReference(0),n.stencilBack.compare=d)}(n.stencilFront.mask!==r.stencilFront.mask||n.stencilBack.mask!==r.stencilBack.mask)&&(n.stencilFront.mask=r.stencilFront.mask,n.stencilBack.mask=r.stencilBack.mask,this.applyStencil()),n.cullMode!==r.cullMode&&(n.cullMode===Nl.NONE?t.enable(t.CULL_FACE):r.cullMode===Nl.NONE&&t.disable(t.CULL_FACE),r.cullMode===Nl.BACK?t.cullFace(t.BACK):r.cullMode===Nl.FRONT?t.cullFace(t.FRONT):r.cullMode===Nl.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Pi(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Pi(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){var t=this;if(this.renderBundle){this.renderBundle.push(function(){return t.setPipeline(r)});return}this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===Ul.NeedsBind){var i=this.gl,a=n.gl_program,s=n.descriptor,l=rS(s.vertex.glsl,B5);if(Gn(i))for(var f=0;f<l.length;f++){var d=(0,kn.CR)(l[f],2),_=d[1],x=i.getUniformBlockIndex(a,_);x!==-1&&x!==4294967295&&i.uniformBlockBinding(a,x,f)}for(var A=rS(s.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),f=0;f<A.length;f++){var C=(0,kn.CR)(A[f],3),I=C[1],O=C[2],Z=i.getUniformLocation(a,I);i.uniform1i(Z,parseInt(O))}n.compileState=Ul.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,s=this,l;if(this.renderBundle){this.renderBundle.push(function(){return s.setVertexInput(r,t,n)});return}if(r!==null){Pi(this.currentPipeline.inputLayout===r);var f=r;this.bindVAO(f.vao);for(var d=this.gl,_=0;_<f.vertexBufferDescriptors.length;_++){var x=f.vertexBufferDescriptors[_],A=x.arrayStride,C=x.attributes;try{for(var I=(i=void 0,(0,kn.XA)(C)),O=I.next();!O.done;O=I.next()){var Z=O.value,Y=Z.shaderLocation,ie=Z.offset,ge=Gn(d)?Y:(l=f.program.attributes[Y])===null||l===void 0?void 0:l.location;if(!(0,Xc.Z)(ge)){var Ve=t[_];if(Ve===null)continue;var gt=Z.vertexFormat;d.bindBuffer(d.ARRAY_BUFFER,kv(Ve.buffer));var lt=(Ve.offset||0)+ie;d.vertexAttribPointer(ge,gt.size,gt.type,gt.normalized,A,lt)}}}catch(Mt){i={error:Mt}}finally{try{O&&!O.done&&(a=I.return)&&a.call(I)}finally{if(i)throw i.error}}}if(Pi(n!==null==(f.indexBufferFormat!==null)),n!==null){var Qe=n.buffer;Pi(Qe.usage===Qa.INDEX),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,kv(Qe)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Pi(this.currentPipeline.inputLayout===null),Pi(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.draw(r,t,n,i)});return}var l=this.gl,f=this.currentPipeline;if(t){var d=[f.drawMode,n||0,r,t];Gn(l)?l.drawArraysInstanced.apply(l,(0,kn.ev)([],(0,kn.CR)(d),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,kn.ev)([],(0,kn.CR)(d),!1))}else l.drawArrays(f.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var s,l=this;if(this.renderBundle){this.renderBundle.push(function(){return l.drawIndexed(r,t,n,i,a)});return}var f=this.gl,d=this.currentPipeline,_=Ld(d.inputLayout),x=Ld(this.currentIndexBufferByteOffset)+n*_.indexBufferCompByteSize;if(t){var A=[d.drawMode,r,_.indexBufferType,x,t];Gn(f)?f.drawElementsInstanced.apply(f,(0,kn.ev)([],(0,kn.CR)(A),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,kn.ev)([],(0,kn.CR)(A),!1))}else f.drawElements(d.drawMode,r,_.indexBufferType,x);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(Gn(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(Gn(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=Gn(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(Pi(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?r.bindFramebuffer(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var f=this.currentDepthStencilAttachment;if(f){var d=this.currentDepthStencilResolveTo,l=!1;d&&(Pi(f.width===d.width&&f.height===d.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,f),this.bindFramebufferDepthStencilAttachment(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,d)),l=!0,t&&r.blitFramebuffer(0,0,f.width,f.height,0,0,d.width,d.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,f),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?Je.READ_FRAMEBUFFER:Je.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?Je.DRAW_FRAMEBUFFER:Je.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){(0,Xc.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Je.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Je.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===Je.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Je.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Je.TEXTURE_3D)return this.fallbackTexture3D;if(t===Je.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Qa.VERTEX|Qa.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Dd.VERTEX,attributes:[{format:It.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Cs.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[It.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Pv(Bd)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[P4]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),N5=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,kn.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d,_,x,A,C,I;return(0,kn.Jh)(this,function(O){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,s=a===void 0?!1:a,l=t.preserveDrawingBuffer,f=l===void 0?!1:l,d=t.premultipliedAlpha,_=d===void 0?!0:d,x=t.shaderDebug,A=t.trackResources,C={antialias:s,preserveDrawingBuffer:f,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(I=r.getContext("webgl2",C)||r.getContext("experimental-webgl2",C)),!I&&n.includes("webgl1")&&(I=r.getContext("webgl",C)||r.getContext("experimental-webgl",C)),[2,new F5(I,{shaderDebug:x,trackResources:A})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}();let Rs;const iS=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&iS.decode();let Wm=null;function h0(){return(Wm===null||Wm.byteLength===0)&&(Wm=new Uint8Array(Rs.memory.buffer)),Wm}function p0(e,r){return e=e>>>0,iS.decode(h0().subarray(e,e+r))}const Qh=new Array(128).fill(void 0);Qh.push(void 0,null,!0,!1);let Gm=Qh.length;function U5(e){Gm===Qh.length&&Qh.push(Qh.length+1);const r=Gm;return Gm=Qh[r],Qh[r]=e,r}function d0(e){return Qh[e]}function z5(e){e<132||(Qh[e]=Gm,Gm=e)}function Z5(e){const r=d0(e);return z5(e),r}let Xm=0;const v0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},V5=typeof v0.encodeInto=="function"?function(e,r){return v0.encodeInto(e,r)}:function(e,r){const t=v0.encode(e);return r.set(t),{read:e.length,written:t.length}};function Ny(e,r,t){if(t===void 0){const l=v0.encode(e),f=r(l.length,1)>>>0;return h0().subarray(f,f+l.length).set(l),Xm=l.length,f}let n=e.length,i=r(n,1)>>>0;const a=h0();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=t(i,n,n=s+e.length*3,1)>>>0;const l=h0().subarray(i+s,i+n),f=V5(e,l);s+=f.written}return Xm=s,i}let $m=null;function m0(){return($m===null||$m.byteLength===0)&&($m=new Int32Array(Rs.memory.buffer)),$m}function j5(e,r,t){let n,i;try{const l=Rs.__wbindgen_add_to_stack_pointer(-16),f=Ny(e,Rs.__wbindgen_malloc,Rs.__wbindgen_realloc),d=Xm,_=Ny(r,Rs.__wbindgen_malloc,Rs.__wbindgen_realloc),x=Xm;Rs.glsl_compile(l,f,d,_,x,t);var a=m0()[l/4+0],s=m0()[l/4+1];return n=a,i=s,p0(a,s)}finally{Rs.__wbindgen_add_to_stack_pointer(16),Rs.__wbindgen_free(n,i,1)}}class Ym{static __wrap(r){r=r>>>0;const t=Object.create(Ym.prototype);return t.__wbg_ptr=r,t}__destroy_into_raw(){const r=this.__wbg_ptr;return this.__wbg_ptr=0,r}free(){const r=this.__destroy_into_raw();Rs.__wbg_wgslcomposer_free(r)}constructor(){const r=Rs.wgslcomposer_new();return Ym.__wrap(r)}wgsl_compile(r){let t,n;try{const s=Rs.__wbindgen_add_to_stack_pointer(-16),l=Ny(r,Rs.__wbindgen_malloc,Rs.__wbindgen_realloc),f=Xm;Rs.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,f);var i=m0()[s/4+0],a=m0()[s/4+1];return t=i,n=a,p0(i,a)}finally{Rs.__wbindgen_add_to_stack_pointer(16),Rs.__wbindgen_free(t,n,1)}}}function H5(e,r){return Yy(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,r)}else{const t=yield WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})}function W5(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){const n=p0(r,t);return U5(n)},e.wbg.__wbindgen_object_drop_ref=function(r){Z5(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(d0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(d0(r),d0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(p0(r,t))},e}function G5(e,r){return Rs=e.exports,aS.__wbindgen_wasm_module=r,$m=null,Wm=null,Rs}function aS(e){return Yy(this,null,function*(){if(Rs!==void 0)return Rs;const r=W5();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield H5(yield e,r);return G5(t,n)})}var Xs;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Xs||(Xs={}));var Uy;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(Uy||(Uy={}));function X5(e){var r=0;return e&ku.SAMPLED&&(r|=Xs.TEXTURE_BINDING|Xs.COPY_DST|Xs.COPY_SRC),e&ku.STORAGE&&(r|=Xs.TEXTURE_BINDING|Xs.STORAGE_BINDING|Xs.COPY_SRC|Xs.COPY_DST),e&ku.RENDER_TARGET&&(r|=Xs.RENDER_ATTACHMENT|Xs.TEXTURE_BINDING|Xs.COPY_SRC|Xs.COPY_DST),r}function zy(e){if(e===It.U8_R_NORM)return"r8unorm";if(e===It.S8_R_NORM)return"r8snorm";if(e===It.U8_RG_NORM)return"rg8unorm";if(e===It.S8_RG_NORM)return"rg8snorm";if(e===It.U32_R)return"r32uint";if(e===It.S32_R)return"r32sint";if(e===It.F32_R)return"r32float";if(e===It.U16_RG)return"rg16uint";if(e===It.S16_RG)return"rg16sint";if(e===It.F16_RG)return"rg16float";if(e===It.U8_RGBA_RT)return"bgra8unorm";if(e===It.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===It.U8_RGBA_NORM)return"rgba8unorm";if(e===It.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===It.S8_RGBA_NORM)return"rgba8snorm";if(e===It.F32_RGB)return"rgb9e5ufloat";if(e===It.U32_RG)return"rg32uint";if(e===It.S32_RG)return"rg32sint";if(e===It.F32_RG)return"rg32float";if(e===It.U16_RGBA)return"rgba16uint";if(e===It.S16_RGBA)return"rgba16sint";if(e===It.F16_RGBA)return"rgba16float";if(e===It.F32_RGBA)return"rgba32float";if(e===It.U32_RGBA)return"rgba32uint";if(e===It.S32_RGBA)return"rgba32sint";if(e===It.D24)return"depth24plus";if(e===It.D24_S8)return"depth24plus-stencil8";if(e===It.D32F)return"depth32float";if(e===It.D32F_S8)return"depth32float-stencil8";if(e===It.BC1)return"bc1-rgba-unorm";if(e===It.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===It.BC2)return"bc2-rgba-unorm";if(e===It.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===It.BC3)return"bc3-rgba-unorm";if(e===It.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===It.BC4_SNORM)return"bc4-r-snorm";if(e===It.BC4_UNORM)return"bc4-r-unorm";if(e===It.BC5_SNORM)return"bc5-rg-snorm";if(e===It.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function $5(e){if(e===Yi.TEXTURE_2D)return"2d";if(e===Yi.TEXTURE_CUBE_MAP)return"2d";if(e===Yi.TEXTURE_2D_ARRAY)return"2d";if(e===Yi.TEXTURE_3D)return"3d";throw new Error("whoops")}function Y5(e){if(e===Yi.TEXTURE_2D)return"2d";if(e===Yi.TEXTURE_CUBE_MAP)return"cube";if(e===Yi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Yi.TEXTURE_3D)return"3d";throw new Error("whoops")}function q5(e){var r=0;return e&Qa.INDEX&&(r|=GPUBufferUsage.INDEX),e&Qa.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&Qa.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&Qa.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&Qa.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),e&Qa.INDIRECT&&(r|=GPUBufferUsage.INDIRECT),r|=GPUBufferUsage.COPY_DST,r}function Zy(e){if(e===yl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===yl.REPEAT)return"repeat";if(e===yl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function oS(e){if(e===os.BILINEAR)return"linear";if(e===os.POINT)return"nearest";throw new Error("whoops")}function K5(e){if(e===Gs.LINEAR)return"linear";if(e===Gs.NEAREST)return"nearest";if(e===Gs.NO_MIP)return"nearest";throw new Error("whoops")}function Lv(e){var r=e;return r.gpuBuffer}function Q5(e){var r=e;return r.gpuSampler}function J5(e){var r=e;return r.querySet}function eD(e){if(e===n0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function tD(e){switch(e){case Cs.TRIANGLES:return"triangle-list";case Cs.POINTS:return"point-list";case Cs.TRIANGLE_STRIP:return"triangle-strip";case Cs.LINES:return"line-list";case Cs.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function rD(e){if(e===Nl.NONE)return"none";if(e===Nl.FRONT)return"front";if(e===Nl.BACK)return"back";throw new Error("whoops")}function nD(e){if(e===zm.CCW)return"ccw";if(e===zm.CW)return"cw";throw new Error("whoops")}function iD(e,r){return{topology:tD(e),cullMode:rD(r.cullMode),frontFace:nD(r.frontFace)}}function sS(e){if(e===Qi.ZERO)return"zero";if(e===Qi.ONE)return"one";if(e===Qi.SRC)return"src";if(e===Qi.ONE_MINUS_SRC)return"one-minus-src";if(e===Qi.DST)return"dst";if(e===Qi.ONE_MINUS_DST)return"one-minus-dst";if(e===Qi.SRC_ALPHA)return"src-alpha";if(e===Qi.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Qi.DST_ALPHA)return"dst-alpha";if(e===Qi.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Qi.CONST)return"constant";if(e===Qi.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Qi.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function aD(e){if(e===ou.ADD)return"add";if(e===ou.SUBSTRACT)return"subtract";if(e===ou.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===ou.MIN)return"min";if(e===ou.MAX)return"max";throw new Error("whoops")}function uS(e){return{operation:aD(e.blendMode),srcFactor:sS(e.blendSrcFactor),dstFactor:sS(e.blendDstFactor)}}function lS(e){return e.blendMode===ou.ADD&&e.blendSrcFactor===Qi.ONE&&e.blendDstFactor===Qi.ZERO}function oD(e){if(!(lS(e.rgbBlendState)&&lS(e.alphaBlendState)))return{color:uS(e.rgbBlendState),alpha:uS(e.alphaBlendState)}}function sD(e,r){return{format:zy(r),blend:oD(e),writeMask:e.channelWriteMask}}function uD(e,r){return r.attachmentsState.map(function(t,n){return sD(t,e[n])})}function g0(e){if(e===Hi.NEVER)return"never";if(e===Hi.LESS)return"less";if(e===Hi.EQUAL)return"equal";if(e===Hi.LEQUAL)return"less-equal";if(e===Hi.GREATER)return"greater";if(e===Hi.NOTEQUAL)return"not-equal";if(e===Hi.GEQUAL)return"greater-equal";if(e===Hi.ALWAYS)return"always";throw new Error("whoops")}function Bv(e){if(e===$o.KEEP)return"keep";if(e===$o.REPLACE)return"replace";if(e===$o.ZERO)return"zero";if(e===$o.DECREMENT_CLAMP)return"decrement-clamp";if(e===$o.DECREMENT_WRAP)return"decrement-wrap";if(e===$o.INCREMENT_CLAMP)return"increment-clamp";if(e===$o.INCREMENT_WRAP)return"increment-wrap";if(e===$o.INVERT)return"invert";throw new Error("whoops")}function lD(e,r){if(!(0,Xc.Z)(e))return{format:zy(e),depthWriteEnabled:!!r.depthWrite,depthCompare:g0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:g0(r.stencilFront.compare),passOp:Bv(r.stencilFront.passOp),failOp:Bv(r.stencilFront.failOp),depthFailOp:Bv(r.stencilFront.depthFailOp)},stencilBack:{compare:g0(r.stencilBack.compare),passOp:Bv(r.stencilBack.passOp),failOp:Bv(r.stencilBack.failOp),depthFailOp:Bv(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function cD(e){if(e!==null){if(e===It.U16_R)return"uint16";if(e===It.U32_R)return"uint32";throw new Error("whoops")}}function fD(e){if(e===Dd.VERTEX)return"vertex";if(e===Dd.INSTANCE)return"instance";throw new Error("whoops")}function hD(e){if(e===It.U8_R)return"uint8x2";if(e===It.U8_RG)return"uint8x2";if(e===It.U8_RGB)return"uint8x4";if(e===It.U8_RGBA)return"uint8x4";if(e===It.U8_RG_NORM)return"unorm8x2";if(e===It.U8_RGBA_NORM)return"unorm8x4";if(e===It.S8_RGB_NORM)return"snorm8x4";if(e===It.S8_RGBA_NORM)return"snorm8x4";if(e===It.U16_RG_NORM)return"unorm16x2";if(e===It.U16_RGBA_NORM)return"unorm16x4";if(e===It.S16_RG_NORM)return"snorm16x2";if(e===It.S16_RGBA_NORM)return"snorm16x4";if(e===It.S16_RG)return"uint16x2";if(e===It.F16_RG)return"float16x2";if(e===It.F16_RGBA)return"float16x4";if(e===It.F32_R)return"float32";if(e===It.F32_RG)return"float32x2";if(e===It.F32_RGB)return"float32x3";if(e===It.F32_RGBA)return"float32x4";throw"whoops"}function pD(e){var r=ph(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_SNORM:case Rr.BC4_UNORM:case Rr.BC5_SNORM:case Rr.BC5_UNORM:return!0;default:return!1}}function dD(e){var r=ph(e);switch(r){case Rr.BC1:case Rr.BC2:case Rr.BC3:case Rr.BC4_SNORM:case Rr.BC4_UNORM:case Rr.BC5_SNORM:case Rr.BC5_UNORM:return 4;default:return 1}}function cS(e,r,t,n){switch(t===void 0&&(t=!1),e){case It.S8_R:case It.S8_R_NORM:case It.S8_RG_NORM:case It.S8_RGB_NORM:case It.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case It.U8_R:case It.U8_R_NORM:case It.U8_RG:case It.U8_RG_NORM:case It.U8_RGB:case It.U8_RGB_NORM:case It.U8_RGB_SRGB:case It.U8_RGBA:case It.U8_RGBA_NORM:case It.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case It.S16_R:case It.S16_RG:case It.S16_RG_NORM:case It.S16_RGB_NORM:case It.S16_RGBA:case It.S16_RGBA_NORM:{var s=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&s.set(new Int16Array(n)),s}case It.U16_R:case It.U16_RGB:case It.U16_RGBA_5551:case It.U16_RGBA_NORM:case It.U16_RG_NORM:case It.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case It.S32_R:{var f=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&f.set(new Int32Array(n)),f}case It.U32_R:case It.U32_RG:{var d=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&d.set(new Uint32Array(n)),d}case It.F32_R:case It.F32_RG:case It.F32_RGB:case It.F32_RGBA:{var _=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&_.set(new Float32Array(n)),_}}var x=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&x.set(new Uint8Array(n)),x}function vD(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*(1/0):(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}function fS(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var Sf=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(DE),mD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Bindings;var d=a.pipeline;Pi(!!d);var _=a.uniformBufferBindings,x=a.storageBufferBindings,A=a.samplerBindings,C=a.storageTextureBindings;f.numUniformBuffers=(_==null?void 0:_.length)||0;var I=[[],[],[],[]],O=0;if(_&&_.length)for(var Z=0;Z<_.length;Z++){var Y=a.uniformBufferBindings[Z],ie=Y.binding,ge=Y.size,Ve=Y.offset,gt=Y.buffer,lt={buffer:Lv(gt),offset:Ve!=null?Ve:0,size:ge};I[0].push({binding:ie!=null?ie:O++,resource:lt})}if(A&&A.length){O=0;for(var Z=0;Z<A.length;Z++){var Qe=(0,kn.pi)((0,kn.pi)({},A[Z]),WE),ie=a.samplerBindings[Z],Mt=ie.texture!==null?ie.texture:f.device.getFallbackTexture(Qe);Qe.dimension=Mt.dimension,Qe.formatKind=NE(Mt.format);var Vt=Mt.gpuTextureView;if(I[1].push({binding:(s=ie.textureBinding)!==null&&s!==void 0?s:O++,resource:Vt}),ie.samplerBinding!==-1){var Sr=ie.sampler!==null?ie.sampler:f.device.getFallbackSampler(Qe),mr=Q5(Sr);I[1].push({binding:(l=ie.samplerBinding)!==null&&l!==void 0?l:O++,resource:mr})}}}if(x&&x.length){O=0;for(var Z=0;Z<x.length;Z++){var Xr=a.storageBufferBindings[Z],ie=Xr.binding,ge=Xr.size,Ve=Xr.offset,gt=Xr.buffer,lt={buffer:Lv(gt),offset:Ve!=null?Ve:0,size:ge};I[2].push({binding:ie!=null?ie:O++,resource:lt})}}if(C&&C.length){O=0;for(var Z=0;Z<C.length;Z++){var mn=a.storageTextureBindings[Z],ie=mn.binding,Mt=mn.texture,Vt=Mt.gpuTextureView;I[3].push({binding:ie!=null?ie:O++,resource:Vt})}}var Yn=I.findLastIndex(function(Ji){return!!Ji.length});return f.gpuBindGroup=I.map(function(Ji,Ma){return Ma<=Yn&&f.device.device.createBindGroup({layout:d.getBindGroupLayout(Ma),entries:Ji})}),f}return r}(Sf),gD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=a.usage,f=a.viewOrSize,d=!!(l&Qa.MAP_READ);s.usage=q5(l),d&&(s.usage=Qa.MAP_READ|Qa.COPY_DST);var _=!(0,wv.Z)(f);if(s.view=(0,wv.Z)(f)?null:f,s.size=(0,wv.Z)(f)?s0(f,4):s0(f.byteLength,4),(0,wv.Z)(f))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:d?_:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var x=f&&f.constructor||Float32Array;new x(s.gpuBuffer.getMappedRange()).set(f),s.gpuBuffer.unmap()}return s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,f=l+a,d=a+3&-4;if(d!==a){var _=new Uint8Array(n.buffer.slice(l,f));n=new Uint8Array(d),n.set(_),i=0,l=0,f=d,a=d}for(var x=1024*1024*15,A=0;f-(l+A)>x;)this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,x),A+=x;this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,a-A)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(Sf),hS=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(r){Pi(this.gpuComputePassEncoder===null),this.frameCommandEncoder=r,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=Ld(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),yD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,f=l.computeStage;if(f===null)return s;var d={layout:"auto",compute:(0,kn.pi)({},f)};return s.gpuComputePipeline=s.device.device.createComputePipeline(d),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(Sf),_D=function(e){(0,kn.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,_=e.call(this,{id:l,device:f})||this;_.type=ya.InputLayout;var x=[];try{for(var A=(0,kn.XA)(d.vertexBufferDescriptors),C=A.next();!C.done;C=A.next()){var I=C.value,O=I.arrayStride,Z=I.stepMode,Y=I.attributes;x.push({arrayStride:O,stepMode:fD(Z),attributes:[]});try{for(var ie=(a=void 0,(0,kn.XA)(Y)),ge=ie.next();!ge.done;ge=ie.next()){var Ve=ge.value,gt=Ve.shaderLocation,lt=Ve.format,Qe=Ve.offset;x[x.length-1].attributes.push({shaderLocation:gt,format:hD(lt),offset:Qe})}}catch(Mt){a={error:Mt}}finally{try{ge&&!ge.done&&(s=ie.return)&&s.call(ie)}finally{if(a)throw a.error}}}}catch(Mt){n={error:Mt}}finally{try{C&&!C.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return _.indexFormat=cD(d.indexBufferFormat),_.buffers=x,_}return r}(Sf),pS=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,s=t.glsl,l=t.wgsl,f=t.entryPoint,d=t.postprocess,_=!1,x=l;if(!x)try{x=this.device.glsl_compile(s,n,_)}catch(Y){throw console.error(Y,s),new Error("whoops")}var A=function(Y){if(!x.includes(Y))return"continue";x=x.replace("var T_".concat(Y,": texture_2d<f32>;"),"var T_".concat(Y,": texture_depth_2d;")),x=x.replace(new RegExp("textureSample\\(T_".concat(Y,"(.*)\\);$"),"gm"),function(ie,ge){return"vec4<f32>(textureSample(T_".concat(Y).concat(ge,"), 0.0, 0.0, 0.0);")})};try{for(var C=(0,kn.XA)(["u_TextureFramebufferDepth"]),I=C.next();!I.done;I=C.next()){var O=I.value;A(O)}}catch(Y){i={error:Y}}finally{try{I&&!I.done&&(a=C.return)&&a.call(C)}finally{if(i)throw i.error}}d&&(x=d(x));var Z=this.device.device.createShaderModule({code:x});return{module:Z,entryPoint:f||"main"}},r}(Sf),bD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=a.elemCount,f=a.type;return s.querySet=s.device.device.createQuerySet({type:eD(f),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(Sf),xD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.Readback,a}return r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),(0,kn.mG)(this,void 0,void 0,function(){var _,x,A,C,I,O,Z,Y;return(0,kn.Jh)(this,function(ie){return _=t,x=0,A=fS(_.gpuTextureformat),C=Math.ceil(a/A.width)*A.length,I=Math.ceil(C/256)*256,O=I*s,Z=this.device.createBuffer({usage:Qa.STORAGE|Qa.MAP_READ|Qa.COPY_DST,hint:Ef.STATIC,viewOrSize:O}),Y=this.device.device.createCommandEncoder(),Y.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(x,0)}},{buffer:Z.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([Y.finish()]),[2,this.readBuffer(Z,0,l.byteLength===O?l:null,f,O,_.format,!0,!1,C,I,s)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,s,l,f,d,_,x,A){var C=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=It.U8_RGB),f===void 0&&(f=!1),_===void 0&&(_=0),x===void 0&&(x=0),A===void 0&&(A=0);var I=t,O=s||I.size,Z=i||I.view,Y=Z&&Z.constructor&&Z.constructor.BYTES_PER_ELEMENT||FE(l),ie=I;if(!(I.usage&Qa.MAP_READ&&I.usage&Qa.COPY_DST)){var ge=this.device.device.createCommandEncoder();ie=this.device.createBuffer({usage:Qa.STORAGE|Qa.MAP_READ|Qa.COPY_DST,hint:Ef.STATIC,viewOrSize:O}),ge.copyBufferToBuffer(I.gpuBuffer,n,ie.gpuBuffer,0,O),this.device.device.queue.submit([ge.finish()])}return new Promise(function(Ve,gt){ie.gpuBuffer.mapAsync(Uy.READ,n,O).then(function(){var lt=ie.gpuBuffer.getMappedRange(n,O),Qe=Z;if(f)Qe===null?Qe=cS(l,O,!0,lt):Qe=cS(l,Qe.buffer,void 0,lt);else if(Qe===null)switch(Y){case 1:Qe=new Uint8Array(O),Qe.set(new Uint8Array(lt));break;case 2:Qe=C.getHalfFloatAsFloatRGBAArrayBuffer(O/2,lt);break;case 4:Qe=new Float32Array(O/4),Qe.set(new Float32Array(lt));break}else switch(Y){case 1:Qe=new Uint8Array(Qe.buffer),Qe.set(new Uint8Array(lt));break;case 2:Qe=C.getHalfFloatAsFloatRGBAArrayBuffer(O/2,lt,Z);break;case 4:var Mt=Z&&Z.constructor||Float32Array;Qe=new Mt(Qe.buffer),Qe.set(new Mt(lt));break}if(_!==x){Y===1&&!f&&(_*=2,x*=2);for(var Vt=new Uint8Array(Qe.buffer),Sr=_,mr=0,Xr=1;Xr<A;++Xr){mr=Xr*x;for(var mn=0;mn<_;++mn)Vt[Sr++]=Vt[mr++]}Y!==0&&!f?Qe=new Float32Array(Vt.buffer,0,Sr/4):Qe=new Uint8Array(Vt.buffer,0,Sr)}ie.gpuBuffer.unmap(),Ve(Qe)},function(lt){return gt(lt)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=vD(a[t]);return i},r}(Sf),dS=function(){function e(r){this.device=r,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var r;return((r=this.renderBundle)===null||r===void 0?void 0:r.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(r,t){return Pi(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,s,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var f=r.colorAttachment.length;this.gfxColorAttachment.length=f,this.gfxColorResolveTo.length=f;for(var d=0;d<r.colorAttachment.length;d++){var _=r.colorAttachment[d],x=r.colorResolveTo[d];if(_===null&&x!==null&&(_=x,x=null),this.gfxColorAttachment[d]=_,this.gfxColorResolveTo[d]=x,this.gfxColorAttachmentLevel[d]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[d])||0,this.gfxColorResolveToLevel[d]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[d])||0,_!==null){this.gpuColorAttachments[d]===void 0&&(this.gpuColorAttachments[d]={});var A=this.gpuColorAttachments[d];A.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[d])||0);var C=(s=(a=r.colorClearColor)===null||a===void 0?void 0:a[d])!==null&&s!==void 0?s:"load";C==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=C),A.storeOp=!((l=r.colorStore)===null||l===void 0)&&l[d]?"store":"discard",A.resolveTarget=void 0,x!==null&&(_.sampleCount>1?A.resolveTarget=this.getTextureView(x,this.gfxColorResolveToLevel[d]):A.storeOp="store")}else{this.gpuColorAttachments.length=d,this.gfxColorAttachment.length=d,this.gfxColorResolveTo.length=d;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var I=r.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var O=!!(Rv(I.format)&Tn.Depth);O?(r.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var Z=!!(Rv(I.format)&Tn.Stencil);Z?(r.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,Xc.Z)(r.occlusionQueryPool)?void 0:J5(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r,t){Pi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(t),this.frameCommandEncoder=r,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,s)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=Ld(t.gpuRenderPipeline);this.getEncoder().setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=this.getEncoder(),a=r;n!==null&&i.setIndexBuffer(Lv(n.buffer),Ld(a.indexFormat),n.offset);for(var s=0;s<t.length;s++){var l=t[s];l!==null&&i.setVertexBuffer(s,Lv(l.buffer),l.offset)}}},e.prototype.setBindings=function(r){var t=r,n=this.getEncoder();t.gpuBindGroup.forEach(function(i,a){i&&n.setBindGroup(a,t.gpuBindGroup[a])})},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.getEncoder().draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.getEncoder().drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.getEncoder().drawIndirect(Lv(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.getEncoder().drawIndexedIndirect(Lv(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.beginBundle=function(r){this.renderBundle=r},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(r){this.gpuRenderPassEncoder.executeBundles(r.map(function(t){return t.renderBundle}))},e.prototype.finish=function(){var r;(r=this.gpuRenderPassEncoder)===null||r===void 0||r.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],i=this.gfxColorResolveTo[t];n!==null&&i!==null&&n.sampleCount===1&&this.copyAttachment(i,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(r,t,n,i){Pi(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:r.gpuTexture,mipLevel:t};Pi(n.width>>>i===r.width>>>t),Pi(n.height>>>i===r.height>>>t),Pi(!!(n.usage&Xs.COPY_SRC)),Pi(!!(r.usage&Xs.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(a,s,[r.width,r.height,1])},e}(),ED=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(Sf),SD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var d=a.lodMinClamp,_=a.mipmapFilter===Gs.NO_MIP?a.lodMinClamp:a.lodMaxClamp,x=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return x>1&&Pi(a.minFilter===os.BILINEAR&&a.magFilter===os.BILINEAR&&a.mipmapFilter===Gs.LINEAR),f.gpuSampler=f.device.device.createSampler({addressModeU:Zy(a.addressModeU),addressModeV:Zy(a.addressModeV),addressModeW:Zy((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:d,lodMaxClamp:_,minFilter:oS(a.minFilter),magFilter:oS(a.magFilter),mipmapFilter:K5(a.mipmapFilter),compare:a.compareFunction!==void 0?g0(a.compareFunction):void 0,maxAnisotropy:x}),f}return r}(Sf),y0=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.skipCreate,l=t.sampleCount,f=e.call(this,{id:n,device:i})||this;f.type=ya.Texture,f.flipY=!1;var d=a.format,_=a.dimension,x=a.width,A=a.height,C=a.depthOrArrayLayers,I=a.mipLevelCount,O=a.usage,Z=a.pixelStore;return f.flipY=!!(Z!=null&&Z.unpackFlipY),f.device.createTextureShared({format:d,dimension:_!=null?_:Yi.TEXTURE_2D,width:x,height:A,depthOrArrayLayers:C!=null?C:1,mipLevelCount:I!=null?I:1,usage:O,sampleCount:l!=null?l:1},f,s),f}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},f=t.createTexture(l),d=0;d<n.length;d++)t.queue.copyExternalImageToTexture({source:n[d],flipY:this.flipY},{texture:f,origin:[0,0,d]},[a,s]);return[f,a,s]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this,s=this.device.device,l,f,d;if(this.isImageBitmapOrCanvases(t))i=(0,kn.CR)(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3),l=i[0],f=i[1],d=i[2];else if(this.isVideo(t))l=s.importExternalTexture({source:t[0]});else{var _=fS(this.gpuTextureformat),x=Math.ceil(this.width/_.width)*_.length;t.forEach(function(A){s.queue.writeTexture({texture:a.gpuTexture},A,{bytesPerRow:x},{width:a.width,height:a.height})})}this.width=f,this.height=d,l&&(this.gpuTexture=l),this.gpuTextureView=this.gpuTexture.createView({dimension:Y5(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(Sf),AD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.RenderBundle,a.renderBundleEncoder=a.device.device.createRenderBundleEncoder({colorFormats:[a.device.swapChainFormat]}),a}return r.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},r}(Sf),TD=function(){function e(r,t,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Xs.RENDER_ATTACHMENT|Xs.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=hh.UPPER_LEFT,this.clipSpaceNearZ=Cv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Yi.TEXTURE_2D_ARRAY,Yo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Yi.TEXTURE_3D,Yo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Yi.TEXTURE_CUBE_MAP,Yo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:os.POINT,magFilter:os.POINT,mipmapFilter:Gs.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:os.POINT,magFilter:os.POINT,mipmapFilter:Gs.NEAREST,compareFunction:Hi.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new y0({id:0,device:this,descriptor:{format:It.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Yi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){Pi(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){Pi(this.frameCommandEncoderPool.every(function(r){return r!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(r){return r.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new gD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new y0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new SD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new y0({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.pi)((0,kn.pi)({},r),{dimension:Yi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ku.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=ya.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.depthOrArrayLayers,l=t.sampleCount,f=t.mipLevelCount,d=t.gpuTexture,_=t.gpuTextureView,x=t.usage;Pi(!!(x&Xs.RENDER_ATTACHMENT));var A=new y0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:Yi.TEXTURE_2D,mipLevelCount:f,usage:x},skipCreate:!0});return A.depthOrArrayLayers=s,A.sampleCount=l,A.gpuTexture=d,A.gpuTextureView=_,A},e.prototype.createProgram=function(r){var t,n;return!((t=r.vertex)===null||t===void 0)&&t.glsl&&(r.vertex.glsl=Vp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((n=r.fragment)===null||n===void 0)&&n.glsl&&(r.fragment.glsl=Vp(this.queryVendorInfo(),"frag",r.fragment.glsl)),new pS({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new pS({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,s=zy(r.format),l=$5(r.dimension),f=X5(r.usage);if(t.gpuTextureformat=s,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=f,t.sampleCount=r.sampleCount,!n){var d=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:r.sampleCount,usage:f}),_=d.createView();t.gpuTexture=d,t.gpuTextureView=_}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===Yo.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===Yi.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Yi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Yi.TEXTURE_3D)return this.fallbackTexture3D;if(t===Yi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===Yi.TEXTURE_CUBE_MAP?6:1,i=t===Yo.Float?It.U8_RGBA_NORM:It.D24;return this.createTexture({dimension:r,format:i,usage:ku.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new mD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new _D({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new yD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new ED({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.pi)({},r)})},e.prototype.createQueryPool=function(r,t){return new bD({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var f=i.megaStateDescriptor||{},d=f.stencilBack,_=f.stencilFront,x=(0,kn._T)(f,["stencilBack","stencilFront"]),A=Pv(Bd);i.megaStateDescriptor=(0,kn.pi)((0,kn.pi)((0,kn.pi)({},A),{stencilBack:(0,kn.pi)((0,kn.pi)({},A.stencilBack),d),stencilFront:(0,kn.pi)((0,kn.pi)({},A.stencilFront),_)}),x);var C=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Ve,gt){i.megaStateDescriptor.attachmentsState[gt]||(i.megaStateDescriptor.attachmentsState[gt]=jE(void 0,C))});var I=iD((n=i.topology)!==null&&n!==void 0?n:Cs.TRIANGLES,i.megaStateDescriptor),O=uD(i.colorAttachmentFormats,i.megaStateDescriptor),Z=lD(i.depthStencilAttachmentFormat,i.megaStateDescriptor),Y=void 0;i.inputLayout!==null&&(Y=i.inputLayout.buffers);var ie=i.sampleCount,ge={layout:"auto",vertex:(0,kn.pi)((0,kn.pi)({},s),{buffers:Y}),primitive:I,depthStencil:Z,multisample:{count:ie},fragment:(0,kn.pi)((0,kn.pi)({},l),{targets:O})};r.gpuRenderPipeline=this.device.createRenderPipeline(ge)}}},e.prototype.createReadback=function(){return new xD({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new AD({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();t===void 0&&(t=new dS(this));var n=this.frameCommandEncoderPool.pop();return n===void 0&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();r===void 0&&(r=new hS);var t=this.frameCommandEncoderPool.pop();return t===void 0&&(t=this.device.createCommandEncoder()),r.beginComputePass(t),r},e.prototype.submitPass=function(r){var t=r;t instanceof dS?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof hS&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(r,t,n,i,a,s,l){var f=this.device.createCommandEncoder(),d=r,_=i,x={texture:_.gpuTexture,origin:[a,s,0],mipLevel:0,aspect:"all"},A={texture:d.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};Pi(!!(_.usage&Xs.COPY_SRC)),Pi(!!(d.usage&Xs.COPY_DST)),f.copyTextureToTexture(x,A,[_.width,_.height,l||1]),this.device.queue.submit([f.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(pD(r)){if(!this.featureTextureCompressionBC)return!1;var i=dD(r);return t%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(r){case It.U16_RGBA_NORM:return!1;case It.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===ya.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===ya.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),wD=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,kn.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d;return(0,kn.Jh)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc","float32-filterable"],s=a.filter(function(x){return t.features.has(x)}),[4,t.requestDevice({requiredFeatures:s})]);case 5:if(l=_.sent(),l&&(f=this.pluginOptions.onContextLost,l.lost.then(function(){f&&f()})),l===null)return[2,null];if(d=r.getContext("webgpu"),!d)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,aS(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new TD(t,l,r,d,j5,Ym&&new Ym)]}})})},e}(),CD=hi.isPlainObject,RD=hi.isTypedArray,MD=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,s=t.uniforms,l=t.primitive,f=t.count,d=t.elements,_=t.depth,x=t.cull,A=t.instances,C={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:hh.LOWER_LEFT,clipSpaceNearZ:Cv.NEGATIVE_ONE,supportMRT:!1},I={};this.options=t,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(ge){I[ge]=r.prop(ge)}));var O={};Object.keys(a).forEach(function(ge){O[ge]=a[ge].get()});var Z=gg(Vp(C,"frag",i,null,!1)),Y=gg(Vp(C,"vert",n,null,!1)),ie={attributes:O,frag:Z,uniforms:I,vert:Y,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:y4[l===void 0?G.TRIANGLES:l]};A&&(ie.instances=A),f?ie.count=f:d&&(ie.elements=d.get()),this.initDepthDrawParams({depth:_},ie),this.initCullDrawParams({cull:x},ie),this.drawCommand=r(ie),this.drawParams=ie}return(0,j.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,V.Z)((0,V.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,V.Z)((0,V.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,Mr.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:E4[i.func||G.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:r0[s&&s.srcRGB||G.SRC_ALPHA],srcAlpha:r0[s&&s.srcAlpha||G.SRC_ALPHA],dstRGB:r0[s&&s.dstRGB||G.ONE_MINUS_SRC_ALPHA],dstAlpha:r0[s&&s.dstAlpha||G.ONE_MINUS_SRC_ALPHA]},equation:{rgb:kE[l&&l.rgb||G.FUNC_ADD],alpha:kE[l&&l.alpha||G.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,d=f===void 0?{cmp:G.ALWAYS,ref:0,mask:-1}:f,_=i.opFront,x=_===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:_,A=i.opBack,C=A===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:A;return{enable:!!a,mask:l,func:(0,V.Z)((0,V.Z)({},d),{},{cmp:S4[d.cmp]}),opFront:{fail:Tv[x.fail],zfail:Tv[x.zfail],zpass:Tv[x.zpass]},opBack:{fail:Tv[C.fail],zfail:Tv[C.zfail],zpass:Tv[C.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?G.BACK:s;n.cull={enable:!!a,face:A4[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||RD(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}CD(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}(),ID=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?G.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,d=f===void 0?!1:f,_=t.format,x=_===void 0?G.RGBA:_,A=t.mipmap,C=A===void 0?!1:A,I=t.wrapS,O=I===void 0?G.CLAMP_TO_EDGE:I,Z=t.wrapT,Y=Z===void 0?G.CLAMP_TO_EDGE:Z,ie=t.aniso,ge=ie===void 0?0:ie,Ve=t.alignment,gt=Ve===void 0?1:Ve,lt=t.premultiplyAlpha,Qe=lt===void 0?!1:lt,Mt=t.mag,Vt=Mt===void 0?G.NEAREST:Mt,Sr=t.min,mr=Sr===void 0?G.NEAREST:Sr,Xr=t.colorSpace,mn=Xr===void 0?G.BROWSER_DEFAULT_WEBGL:Xr,Yn=t.x,Ji=Yn===void 0?0:Yn,Ma=t.y,Ko=Ma===void 0?0:Ma,Vo=t.copy,$s=Vo===void 0?!1:Vo;this.width=s,this.height=l;var bl={width:s,height:l,type:Oy[a],format:_4[x],wrapS:OE[O],wrapT:OE[Y],mag:PE[Vt],min:PE[mr],alignment:gt,flipY:d,colorSpace:x4[mn],premultiplyAlpha:Qe,aniso:ge,x:Ji,y:Ko,copy:$s};n&&(bl.data=n),typeof C=="number"?bl.mipmap=b4[C]:typeof C=="boolean"&&(bl.mipmap=C),this.texture=r.texture(bl)}return(0,j.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),vS,mS,PD=(vS=(0,rr.b2)(),vS(mS=function(){function e(){var r=this;(0,J.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return"WebGL1"}),(0,F.Z)(this,"createModel",function(t){return new MD(r.gl,t)}),(0,F.Z)(this,"createAttribute",function(t){return new g4(r.gl,t)}),(0,F.Z)(this,"createBuffer",function(t){return new T4(r.gl,t)}),(0,F.Z)(this,"createElements",function(t){return new w4(r.gl,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new ID(r.gl,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new C4(r.gl,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,F.Z)(this,"useFramebufferAsync",function(){var t=(0,Ut.Z)(pe().mark(function n(i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r.gl({framebuffer:i?i.get():null})(a);case 1:case"end":return l.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}()),(0,F.Z)(this,"clear",function(t){var n,i=t.color,a=t.depth,s=t.stencil,l=t.framebuffer,f=l===void 0?null:l,d={color:i,depth:a,stencil:s};d.framebuffer=f===null?f:f.get(),(n=r.gl)===null||n===void 0||n.clear(d)}),(0,F.Z)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,s=t.height;r.gl._gl.viewport(n,i,a,s),r.width=a,r.height=s,r.gl._refresh()}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f={x:i,y:a,width:s,height:l};return n&&(f.framebuffer=n.get()),r.gl.read(f)}),(0,F.Z)(this,"readPixelsAsync",function(){var t=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",r.readPixels(i));case 1:case"end":return s.stop()}},n)}));return function(n){return t.apply(this,arguments)}}()),(0,F.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,j.Z)(e,[{key:"init",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a,s){var l=this;return pe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.canvas=i,!s){d.next=5;break}this.gl=s,d.next=8;break;case 5:return d.next=7,new Promise(function(_,x){m4()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(C,I){(C||!I)&&x(C),_(I)}})});case 7:this.gl=d.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return d.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||mS),OD=function(){function e(r,t){(0,J.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor,d=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:d,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Hp,Jh,Fv,qm,Km,dh,_0,Fd,Du,vh,mh,b0=(Hp={},(0,F.Z)(Hp,G.FLOAT,Float32Array),(0,F.Z)(Hp,G.UNSIGNED_BYTE,Uint8Array),(0,F.Z)(Hp,G.SHORT,Int16Array),(0,F.Z)(Hp,G.UNSIGNED_SHORT,Uint16Array),(0,F.Z)(Hp,G.INT,Int32Array),(0,F.Z)(Hp,G.UNSIGNED_INT,Uint32Array),Hp),kD=(Jh={},(0,F.Z)(Jh,G.POINTS,Cs.POINTS),(0,F.Z)(Jh,G.LINES,Cs.LINES),(0,F.Z)(Jh,G.LINE_LOOP,Cs.LINES),(0,F.Z)(Jh,G.LINE_STRIP,Cs.LINE_STRIP),(0,F.Z)(Jh,G.TRIANGLES,Cs.TRIANGLES),(0,F.Z)(Jh,G.TRIANGLE_FAN,Cs.TRIANGLES),(0,F.Z)(Jh,G.TRIANGLE_STRIP,Cs.TRIANGLE_STRIP),Jh),DD=(Fv={},(0,F.Z)(Fv,1,It.F32_R),(0,F.Z)(Fv,2,It.F32_RG),(0,F.Z)(Fv,3,It.F32_RGB),(0,F.Z)(Fv,4,It.F32_RGBA),Fv),LD=(qm={},(0,F.Z)(qm,G.STATIC_DRAW,Ef.STATIC),(0,F.Z)(qm,G.DYNAMIC_DRAW,Ef.DYNAMIC),(0,F.Z)(qm,G.STREAM_DRAW,Ef.DYNAMIC),qm),gS=(Km={},(0,F.Z)(Km,G.REPEAT,yl.REPEAT),(0,F.Z)(Km,G.CLAMP_TO_EDGE,yl.CLAMP_TO_EDGE),(0,F.Z)(Km,G.MIRRORED_REPEAT,yl.MIRRORED_REPEAT),Km),BD=(dh={},(0,F.Z)(dh,G.NEVER,Hi.NEVER),(0,F.Z)(dh,G.ALWAYS,Hi.ALWAYS),(0,F.Z)(dh,G.LESS,Hi.LESS),(0,F.Z)(dh,G.LEQUAL,Hi.LEQUAL),(0,F.Z)(dh,G.GREATER,Hi.GREATER),(0,F.Z)(dh,G.GEQUAL,Hi.GEQUAL),(0,F.Z)(dh,G.EQUAL,Hi.EQUAL),(0,F.Z)(dh,G.NOTEQUAL,Hi.NOTEQUAL),dh),FD=(_0={},(0,F.Z)(_0,G.FRONT,Nl.FRONT),(0,F.Z)(_0,G.BACK,Nl.BACK),_0),yS=(Fd={},(0,F.Z)(Fd,G.FUNC_ADD,ou.ADD),(0,F.Z)(Fd,G.MIN_EXT,ou.MIN),(0,F.Z)(Fd,G.MAX_EXT,ou.MAX),(0,F.Z)(Fd,G.FUNC_SUBTRACT,ou.SUBSTRACT),(0,F.Z)(Fd,G.FUNC_REVERSE_SUBTRACT,ou.REVERSE_SUBSTRACT),Fd),x0=(Du={},(0,F.Z)(Du,G.ZERO,Qi.ZERO),(0,F.Z)(Du,G.ONE,Qi.ONE),(0,F.Z)(Du,G.SRC_COLOR,Qi.SRC),(0,F.Z)(Du,G.ONE_MINUS_SRC_COLOR,Qi.ONE_MINUS_SRC),(0,F.Z)(Du,G.SRC_ALPHA,Qi.SRC_ALPHA),(0,F.Z)(Du,G.ONE_MINUS_SRC_ALPHA,Qi.ONE_MINUS_SRC_ALPHA),(0,F.Z)(Du,G.DST_COLOR,Qi.DST),(0,F.Z)(Du,G.ONE_MINUS_DST_COLOR,Qi.ONE_MINUS_DST),(0,F.Z)(Du,G.DST_ALPHA,Qi.DST_ALPHA),(0,F.Z)(Du,G.ONE_MINUS_DST_ALPHA,Qi.ONE_MINUS_DST_ALPHA),(0,F.Z)(Du,G.CONSTANT_COLOR,Qi.CONST),(0,F.Z)(Du,G.ONE_MINUS_CONSTANT_COLOR,Qi.ONE_MINUS_CONSTANT),(0,F.Z)(Du,G.CONSTANT_ALPHA,Qi.CONST),(0,F.Z)(Du,G.ONE_MINUS_CONSTANT_ALPHA,Qi.ONE_MINUS_CONSTANT),(0,F.Z)(Du,G.SRC_ALPHA_SATURATE,Qi.SRC_ALPHA_SATURATE),Du),Nv=(vh={},(0,F.Z)(vh,G.REPLACE,$o.REPLACE),(0,F.Z)(vh,G.KEEP,$o.KEEP),(0,F.Z)(vh,G.ZERO,$o.ZERO),(0,F.Z)(vh,G.INVERT,$o.INVERT),(0,F.Z)(vh,G.INCR,$o.INCREMENT_CLAMP),(0,F.Z)(vh,G.DECR,$o.DECREMENT_CLAMP),(0,F.Z)(vh,G.INCR_WRAP,$o.INCREMENT_WRAP),(0,F.Z)(vh,G.DECR_WRAP,$o.DECREMENT_WRAP),vh),ND=(mh={},(0,F.Z)(mh,G.ALWAYS,Hi.ALWAYS),(0,F.Z)(mh,G.EQUAL,Hi.EQUAL),(0,F.Z)(mh,G.GEQUAL,Hi.GEQUAL),(0,F.Z)(mh,G.GREATER,Hi.GREATER),(0,F.Z)(mh,G.LEQUAL,Hi.LEQUAL),(0,F.Z)(mh,G.LESS,Hi.LESS),(0,F.Z)(mh,G.NEVER,Hi.NEVER),(0,F.Z)(mh,G.NOTEQUAL,Hi.NOTEQUAL),mh),UD={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function E0(e){return Object.prototype.toString.call(e)in UD}function zD(e,r){for(var t=e.length,n=Math.ceil(t/3),i=t+n,a=new Float32Array(i),s=0;s<i;s+=4)a[s]=e[s/4*3],a[s+1]=e[s/4*3+1],a[s+2]=e[s/4*3+2],a[s+3]=r;return a}var ZD=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,s=t.isUBO,l=t.label,f;E0(n)?f=n:f=new b0[this.type||G.FLOAT](n),this.type=a,this.size=f.byteLength,this.buffer=r.createBuffer({viewOrSize:f,usage:s?Qa.UNIFORM:Qa.VERTEX,hint:LD[i||G.STATIC_DRAW]}),l&&r.setResourceName(this.buffer,l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;E0(n)?a=n:a=new b0[this.type||G.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}();function _S(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=VD(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function VD(e,r){if(e){if(typeof e=="string")return bS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bS(e,r)}}function bS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Oa(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e+=r,e+=e<<10,e+=e>>>6,e>>>0}function xS(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function ES(e){return 0}var jD=(0,j.Z)(function e(){(0,J.Z)(this,e),(0,F.Z)(this,"keys",[]),(0,F.Z)(this,"values",[])}),S0=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"buckets",new Map),this.keyEqualFunc=r,this.keyHashFunc=t}return(0,j.Z)(e,[{key:"findBucketIndex",value:function(t,n){for(var i=0;i<t.keys.length;i++)if(this.keyEqualFunc(n,t.keys[i]))return i;return-1}},{key:"findBucket",value:function(t){var n=this.keyHashFunc(t);return this.buckets.get(n)}},{key:"get",value:function(t){var n=this.findBucket(t);if(n===void 0)return null;var i=this.findBucketIndex(n,t);return i<0?null:n.values[i]}},{key:"add",value:function(t,n){var i=this.keyHashFunc(t);this.buckets.get(i)===void 0&&this.buckets.set(i,new jD);var a=this.buckets.get(i);a.keys.push(t),a.values.push(n)}},{key:"delete",value:function(t){var n=this.findBucket(t);if(n!==void 0){var i=this.findBucketIndex(n,t);i!==-1&&(n.keys.splice(i,1),n.values.splice(i,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var t=0,n=_S(this.buckets.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;t+=a.values.length}}catch(s){n.e(s)}finally{n.f()}return t}},{key:"values",value:pe().mark(function r(){var t,n,i,a;return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t=_S(this.buckets.values()),l.prev=1,t.s();case 3:if((n=t.n()).done){l.next=14;break}i=n.value,a=i.values.length-1;case 6:if(!(a>=0)){l.next=12;break}return l.next=9,i.values[a];case 9:a--,l.next=6;break;case 12:l.next=3;break;case 14:l.next=19;break;case 16:l.prev=16,l.t0=l.catch(1),t.e(l.t0);case 19:return l.prev=19,t.f(),l.finish(19);case 22:case"end":return l.stop()}},r,this,[[1,16,19,22]])})}]),e}();function A0(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=HD(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function HD(e,r){if(e){if(typeof e=="string")return SS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return SS(e,r)}}function SS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function AS(e,r){return e=Oa(e,r.blendMode),e=Oa(e,r.blendSrcFactor),e=Oa(e,r.blendDstFactor),e}function WD(e,r){return e=AS(e,r.rgbBlendState),e=AS(e,r.alphaBlendState),e=Oa(e,r.channelWriteMask),e}function GD(e,r){return e=Oa(e,r.r<<24|r.g<<16|r.b<<8|r.a),e}function XD(e,r){for(var t,n,i,a,s,l,f,d,_=0;_<r.attachmentsState.length;_++)e=WD(e,r.attachmentsState[_]);return e=GD(e,r.blendConstant||a0),e=Oa(e,r.depthCompare),e=Oa(e,r.depthWrite?1:0),e=Oa(e,(t=r.stencilFront)===null||t===void 0?void 0:t.compare),e=Oa(e,(n=r.stencilFront)===null||n===void 0?void 0:n.passOp),e=Oa(e,(i=r.stencilFront)===null||i===void 0?void 0:i.failOp),e=Oa(e,(a=r.stencilFront)===null||a===void 0?void 0:a.depthFailOp),e=Oa(e,(s=r.stencilBack)===null||s===void 0?void 0:s.compare),e=Oa(e,(l=r.stencilBack)===null||l===void 0?void 0:l.passOp),e=Oa(e,(f=r.stencilBack)===null||f===void 0?void 0:f.failOp),e=Oa(e,(d=r.stencilBack)===null||d===void 0?void 0:d.depthFailOp),e=Oa(e,r.stencilWrite?1:0),e=Oa(e,r.cullMode),e=Oa(e,r.frontFace?1:0),e=Oa(e,r.polygonOffset?1:0),e}function $D(e){var r=0;r=Oa(r,e.program.id),e.inputLayout!==null&&(r=Oa(r,e.inputLayout.id)),r=XD(r,e.megaStateDescriptor);for(var t=0;t<e.colorAttachmentFormats.length;t++)r=Oa(r,e.colorAttachmentFormats[t]||0);return r=Oa(r,e.depthStencilAttachmentFormat||0),xS(r)}function YD(e){var r=0;if(e.samplerBindings)for(var t=0;t<e.samplerBindings.length;t++){var n=e.samplerBindings[t];n!==null&&n.texture!==null&&(r=Oa(r,n.texture.id))}if(e.uniformBufferBindings)for(var i=0;i<e.uniformBufferBindings.length;i++){var a=e.uniformBufferBindings[i];a!==null&&a.buffer!==null&&(r=Oa(r,a.buffer.id),r=Oa(r,a.binding),r=Oa(r,a.offset),r=Oa(r,a.size))}if(e.storageBufferBindings)for(var s=0;s<e.storageBufferBindings.length;s++){var l=e.storageBufferBindings[s];l!==null&&l.buffer!==null&&(r=Oa(r,l.buffer.id),r=Oa(r,l.binding),r=Oa(r,l.offset),r=Oa(r,l.size))}if(e.storageTextureBindings)for(var f=0;f<e.storageTextureBindings.length;f++){var d=e.storageTextureBindings[f];d!==null&&d.texture!==null&&(r=Oa(r,d.texture.id),r=Oa(r,d.binding))}return xS(r)}function qD(e,r){var t,n,i,a;return((t=e.vertex)===null||t===void 0?void 0:t.glsl)===((n=r.vertex)===null||n===void 0?void 0:n.glsl)&&((i=e.fragment)===null||i===void 0?void 0:i.glsl)===((a=r.fragment)===null||a===void 0?void 0:a.glsl)}function KD(e){var r,t;return{vertex:{glsl:(r=e.vertex)===null||r===void 0?void 0:r.glsl},fragment:{glsl:(t=e.fragment)===null||t===void 0?void 0:t.glsl}}}var QD=function(){function e(r){(0,J.Z)(this,e),(0,F.Z)(this,"bindingsCache",new S0(j4,YD)),(0,F.Z)(this,"renderPipelinesCache",new S0(X4,$D)),(0,F.Z)(this,"inputLayoutsCache",new S0(q4,ES)),(0,F.Z)(this,"programCache",new S0(qD,ES)),this.device=r}return(0,j.Z)(e,[{key:"createBindings",value:function(t){var n=this.bindingsCache.get(t);if(n===null){var i,a=J4(t);a.uniformBufferBindings=(i=a.uniformBufferBindings)===null||i===void 0?void 0:i.filter(function(s){var l=s.size;return l&&l>0}),n=this.device.createBindings(a),this.bindingsCache.add(a,n)}return n}},{key:"createRenderPipeline",value:function(t){var n=this.renderPipelinesCache.get(t);if(n===null){var i=e5(t);i.colorAttachmentFormats=i.colorAttachmentFormats.filter(function(a){return a}),n=this.device.createRenderPipeline(i),this.renderPipelinesCache.add(i,n)}return n}},{key:"createInputLayout",value:function(t){t.vertexBufferDescriptors=t.vertexBufferDescriptors.filter(function(a){return!!a});var n=this.inputLayoutsCache.get(t);if(n===null){var i=n5(t);n=this.device.createInputLayout(i),this.inputLayoutsCache.add(i,n)}return n}},{key:"createProgram",value:function(t){var n=this.programCache.get(t);if(n===null){var i=KD(t);n=this.device.createProgram(t),this.programCache.add(i,n)}return n}},{key:"destroy",value:function(){var t=A0(this.bindingsCache.values()),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.destroy()}}catch(I){t.e(I)}finally{t.f()}var a=A0(this.renderPipelinesCache.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.destroy()}}catch(I){a.e(I)}finally{a.f()}var f=A0(this.inputLayoutsCache.values()),d;try{for(f.s();!(d=f.n()).done;){var _=d.value;_.destroy()}}catch(I){f.e(I)}finally{f.f()}var x=A0(this.programCache.values()),A;try{for(x.s();!(A=x.n()).done;){var C=A.value;C.destroy()}}catch(I){x.e(I)}finally{x.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}]),e}(),JD=function(){function e(r,t){(0,J.Z)(this,e);var n=t.data,i=t.type,a=t.count,s=a===void 0?0:a,l;E0(n)?l=n:l=new b0[this.type||G.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:Qa.INDEX})}return(0,j.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;E0(n)?i=n:i=new b0[this.type||G.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function TS(e){return!!(e&&e.texture)}var wS=function(){function e(r,t){(0,J.Z)(this,e),(0,F.Z)(this,"isDestroy",!1),this.device=r,this.options=t;var n=t.wrapS,i=n===void 0?G.CLAMP_TO_EDGE:n,a=t.wrapT,s=a===void 0?G.CLAMP_TO_EDGE:a,l=t.aniso,f=t.mipmap,d=f===void 0?!1:f,_=t.mag,x=_===void 0?G.NEAREST:_,A=t.min,C=A===void 0?G.NEAREST:A;this.createTexture(t),this.sampler=r.createSampler({addressModeU:gS[i],addressModeV:gS[s],minFilter:C===G.NEAREST?os.POINT:os.BILINEAR,magFilter:x===G.NEAREST?os.POINT:os.BILINEAR,mipmapFilter:Gs.NO_MIP,maxAnisotropy:l})}return(0,j.Z)(e,[{key:"createTexture",value:function(t){var n=t.type,i=n===void 0?G.UNSIGNED_BYTE:n,a=t.width,s=t.height,l=t.flipY,f=l===void 0?!1:l,d=t.format,_=d===void 0?G.RGBA:d,x=t.aniso,A=t.alignment,C=A===void 0?1:A,I=t.usage,O=I===void 0?He.SAMPLED:I,Z=t.unorm,Y=Z===void 0?!1:Z,ie=t.label,ge=t.data;this.width=a,this.height=s;var Ve=It.U8_RGBA_RT;if(i===G.UNSIGNED_BYTE&&_===G.RGBA)Ve=Y?It.U8_RGBA_NORM:It.U8_RGBA_RT;else if(i===G.UNSIGNED_BYTE&&_===G.LUMINANCE)Ve=It.U8_LUMINANCE;else if(i===G.FLOAT&&_===G.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(ge&&(ge=zD(ge,0)),Ve=It.F32_RGBA):Ve=It.F32_RGB;else if(i===G.FLOAT&&_===G.RGBA)Ve=It.F32_RGBA;else if(i===G.FLOAT&&_===G.RED)Ve=It.F32_R;else throw new Error("create texture error, type: ".concat(i,", format: ").concat(_));this.texture=this.device.createTexture({format:Ve,width:a,height:s,usage:O===He.SAMPLED?ku.SAMPLED:ku.RENDER_TARGET,pixelStore:{unpackFlipY:f,packAlignment:C},mipLevelCount:1}),ie&&this.device.setResourceName(this.texture,ie),ge&&this.texture.setImageData([ge])}},{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&this.destroy(),this.options.width=n,this.options.height=i,this.createTexture(this.options),this.isDestroy=!1}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy&&!this.texture.destroyed){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),CS=function(){function e(r,t){(0,J.Z)(this,e),this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,j.Z)(e,[{key:"createColorRenderTarget",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.options,i=n.width,a=n.height,s=n.color;s&&(TS(s)?(t&&s.resize({width:i,height:a}),this.colorTexture=s.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=s.width,this.height=s.height):i&&a&&(this.colorTexture=this.device.createTexture({format:It.U8_RGBA_RT,usage:ku.RENDER_TARGET,width:i,height:a}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i,this.height=a))}},{key:"createDepthRenderTarget",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.options,i=n.width,a=n.height,s=n.depth;s&&(TS(s)?(t&&s.resize({width:i,height:a}),this.depthTexture=s.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=s.width,this.height=s.height):i&&a&&(this.depthTexture=this.device.createTexture({format:It.D24_S8,usage:ku.RENDER_TARGET,width:i,height:a}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i,this.height=a))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var t,n;(t=this.colorRenderTarget)===null||t===void 0||t.destroy(),(n=this.depthRenderTarget)===null||n===void 0||n.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=n,this.options.height=i,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}]),e}(),eL=hi.isPlainObject,tL=hi.isTypedArray,rL=function(){function e(r,t,n){var i=this;(0,J.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),(0,F.Z)(this,"vertexBuffers",[]),this.device=r,this.options=t,this.service=n;var a=t.vs,s=t.fs,l=t.attributes,f=t.uniforms,d=t.count,_=t.elements,x=t.diagnosticDerivativeUniformityEnabled;this.options=t;var A=x?"":this.service.viewportOrigin===hh.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=n.renderCache.createProgram({vertex:{glsl:a},fragment:{glsl:s,postprocess:function(Y){return A+Y}}}),f&&(this.uniforms=this.extractUniforms(f));var C=[],I=0;Object.keys(l).forEach(function(Z){var Y=l[Z],ie=Y.get();i.vertexBuffers.push(ie.get());var ge=Y.attribute,Ve=ge.offset,gt=Ve===void 0?0:Ve,lt=ge.stride,Qe=lt===void 0?0:lt,Mt=ge.size,Vt=Mt===void 0?1:Mt,Sr=ge.divisor,mr=Sr===void 0?0:Sr,Xr=ge.shaderLocation,mn=Xr===void 0?0:Xr;C.push({arrayStride:Qe||Vt*4,stepMode:Dd.VERTEX,attributes:[{format:DD[Vt],shaderLocation:mn,offset:gt,divisor:mr}]}),I=ie.size/Vt}),d||(this.options.count=I),_&&(this.indexBuffer=_.get());var O=n.renderCache.createInputLayout({vertexBufferDescriptors:C,indexBufferFormat:_?It.U32_R:null,program:this.program});this.inputLayout=O,this.pipeline=this.createPipeline(t)}return(0,j.Z)(e,[{key:"createPipeline",value:function(t,n){var i=t.primitive,a=i===void 0?G.TRIANGLES:i,s=t.depth,l=t.cull,f=t.blend,d=t.stencil,_=this.initDepthDrawParams({depth:s}),x=!!(_&&_.enable),A=this.initCullDrawParams({cull:l}),C=!!(A&&A.enable),I=this.getBlendDrawParams({blend:f}),O=!!(I&&I.enable),Z=this.getStencilDrawParams({stencil:d}),Y=!!(Z&&Z.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:kD[a],colorAttachmentFormats:[It.U8_RGBA_RT],depthStencilAttachmentFormat:It.D24_S8,megaStateDescriptor:{attachmentsState:[n?{channelWriteMask:su.ALL,rgbBlendState:{blendMode:ou.ADD,blendSrcFactor:Qi.ONE,blendDstFactor:Qi.ZERO},alphaBlendState:{blendMode:ou.ADD,blendSrcFactor:Qi.ONE,blendDstFactor:Qi.ZERO}}:{channelWriteMask:Y&&Z.opFront.zpass===$o.REPLACE?su.NONE:su.ALL,rgbBlendState:{blendMode:O&&I.equation.rgb||ou.ADD,blendSrcFactor:O&&I.func.srcRGB||Qi.SRC_ALPHA,blendDstFactor:O&&I.func.dstRGB||Qi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:O&&I.equation.alpha||ou.ADD,blendSrcFactor:O&&I.func.srcAlpha||Qi.ONE,blendDstFactor:O&&I.func.dstAlpha||Qi.ONE}}],blendConstant:O?a0:void 0,depthWrite:x,depthCompare:x&&_.func||Hi.LESS,cullMode:C&&A.face||Nl.NONE,stencilWrite:Y,stencilFront:{compare:Y?Z.func.cmp:Hi.ALWAYS,passOp:Z.opFront.zpass,failOp:Z.opFront.fail,depthFailOp:Z.opFront.zfail,mask:Z.opFront.mask},stencilBack:{compare:Y?Z.func.cmp:Hi.ALWAYS,passOp:Z.opBack.zpass,failOp:Z.opBack.fail,depthFailOp:Z.opBack.zfail,mask:Z.opBack.mask}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,V.Z)((0,V.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){var i=this,a=(0,V.Z)((0,V.Z)({},this.options),t),s=a.count,l=s===void 0?0:s,f=a.instances,d=a.elements,_=a.uniforms,x=_===void 0?{}:_,A=a.uniformBuffers,C=a.textures;this.uniforms=(0,V.Z)((0,V.Z)({},this.uniforms),this.extractUniforms(x));var I=this.service,O=I.renderPass,Z=I.currentFramebuffer,Y=I.width,ie=I.height,ge=I.renderCache;this.pipeline=this.createPipeline(a,n);var Ve=this.service.device,gt=Ve.swapChainHeight;if(Ve.swapChainHeight=(Z==null?void 0:Z.height)||ie,O.setViewport(0,0,(Z==null?void 0:Z.width)||Y,(Z==null?void 0:Z.height)||ie),Ve.swapChainHeight=gt,O.setPipeline(this.pipeline),O.setStencilReference(1),O.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(Qe){return{buffer:Qe}}),d?{buffer:this.indexBuffer,offset:0}:null),A&&(this.bindings=ge.createBindings({pipeline:this.pipeline,uniformBufferBindings:A.map(function(Qe,Mt){var Vt=Qe;return{binding:Mt,buffer:Vt.get(),size:Vt.size}}),samplerBindings:C==null?void 0:C.map(function(Qe){return{texture:Qe.texture,sampler:Qe.sampler}})})),this.bindings&&(O.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(Qe){var Mt=i.uniforms[Qe];Mt instanceof wS?i.uniforms[Qe]=Mt.get():Mt instanceof CS&&(i.uniforms[Qe]=Mt.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),d){var lt=d.count;lt===0?O.draw(l,f):O.drawIndexed(lt,f)}else O.draw(l,f)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:BD[n.func||G.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:x0[s&&s.srcRGB||G.SRC_ALPHA],srcAlpha:x0[s&&s.srcAlpha||G.SRC_ALPHA],dstRGB:x0[s&&s.dstRGB||G.ONE_MINUS_SRC_ALPHA],dstAlpha:x0[s&&s.dstAlpha||G.ONE_MINUS_SRC_ALPHA]},equation:{rgb:yS[l&&l.rgb||G.FUNC_ADD],alpha:yS[l&&l.alpha||G.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?4294967295:s,f=i.func,d=f===void 0?{cmp:G.ALWAYS,ref:0,mask:4294967295}:f,_=i.opFront,x=_===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:_,A=i.opBack,C=A===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:A;return{enable:!!a,mask:l,func:(0,V.Z)((0,V.Z)({},d),{},{cmp:ND[d.cmp]}),opFront:{fail:Nv[x.fail],zfail:Nv[x.zfail],zpass:Nv[x.zpass],mask:d.mask},opBack:{fail:Nv[C.fail],zfail:Nv[C.zfail],zpass:Nv[C.zpass],mask:d.mask}}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?G.BACK:a;return{enable:!!i,face:FD[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||tL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}eL(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}();function nL(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var RS,MS,T0=hi.isUndefined,iL=(RS=(0,rr.b2)(),RS(MS=function(){function e(){var r=this;(0,J.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return r.device.queryVendorInfo().platformString}),(0,F.Z)(this,"createModel",function(t){return new rL(r.device,t,r)}),(0,F.Z)(this,"createAttribute",function(t){return new OD(r.device,t)}),(0,F.Z)(this,"createBuffer",function(t){return new ZD(r.device,t)}),(0,F.Z)(this,"createElements",function(t){return new JD(r.device,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new wS(r.device,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new CS(r.device,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.currentFramebuffer=t,r.beginFrame(),n(),r.endFrame(),r.currentFramebuffer=null}),(0,F.Z)(this,"useFramebufferAsync",function(){var t=(0,Ut.Z)(pe().mark(function n(i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r.currentFramebuffer=i,r.preRenderPass=r.renderPass,r.beginFrame(),l.next=5,a();case 5:r.endFrame(),r.currentFramebuffer=null,r.renderPass=r.preRenderPass;case 8:case"end":return l.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}()),(0,F.Z)(this,"clear",function(t){var n=t.color,i=t.depth,a=t.stencil,s=t.framebuffer,l=s===void 0?null:s;if(l)l.clearOptions={color:n,depth:i,stencil:a};else{var f=r.queryVerdorInfo();if(f==="WebGL1"){var d=r.getGLContext();T0(a)?T0(i)||(d.clearDepth(i),d.clear(d.DEPTH_BUFFER_BIT)):(d.clearStencil(a),d.clear(d.STENCIL_BUFFER_BIT))}else if(f==="WebGL2"){var _=r.getGLContext();T0(a)?T0(i)||_.clearBufferfv(_.DEPTH,0,[i]):_.clearBufferiv(_.STENCIL,0,[a])}}}),(0,F.Z)(this,"viewport",function(t){var n=t.width,i=t.height;r.swapChain.configureSwapChain(n,i),r.createMainColorDepthRT(n,i),r.width=n,r.height=i}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f=r.device.createReadback(),d=n.colorTexture,_=f.readTextureSync(d,i,r.viewportOrigin===hh.LOWER_LEFT?a:r.height-a,s,l,new Uint8Array(s*l*4));return f.destroy(),_}),(0,F.Z)(this,"readPixelsAsync",function(){var t=(0,Ut.Z)(pe().mark(function n(i){var a,s,l,f,d,_,x,A,C,I;return pe().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return a=i.framebuffer,s=i.x,l=i.y,f=i.width,d=i.height,_=r.device.createReadback(),x=a.colorTexture,Z.next=5,_.readTexture(x,s,r.viewportOrigin===hh.LOWER_LEFT?l:r.height-l,f,d,new Uint8Array(f*d*4));case 5:if(A=Z.sent,r.viewportOrigin!==hh.LOWER_LEFT)for(C=0;C<A.length;C+=4)I=A[C],A[C]=A[C+2],A[C+2]=I;return _.destroy(),Z.abrupt("return",A);case 9:case"end":return Z.stop()}},n)}));return function(n){return t.apply(this,arguments)}}()),(0,F.Z)(this,"getViewportSize",function(){return{width:r.width,height:r.height}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.device.gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy(),r.renderCache.destroy()})}return(0,j.Z)(e,[{key:"init",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){var s,l,f,d,_;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,f=s?new wD({shaderCompilerPath:l}):new N5({targets:["webgl2","webgl1"],onContextLost:function(I){console.warn("context lost",I)},onContextCreationError:function(I){console.warn("context creation error",I)},onContextRestored:function(I){console.warn("context restored",I)}}),A.next=5,f.createSwapChain(i);case 5:d=A.sent,d.configureSwapChain(i.width,i.height),this.device=d.getDevice(),this.swapChain=d,this.renderCache=new QD(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin,_=this.device.gl,this.extensionObject={OES_texture_float:!nL(_)&&this.device.OES_texture_float},this.createMainColorDepthRT(i.width,i.height);case 15:case"end":return A.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"createMainColorDepthRT",value:function(t,n){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:It.U8_RGBA_RT,width:t,height:n,usage:ku.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:It.D24_S8,width:t,height:n,usage:ku.RENDER_TARGET}))}},{key:"beginFrame",value:function(){this.device.beginFrame();var t=this.currentFramebuffer,n=this.swapChain,i=this.mainColorRT,a=this.mainDepthRT,s=t?t.colorRenderTarget:i,l=t?null:n.getOnscreenTexture(),f=t?t.depthRenderTarget:a,d=(t==null?void 0:t.clearOptions)||{},_=d.color,x=_===void 0?[0,0,0,0]:_,A=d.depth,C=A===void 0?1:A,I=d.stencil,O=I===void 0?0:I,Z=s?Zm(x[0]*255,x[1]*255,x[2]*255,x[3]):a0,Y=f?C:void 0,ie=f?O:void 0,ge=this.device.createRenderPass({colorAttachment:[s],colorResolveTo:[l],colorClearColor:[Z],colorStore:[!0],depthStencilAttachment:f,depthClearValue:Y,stencilClearValue:ie});this.renderPass=ge}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass),this.device.endFrame()}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||MS);function aL(e){var r=oL();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function oL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vy=["selectstart","selecting","selectend"],sL=function(e){(0,Ne.Z)(t,e);var r=aL(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,J.Z)(this,t),i=r.call(this),(0,F.Z)((0,Me.Z)(i),"isEnable",!1),(0,F.Z)((0,Me.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Me.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Me.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,j.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=ta("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,f=l.x,d=l.y,_=Math.min(a,f),x=Math.min(s,d),A=Math.abs(a-f),C=Math.abs(s-d);this.box.style.top="".concat(x,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(C,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,f=l.lng,d=l.lat;return Df([[a,s],[f,d]])}}]),t}(eo.EventEmitter),uL=function(){function e(r){(0,J.Z)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.renderer,s=a===void 0?"regl":a,l=qA();this.container=l,n.setContainer(l,t,i),l.bind(it.IRendererService).to(s==="regl"?PD:iL).inSingletonScope(),this.sceneService=l.get(it.ISceneService),this.mapService=l.get(it.IMapService),this.iconService=l.get(it.IIconService),this.fontService=l.get(it.IFontService),this.controlService=l.get(it.IControlService),this.layerService=l.get(it.ILayerService),this.debugService=l.get(it.IDebugService),this.debugService.setEnable(r.debug),this.markerService=l.get(it.IMarkerService),this.interactionService=l.get(it.IInteractionService),this.popupService=l.get(it.IPopupService),this.boxSelect=new sL(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return(0,j.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i){return pe().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=_m(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var s=n.initMask(t);n.addMask(s,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,f=n.maskOpacity,d=f===void 0?0:f;if(!(!i||!a)){var _=new pb().source(a).shape("fill").style({color:l,opacity:d});return _}}},{key:"addMask",value:function(t,n){if(t){var i=this.getLayer(n);if(i){var a=_m(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=(0,Ut.Z)(pe().mark(function n(){return pe().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=(0,Cn.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=(0,Ut.Z)(pe().mark(function n(i,a){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(Vy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else Tg.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(Vy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else Tg.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){Tg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(Vy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else Tg.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(t,n||(0,V.Z)((0,V.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(it.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Qr.REGISTERED_PROTOCOLS[t]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Bs(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new f1({position:i}))}}],[{key:"addProtocol",value:function(t,n){Qr.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Qr.REGISTERED_PROTOCOLS[t]}}]),e}(),I6="2.20.19";function Qm(e){"@babel/helpers - typeof";return Qm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Qm(e)}function IS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function P6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?IS(Object(t),!0).forEach(function(n){lL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):IS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function lL(e,r,t){return r=cL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function cL(e){var r=fL(e,"string");return Qm(r)==="symbol"?r:String(r)}function fL(e,r){if(Qm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Qm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function O6(e,r){return vL(e)||dL(e,r)||pL(e,r)||hL()}function hL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pL(e,r){if(e){if(typeof e=="string")return PS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return PS(e,r)}}function PS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function dL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function vL(e){if(Array.isArray(e))return e}var k6=null,D6=null,OS,jy,kS,mL=(OS=U0(it.IGlobalConfigService),jy=function(){function e(r){(0,J.Z)(this,e),Ni(this,"configService",kS,this),this.config=r}return(0,j.Z)(e,[{key:"setContainer",value:function(t,n,i){t.bind(it.MapConfig).toConstantValue((0,V.Z)((0,V.Z)({},this.config),{},{id:n,canvas:i})),t.bind(it.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),kS=Li(jy.prototype,"configService",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy),gL=B(6158),Jm=B.n(gL),yL=function(){function e(r){(0,J.Z)(this,e),(0,F.Z)(this,"size",1e4),this.size=r||1e4}return(0,j.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}(),_L={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},DS,LS,BS,FS,NS,US,Uv,zS,ZS,VS,jS,HS={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},bL=12,xL=(DS=(0,rr.b2)(),LS=(0,rr.f3)(it.MapConfig),BS=(0,rr.f3)(it.IGlobalConfigService),FS=(0,rr.f3)(it.ICoordinateSystemService),NS=(0,rr.f3)(it.IEventEmitter),DS(US=(Uv=function(){function e(){var r=this;(0,J.Z)(this,e),(0,F.Z)(this,"version","DEFAUlTMAP"),(0,F.Z)(this,"simpleMapCoord",new yL),(0,F.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ni(this,"config",zS,this),Ni(this,"configService",ZS,this),Ni(this,"coordinateSystemService",VS,this),Ni(this,"eventEmitter",jS,this),(0,F.Z)(this,"handleCameraChanged",function(t){var n=r.map.getCenter(),i=n.lat,a=n.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[a,i],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.updateCoordinateSystemService(),r.cameraChangedCallback(r.viewport)})}return(0,j.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ta("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){uT.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(HS[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(HS[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return _L}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>bL&&n?this.coordinateSystemService.setCoordinateSystem(io.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(io.LNGLAT)}}]),e}(),zS=Li(Uv.prototype,"config",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZS=Li(Uv.prototype,"configService",[BS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VS=Li(Uv.prototype,"coordinateSystemService",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jS=Li(Uv.prototype,"eventEmitter",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv))||US);function eg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function w0(e,r){var t=zh.fF([],r,e);return zh.bA(t,t,1/t[3]),t}function L6(e,r){var t=e%r;return t<0?r+t:t}function B6(e,r,t){return t*r+(1-t)*e}function Nd(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var Af=Math.PI,WS=Af/4,ep=Af/180,GS=180/Af,Hy=512,Wy=4003e4,EL=1.5;function XS(e){return Math.pow(2,e)}function SL(e){return Math.log2(e)}function C0(e,r){var t=(0,Cn.Z)(e,2),n=t[0],i=t[1];Nd(Number.isFinite(n)&&Number.isFinite(r)),Nd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=Hy;var a=n*ep,s=i*ep,l=r*(a+Af)/(2*Af),f=r*(Af-Math.log(Math.tan(WS+s*.5)))/(2*Af);return[l,f]}function Gy(e,r){var t=(0,Cn.Z)(e,2),n=t[0],i=t[1];r*=Hy;var a=n/r*(2*Af)-Af,s=2*(Math.atan(Math.exp(Af-i/r*(2*Af)))-WS);return[a*GS,s*GS]}function F6(e){var r=e.latitude;assert(Number.isFinite(r));var t=Math.cos(r*ep);return SL(Wy*t)-9}function $S(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:XS(n),Nd(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},f=Hy*i,d=Math.cos(r*ep),_=f/360,x=_/d,A=f/Wy/d;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[_,-x,A],l.degreesPerPixel=[1/_,-1/x,1/A],s){var C=ep*Math.tan(r*ep)/d,I=_*C/2,O=f/Wy*C,Z=O/x*A;l.pixelsPerDegree2=[0,-I,O],l.pixelsPerMeter2=[Z,0,Z]}return l}function N6(e,r){var t=_slicedToArray(e,3),n=t[0],i=t[1],a=t[2],s=_slicedToArray(r,3),l=s[0],f=s[1],d=s[2],_=1,x=$S({longitude:n,latitude:i,scale:_,highPrecision:!0}),A=x.pixelsPerMeter,C=x.pixelsPerMeter2,I=C0(e,_);I[0]+=l*(A[0]+C[0]*f),I[1]+=f*(A[1]+C[1]*f);var O=Gy(I,_),Z=(a||0)+(d||0);return Number.isFinite(a)||Number.isFinite(d)?[O[0],O[1],Z]:O}function AL(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,f=l===void 0?!1:l,d=eg();return Lt.translate(d,d,[0,0,-i]),Lt.scale(d,d,[1,1,1/r]),Lt.rotateX(d,d,-t*ep),Lt.rotateZ(d,d,n*ep),f&&Lt.scale(d,d,[1,-1,1]),s&&Lt.translate(d,d,Fa.negate([],s)),d}function TL(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?EL:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,f=l===void 0?1:l,d=e.farZMultiplier,_=d===void 0?1:d,x=s*ep,A=Math.atan(.5/i),C=Math.sin(A)*i/Math.sin(Math.PI/2-x-A),I=Math.cos(Math.PI/2-x)*C+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:f,far:I*_}}function wL(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=TL({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),f=l.fov,d=l.aspect,_=l.near,x=l.far,A=Lt.perspective([],f,d,_,x);return A}function CL(e,r){var t=(0,Cn.Z)(e,3),n=t[0],i=t[1],a=t[2],s=a===void 0?0:a;return Nd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),w0(r,[n,i,s,1])}function YS(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Cn.Z)(e,3),i=n[0],a=n[1],s=n[2];if(Nd(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=w0(r,[i,a,s,1]);return l}var f=w0(r,[i,a,0,1]),d=w0(r,[i,a,1,1]),_=f[2],x=d[2],A=_===x?0:((t||0)-_)/(x-_);return Br.t7([],f,d,A)}var qS=eg(),RL=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?qS:i,s=r.projectionMatrix,l=s===void 0?qS:s;(0,J.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var f=eg();Lt.multiply(f,f,this.projectionMatrix),Lt.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f;var d=eg();Lt.scale(d,d,[this.width/2,-this.height/2,1]),Lt.translate(d,d,[1,-1,0]),Lt.multiply(d,d,this.viewProjectionMatrix);var _=Lt.invert(eg(),d);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,j.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Lt.equals(t.projectionMatrix,this.projectionMatrix)&&Lt.equals(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(t),l=CL(s,this.pixelProjectionMatrix),f=(0,Cn.Z)(l,2),d=f[0],_=f[1],x=a?_:this.height-_;return t.length===2?[d,x]:[d,x,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,Cn.Z)(t,3),f=l[0],d=l[1],_=l[2],x=a?d:this.height-d,A=s&&s*this.pixelsPerMeter,C=YS([f,x,_],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(C),O=(0,Cn.Z)(I,3),Z=O[0],Y=O[1],ie=O[2];return Number.isFinite(_)?[Z,Y,ie]:Number.isFinite(s)?[Z,Y,s]:[Z,Y]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=(0,Cn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=(0,Cn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function ML(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,f=e.padding,d=f===void 0?0:f,_=e.offset,x=_===void 0?[0,0]:_,A=(0,Cn.Z)(n,2),C=(0,Cn.Z)(A[0],2),I=C[0],O=C[1],Z=(0,Cn.Z)(A[1],2),Y=Z[0],ie=Z[1];if(Number.isFinite(d)){var ge=d;d={top:ge,bottom:ge,left:ge,right:ge}}else Nd(Number.isFinite(d.top)&&Number.isFinite(d.bottom)&&Number.isFinite(d.left)&&Number.isFinite(d.right));var Ve=new KS({width:r,height:t,longitude:0,latitude:0,zoom:0}),gt=Ve.project([I,ie]),lt=Ve.project([Y,O]),Qe=[Math.max(Math.abs(lt[0]-gt[0]),a),Math.max(Math.abs(lt[1]-gt[1]),a)],Mt=[r-d.left-d.right-Math.abs(x[0])*2,t-d.top-d.bottom-Math.abs(x[1])*2];Nd(Mt[0]>0&&Mt[1]>0);var Vt=Mt[0]/Qe[0],Sr=Mt[1]/Qe[1],mr=(d.right-d.left)/2/Vt,Xr=(d.bottom-d.top)/2/Sr,mn=[(lt[0]+gt[0])/2+mr,(lt[1]+gt[1])/2+Xr],Yn=Ve.unproject(mn),Ji=Ve.zoom+Math.log2(Math.abs(Math.min(Vt,Sr)));return{longitude:Yn[0],latitude:Yn[1],zoom:Math.min(Ji,l)}}var KS=function(e){(0,Ne.Z)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,f=n.longitude,d=f===void 0?0:f,_=n.zoom,x=_===void 0?0:_,A=n.pitch,C=A===void 0?0:A,I=n.bearing,O=I===void 0?0:I,Z=n.altitude,Y=Z===void 0?1.5:Z,ie=n.nearZMultiplier,ge=n.farZMultiplier;(0,J.Z)(this,r),i=i||1,a=a||1;var Ve=XS(x);Y=Math.max(.75,Y);var gt=C0([d,l],Ve);gt[2]=0;var lt=wL({width:i,height:a,pitch:C,bearing:O,altitude:Y,nearZMultiplier:ie||1/a,farZMultiplier:ge||1.01}),Qe=AL({height:a,center:gt,pitch:C,bearing:O,altitude:Y,flipY:!0});return t=(0,st.Z)(this,(0,Te.Z)(r).call(this,{width:i,height:a,viewMatrix:Qe,projectionMatrix:lt})),t.latitude=l,t.longitude=d,t.zoom=x,t.pitch=C,t.bearing=O,t.altitude=Y,t.scale=Ve,t.center=gt,t.pixelsPerMeter=$S((0,Me.Z)((0,Me.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Me.Z)((0,Me.Z)(t))),t}return(0,j.Z)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return C0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Gy(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=YS(a,this.pixelUnprojectionMatrix),l=C0(i,this.scale),f=Br.IH([],l,Br.tk([],s)),d=Br.IH([],this.center,f);return Gy(d,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=ML(Object.assign({width:a,height:s,bounds:n},i)),f=l.longitude,d=l.latitude,_=l.zoom;return new r({width:a,height:s,longitude:f,latitude:d,zoom:_})}}]),r}(RL),IL=function(){function e(){(0,J.Z)(this,e)}return(0,j.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,s=t.bearing,l=t.viewportHeight,f=t.viewportWidth;this.viewport=new KS({width:f,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),PL=["id","attributionControl","style","token","rotation","mapInstance"],QS,JS;function OL(e){var r=kL();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function kL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function DL(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}DL(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Jm();var LL=0,e2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",BL=(QS=(0,rr.b2)(),QS(JS=function(e){(0,Ne.Z)(t,e);var r=OL(t);function t(){var n;(0,J.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Me.Z)(n),"version","MAPBOX"),n}return(0,j.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,f=s.y;return[l-a.x,f-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,f=l===void 0?0:l,d=s.y,_=d===void 0?0:d,x=s.z,A=x===void 0?0:x;return{x:f,y:_,z:A}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},d=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),_=d.meterInMercatorCoordinateUnits(),x=Lt.create();return Lt.translate(x,x,Fa.fromValues(d.x-f.x,d.y-f.y,d.z||0-f.z)),Lt.scale(x,x,Fa.fromValues(_*l[0],-_*l[1],_*l[2])),Lt.rotateX(x,x,s[0]),Lt.rotateY(x,x,s[1]),Lt.rotateZ(x,x,s[2]),x}},{key:"init",value:function(){var n=(0,Ut.Z)(pe().mark(function a(){var s=this,l,f,d,_,x,A,C,I,O,Z,Y,ie,ge;return pe().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:l=this.config,f=l.id,d=f===void 0?"map":f,_=l.attributionControl,x=_===void 0?!1:_,A=l.style,C=A===void 0?"light":A,I=l.token,O=I===void 0?e2:I,Z=l.rotation,Y=Z===void 0?0:Z,ie=l.mapInstance,ge=(0,ji.Z)(l,PL),this.viewport=new IL,!ie&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===e2&&C!=="blank"&&!window.mapboxgl.accessToken&&!ie&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ie&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),ie?(this.map=ie,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(d),this.map=new window.mapboxgl.Map((0,V.Z)({container:this.$mapContainer,style:this.getMapStyleValue(C),attributionControl:x,bearing:Y},ge))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return gt.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(Jm()).LngLat(i[0],i[1]),l=new(Jm()).LngLat(a[0],a[1]),f=s.distanceTo(l),d=Jm().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),_=Jm().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),x=d.x,A=d.y,C=_.x,I=_.y,O=Math.sqrt(Math.pow(x-C,2)+Math.pow(A-I,2))*4194304*2;return O/f}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+LL++,a.appendChild(s),s}}]),t}(xL))||JS);function FL(e){var r=NL();return function(){var n=(0,Te.Z)(e),i;if(r){var a=(0,Te.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,st.Z)(this,i)}}function NL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function UL(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}UL(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var zL=function(e){(0,Ne.Z)(t,e);var r=FL(t);function t(){return(0,J.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getServiceConstructor",value:function(){return BL}}]),t}(mL);function tg(e){"@babel/helpers - typeof";return tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},tg(e)}function t2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function r2(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?t2(Object(t),!0).forEach(function(n){ZL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):t2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ZL(e,r,t){return r=VL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function VL(e){var r=jL(e,"string");return tg(r)==="symbol"?r:String(r)}function jL(e,r){if(tg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(tg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function HL(e,r){return $L(e)||XL(e,r)||GL(e,r)||WL()}function WL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GL(e,r){if(e){if(typeof e=="string")return n2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n2(e,r)}}function n2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function XL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function $L(e){if(Array.isArray(e))return e}var YL=ne.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,ne.createRef)(),l=(0,ne.useState)(),f=HL(l,2),d=f[0],_=f[1];return(0,ne.useEffect)(function(){var x=new uL(r2(r2({id:s.current},i),{},{map:new zL(n)}));return x.on("loaded",function(){_(x),a&&a(x)}),function(){x.destroy()}},[]),(0,ne.useEffect)(function(){d&&n.style&&d.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ne.useEffect)(function(){d&&n.zoom&&d.setZoom(n.zoom)},[n.zoom]),(0,ne.useEffect)(function(){d&&n.center&&d.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ne.useEffect)(function(){d&&n.pitch!==void 0&&d.setPitch(n.pitch||0)},[n.pitch]),(0,ne.useEffect)(function(){d&&n.rotation&&d.setRotation(n.rotation)},[n.rotation]),ne.createElement(de.Provider,{value:d},(0,ne.createElement)("div",{ref:s,style:r,className:t},d&&e.children))}),qL=YL;function rg(e){"@babel/helpers - typeof";return rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},rg(e)}function i2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function U6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?i2(Object(t),!0).forEach(function(n){KL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function KL(e,r,t){return r=QL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function QL(e){var r=JL(e,"string");return rg(r)==="symbol"?r:String(r)}function JL(e,r){if(rg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(rg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function z6(e,r){return nB(e)||rB(e,r)||tB(e,r)||eB()}function eB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tB(e,r){if(e){if(typeof e=="string")return a2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a2(e,r)}}function a2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function rB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function nB(e){if(Array.isArray(e))return e}var Z6=null,V6=null;function ng(e){"@babel/helpers - typeof";return ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ng(e)}function o2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function j6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?o2(Object(t),!0).forEach(function(n){iB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function iB(e,r,t){return r=aB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function aB(e){var r=oB(e,"string");return ng(r)==="symbol"?r:String(r)}function oB(e,r){if(ng(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(ng(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function H6(e,r){return cB(e)||lB(e,r)||uB(e,r)||sB()}function sB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uB(e,r){if(e){if(typeof e=="string")return s2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s2(e,r)}}function s2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function lB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function cB(e){if(Array.isArray(e))return e}var W6=null,G6=null;function ig(e){"@babel/helpers - typeof";return ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ig(e)}function u2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function X6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?u2(Object(t),!0).forEach(function(n){fB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function fB(e,r,t){return r=hB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function hB(e){var r=pB(e,"string");return ig(r)==="symbol"?r:String(r)}function pB(e,r){if(ig(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(ig(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function $6(e,r){return gB(e)||mB(e,r)||vB(e,r)||dB()}function dB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vB(e,r){if(e){if(typeof e=="string")return l2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l2(e,r)}}function l2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function mB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function gB(e){if(Array.isArray(e))return e}var Y6=null,q6=null;function K6(e,r){return xB(e)||bB(e,r)||_B(e,r)||yB()}function yB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _B(e,r){if(e){if(typeof e=="string")return c2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c2(e,r)}}function c2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function bB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function xB(e){if(Array.isArray(e))return e}var Q6=null;function ag(e){"@babel/helpers - typeof";return ag=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ag(e)}var J6=null;function f2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function e8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?f2(Object(t),!0).forEach(function(n){EB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function EB(e,r,t){return r=SB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function SB(e){var r=AB(e,"string");return ag(r)==="symbol"?r:String(r)}function AB(e,r){if(ag(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(ag(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function t8(e,r){if(e==null)return{};var t=TB(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function TB(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var r8={exportImage:Ew,fullscreen:Cw,geoLocate:Iw,layer:c1,layerSwitch:c1,logo:f1,mapTheme:Uw,mouseLocation:Vw,zoom:c4,scale:Ww},n8=null,h2=B(73935);function p2(e,r){return MB(e)||RB(e,r)||CB(e,r)||wB()}function wB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CB(e,r){if(e){if(typeof e=="string")return d2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d2(e,r)}}function d2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function RB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function MB(e){if(Array.isArray(e))return e}var v2=ne.useEffect,m2=ne.useState,IB=/\B([A-Z])/g,PB=function(r){return r.replace(IB,"-$1").toLowerCase()};function i8(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=m2(),s=p2(a,2),l=s[0],f=s[1],d=useSceneValue(),_=m2(function(){return document.createElement("div")}),x=p2(_,1),A=x[0];return v2(function(){var C=new Control({position:i});return C.onAdd=function(){if(r&&(A.className=r),t){var I=Object.keys(t).map(function(O){return"".concat(PB(O),":").concat(t[O])}).join(";");A.style.cssText=I}return A},C.onRemove=function(){},f(C),d.addControl(C),function(){d.removeControl(C)}},[]),v2(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,A)}var g2=(0,ne.createContext)({});function a8(){return useContext(g2)}var OB=ne.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},Ms()),kB=ne.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},Ms()),DB=ne.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},Ms()),LB=ne.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},Ms()),BB=ne.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},Ms()),FB=ne.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},Ms()),NB=ne.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},Ms()),UB=ne.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},Ms()),zB=["data"];function ZB(e,r){if(e==null)return{};var t=VB(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function VB(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var jB=ne.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=ZB(n,zB);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},Ms()),o8=ne.useEffect,HB=ne.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},Ms());function WB(e,r){return YB(e)||$B(e,r)||XB(e,r)||GB()}function GB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XB(e,r){if(e){if(typeof e=="string")return y2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y2(e,r)}}function y2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function $B(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function YB(e){if(Array.isArray(e))return e}var og=ne.useEffect,qB=ne.useState;function _2(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,s=r.size,l=r.scale,f=r.active,d=r.select,_=r.filter,x=r.animate,A=r.options,C=r.onLayerLoaded,I=y(),O=qB(function(){var ie;switch(e){case"polygonLayer":ie=new Dg(A);break;case"lineLayer":ie=new ty(A);break;case"pointLayer":ie=new kg(A);break;case"heatmapLayer":ie=new r3(A);break;case"rasterLayer":ie=new Lg(A);break;case"imageLayer":ie=new Z1(A);break;case"citybuildingLayer":ie=new wC(A);break;default:ie=new Dg(A)}return ie.on("inited",function(){C&&C(ie,I)}),ie}),Z=WB(O,1),Y=Z[0];return og(function(){return I.addLayer(Y),function(){I.removeLayer(Y)}},[]),og(function(){Y.inited&&A&&Y.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),og(function(){Y.inited&&(A!=null&&A.zIndex)&&Y.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),og(function(){Y.inited&&(A!=null&&A.blend)&&Y.setBlend(A.blend)},[A==null?void 0:A.blend]),og(function(){I.render()}),ne.createElement(g2.Provider,{value:Y},ne.createElement(jB,{layer:Y,source:t}),l&&ne.createElement(BB,{layer:Y,scale:l}),n&&ne.createElement(DB,{layer:Y,color:n}),s&&ne.createElement(UB,{layer:Y,size:s}),i&&ne.createElement(NB,{layer:Y,shape:i}),a&&ne.createElement(HB,{layer:Y,style:a}),f&&ne.createElement(OB,{layer:Y,active:f}),d&&ne.createElement(FB,{layer:Y,select:d}),_&&ne.createElement(LB,{layer:Y,filter:_}),x&&ne.createElement(kB,{layer:Y,animate:x}),r.children)}var s8=null,u8=null,KB=ne.memo(function(r){return _2("pointLayer",r)}),QB=ne.memo(function(r){return _2("heatmapLayer",r)}),l8=null,c8=null,f8=null,h8=ne.useEffect,p8=null,d8=null;function zv(e){"@babel/helpers - typeof";return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},zv(e)}function b2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function R0(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?b2(Object(t),!0).forEach(function(n){JB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function JB(e,r,t){return r=E2(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function eF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function x2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E2(n.key),n)}}function tF(e,r,t){return r&&x2(e.prototype,r),t&&x2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function E2(e){var r=rF(e,"string");return zv(r)==="symbol"?r:String(r)}function rF(e,r){if(zv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function nF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Xy(e,r)}function Xy(e,r){return Xy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Xy(e,r)}function iF(e){var r=sF();return function(){var n=M0(e),i;if(r){var a=M0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return aF(this,i)}}function aF(e,r){if(r&&(zv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oF(e)}function oF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function M0(e){return M0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},M0(e)}var v8=function(e){nF(t,e);var r=iF(t);function t(n){var i;return eF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return tF(t,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,f=a.option,d=a.lngLat,_=new ME(R0(R0({},f),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&_.setLnglat(s),d&&_.setLnglat(d),l&&_.setHTML(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,s,l,f,d,_,x=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(f=l.lnglat)===null||f===void 0?void 0:f.lng,(d=this.props)===null||d===void 0||(_=d.lnglat)===null||_===void 0?void 0:_.lat],C=x.toString()!==A.toString();if(C){var I;this.popup.remove(),this.popup=new ME(R0(R0({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return ne.createElement(de.Consumer,{},function(a){return a&&(i.scene=a),(0,h2.createPortal)(i.props.children,i.el)})}}]),t}(ne.PureComponent);function Zv(e){"@babel/helpers - typeof";return Zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Zv(e)}function uF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function S2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cF(n.key),n)}}function lF(e,r,t){return r&&S2(e.prototype,r),t&&S2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function cF(e){var r=fF(e,"string");return Zv(r)==="symbol"?r:String(r)}function fF(e,r){if(Zv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function hF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&$y(e,r)}function $y(e,r){return $y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},$y(e,r)}function pF(e){var r=mF();return function(){var n=I0(e),i;if(r){var a=I0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return dF(this,i)}}function dF(e,r){if(r&&(Zv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vF(e)}function vF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function I0(e){return I0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I0(e)}var m8=function(e){hF(t,e);var r=pF(t);function t(n){var i;return uF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return lF(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,f=i.onMarkerLoaded,d=new ow(l);a&&d.setLnglat(a),s&&d.setElement(this.el),this.marker=d,f&&f(d),this.scene.addMarker(d)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return ne.createElement(de.Consumer,{},function(a){return a&&(i.scene=a),(0,h2.createPortal)(i.props.children,i.el)})}}]),t}(ne.PureComponent),g8=ne.useEffect,y8=null,_8=null,b8=ne.useEffect,x8=null},38163:function(Ht){Ht.exports=re;function re(de,y){var ce=de&&de.type,L;if(ce==="FeatureCollection")for(L=0;L<de.features.length;L++)re(de.features[L],y);else if(ce==="GeometryCollection")for(L=0;L<de.geometries.length;L++)re(de.geometries[L],y);else if(ce==="Feature")re(de.geometry,y);else if(ce==="Polygon")B(de.coordinates,y);else if(ce==="MultiPolygon")for(L=0;L<de.coordinates.length;L++)B(de.coordinates[L],y);return de}function B(de,y){if(de.length!==0){ne(de[0],y);for(var ce=1;ce<de.length;ce++)ne(de[ce],!y)}}function ne(de,y){for(var ce=0,L=0,ue=0,oe=de.length,Be=oe-1;ue<oe;Be=ue++){var se=(de[ue][0]-de[Be][0])*(de[Be][1]+de[ue][1]),ze=ce+se;L+=Math.abs(ce)>=Math.abs(se)?ce-ze+se:se-ze+ce,ce=ze}ce+L>=0!=!!y&&de.reverse()}},75550:function(Ht){"use strict";Ht.exports=re;function re(B,ne){this.x=B,this.y=ne}re.prototype={clone:function(){return new re(this.x,this.y)},add:function(B){return this.clone()._add(B)},sub:function(B){return this.clone()._sub(B)},multByPoint:function(B){return this.clone()._multByPoint(B)},divByPoint:function(B){return this.clone()._divByPoint(B)},mult:function(B){return this.clone()._mult(B)},div:function(B){return this.clone()._div(B)},rotate:function(B){return this.clone()._rotate(B)},rotateAround:function(B,ne){return this.clone()._rotateAround(B,ne)},matMult:function(B){return this.clone()._matMult(B)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(B){return this.x===B.x&&this.y===B.y},dist:function(B){return Math.sqrt(this.distSqr(B))},distSqr:function(B){var ne=B.x-this.x,de=B.y-this.y;return ne*ne+de*de},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(B){return Math.atan2(this.y-B.y,this.x-B.x)},angleWith:function(B){return this.angleWithSep(B.x,B.y)},angleWithSep:function(B,ne){return Math.atan2(this.x*ne-this.y*B,this.x*B+this.y*ne)},_matMult:function(B){var ne=B[0]*this.x+B[1]*this.y,de=B[2]*this.x+B[3]*this.y;return this.x=ne,this.y=de,this},_add:function(B){return this.x+=B.x,this.y+=B.y,this},_sub:function(B){return this.x-=B.x,this.y-=B.y,this},_mult:function(B){return this.x*=B,this.y*=B,this},_div:function(B){return this.x/=B,this.y/=B,this},_multByPoint:function(B){return this.x*=B.x,this.y*=B.y,this},_divByPoint:function(B){return this.x/=B.x,this.y/=B.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var B=this.y;return this.y=this.x,this.x=-B,this},_rotate:function(B){var ne=Math.cos(B),de=Math.sin(B),y=ne*this.x-de*this.y,ce=de*this.x+ne*this.y;return this.x=y,this.y=ce,this},_rotateAround:function(B,ne){var de=Math.cos(B),y=Math.sin(B),ce=ne.x+de*(this.x-ne.x)-y*(this.y-ne.y),L=ne.y+y*(this.x-ne.x)+de*(this.y-ne.y);return this.x=ce,this.y=L,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},re.convert=function(B){return B instanceof re?B:Array.isArray(B)?new re(B[0],B[1]):B}},49296:function(Ht){"use strict";Ht.exports=B,Ht.exports.default=B;var re=1e20;function B(L,ue,oe,Be,se,ze){this.fontSize=L||24,this.buffer=ue===void 0?3:ue,this.cutoff=Be||.25,this.fontFamily=se||"sans-serif",this.fontWeight=ze||"normal",this.radius=oe||8;var Ge=this.size=this.fontSize+this.buffer*2,Ke=Ge+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ge,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ke*Ke),this.gridInner=new Float64Array(Ke*Ke),this.f=new Float64Array(Ke),this.z=new Float64Array(Ke+1),this.v=new Uint16Array(Ke),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ge/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ne(L,ue,oe,Be,se,ze,Ge){ze.fill(re,0,ue*oe),Ge.fill(0,0,ue*oe);for(var Ke=(ue-Be)/2,Rt=0;Rt<se;Rt++)for(var St=0;St<Be;St++){var Nt=(Rt+Ke)*ue+St+Ke,Pt=L.data[4*(Rt*Be+St)+3]/255;if(Pt===1)ze[Nt]=0,Ge[Nt]=re;else if(Pt===0)ze[Nt]=re,Ge[Nt]=0;else{var Ct=Math.max(0,.5-Pt),pt=Math.max(0,Pt-.5);ze[Nt]=Ct*Ct,Ge[Nt]=pt*pt}}}function de(L,ue,oe,Be,se,ze,Ge){for(var Ke=0;Ke<ue*oe;Ke++){var Rt=Math.sqrt(Be[Ke])-Math.sqrt(se[Ke]);L[Ke]=Math.round(255-255*(Rt/ze+Ge))}}B.prototype._draw=function(L,ue){var oe=this.ctx.measureText(L),Be=oe.width,se=2*this.buffer,ze,Ge,Ke,Rt,St,Nt,Pt,Ct;ue&&this.useMetrics?(St=Math.floor(oe.actualBoundingBoxAscent),Ct=this.buffer+Math.ceil(oe.actualBoundingBoxAscent),Nt=this.buffer,Pt=this.buffer,Ge=Math.min(this.size,Math.ceil(oe.actualBoundingBoxRight-oe.actualBoundingBoxLeft)),Rt=Math.min(this.size-Nt,Math.ceil(oe.actualBoundingBoxAscent+oe.actualBoundingBoxDescent)),ze=Ge+se,Ke=Rt+se,this.ctx.textBaseline="alphabetic"):(ze=Ge=this.size,Ke=Rt=this.size,St=19*this.fontSize/24,Nt=Pt=0,Ct=this.middle,this.ctx.textBaseline="middle");var pt;Ge&&Rt&&(this.ctx.clearRect(Pt,Nt,Ge,Rt),this.ctx.fillText(L,this.buffer,Ct),pt=this.ctx.getImageData(Pt,Nt,Ge,Rt));var mt=new Uint8ClampedArray(ze*Ke);return ne(pt,ze,Ke,Ge,Rt,this.gridOuter,this.gridInner),y(this.gridOuter,ze,Ke,this.f,this.v,this.z),y(this.gridInner,ze,Ke,this.f,this.v,this.z),de(mt,ze,Ke,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:mt,metrics:{width:Ge,height:Rt,sdfWidth:ze,sdfHeight:Ke,top:St,left:0,advance:Be}}},B.prototype.draw=function(L){return this._draw(L,!1).data},B.prototype.drawWithMetrics=function(L){return this._draw(L,!0)};function y(L,ue,oe,Be,se,ze){for(var Ge=0;Ge<ue;Ge++)ce(L,Ge,ue,oe,Be,se,ze);for(var Ke=0;Ke<oe;Ke++)ce(L,Ke*ue,1,ue,Be,se,ze)}function ce(L,ue,oe,Be,se,ze,Ge){var Ke,Rt,St,Nt;for(ze[0]=0,Ge[0]=-re,Ge[1]=re,Ke=0;Ke<Be;Ke++)se[Ke]=L[ue+Ke*oe];for(Ke=1,Rt=0,St=0;Ke<Be;Ke++){do Nt=ze[Rt],St=(se[Ke]-se[Nt]+Ke*Ke-Nt*Nt)/(Ke-Nt)/2;while(St<=Ge[Rt]&&--Rt>-1);Rt++,ze[Rt]=Ke,Ge[Rt]=St,Ge[Rt+1]=re}for(Ke=0,Rt=0;Ke<Be;Ke++){for(;Ge[Rt+1]<Ke;)Rt++;Nt=ze[Rt],L[ue+Ke*oe]=se[Nt]+(Ke-Nt)*(Ke-Nt)}}},38929:function(Ht,re,B){Ht.exports.VectorTile=B(22779),B(66024),B(59701)},22779:function(Ht,re,B){"use strict";var ne=B(59701);Ht.exports=de;function de(ce,L){this.layers=ce.readFields(y,{},L)}function y(ce,L,ue){if(ce===3){var oe=new ne(ue,ue.readVarint()+ue.pos);oe.length&&(L[oe.name]=oe)}}},66024:function(Ht,re,B){"use strict";var ne=B(75550);Ht.exports=de;function de(oe,Be,se,ze,Ge){this.properties={},this.extent=se,this.type=0,this._pbf=oe,this._geometry=-1,this._keys=ze,this._values=Ge,oe.readFields(y,this,Be)}function y(oe,Be,se){oe==1?Be.id=se.readVarint():oe==2?ce(se,Be):oe==3?Be.type=se.readVarint():oe==4&&(Be._geometry=se.pos)}function ce(oe,Be){for(var se=oe.readVarint()+oe.pos;oe.pos<se;){var ze=Be._keys[oe.readVarint()],Ge=Be._values[oe.readVarint()];Be.properties[ze]=Ge}}de.types=["Unknown","Point","LineString","Polygon"],de.prototype.loadGeometry=function(){var oe=this._pbf;oe.pos=this._geometry;for(var Be=oe.readVarint()+oe.pos,se=1,ze=0,Ge=0,Ke=0,Rt=[],St;oe.pos<Be;){if(ze<=0){var Nt=oe.readVarint();se=Nt&7,ze=Nt>>3}if(ze--,se===1||se===2)Ge+=oe.readSVarint(),Ke+=oe.readSVarint(),se===1&&(St&&Rt.push(St),St=[]),St.push(new ne(Ge,Ke));else if(se===7)St&&St.push(St[0].clone());else throw new Error("unknown command "+se)}return St&&Rt.push(St),Rt},de.prototype.bbox=function(){var oe=this._pbf;oe.pos=this._geometry;for(var Be=oe.readVarint()+oe.pos,se=1,ze=0,Ge=0,Ke=0,Rt=1/0,St=-1/0,Nt=1/0,Pt=-1/0;oe.pos<Be;){if(ze<=0){var Ct=oe.readVarint();se=Ct&7,ze=Ct>>3}if(ze--,se===1||se===2)Ge+=oe.readSVarint(),Ke+=oe.readSVarint(),Ge<Rt&&(Rt=Ge),Ge>St&&(St=Ge),Ke<Nt&&(Nt=Ke),Ke>Pt&&(Pt=Ke);else if(se!==7)throw new Error("unknown command "+se)}return[Rt,Nt,St,Pt]},de.prototype.toGeoJSON=function(oe,Be,se){var ze=this.extent*Math.pow(2,se),Ge=this.extent*oe,Ke=this.extent*Be,Rt=this.loadGeometry(),St=de.types[this.type],Nt,Pt;function Ct(pr){for(var gr=0;gr<pr.length;gr++){var lr=pr[gr],ut=180-(lr.y+Ke)*360/ze;pr[gr]=[(lr.x+Ge)*360/ze-180,360/Math.PI*Math.atan(Math.exp(ut*Math.PI/180))-90]}}switch(this.type){case 1:var pt=[];for(Nt=0;Nt<Rt.length;Nt++)pt[Nt]=Rt[Nt][0];Rt=pt,Ct(Rt);break;case 2:for(Nt=0;Nt<Rt.length;Nt++)Ct(Rt[Nt]);break;case 3:for(Rt=L(Rt),Nt=0;Nt<Rt.length;Nt++)for(Pt=0;Pt<Rt[Nt].length;Pt++)Ct(Rt[Nt][Pt]);break}Rt.length===1?Rt=Rt[0]:St="Multi"+St;var mt={type:"Feature",geometry:{type:St,coordinates:Rt},properties:this.properties};return"id"in this&&(mt.id=this.id),mt};function L(oe){var Be=oe.length;if(Be<=1)return[oe];for(var se=[],ze,Ge,Ke=0;Ke<Be;Ke++){var Rt=ue(oe[Ke]);Rt!==0&&(Ge===void 0&&(Ge=Rt<0),Ge===Rt<0?(ze&&se.push(ze),ze=[oe[Ke]]):ze.push(oe[Ke]))}return ze&&se.push(ze),se}function ue(oe){for(var Be=0,se=0,ze=oe.length,Ge=ze-1,Ke,Rt;se<ze;Ge=se++)Ke=oe[se],Rt=oe[Ge],Be+=(Rt.x-Ke.x)*(Ke.y+Rt.y);return Be}},59701:function(Ht,re,B){"use strict";var ne=B(66024);Ht.exports=de;function de(L,ue){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=L,this._keys=[],this._values=[],this._features=[],L.readFields(y,this,ue),this.length=this._features.length}function y(L,ue,oe){L===15?ue.version=oe.readVarint():L===1?ue.name=oe.readString():L===5?ue.extent=oe.readVarint():L===2?ue._features.push(oe.pos):L===3?ue._keys.push(oe.readString()):L===4&&ue._values.push(ce(oe))}function ce(L){for(var ue=null,oe=L.readVarint()+L.pos;L.pos<oe;){var Be=L.readVarint()>>3;ue=Be===1?L.readString():Be===2?L.readFloat():Be===3?L.readDouble():Be===4?L.readVarint64():Be===5?L.readVarint():Be===6?L.readSVarint():Be===7?L.readBoolean():null}return ue}de.prototype.feature=function(L){if(L<0||L>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[L];var ue=this._pbf.readVarint()+this._pbf.pos;return new ne(this._pbf,ue,this.extent,this._keys,this._values)}},55054:function(Ht,re,B){"use strict";B.d(re,{Z:function(){return vr}});var ne=B(67294),de=B(57838),y=B(96159),ce=B(93967),L=B.n(ce),ue=B(64217),oe=B(53124),Be=B(99559),ze=ee=>{const{value:V,formatter:Q,precision:Re,decimalSeparator:xe,groupSeparator:nt="",prefixCls:Le}=ee;let Ye;if(typeof Q=="function")Ye=Q(V);else{const rt=String(V),Tt=rt.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Tt||rt==="-")Ye=rt;else{const dr=Tt[1];let Ot=Tt[2]||"0",Vr=Tt[4]||"";Ot=Ot.replace(/\B(?=(\d{3})+(?!\d))/g,nt),typeof Re=="number"&&(Vr=Vr.padEnd(Re,"0").slice(0,Re>0?Re:0)),Vr&&(Vr=`${xe}${Vr}`),Ye=[ne.createElement("span",{key:"int",className:`${Le}-content-value-int`},dr,Ot),Vr&&ne.createElement("span",{key:"decimal",className:`${Le}-content-value-decimal`},Vr)]}}return ne.createElement("span",{className:`${Le}-content-value`},Ye)},Ge=B(14747),Ke=B(91945),Rt=B(45503);const St=ee=>{const{componentCls:V,marginXXS:Q,padding:Re,colorTextDescription:xe,titleFontSize:nt,colorTextHeading:Le,contentFontSize:Ye,fontFamily:rt}=ee;return{[`${V}`]:Object.assign(Object.assign({},(0,Ge.Wf)(ee)),{[`${V}-title`]:{marginBottom:Q,color:xe,fontSize:nt},[`${V}-skeleton`]:{paddingTop:Re},[`${V}-content`]:{color:Le,fontSize:Ye,fontFamily:rt,[`${V}-content-value`]:{display:"inline-block",direction:"ltr"},[`${V}-content-prefix, ${V}-content-suffix`]:{display:"inline-block"},[`${V}-content-prefix`]:{marginInlineEnd:Q},[`${V}-content-suffix`]:{marginInlineStart:Q}}})}},Nt=ee=>{const{fontSizeHeading3:V,fontSize:Q}=ee;return{titleFontSize:Q,contentFontSize:V}};var Pt=(0,Ke.I$)("Statistic",ee=>{const V=(0,Rt.TS)(ee,{});return[St(V)]},Nt),Ct=function(ee,V){var Q={};for(var Re in ee)Object.prototype.hasOwnProperty.call(ee,Re)&&V.indexOf(Re)<0&&(Q[Re]=ee[Re]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xe=0,Re=Object.getOwnPropertySymbols(ee);xe<Re.length;xe++)V.indexOf(Re[xe])<0&&Object.prototype.propertyIsEnumerable.call(ee,Re[xe])&&(Q[Re[xe]]=ee[Re[xe]]);return Q},mt=ee=>{const{prefixCls:V,className:Q,rootClassName:Re,style:xe,valueStyle:nt,value:Le=0,title:Ye,valueRender:rt,prefix:Tt,suffix:dr,loading:Ot=!1,formatter:Vr,precision:Kr,decimalSeparator:Or=".",groupSeparator:In=",",onMouseEnter:gn,onMouseLeave:nn}=ee,fi=Ct(ee,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:Lr,direction:Vn,statistic:Hr}=ne.useContext(oe.E_),hn=Lr("statistic",V),[qi,xi,ia]=Pt(hn),ea=ne.createElement(ze,{decimalSeparator:Or,groupSeparator:In,prefixCls:hn,formatter:Vr,precision:Kr,value:Le}),be=L()(hn,{[`${hn}-rtl`]:Vn==="rtl"},Hr==null?void 0:Hr.className,Q,Re,xi,ia),Fi=(0,ue.Z)(fi,{aria:!0,data:!0});return qi(ne.createElement("div",Object.assign({},Fi,{className:be,style:Object.assign(Object.assign({},Hr==null?void 0:Hr.style),xe),onMouseEnter:gn,onMouseLeave:nn}),Ye&&ne.createElement("div",{className:`${hn}-title`},Ye),ne.createElement(Be.Z,{paragraph:!1,loading:Ot,className:`${hn}-skeleton`},ne.createElement("div",{style:nt,className:`${hn}-content`},Tt&&ne.createElement("span",{className:`${hn}-content-prefix`},Tt),rt?rt(ea):ea,dr&&ne.createElement("span",{className:`${hn}-content-suffix`},dr)))))};const pr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function gr(ee,V){let Q=ee;const Re=/\[[^\]]*]/g,xe=(V.match(Re)||[]).map(rt=>rt.slice(1,-1)),nt=V.replace(Re,"[]"),Le=pr.reduce((rt,Tt)=>{let[dr,Ot]=Tt;if(rt.includes(dr)){const Vr=Math.floor(Q/Ot);return Q-=Vr*Ot,rt.replace(new RegExp(`${dr}+`,"g"),Kr=>{const Or=Kr.length;return Vr.toString().padStart(Or,"0")})}return rt},nt);let Ye=0;return Le.replace(Re,()=>{const rt=xe[Ye];return Ye+=1,rt})}function lr(ee,V){const{format:Q=""}=V,Re=new Date(ee).getTime(),xe=Date.now(),nt=Math.max(Re-xe,0);return gr(nt,Q)}var ut=function(ee,V){var Q={};for(var Re in ee)Object.prototype.hasOwnProperty.call(ee,Re)&&V.indexOf(Re)<0&&(Q[Re]=ee[Re]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xe=0,Re=Object.getOwnPropertySymbols(ee);xe<Re.length;xe++)V.indexOf(Re[xe])<0&&Object.prototype.propertyIsEnumerable.call(ee,Re[xe])&&(Q[Re[xe]]=ee[Re[xe]]);return Q};const we=1e3/30;function At(ee){return new Date(ee).getTime()}const Fe=ee=>{const{value:V,format:Q="HH:mm:ss",onChange:Re,onFinish:xe}=ee,nt=ut(ee,["value","format","onChange","onFinish"]),Le=(0,de.Z)(),Ye=ne.useRef(null),rt=()=>{xe==null||xe(),Ye.current&&(clearInterval(Ye.current),Ye.current=null)},Tt=()=>{const Vr=At(V);Vr>=Date.now()&&(Ye.current=setInterval(()=>{Le(),Re==null||Re(Vr-Date.now()),Vr<Date.now()&&rt()},we))};ne.useEffect(()=>(Tt(),()=>{Ye.current&&(clearInterval(Ye.current),Ye.current=null)}),[V]);const dr=(Vr,Kr)=>lr(Vr,Object.assign(Object.assign({},Kr),{format:Q})),Ot=Vr=>(0,y.Tm)(Vr,{title:void 0});return ne.createElement(mt,Object.assign({},nt,{value:V,valueRender:Ot,formatter:dr}))};var Zt=ne.memo(Fe);mt.Countdown=Zt;var vr=mt},98129:function(Ht,re,B){"use strict";var ne=B(60690);Ht.exports=function(ce){ce=ce||{};var L=ce.reporter,ue=ne.getOption(ce,"async",!0),oe=ne.getOption(ce,"auto",!0);oe&&!ue&&(L&&L.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),ue=!0);var Be=de(),se,ze=!1;function Ge(pt,mt){!ze&&oe&&ue&&Be.size()===0&&St(),Be.add(pt,mt)}function Ke(){for(ze=!0;Be.size();){var pt=Be;Be=de(),pt.process()}ze=!1}function Rt(pt){ze||(pt===void 0&&(pt=ue),se&&(Pt(se),se=null),pt?St():Ke())}function St(){se=Ct(Ke)}function Nt(){Be={},batchSize=0,topLevel=0,bottomLevel=0}function Pt(pt){var mt=clearTimeout;return mt(pt)}function Ct(pt){var mt=function(pr){return setTimeout(pr,0)};return mt(pt)}return{add:Ge,force:Rt}};function de(){var y={},ce=0,L=0,ue=0;function oe(ze,Ge){Ge||(Ge=ze,ze=0),ze>L?L=ze:ze<ue&&(ue=ze),y[ze]||(y[ze]=[]),y[ze].push(Ge),ce++}function Be(){for(var ze=ue;ze<=L;ze++)for(var Ge=y[ze],Ke=0;Ke<Ge.length;Ke++){var Rt=Ge[Ke];Rt()}}function se(){return ce}return{add:oe,process:Be,size:se}}},60690:function(Ht){"use strict";var re=Ht.exports={};re.getOption=B;function B(ne,de,y){var ce=ne[de];return ce==null&&y!==void 0?y:ce}},9187:function(Ht){"use strict";Ht.exports=re,Ht.exports.default=re;function re(Q,Re,xe){xe=xe||2;var nt=Re&&Re.length,Le=nt?Re[0]*xe:Q.length,Ye=B(Q,0,Le,xe,!0),rt=[];if(!Ye||Ye.next===Ye.prev)return rt;var Tt,dr,Ot,Vr,Kr,Or,In;if(nt&&(Ye=oe(Q,Re,Ye,xe)),Q.length>80*xe){Tt=Ot=Q[0],dr=Vr=Q[1];for(var gn=xe;gn<Le;gn+=xe)Kr=Q[gn],Or=Q[gn+1],Kr<Tt&&(Tt=Kr),Or<dr&&(dr=Or),Kr>Ot&&(Ot=Kr),Or>Vr&&(Vr=Or);In=Math.max(Ot-Tt,Vr-dr),In=In!==0?32767/In:0}return de(Ye,rt,xe,Tt,dr,In,0),rt}function B(Q,Re,xe,nt,Le){var Ye,rt;if(Le===V(Q,Re,xe,nt)>0)for(Ye=Re;Ye<xe;Ye+=nt)rt=Zt(Ye,Q[Ye],Q[Ye+1],rt);else for(Ye=xe-nt;Ye>=Re;Ye-=nt)rt=Zt(Ye,Q[Ye],Q[Ye+1],rt);return rt&&mt(rt,rt.next)&&(vr(rt),rt=rt.next),rt}function ne(Q,Re){if(!Q)return Q;Re||(Re=Q);var xe=Q,nt;do if(nt=!1,!xe.steiner&&(mt(xe,xe.next)||pt(xe.prev,xe,xe.next)===0)){if(vr(xe),xe=Re=xe.prev,xe===xe.next)break;nt=!0}else xe=xe.next;while(nt||xe!==Re);return Re}function de(Q,Re,xe,nt,Le,Ye,rt){if(Q){!rt&&Ye&&Ke(Q,nt,Le,Ye);for(var Tt=Q,dr,Ot;Q.prev!==Q.next;){if(dr=Q.prev,Ot=Q.next,Ye?ce(Q,nt,Le,Ye):y(Q)){Re.push(dr.i/xe|0),Re.push(Q.i/xe|0),Re.push(Ot.i/xe|0),vr(Q),Q=Ot.next,Tt=Ot.next;continue}if(Q=Ot,Q===Tt){rt?rt===1?(Q=L(ne(Q),Re,xe),de(Q,Re,xe,nt,Le,Ye,2)):rt===2&&ue(Q,Re,xe,nt,Le,Ye):de(ne(Q),Re,xe,nt,Le,Ye,1);break}}}}function y(Q){var Re=Q.prev,xe=Q,nt=Q.next;if(pt(Re,xe,nt)>=0)return!1;for(var Le=Re.x,Ye=xe.x,rt=nt.x,Tt=Re.y,dr=xe.y,Ot=nt.y,Vr=Le<Ye?Le<rt?Le:rt:Ye<rt?Ye:rt,Kr=Tt<dr?Tt<Ot?Tt:Ot:dr<Ot?dr:Ot,Or=Le>Ye?Le>rt?Le:rt:Ye>rt?Ye:rt,In=Tt>dr?Tt>Ot?Tt:Ot:dr>Ot?dr:Ot,gn=nt.next;gn!==Re;){if(gn.x>=Vr&&gn.x<=Or&&gn.y>=Kr&&gn.y<=In&&Pt(Le,Tt,Ye,dr,rt,Ot,gn.x,gn.y)&&pt(gn.prev,gn,gn.next)>=0)return!1;gn=gn.next}return!0}function ce(Q,Re,xe,nt){var Le=Q.prev,Ye=Q,rt=Q.next;if(pt(Le,Ye,rt)>=0)return!1;for(var Tt=Le.x,dr=Ye.x,Ot=rt.x,Vr=Le.y,Kr=Ye.y,Or=rt.y,In=Tt<dr?Tt<Ot?Tt:Ot:dr<Ot?dr:Ot,gn=Vr<Kr?Vr<Or?Vr:Or:Kr<Or?Kr:Or,nn=Tt>dr?Tt>Ot?Tt:Ot:dr>Ot?dr:Ot,fi=Vr>Kr?Vr>Or?Vr:Or:Kr>Or?Kr:Or,Lr=St(In,gn,Re,xe,nt),Vn=St(nn,fi,Re,xe,nt),Hr=Q.prevZ,hn=Q.nextZ;Hr&&Hr.z>=Lr&&hn&&hn.z<=Vn;){if(Hr.x>=In&&Hr.x<=nn&&Hr.y>=gn&&Hr.y<=fi&&Hr!==Le&&Hr!==rt&&Pt(Tt,Vr,dr,Kr,Ot,Or,Hr.x,Hr.y)&&pt(Hr.prev,Hr,Hr.next)>=0||(Hr=Hr.prevZ,hn.x>=In&&hn.x<=nn&&hn.y>=gn&&hn.y<=fi&&hn!==Le&&hn!==rt&&Pt(Tt,Vr,dr,Kr,Ot,Or,hn.x,hn.y)&&pt(hn.prev,hn,hn.next)>=0))return!1;hn=hn.nextZ}for(;Hr&&Hr.z>=Lr;){if(Hr.x>=In&&Hr.x<=nn&&Hr.y>=gn&&Hr.y<=fi&&Hr!==Le&&Hr!==rt&&Pt(Tt,Vr,dr,Kr,Ot,Or,Hr.x,Hr.y)&&pt(Hr.prev,Hr,Hr.next)>=0)return!1;Hr=Hr.prevZ}for(;hn&&hn.z<=Vn;){if(hn.x>=In&&hn.x<=nn&&hn.y>=gn&&hn.y<=fi&&hn!==Le&&hn!==rt&&Pt(Tt,Vr,dr,Kr,Ot,Or,hn.x,hn.y)&&pt(hn.prev,hn,hn.next)>=0)return!1;hn=hn.nextZ}return!0}function L(Q,Re,xe){var nt=Q;do{var Le=nt.prev,Ye=nt.next.next;!mt(Le,Ye)&&pr(Le,nt,nt.next,Ye)&&we(Le,Ye)&&we(Ye,Le)&&(Re.push(Le.i/xe|0),Re.push(nt.i/xe|0),Re.push(Ye.i/xe|0),vr(nt),vr(nt.next),nt=Q=Ye),nt=nt.next}while(nt!==Q);return ne(nt)}function ue(Q,Re,xe,nt,Le,Ye){var rt=Q;do{for(var Tt=rt.next.next;Tt!==rt.prev;){if(rt.i!==Tt.i&&Ct(rt,Tt)){var dr=Fe(rt,Tt);rt=ne(rt,rt.next),dr=ne(dr,dr.next),de(rt,Re,xe,nt,Le,Ye,0),de(dr,Re,xe,nt,Le,Ye,0);return}Tt=Tt.next}rt=rt.next}while(rt!==Q)}function oe(Q,Re,xe,nt){var Le=[],Ye,rt,Tt,dr,Ot;for(Ye=0,rt=Re.length;Ye<rt;Ye++)Tt=Re[Ye]*nt,dr=Ye<rt-1?Re[Ye+1]*nt:Q.length,Ot=B(Q,Tt,dr,nt,!1),Ot===Ot.next&&(Ot.steiner=!0),Le.push(Nt(Ot));for(Le.sort(Be),Ye=0;Ye<Le.length;Ye++)xe=se(Le[Ye],xe);return xe}function Be(Q,Re){return Q.x-Re.x}function se(Q,Re){var xe=ze(Q,Re);if(!xe)return Re;var nt=Fe(xe,Q);return ne(nt,nt.next),ne(xe,xe.next)}function ze(Q,Re){var xe=Re,nt=Q.x,Le=Q.y,Ye=-1/0,rt;do{if(Le<=xe.y&&Le>=xe.next.y&&xe.next.y!==xe.y){var Tt=xe.x+(Le-xe.y)*(xe.next.x-xe.x)/(xe.next.y-xe.y);if(Tt<=nt&&Tt>Ye&&(Ye=Tt,rt=xe.x<xe.next.x?xe:xe.next,Tt===nt))return rt}xe=xe.next}while(xe!==Re);if(!rt)return null;var dr=rt,Ot=rt.x,Vr=rt.y,Kr=1/0,Or;xe=rt;do nt>=xe.x&&xe.x>=Ot&&nt!==xe.x&&Pt(Le<Vr?nt:Ye,Le,Ot,Vr,Le<Vr?Ye:nt,Le,xe.x,xe.y)&&(Or=Math.abs(Le-xe.y)/(nt-xe.x),we(xe,Q)&&(Or<Kr||Or===Kr&&(xe.x>rt.x||xe.x===rt.x&&Ge(rt,xe)))&&(rt=xe,Kr=Or)),xe=xe.next;while(xe!==dr);return rt}function Ge(Q,Re){return pt(Q.prev,Q,Re.prev)<0&&pt(Re.next,Q,Q.next)<0}function Ke(Q,Re,xe,nt){var Le=Q;do Le.z===0&&(Le.z=St(Le.x,Le.y,Re,xe,nt)),Le.prevZ=Le.prev,Le.nextZ=Le.next,Le=Le.next;while(Le!==Q);Le.prevZ.nextZ=null,Le.prevZ=null,Rt(Le)}function Rt(Q){var Re,xe,nt,Le,Ye,rt,Tt,dr,Ot=1;do{for(xe=Q,Q=null,Ye=null,rt=0;xe;){for(rt++,nt=xe,Tt=0,Re=0;Re<Ot&&(Tt++,nt=nt.nextZ,!!nt);Re++);for(dr=Ot;Tt>0||dr>0&&nt;)Tt!==0&&(dr===0||!nt||xe.z<=nt.z)?(Le=xe,xe=xe.nextZ,Tt--):(Le=nt,nt=nt.nextZ,dr--),Ye?Ye.nextZ=Le:Q=Le,Le.prevZ=Ye,Ye=Le;xe=nt}Ye.nextZ=null,Ot*=2}while(rt>1);return Q}function St(Q,Re,xe,nt,Le){return Q=(Q-xe)*Le|0,Re=(Re-nt)*Le|0,Q=(Q|Q<<8)&16711935,Q=(Q|Q<<4)&252645135,Q=(Q|Q<<2)&858993459,Q=(Q|Q<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,Q|Re<<1}function Nt(Q){var Re=Q,xe=Q;do(Re.x<xe.x||Re.x===xe.x&&Re.y<xe.y)&&(xe=Re),Re=Re.next;while(Re!==Q);return xe}function Pt(Q,Re,xe,nt,Le,Ye,rt,Tt){return(Le-rt)*(Re-Tt)>=(Q-rt)*(Ye-Tt)&&(Q-rt)*(nt-Tt)>=(xe-rt)*(Re-Tt)&&(xe-rt)*(Ye-Tt)>=(Le-rt)*(nt-Tt)}function Ct(Q,Re){return Q.next.i!==Re.i&&Q.prev.i!==Re.i&&!ut(Q,Re)&&(we(Q,Re)&&we(Re,Q)&&At(Q,Re)&&(pt(Q.prev,Q,Re.prev)||pt(Q,Re.prev,Re))||mt(Q,Re)&&pt(Q.prev,Q,Q.next)>0&&pt(Re.prev,Re,Re.next)>0)}function pt(Q,Re,xe){return(Re.y-Q.y)*(xe.x-Re.x)-(Re.x-Q.x)*(xe.y-Re.y)}function mt(Q,Re){return Q.x===Re.x&&Q.y===Re.y}function pr(Q,Re,xe,nt){var Le=lr(pt(Q,Re,xe)),Ye=lr(pt(Q,Re,nt)),rt=lr(pt(xe,nt,Q)),Tt=lr(pt(xe,nt,Re));return!!(Le!==Ye&&rt!==Tt||Le===0&&gr(Q,xe,Re)||Ye===0&&gr(Q,nt,Re)||rt===0&&gr(xe,Q,nt)||Tt===0&&gr(xe,Re,nt))}function gr(Q,Re,xe){return Re.x<=Math.max(Q.x,xe.x)&&Re.x>=Math.min(Q.x,xe.x)&&Re.y<=Math.max(Q.y,xe.y)&&Re.y>=Math.min(Q.y,xe.y)}function lr(Q){return Q>0?1:Q<0?-1:0}function ut(Q,Re){var xe=Q;do{if(xe.i!==Q.i&&xe.next.i!==Q.i&&xe.i!==Re.i&&xe.next.i!==Re.i&&pr(xe,xe.next,Q,Re))return!0;xe=xe.next}while(xe!==Q);return!1}function we(Q,Re){return pt(Q.prev,Q,Q.next)<0?pt(Q,Re,Q.next)>=0&&pt(Q,Q.prev,Re)>=0:pt(Q,Re,Q.prev)<0||pt(Q,Q.next,Re)<0}function At(Q,Re){var xe=Q,nt=!1,Le=(Q.x+Re.x)/2,Ye=(Q.y+Re.y)/2;do xe.y>Ye!=xe.next.y>Ye&&xe.next.y!==xe.y&&Le<(xe.next.x-xe.x)*(Ye-xe.y)/(xe.next.y-xe.y)+xe.x&&(nt=!nt),xe=xe.next;while(xe!==Q);return nt}function Fe(Q,Re){var xe=new ee(Q.i,Q.x,Q.y),nt=new ee(Re.i,Re.x,Re.y),Le=Q.next,Ye=Re.prev;return Q.next=Re,Re.prev=Q,xe.next=Le,Le.prev=xe,nt.next=xe,xe.prev=nt,Ye.next=nt,nt.prev=Ye,nt}function Zt(Q,Re,xe,nt){var Le=new ee(Q,Re,xe);return nt?(Le.next=nt.next,Le.prev=nt,nt.next.prev=Le,nt.next=Le):(Le.prev=Le,Le.next=Le),Le}function vr(Q){Q.next.prev=Q.prev,Q.prev.next=Q.next,Q.prevZ&&(Q.prevZ.nextZ=Q.nextZ),Q.nextZ&&(Q.nextZ.prevZ=Q.prevZ)}function ee(Q,Re,xe){this.i=Q,this.x=Re,this.y=xe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}re.deviation=function(Q,Re,xe,nt){var Le=Re&&Re.length,Ye=Le?Re[0]*xe:Q.length,rt=Math.abs(V(Q,0,Ye,xe));if(Le)for(var Tt=0,dr=Re.length;Tt<dr;Tt++){var Ot=Re[Tt]*xe,Vr=Tt<dr-1?Re[Tt+1]*xe:Q.length;rt-=Math.abs(V(Q,Ot,Vr,xe))}var Kr=0;for(Tt=0;Tt<nt.length;Tt+=3){var Or=nt[Tt]*xe,In=nt[Tt+1]*xe,gn=nt[Tt+2]*xe;Kr+=Math.abs((Q[Or]-Q[gn])*(Q[In+1]-Q[Or+1])-(Q[Or]-Q[In])*(Q[gn+1]-Q[Or+1]))}return rt===0&&Kr===0?0:Math.abs((Kr-rt)/rt)};function V(Q,Re,xe,nt){for(var Le=0,Ye=Re,rt=xe-nt;Ye<xe;Ye+=nt)Le+=(Q[rt]-Q[Ye])*(Q[Ye+1]+Q[rt+1]),rt=Ye;return Le}re.flatten=function(Q){for(var Re=Q[0][0].length,xe={vertices:[],holes:[],dimensions:Re},nt=0,Le=0;Le<Q.length;Le++){for(var Ye=0;Ye<Q[Le].length;Ye++)for(var rt=0;rt<Re;rt++)xe.vertices.push(Q[Le][Ye][rt]);Le>0&&(nt+=Q[Le-1].length,xe.holes.push(nt))}return xe}},2268:function(Ht){"use strict";var re=Ht.exports={};re.isIE=function(B){function ne(){var y=navigator.userAgent.toLowerCase();return y.indexOf("msie")!==-1||y.indexOf("trident")!==-1||y.indexOf(" edge/")!==-1}if(!ne())return!1;if(!B)return!0;var de=function(){var y,ce=3,L=document.createElement("div"),ue=L.getElementsByTagName("i");do L.innerHTML="<!--[if gt IE "+ ++ce+"]><i></i><![endif]-->";while(ue[0]);return ce>4?ce:y}();return B===de},re.isLegacyOpera=function(){return!!window.opera}},17900:function(Ht){"use strict";var re=Ht.exports={};re.forEach=function(B,ne){for(var de=0;de<B.length;de++){var y=ne(B[de]);if(y)return y}}},58229:function(Ht,re,B){"use strict";var ne=B(2268);Ht.exports=function(de){de=de||{};var y=de.reporter,ce=de.batchProcessor,L=de.stateHandler.getState;if(!y)throw new Error("Missing required dependency: reporter.");function ue(Ge,Ke){function Rt(){Ke(Ge)}if(ne.isIE(8))L(Ge).object={proxy:Rt},Ge.attachEvent("onresize",Rt);else{var St=se(Ge);if(!St)throw new Error("Element is not detectable by this strategy.");St.contentDocument.defaultView.addEventListener("resize",Rt)}}function oe(Ge){var Ke=de.important?" !important; ":"; ";return(Ge.join(Ke)+Ke).trim()}function Be(Ge,Ke,Rt){Rt||(Rt=Ke,Ke=Ge,Ge=null),Ge=Ge||{};var St=Ge.debug;function Nt(Pt,Ct){var pt=oe(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),mt=!1,pr=window.getComputedStyle(Pt),gr=Pt.offsetWidth,lr=Pt.offsetHeight;L(Pt).startSize={width:gr,height:lr};function ut(){function we(){if(pr.position==="static"){Pt.style.setProperty("position","relative",Ge.important?"important":"");var Zt=function(vr,ee,V,Q){function Re(nt){return nt.replace(/[^-\d\.]/g,"")}var xe=V[Q];xe!=="auto"&&Re(xe)!=="0"&&(vr.warn("An element that is positioned static has style."+Q+"="+xe+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+Q+" will be set to 0. Element: ",ee),ee.style.setProperty(Q,"0",Ge.important?"important":""))};Zt(y,Pt,pr,"top"),Zt(y,Pt,pr,"right"),Zt(y,Pt,pr,"bottom"),Zt(y,Pt,pr,"left")}}function At(){mt||we();function Zt(ee,V){if(!ee.contentDocument){var Q=L(ee);Q.checkForObjectDocumentTimeoutId&&window.clearTimeout(Q.checkForObjectDocumentTimeoutId),Q.checkForObjectDocumentTimeoutId=setTimeout(function(){Q.checkForObjectDocumentTimeoutId=0,Zt(ee,V)},100);return}V(ee.contentDocument)}var vr=this;Zt(vr,function(V){Ct(Pt)})}pr.position!==""&&(we(pr),mt=!0);var Fe=document.createElement("object");Fe.style.cssText=pt,Fe.tabIndex=-1,Fe.type="text/html",Fe.setAttribute("aria-hidden","true"),Fe.onload=At,ne.isIE()||(Fe.data="about:blank"),L(Pt)&&(Pt.appendChild(Fe),L(Pt).object=Fe,ne.isIE()&&(Fe.data="about:blank"))}ce?ce.add(ut):ut()}ne.isIE(8)?Rt(Ke):Nt(Ke,Rt)}function se(Ge){return L(Ge).object}function ze(Ge){if(L(Ge)){var Ke=se(Ge);Ke&&(ne.isIE(8)?Ge.detachEvent("onresize",Ke.proxy):Ge.removeChild(Ke),L(Ge).checkForObjectDocumentTimeoutId&&window.clearTimeout(L(Ge).checkForObjectDocumentTimeoutId),delete L(Ge).object)}}return{makeDetectable:Be,addListener:ue,uninstall:ze}}},60787:function(Ht,re,B){"use strict";var ne=B(17900).forEach;Ht.exports=function(de){de=de||{};var y=de.reporter,ce=de.batchProcessor,L=de.stateHandler.getState,ue=de.stateHandler.hasState,oe=de.idHandler;if(!ce)throw new Error("Missing required dependency: batchProcessor");if(!y)throw new Error("Missing required dependency: reporter.");var Be=Rt(),se="erd_scroll_detection_scrollbar_style",ze="erd_scroll_detection_container";function Ge(ut){St(ut,se,ze)}Ge(window.document);function Ke(ut){var we=de.important?" !important; ":"; ";return(ut.join(we)+we).trim()}function Rt(){var ut=500,we=500,At=document.createElement("div");At.style.cssText=Ke(["position: absolute","width: "+ut*2+"px","height: "+we*2+"px","visibility: hidden","margin: 0","padding: 0"]);var Fe=document.createElement("div");Fe.style.cssText=Ke(["position: absolute","width: "+ut+"px","height: "+we+"px","overflow: scroll","visibility: none","top: "+-ut*3+"px","left: "+-we*3+"px","visibility: hidden","margin: 0","padding: 0"]),Fe.appendChild(At),document.body.insertBefore(Fe,document.body.firstChild);var Zt=ut-Fe.clientWidth,vr=we-Fe.clientHeight;return document.body.removeChild(Fe),{width:Zt,height:vr}}function St(ut,we,At){function Fe(V,Q){Q=Q||function(xe){ut.head.appendChild(xe)};var Re=ut.createElement("style");return Re.innerHTML=V,Re.id=we,Q(Re),Re}if(!ut.getElementById(we)){var Zt=At+"_animation",vr=At+"_animation_active",ee=`/* Created by the element-resize-detector library. */
`;ee+="."+At+" > div::-webkit-scrollbar { "+Ke(["display: none"])+` }

`,ee+="."+vr+" { "+Ke(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+Zt,"animation-name: "+Zt])+` }
`,ee+="@-webkit-keyframes "+Zt+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,ee+="@keyframes "+Zt+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",Fe(ee)}}function Nt(ut){ut.className+=" "+ze+"_animation_active"}function Pt(ut,we,At){if(ut.addEventListener)ut.addEventListener(we,At);else if(ut.attachEvent)ut.attachEvent("on"+we,At);else return y.error("[scroll] Don't know how to add event listeners.")}function Ct(ut,we,At){if(ut.removeEventListener)ut.removeEventListener(we,At);else if(ut.detachEvent)ut.detachEvent("on"+we,At);else return y.error("[scroll] Don't know how to remove event listeners.")}function pt(ut){return L(ut).container.childNodes[0].childNodes[0].childNodes[0]}function mt(ut){return L(ut).container.childNodes[0].childNodes[0].childNodes[1]}function pr(ut,we){var At=L(ut).listeners;if(!At.push)throw new Error("Cannot add listener to an element that is not detectable.");L(ut).listeners.push(we)}function gr(ut,we,At){At||(At=we,we=ut,ut=null),ut=ut||{};function Fe(){if(ut.debug){var Lr=Array.prototype.slice.call(arguments);if(Lr.unshift(oe.get(we),"Scroll: "),y.log.apply)y.log.apply(null,Lr);else for(var Vn=0;Vn<Lr.length;Vn++)y.log(Lr[Vn])}}function Zt(Lr){function Vn(Hr){var hn=Hr.getRootNode&&Hr.getRootNode().contains(Hr);return Hr===Hr.ownerDocument.body||Hr.ownerDocument.body.contains(Hr)||hn}return!Vn(Lr)||window.getComputedStyle(Lr)===null}function vr(Lr){var Vn=L(Lr).container.childNodes[0],Hr=window.getComputedStyle(Vn);return!Hr.width||Hr.width.indexOf("px")===-1}function ee(){var Lr=window.getComputedStyle(we),Vn={};return Vn.position=Lr.position,Vn.width=we.offsetWidth,Vn.height=we.offsetHeight,Vn.top=Lr.top,Vn.right=Lr.right,Vn.bottom=Lr.bottom,Vn.left=Lr.left,Vn.widthCSS=Lr.width,Vn.heightCSS=Lr.height,Vn}function V(){var Lr=ee();L(we).startSize={width:Lr.width,height:Lr.height},Fe("Element start size",L(we).startSize)}function Q(){L(we).listeners=[]}function Re(){if(Fe("storeStyle invoked."),!L(we)){Fe("Aborting because element has been uninstalled");return}var Lr=ee();L(we).style=Lr}function xe(Lr,Vn,Hr){L(Lr).lastWidth=Vn,L(Lr).lastHeight=Hr}function nt(Lr){return pt(Lr).childNodes[0]}function Le(){return 2*Be.width+1}function Ye(){return 2*Be.height+1}function rt(Lr){return Lr+10+Le()}function Tt(Lr){return Lr+10+Ye()}function dr(Lr){return Lr*2+Le()}function Ot(Lr){return Lr*2+Ye()}function Vr(Lr,Vn,Hr){var hn=pt(Lr),qi=mt(Lr),xi=rt(Vn),ia=Tt(Hr),ea=dr(Vn),be=Ot(Hr);hn.scrollLeft=xi,hn.scrollTop=ia,qi.scrollLeft=ea,qi.scrollTop=be}function Kr(){var Lr=L(we).container;if(!Lr){Lr=document.createElement("div"),Lr.className=ze,Lr.style.cssText=Ke(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),L(we).container=Lr,Nt(Lr),we.appendChild(Lr);var Vn=function(){L(we).onRendered&&L(we).onRendered()};Pt(Lr,"animationstart",Vn),L(we).onAnimationStart=Vn}return Lr}function Or(){function Lr(){var yn=L(we).style;if(yn.position==="static"){we.style.setProperty("position","relative",ut.important?"important":"");var Ti=function(fe,k,z,le){function Se($t){return $t.replace(/[^-\d\.]/g,"")}var De=z[le];De!=="auto"&&Se(De)!=="0"&&(fe.warn("An element that is positioned static has style."+le+"="+De+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+le+" will be set to 0. Element: ",k),k.style[le]=0)};Ti(y,we,yn,"top"),Ti(y,we,yn,"right"),Ti(y,we,yn,"bottom"),Ti(y,we,yn,"left")}}function Vn(yn,Ti,fe,k){return yn=yn?yn+"px":"0",Ti=Ti?Ti+"px":"0",fe=fe?fe+"px":"0",k=k?k+"px":"0",["left: "+yn,"top: "+Ti,"right: "+k,"bottom: "+fe]}if(Fe("Injecting elements"),!L(we)){Fe("Aborting because element has been uninstalled");return}Lr();var Hr=L(we).container;Hr||(Hr=Kr());var hn=Be.width,qi=Be.height,xi=Ke(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),ia=Ke(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(Vn(-(1+hn),-(1+qi),-qi,-hn))),ea=Ke(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),be=Ke(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Fi=Ke(["position: absolute","left: 0","top: 0"]),aa=Ke(["position: absolute","width: 200%","height: 200%"]),va=document.createElement("div"),oo=document.createElement("div"),po=document.createElement("div"),Mo=document.createElement("div"),Gt=document.createElement("div"),_r=document.createElement("div");va.dir="ltr",va.style.cssText=xi,va.className=ze,oo.className=ze,oo.style.cssText=ia,po.style.cssText=ea,Mo.style.cssText=Fi,Gt.style.cssText=be,_r.style.cssText=aa,po.appendChild(Mo),Gt.appendChild(_r),oo.appendChild(po),oo.appendChild(Gt),va.appendChild(oo),Hr.appendChild(va);function Gr(){var yn=L(we);yn&&yn.onExpand?yn.onExpand():Fe("Aborting expand scroll handler: element has been uninstalled")}function rn(){var yn=L(we);yn&&yn.onShrink?yn.onShrink():Fe("Aborting shrink scroll handler: element has been uninstalled")}Pt(po,"scroll",Gr),Pt(Gt,"scroll",rn),L(we).onExpandScroll=Gr,L(we).onShrinkScroll=rn}function In(){function Lr(ea,be,Fi){var aa=nt(ea),va=rt(be),oo=Tt(Fi);aa.style.setProperty("width",va+"px",ut.important?"important":""),aa.style.setProperty("height",oo+"px",ut.important?"important":"")}function Vn(ea){var be=we.offsetWidth,Fi=we.offsetHeight,aa=be!==L(we).lastWidth||Fi!==L(we).lastHeight;Fe("Storing current size",be,Fi),xe(we,be,Fi),ce.add(0,function(){if(aa){if(!L(we)){Fe("Aborting because element has been uninstalled");return}if(!Hr()){Fe("Aborting because element container has not been initialized");return}if(ut.debug){var oo=we.offsetWidth,po=we.offsetHeight;(oo!==be||po!==Fi)&&y.warn(oe.get(we),"Scroll: Size changed before updating detector elements.")}Lr(we,be,Fi)}}),ce.add(1,function(){if(!L(we)){Fe("Aborting because element has been uninstalled");return}if(!Hr()){Fe("Aborting because element container has not been initialized");return}Vr(we,be,Fi)}),aa&&ea&&ce.add(2,function(){if(!L(we)){Fe("Aborting because element has been uninstalled");return}if(!Hr()){Fe("Aborting because element container has not been initialized");return}ea()})}function Hr(){return!!L(we).container}function hn(){function ea(){return L(we).lastNotifiedWidth===void 0}Fe("notifyListenersIfNeeded invoked");var be=L(we);if(ea()&&be.lastWidth===be.startSize.width&&be.lastHeight===be.startSize.height)return Fe("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(be.lastWidth===be.lastNotifiedWidth&&be.lastHeight===be.lastNotifiedHeight)return Fe("Not notifying: Size already notified");Fe("Current size not notified, notifying..."),be.lastNotifiedWidth=be.lastWidth,be.lastNotifiedHeight=be.lastHeight,ne(L(we).listeners,function(Fi){Fi(we)})}function qi(){if(Fe("startanimation triggered."),vr(we)){Fe("Ignoring since element is still unrendered...");return}Fe("Element rendered.");var ea=pt(we),be=mt(we);(ea.scrollLeft===0||ea.scrollTop===0||be.scrollLeft===0||be.scrollTop===0)&&(Fe("Scrollbars out of sync. Updating detector elements..."),Vn(hn))}function xi(){if(Fe("Scroll detected."),vr(we)){Fe("Scroll event fired while unrendered. Ignoring...");return}Vn(hn)}if(Fe("registerListenersAndPositionElements invoked."),!L(we)){Fe("Aborting because element has been uninstalled");return}L(we).onRendered=qi,L(we).onExpand=xi,L(we).onShrink=xi;var ia=L(we).style;Lr(we,ia.width,ia.height)}function gn(){if(Fe("finalizeDomMutation invoked."),!L(we)){Fe("Aborting because element has been uninstalled");return}var Lr=L(we).style;xe(we,Lr.width,Lr.height),Vr(we,Lr.width,Lr.height)}function nn(){At(we)}function fi(){Fe("Installing..."),Q(),V(),ce.add(0,Re),ce.add(1,Or),ce.add(2,In),ce.add(3,gn),ce.add(4,nn)}Fe("Making detectable..."),Zt(we)?(Fe("Element is detached"),Kr(),Fe("Waiting until element is attached..."),L(we).onRendered=function(){Fe("Element is now attached"),fi()}):fi()}function lr(ut){var we=L(ut);we&&(we.onExpandScroll&&Ct(pt(ut),"scroll",we.onExpandScroll),we.onShrinkScroll&&Ct(mt(ut),"scroll",we.onShrinkScroll),we.onAnimationStart&&Ct(we.container,"animationstart",we.onAnimationStart),we.container&&ut.removeChild(we.container))}return{makeDetectable:gr,addListener:pr,uninstall:lr,initDocument:Ge}}},63844:function(Ht,re,B){"use strict";var ne=B(17900).forEach,de=B(68452),y=B(96199),ce=B(75805),L=B(79799),ue=B(71724),oe=B(2268),Be=B(98129),se=B(21931),ze=B(58229),Ge=B(60787);function Ke(Pt){return Array.isArray(Pt)||Pt.length!==void 0}function Rt(Pt){if(Array.isArray(Pt))return Pt;var Ct=[];return ne(Pt,function(pt){Ct.push(pt)}),Ct}function St(Pt){return Pt&&Pt.nodeType===1}Ht.exports=function(Pt){Pt=Pt||{};var Ct;if(Pt.idHandler)Ct={get:function(nt){return Pt.idHandler.get(nt,!0)},set:Pt.idHandler.set};else{var pt=ce(),mt=L({idGenerator:pt,stateHandler:se});Ct=mt}var pr=Pt.reporter;if(!pr){var gr=pr===!1;pr=ue(gr)}var lr=Nt(Pt,"batchProcessor",Be({reporter:pr})),ut={};ut.callOnAdd=!!Nt(Pt,"callOnAdd",!0),ut.debug=!!Nt(Pt,"debug",!1);var we=y(Ct),At=de({stateHandler:se}),Fe,Zt=Nt(Pt,"strategy","object"),vr=Nt(Pt,"important",!1),ee={reporter:pr,batchProcessor:lr,stateHandler:se,idHandler:Ct,important:vr};if(Zt==="scroll"&&(oe.isLegacyOpera()?(pr.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),Zt="object"):oe.isIE(9)&&(pr.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),Zt="object")),Zt==="scroll")Fe=Ge(ee);else if(Zt==="object")Fe=ze(ee);else throw new Error("Invalid strategy name: "+Zt);var V={};function Q(nt,Le,Ye){function rt(Or){var In=we.get(Or);ne(In,function(nn){nn(Or)})}function Tt(Or,In,gn){we.add(In,gn),Or&&gn(In)}if(Ye||(Ye=Le,Le=nt,nt={}),!Le)throw new Error("At least one element required.");if(!Ye)throw new Error("Listener required.");if(St(Le))Le=[Le];else if(Ke(Le))Le=Rt(Le);else return pr.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var dr=0,Ot=Nt(nt,"callOnAdd",ut.callOnAdd),Vr=Nt(nt,"onReady",function(){}),Kr=Nt(nt,"debug",ut.debug);ne(Le,function(In){se.getState(In)||(se.initState(In),Ct.set(In));var gn=Ct.get(In);if(Kr&&pr.log("Attaching listener to element",gn,In),!At.isDetectable(In)){if(Kr&&pr.log(gn,"Not detectable."),At.isBusy(In)){Kr&&pr.log(gn,"System busy making it detectable"),Tt(Ot,In,Ye),V[gn]=V[gn]||[],V[gn].push(function(){dr++,dr===Le.length&&Vr()});return}return Kr&&pr.log(gn,"Making detectable..."),At.markBusy(In,!0),Fe.makeDetectable({debug:Kr,important:vr},In,function(fi){if(Kr&&pr.log(gn,"onElementDetectable"),se.getState(fi)){At.markAsDetectable(fi),At.markBusy(fi,!1),Fe.addListener(fi,rt),Tt(Ot,fi,Ye);var Lr=se.getState(fi);if(Lr&&Lr.startSize){var Vn=fi.offsetWidth,Hr=fi.offsetHeight;(Lr.startSize.width!==Vn||Lr.startSize.height!==Hr)&&rt(fi)}V[gn]&&ne(V[gn],function(hn){hn()})}else Kr&&pr.log(gn,"Element uninstalled before being detectable.");delete V[gn],dr++,dr===Le.length&&Vr()})}Kr&&pr.log(gn,"Already detecable, adding listener."),Tt(Ot,In,Ye),dr++}),dr===Le.length&&Vr()}function Re(nt){if(!nt)return pr.error("At least one element is required.");if(St(nt))nt=[nt];else if(Ke(nt))nt=Rt(nt);else return pr.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");ne(nt,function(Le){we.removeAllListeners(Le),Fe.uninstall(Le),se.cleanState(Le)})}function xe(nt){Fe.initDocument&&Fe.initDocument(nt)}return{listenTo:Q,removeListener:we.removeListener,removeAllListeners:we.removeAllListeners,uninstall:Re,initDocument:xe}};function Nt(Pt,Ct,pt){var mt=Pt[Ct];return mt==null&&pt!==void 0?pt:mt}},68452:function(Ht){"use strict";Ht.exports=function(re){var B=re.stateHandler.getState;function ne(L){var ue=B(L);return ue&&!!ue.isDetectable}function de(L){B(L).isDetectable=!0}function y(L){return!!B(L).busy}function ce(L,ue){B(L).busy=!!ue}return{isDetectable:ne,markAsDetectable:de,isBusy:y,markBusy:ce}}},75805:function(Ht){"use strict";Ht.exports=function(){var re=1;function B(){return re++}return{generate:B}}},79799:function(Ht){"use strict";Ht.exports=function(re){var B=re.idGenerator,ne=re.stateHandler.getState;function de(ce){var L=ne(ce);return L&&L.id!==void 0?L.id:null}function y(ce){var L=ne(ce);if(!L)throw new Error("setId required the element to have a resize detection state.");var ue=B.generate();return L.id=ue,ue}return{get:de,set:y}}},96199:function(Ht){"use strict";Ht.exports=function(re){var B={};function ne(L){var ue=re.get(L);return ue===void 0?[]:B[ue]||[]}function de(L,ue){var oe=re.get(L);B[oe]||(B[oe]=[]),B[oe].push(ue)}function y(L,ue){for(var oe=ne(L),Be=0,se=oe.length;Be<se;++Be)if(oe[Be]===ue){oe.splice(Be,1);break}}function ce(L){var ue=ne(L);ue&&(ue.length=0)}return{get:ne,add:de,removeListener:y,removeAllListeners:ce}}},71724:function(Ht){"use strict";Ht.exports=function(re){function B(){}var ne={log:B,warn:B,error:B};if(!re&&window.console){var de=function(y,ce){y[ce]=function(){var ue=console[ce];if(ue.apply)ue.apply(console,arguments);else for(var oe=0;oe<arguments.length;oe++)ue(arguments[oe])}};de(ne,"log"),de(ne,"warn"),de(ne,"error")}return ne}},21931:function(Ht){"use strict";var re="_erd";function B(y){return y[re]={},ne(y)}function ne(y){return y[re]}function de(y){delete y[re]}Ht.exports={initState:B,getState:ne,cleanState:de}},26729:function(Ht){"use strict";var re=Object.prototype.hasOwnProperty,B="~";function ne(){}Object.create&&(ne.prototype=Object.create(null),new ne().__proto__||(B=!1));function de(ue,oe,Be){this.fn=ue,this.context=oe,this.once=Be||!1}function y(ue,oe,Be,se,ze){if(typeof Be!="function")throw new TypeError("The listener must be a function");var Ge=new de(Be,se||ue,ze),Ke=B?B+oe:oe;return ue._events[Ke]?ue._events[Ke].fn?ue._events[Ke]=[ue._events[Ke],Ge]:ue._events[Ke].push(Ge):(ue._events[Ke]=Ge,ue._eventsCount++),ue}function ce(ue,oe){--ue._eventsCount===0?ue._events=new ne:delete ue._events[oe]}function L(){this._events=new ne,this._eventsCount=0}L.prototype.eventNames=function(){var oe=[],Be,se;if(this._eventsCount===0)return oe;for(se in Be=this._events)re.call(Be,se)&&oe.push(B?se.slice(1):se);return Object.getOwnPropertySymbols?oe.concat(Object.getOwnPropertySymbols(Be)):oe},L.prototype.listeners=function(oe){var Be=B?B+oe:oe,se=this._events[Be];if(!se)return[];if(se.fn)return[se.fn];for(var ze=0,Ge=se.length,Ke=new Array(Ge);ze<Ge;ze++)Ke[ze]=se[ze].fn;return Ke},L.prototype.listenerCount=function(oe){var Be=B?B+oe:oe,se=this._events[Be];return se?se.fn?1:se.length:0},L.prototype.emit=function(oe,Be,se,ze,Ge,Ke){var Rt=B?B+oe:oe;if(!this._events[Rt])return!1;var St=this._events[Rt],Nt=arguments.length,Pt,Ct;if(St.fn){switch(St.once&&this.removeListener(oe,St.fn,void 0,!0),Nt){case 1:return St.fn.call(St.context),!0;case 2:return St.fn.call(St.context,Be),!0;case 3:return St.fn.call(St.context,Be,se),!0;case 4:return St.fn.call(St.context,Be,se,ze),!0;case 5:return St.fn.call(St.context,Be,se,ze,Ge),!0;case 6:return St.fn.call(St.context,Be,se,ze,Ge,Ke),!0}for(Ct=1,Pt=new Array(Nt-1);Ct<Nt;Ct++)Pt[Ct-1]=arguments[Ct];St.fn.apply(St.context,Pt)}else{var pt=St.length,mt;for(Ct=0;Ct<pt;Ct++)switch(St[Ct].once&&this.removeListener(oe,St[Ct].fn,void 0,!0),Nt){case 1:St[Ct].fn.call(St[Ct].context);break;case 2:St[Ct].fn.call(St[Ct].context,Be);break;case 3:St[Ct].fn.call(St[Ct].context,Be,se);break;case 4:St[Ct].fn.call(St[Ct].context,Be,se,ze);break;default:if(!Pt)for(mt=1,Pt=new Array(Nt-1);mt<Nt;mt++)Pt[mt-1]=arguments[mt];St[Ct].fn.apply(St[Ct].context,Pt)}}return!0},L.prototype.on=function(oe,Be,se){return y(this,oe,Be,se,!1)},L.prototype.once=function(oe,Be,se){return y(this,oe,Be,se,!0)},L.prototype.removeListener=function(oe,Be,se,ze){var Ge=B?B+oe:oe;if(!this._events[Ge])return this;if(!Be)return ce(this,Ge),this;var Ke=this._events[Ge];if(Ke.fn)Ke.fn===Be&&(!ze||Ke.once)&&(!se||Ke.context===se)&&ce(this,Ge);else{for(var Rt=0,St=[],Nt=Ke.length;Rt<Nt;Rt++)(Ke[Rt].fn!==Be||ze&&!Ke[Rt].once||se&&Ke[Rt].context!==se)&&St.push(Ke[Rt]);St.length?this._events[Ge]=St.length===1?St[0]:St:ce(this,Ge)}return this},L.prototype.removeAllListeners=function(oe){var Be;return oe?(Be=B?B+oe:oe,this._events[Be]&&ce(this,Be)):(this._events=new ne,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=B,L.EventEmitter=L,Ht.exports=L},50840:function(Ht,re,B){var ne;(function(de,y,ce,L){"use strict";var ue=["","webkit","Moz","MS","ms","o"],oe=y.createElement("div"),Be="function",se=Math.round,ze=Math.abs,Ge=Date.now;function Ke(_e,ke,bt){return setTimeout(pr(_e,bt),ke)}function Rt(_e,ke,bt){return Array.isArray(_e)?(St(_e,bt[ke],bt),!0):!1}function St(_e,ke,bt){var cr;if(_e)if(_e.forEach)_e.forEach(ke,bt);else if(_e.length!==L)for(cr=0;cr<_e.length;)ke.call(bt,_e[cr],cr,_e),cr++;else for(cr in _e)_e.hasOwnProperty(cr)&&ke.call(bt,_e[cr],cr,_e)}function Nt(_e,ke,bt){var cr="DEPRECATED METHOD: "+ke+`
`+bt+` AT 
`;return function(){var tn=new Error("get-stack-trace"),Bn=tn&&tn.stack?tn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Xi=de.console&&(de.console.warn||de.console.log);return Xi&&Xi.call(de.console,cr,Bn),_e.apply(this,arguments)}}var Pt;typeof Object.assign!="function"?Pt=function(ke){if(ke===L||ke===null)throw new TypeError("Cannot convert undefined or null to object");for(var bt=Object(ke),cr=1;cr<arguments.length;cr++){var tn=arguments[cr];if(tn!==L&&tn!==null)for(var Bn in tn)tn.hasOwnProperty(Bn)&&(bt[Bn]=tn[Bn])}return bt}:Pt=Object.assign;var Ct=Nt(function(ke,bt,cr){for(var tn=Object.keys(bt),Bn=0;Bn<tn.length;)(!cr||cr&&ke[tn[Bn]]===L)&&(ke[tn[Bn]]=bt[tn[Bn]]),Bn++;return ke},"extend","Use `assign`."),pt=Nt(function(ke,bt){return Ct(ke,bt,!0)},"merge","Use `assign`.");function mt(_e,ke,bt){var cr=ke.prototype,tn;tn=_e.prototype=Object.create(cr),tn.constructor=_e,tn._super=cr,bt&&Pt(tn,bt)}function pr(_e,ke){return function(){return _e.apply(ke,arguments)}}function gr(_e,ke){return typeof _e==Be?_e.apply(ke&&ke[0]||L,ke):_e}function lr(_e,ke){return _e===L?ke:_e}function ut(_e,ke,bt){St(Zt(ke),function(cr){_e.addEventListener(cr,bt,!1)})}function we(_e,ke,bt){St(Zt(ke),function(cr){_e.removeEventListener(cr,bt,!1)})}function At(_e,ke){for(;_e;){if(_e==ke)return!0;_e=_e.parentNode}return!1}function Fe(_e,ke){return _e.indexOf(ke)>-1}function Zt(_e){return _e.trim().split(/\s+/g)}function vr(_e,ke,bt){if(_e.indexOf&&!bt)return _e.indexOf(ke);for(var cr=0;cr<_e.length;){if(bt&&_e[cr][bt]==ke||!bt&&_e[cr]===ke)return cr;cr++}return-1}function ee(_e){return Array.prototype.slice.call(_e,0)}function V(_e,ke,bt){for(var cr=[],tn=[],Bn=0;Bn<_e.length;){var Xi=ke?_e[Bn][ke]:_e[Bn];vr(tn,Xi)<0&&cr.push(_e[Bn]),tn[Bn]=Xi,Bn++}return bt&&(ke?cr=cr.sort(function(Io,vo){return Io[ke]>vo[ke]}):cr=cr.sort()),cr}function Q(_e,ke){for(var bt,cr,tn=ke[0].toUpperCase()+ke.slice(1),Bn=0;Bn<ue.length;){if(bt=ue[Bn],cr=bt?bt+tn:ke,cr in _e)return cr;Bn++}return L}var Re=1;function xe(){return Re++}function nt(_e){var ke=_e.ownerDocument||_e;return ke.defaultView||ke.parentWindow||de}var Le=/mobile|tablet|ip(ad|hone|od)|android/i,Ye="ontouchstart"in de,rt=Q(de,"PointerEvent")!==L,Tt=Ye&&Le.test(navigator.userAgent),dr="touch",Ot="pen",Vr="mouse",Kr="kinect",Or=25,In=1,gn=2,nn=4,fi=8,Lr=1,Vn=2,Hr=4,hn=8,qi=16,xi=Vn|Hr,ia=hn|qi,ea=xi|ia,be=["x","y"],Fi=["clientX","clientY"];function aa(_e,ke){var bt=this;this.manager=_e,this.callback=ke,this.element=_e.element,this.target=_e.options.inputTarget,this.domHandler=function(cr){gr(_e.options.enable,[_e])&&bt.handler(cr)},this.init()}aa.prototype={handler:function(){},init:function(){this.evEl&&ut(this.element,this.evEl,this.domHandler),this.evTarget&&ut(this.target,this.evTarget,this.domHandler),this.evWin&&ut(nt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&we(this.element,this.evEl,this.domHandler),this.evTarget&&we(this.target,this.evTarget,this.domHandler),this.evWin&&we(nt(this.element),this.evWin,this.domHandler)}};function va(_e){var ke,bt=_e.options.inputClass;return bt?ke=bt:rt?ke=N:Tt?ke=Ne:Ye?ke=xr:ke=$t,new ke(_e,oo)}function oo(_e,ke,bt){var cr=bt.pointers.length,tn=bt.changedPointers.length,Bn=ke&In&&cr-tn===0,Xi=ke&(nn|fi)&&cr-tn===0;bt.isFirst=!!Bn,bt.isFinal=!!Xi,Bn&&(_e.session={}),bt.eventType=ke,po(_e,bt),_e.emit("hammer.input",bt),_e.recognize(bt),_e.session.prevInput=bt}function po(_e,ke){var bt=_e.session,cr=ke.pointers,tn=cr.length;bt.firstInput||(bt.firstInput=_r(ke)),tn>1&&!bt.firstMultiple?bt.firstMultiple=_r(ke):tn===1&&(bt.firstMultiple=!1);var Bn=bt.firstInput,Xi=bt.firstMultiple,yo=Xi?Xi.center:Bn.center,Io=ke.center=Gr(cr);ke.timeStamp=Ge(),ke.deltaTime=ke.timeStamp-Bn.timeStamp,ke.angle=fe(yo,Io),ke.distance=Ti(yo,Io),Mo(bt,ke),ke.offsetDirection=yn(ke.deltaX,ke.deltaY);var vo=rn(ke.deltaTime,ke.deltaX,ke.deltaY);ke.overallVelocityX=vo.x,ke.overallVelocityY=vo.y,ke.overallVelocity=ze(vo.x)>ze(vo.y)?vo.x:vo.y,ke.scale=Xi?z(Xi.pointers,cr):1,ke.rotation=Xi?k(Xi.pointers,cr):0,ke.maxPointers=bt.prevInput?ke.pointers.length>bt.prevInput.maxPointers?ke.pointers.length:bt.prevInput.maxPointers:ke.pointers.length,Gt(bt,ke);var Ds=_e.element;At(ke.srcEvent.target,Ds)&&(Ds=ke.srcEvent.target),ke.target=Ds}function Mo(_e,ke){var bt=ke.center,cr=_e.offsetDelta||{},tn=_e.prevDelta||{},Bn=_e.prevInput||{};(ke.eventType===In||Bn.eventType===nn)&&(tn=_e.prevDelta={x:Bn.deltaX||0,y:Bn.deltaY||0},cr=_e.offsetDelta={x:bt.x,y:bt.y}),ke.deltaX=tn.x+(bt.x-cr.x),ke.deltaY=tn.y+(bt.y-cr.y)}function Gt(_e,ke){var bt=_e.lastInterval||ke,cr=ke.timeStamp-bt.timeStamp,tn,Bn,Xi,yo;if(ke.eventType!=fi&&(cr>Or||bt.velocity===L)){var Io=ke.deltaX-bt.deltaX,vo=ke.deltaY-bt.deltaY,Ds=rn(cr,Io,vo);Bn=Ds.x,Xi=Ds.y,tn=ze(Ds.x)>ze(Ds.y)?Ds.x:Ds.y,yo=yn(Io,vo),_e.lastInterval=ke}else tn=bt.velocity,Bn=bt.velocityX,Xi=bt.velocityY,yo=bt.direction;ke.velocity=tn,ke.velocityX=Bn,ke.velocityY=Xi,ke.direction=yo}function _r(_e){for(var ke=[],bt=0;bt<_e.pointers.length;)ke[bt]={clientX:se(_e.pointers[bt].clientX),clientY:se(_e.pointers[bt].clientY)},bt++;return{timeStamp:Ge(),pointers:ke,center:Gr(ke),deltaX:_e.deltaX,deltaY:_e.deltaY}}function Gr(_e){var ke=_e.length;if(ke===1)return{x:se(_e[0].clientX),y:se(_e[0].clientY)};for(var bt=0,cr=0,tn=0;tn<ke;)bt+=_e[tn].clientX,cr+=_e[tn].clientY,tn++;return{x:se(bt/ke),y:se(cr/ke)}}function rn(_e,ke,bt){return{x:ke/_e||0,y:bt/_e||0}}function yn(_e,ke){return _e===ke?Lr:ze(_e)>=ze(ke)?_e<0?Vn:Hr:ke<0?hn:qi}function Ti(_e,ke,bt){bt||(bt=be);var cr=ke[bt[0]]-_e[bt[0]],tn=ke[bt[1]]-_e[bt[1]];return Math.sqrt(cr*cr+tn*tn)}function fe(_e,ke,bt){bt||(bt=be);var cr=ke[bt[0]]-_e[bt[0]],tn=ke[bt[1]]-_e[bt[1]];return Math.atan2(tn,cr)*180/Math.PI}function k(_e,ke){return fe(ke[1],ke[0],Fi)+fe(_e[1],_e[0],Fi)}function z(_e,ke){return Ti(ke[0],ke[1],Fi)/Ti(_e[0],_e[1],Fi)}var le={mousedown:In,mousemove:gn,mouseup:nn},Se="mousedown",De="mousemove mouseup";function $t(){this.evEl=Se,this.evWin=De,this.pressed=!1,aa.apply(this,arguments)}mt($t,aa,{handler:function(ke){var bt=le[ke.type];bt&In&&ke.button===0&&(this.pressed=!0),bt&gn&&ke.which!==1&&(bt=nn),this.pressed&&(bt&nn&&(this.pressed=!1),this.callback(this.manager,bt,{pointers:[ke],changedPointers:[ke],pointerType:Vr,srcEvent:ke}))}});var Dt={pointerdown:In,pointermove:gn,pointerup:nn,pointercancel:fi,pointerout:fi},Bt={2:dr,3:Ot,4:Vr,5:Kr},yt="pointerdown",U="pointermove pointerup pointercancel";de.MSPointerEvent&&!de.PointerEvent&&(yt="MSPointerDown",U="MSPointerMove MSPointerUp MSPointerCancel");function N(){this.evEl=yt,this.evWin=U,aa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}mt(N,aa,{handler:function(ke){var bt=this.store,cr=!1,tn=ke.type.toLowerCase().replace("ms",""),Bn=Dt[tn],Xi=Bt[ke.pointerType]||ke.pointerType,yo=Xi==dr,Io=vr(bt,ke.pointerId,"pointerId");Bn&In&&(ke.button===0||yo)?Io<0&&(bt.push(ke),Io=bt.length-1):Bn&(nn|fi)&&(cr=!0),!(Io<0)&&(bt[Io]=ke,this.callback(this.manager,Bn,{pointers:bt,changedPointers:[ke],pointerType:Xi,srcEvent:ke}),cr&&bt.splice(Io,1))}});var $={touchstart:In,touchmove:gn,touchend:nn,touchcancel:fi},ae="touchstart",Ae="touchstart touchmove touchend touchcancel";function Ze(){this.evTarget=ae,this.evWin=Ae,this.started=!1,aa.apply(this,arguments)}mt(Ze,aa,{handler:function(ke){var bt=$[ke.type];if(bt===In&&(this.started=!0),!!this.started){var cr=at.call(this,ke,bt);bt&(nn|fi)&&cr[0].length-cr[1].length===0&&(this.started=!1),this.callback(this.manager,bt,{pointers:cr[0],changedPointers:cr[1],pointerType:dr,srcEvent:ke})}}});function at(_e,ke){var bt=ee(_e.touches),cr=ee(_e.changedTouches);return ke&(nn|fi)&&(bt=V(bt.concat(cr),"identifier",!0)),[bt,cr]}var j={touchstart:In,touchmove:gn,touchend:nn,touchcancel:fi},J="touchstart touchmove touchend touchcancel";function Ne(){this.evTarget=J,this.targetIds={},aa.apply(this,arguments)}mt(Ne,aa,{handler:function(ke){var bt=j[ke.type],cr=st.call(this,ke,bt);cr&&this.callback(this.manager,bt,{pointers:cr[0],changedPointers:cr[1],pointerType:dr,srcEvent:ke})}});function st(_e,ke){var bt=ee(_e.touches),cr=this.targetIds;if(ke&(In|gn)&&bt.length===1)return cr[bt[0].identifier]=!0,[bt,bt];var tn,Bn,Xi=ee(_e.changedTouches),yo=[],Io=this.target;if(Bn=bt.filter(function(vo){return At(vo.target,Io)}),ke===In)for(tn=0;tn<Bn.length;)cr[Bn[tn].identifier]=!0,tn++;for(tn=0;tn<Xi.length;)cr[Xi[tn].identifier]&&yo.push(Xi[tn]),ke&(nn|fi)&&delete cr[Xi[tn].identifier],tn++;if(yo.length)return[V(Bn.concat(yo),"identifier",!0),yo]}var Te=2500,Kt=25;function xr(){aa.apply(this,arguments);var _e=pr(this.handler,this);this.touch=new Ne(this.manager,_e),this.mouse=new $t(this.manager,_e),this.primaryTouch=null,this.lastTouches=[]}mt(xr,aa,{handler:function(ke,bt,cr){var tn=cr.pointerType==dr,Bn=cr.pointerType==Vr;if(!(Bn&&cr.sourceCapabilities&&cr.sourceCapabilities.firesTouchEvents)){if(tn)sn.call(this,bt,cr);else if(Bn&&nr.call(this,cr))return;this.callback(ke,bt,cr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function sn(_e,ke){_e&In?(this.primaryTouch=ke.changedPointers[0].identifier,un.call(this,ke)):_e&(nn|fi)&&un.call(this,ke)}function un(_e){var ke=_e.changedPointers[0];if(ke.identifier===this.primaryTouch){var bt={x:ke.clientX,y:ke.clientY};this.lastTouches.push(bt);var cr=this.lastTouches,tn=function(){var Bn=cr.indexOf(bt);Bn>-1&&cr.splice(Bn,1)};setTimeout(tn,Te)}}function nr(_e){for(var ke=_e.srcEvent.clientX,bt=_e.srcEvent.clientY,cr=0;cr<this.lastTouches.length;cr++){var tn=this.lastTouches[cr],Bn=Math.abs(ke-tn.x),Xi=Math.abs(bt-tn.y);if(Bn<=Kt&&Xi<=Kt)return!0}return!1}var Qr=Q(oe.style,"touchAction"),Wr=Qr!==L,$r="compute",ii="auto",pn="manipulation",mi="none",Gi="pan-x",di="pan-y",Ui=oa();function wi(_e,ke){this.manager=_e,this.set(ke)}wi.prototype={set:function(_e){_e==$r&&(_e=this.compute()),Wr&&this.manager.element.style&&Ui[_e]&&(this.manager.element.style[Qr]=_e),this.actions=_e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var _e=[];return St(this.manager.recognizers,function(ke){gr(ke.options.enable,[ke])&&(_e=_e.concat(ke.getTouchAction()))}),ss(_e.join(" "))},preventDefaults:function(_e){var ke=_e.srcEvent,bt=_e.offsetDirection;if(this.manager.session.prevented){ke.preventDefault();return}var cr=this.actions,tn=Fe(cr,mi)&&!Ui[mi],Bn=Fe(cr,di)&&!Ui[di],Xi=Fe(cr,Gi)&&!Ui[Gi];if(tn){var yo=_e.pointers.length===1,Io=_e.distance<2,vo=_e.deltaTime<250;if(yo&&Io&&vo)return}if(!(Xi&&Bn)&&(tn||Bn&&bt&xi||Xi&&bt&ia))return this.preventSrc(ke)},preventSrc:function(_e){this.manager.session.prevented=!0,_e.preventDefault()}};function ss(_e){if(Fe(_e,mi))return mi;var ke=Fe(_e,Gi),bt=Fe(_e,di);return ke&&bt?mi:ke||bt?ke?Gi:di:Fe(_e,pn)?pn:ii}function oa(){if(!Wr)return!1;var _e={},ke=de.CSS&&de.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(bt){_e[bt]=ke?de.CSS.supports("touch-action",bt):!0}),_e}var ka=1,Ci=2,yi=4,Ri=8,Da=Ri,gu=16,_a=32;function Ia(_e){this.options=Pt({},this.defaults,_e||{}),this.id=xe(),this.manager=null,this.options.enable=lr(this.options.enable,!0),this.state=ka,this.simultaneous={},this.requireFail=[]}Ia.prototype={defaults:{},set:function(_e){return Pt(this.options,_e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(_e){if(Rt(_e,"recognizeWith",this))return this;var ke=this.simultaneous;return _e=Pa(_e,this),ke[_e.id]||(ke[_e.id]=_e,_e.recognizeWith(this)),this},dropRecognizeWith:function(_e){return Rt(_e,"dropRecognizeWith",this)?this:(_e=Pa(_e,this),delete this.simultaneous[_e.id],this)},requireFailure:function(_e){if(Rt(_e,"requireFailure",this))return this;var ke=this.requireFail;return _e=Pa(_e,this),vr(ke,_e)===-1&&(ke.push(_e),_e.requireFailure(this)),this},dropRequireFailure:function(_e){if(Rt(_e,"dropRequireFailure",this))return this;_e=Pa(_e,this);var ke=vr(this.requireFail,_e);return ke>-1&&this.requireFail.splice(ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(_e){return!!this.simultaneous[_e.id]},emit:function(_e){var ke=this,bt=this.state;function cr(tn){ke.manager.emit(tn,_e)}bt<Ri&&cr(ke.options.event+Zl(bt)),cr(ke.options.event),_e.additionalEvent&&cr(_e.additionalEvent),bt>=Ri&&cr(ke.options.event+Zl(bt))},tryEmit:function(_e){if(this.canEmit())return this.emit(_e);this.state=_a},canEmit:function(){for(var _e=0;_e<this.requireFail.length;){if(!(this.requireFail[_e].state&(_a|ka)))return!1;_e++}return!0},recognize:function(_e){var ke=Pt({},_e);if(!gr(this.options.enable,[this,ke])){this.reset(),this.state=_a;return}this.state&(Da|gu|_a)&&(this.state=ka),this.state=this.process(ke),this.state&(Ci|yi|Ri|gu)&&this.tryEmit(ke)},process:function(_e){},getTouchAction:function(){},reset:function(){}};function Zl(_e){return _e&gu?"cancel":_e&Ri?"end":_e&yi?"move":_e&Ci?"start":""}function vs(_e){return _e==qi?"down":_e==hn?"up":_e==Vn?"left":_e==Hr?"right":""}function Pa(_e,ke){var bt=ke.manager;return bt?bt.get(_e):_e}function _i(){Ia.apply(this,arguments)}mt(_i,Ia,{defaults:{pointers:1},attrTest:function(_e){var ke=this.options.pointers;return ke===0||_e.pointers.length===ke},process:function(_e){var ke=this.state,bt=_e.eventType,cr=ke&(Ci|yi),tn=this.attrTest(_e);return cr&&(bt&fi||!tn)?ke|gu:cr||tn?bt&nn?ke|Ri:ke&Ci?ke|yi:Ci:_a}});function La(){_i.apply(this,arguments),this.pX=null,this.pY=null}mt(La,_i,{defaults:{event:"pan",threshold:10,pointers:1,direction:ea},getTouchAction:function(){var _e=this.options.direction,ke=[];return _e&xi&&ke.push(di),_e&ia&&ke.push(Gi),ke},directionTest:function(_e){var ke=this.options,bt=!0,cr=_e.distance,tn=_e.direction,Bn=_e.deltaX,Xi=_e.deltaY;return tn&ke.direction||(ke.direction&xi?(tn=Bn===0?Lr:Bn<0?Vn:Hr,bt=Bn!=this.pX,cr=Math.abs(_e.deltaX)):(tn=Xi===0?Lr:Xi<0?hn:qi,bt=Xi!=this.pY,cr=Math.abs(_e.deltaY))),_e.direction=tn,bt&&cr>ke.threshold&&tn&ke.direction},attrTest:function(_e){return _i.prototype.attrTest.call(this,_e)&&(this.state&Ci||!(this.state&Ci)&&this.directionTest(_e))},emit:function(_e){this.pX=_e.deltaX,this.pY=_e.deltaY;var ke=vs(_e.direction);ke&&(_e.additionalEvent=this.options.event+ke),this._super.emit.call(this,_e)}});function fa(){_i.apply(this,arguments)}mt(fa,_i,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[mi]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.scale-1)>this.options.threshold||this.state&Ci)},emit:function(_e){if(_e.scale!==1){var ke=_e.scale<1?"in":"out";_e.additionalEvent=this.options.event+ke}this._super.emit.call(this,_e)}});function Ho(){Ia.apply(this,arguments),this._timer=null,this._input=null}mt(Ho,Ia,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ii]},process:function(_e){var ke=this.options,bt=_e.pointers.length===ke.pointers,cr=_e.distance<ke.threshold,tn=_e.deltaTime>ke.time;if(this._input=_e,!cr||!bt||_e.eventType&(nn|fi)&&!tn)this.reset();else if(_e.eventType&In)this.reset(),this._timer=Ke(function(){this.state=Da,this.tryEmit()},ke.time,this);else if(_e.eventType&nn)return Da;return _a},reset:function(){clearTimeout(this._timer)},emit:function(_e){this.state===Da&&(_e&&_e.eventType&nn?this.manager.emit(this.options.event+"up",_e):(this._input.timeStamp=Ge(),this.manager.emit(this.options.event,this._input)))}});function ga(){_i.apply(this,arguments)}mt(ga,_i,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[mi]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.rotation)>this.options.threshold||this.state&Ci)}});function us(){_i.apply(this,arguments)}mt(us,_i,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:xi|ia,pointers:1},getTouchAction:function(){return La.prototype.getTouchAction.call(this)},attrTest:function(_e){var ke=this.options.direction,bt;return ke&(xi|ia)?bt=_e.overallVelocity:ke&xi?bt=_e.overallVelocityX:ke&ia&&(bt=_e.overallVelocityY),this._super.attrTest.call(this,_e)&&ke&_e.offsetDirection&&_e.distance>this.options.threshold&&_e.maxPointers==this.options.pointers&&ze(bt)>this.options.velocity&&_e.eventType&nn},emit:function(_e){var ke=vs(_e.offsetDirection);ke&&this.manager.emit(this.options.event+ke,_e),this.manager.emit(this.options.event,_e)}});function Qo(){Ia.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}mt(Qo,Ia,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pn]},process:function(_e){var ke=this.options,bt=_e.pointers.length===ke.pointers,cr=_e.distance<ke.threshold,tn=_e.deltaTime<ke.time;if(this.reset(),_e.eventType&In&&this.count===0)return this.failTimeout();if(cr&&tn&&bt){if(_e.eventType!=nn)return this.failTimeout();var Bn=this.pTime?_e.timeStamp-this.pTime<ke.interval:!0,Xi=!this.pCenter||Ti(this.pCenter,_e.center)<ke.posThreshold;this.pTime=_e.timeStamp,this.pCenter=_e.center,!Xi||!Bn?this.count=1:this.count+=1,this._input=_e;var yo=this.count%ke.taps;if(yo===0)return this.hasRequireFailures()?(this._timer=Ke(function(){this.state=Da,this.tryEmit()},ke.interval,this),Ci):Da}return _a},failTimeout:function(){return this._timer=Ke(function(){this.state=_a},this.options.interval,this),_a},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Da&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Lu(_e,ke){return ke=ke||{},ke.recognizers=lr(ke.recognizers,Lu.defaults.preset),new wa(_e,ke)}Lu.VERSION="2.0.7",Lu.defaults={domEvents:!1,touchAction:$r,enable:!0,inputTarget:null,inputClass:null,preset:[[ga,{enable:!1}],[fa,{enable:!1},["rotate"]],[us,{direction:xi}],[La,{direction:xi},["swipe"]],[Qo],[Qo,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ms=1,gc=2;function wa(_e,ke){this.options=Pt({},Lu.defaults,ke||{}),this.options.inputTarget=this.options.inputTarget||_e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=_e,this.input=va(this),this.touchAction=new wi(this,this.options.touchAction),sa(this,!0),St(this.options.recognizers,function(bt){var cr=this.add(new bt[0](bt[1]));bt[2]&&cr.recognizeWith(bt[2]),bt[3]&&cr.requireFailure(bt[3])},this)}wa.prototype={set:function(_e){return Pt(this.options,_e),_e.touchAction&&this.touchAction.update(),_e.inputTarget&&(this.input.destroy(),this.input.target=_e.inputTarget,this.input.init()),this},stop:function(_e){this.session.stopped=_e?gc:ms},recognize:function(_e){var ke=this.session;if(!ke.stopped){this.touchAction.preventDefaults(_e);var bt,cr=this.recognizers,tn=ke.curRecognizer;(!tn||tn&&tn.state&Da)&&(tn=ke.curRecognizer=null);for(var Bn=0;Bn<cr.length;)bt=cr[Bn],ke.stopped!==gc&&(!tn||bt==tn||bt.canRecognizeWith(tn))?bt.recognize(_e):bt.reset(),!tn&&bt.state&(Ci|yi|Ri)&&(tn=ke.curRecognizer=bt),Bn++}},get:function(_e){if(_e instanceof Ia)return _e;for(var ke=this.recognizers,bt=0;bt<ke.length;bt++)if(ke[bt].options.event==_e)return ke[bt];return null},add:function(_e){if(Rt(_e,"add",this))return this;var ke=this.get(_e.options.event);return ke&&this.remove(ke),this.recognizers.push(_e),_e.manager=this,this.touchAction.update(),_e},remove:function(_e){if(Rt(_e,"remove",this))return this;if(_e=this.get(_e),_e){var ke=this.recognizers,bt=vr(ke,_e);bt!==-1&&(ke.splice(bt,1),this.touchAction.update())}return this},on:function(_e,ke){if(_e!==L&&ke!==L){var bt=this.handlers;return St(Zt(_e),function(cr){bt[cr]=bt[cr]||[],bt[cr].push(ke)}),this}},off:function(_e,ke){if(_e!==L){var bt=this.handlers;return St(Zt(_e),function(cr){ke?bt[cr]&&bt[cr].splice(vr(bt[cr],ke),1):delete bt[cr]}),this}},emit:function(_e,ke){this.options.domEvents&&er(_e,ke);var bt=this.handlers[_e]&&this.handlers[_e].slice();if(!(!bt||!bt.length)){ke.type=_e,ke.preventDefault=function(){ke.srcEvent.preventDefault()};for(var cr=0;cr<bt.length;)bt[cr](ke),cr++}},destroy:function(){this.element&&sa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function sa(_e,ke){var bt=_e.element;if(bt.style){var cr;St(_e.options.cssProps,function(tn,Bn){cr=Q(bt.style,Bn),ke?(_e.oldCssProps[cr]=bt.style[cr],bt.style[cr]=tn):bt.style[cr]=_e.oldCssProps[cr]||""}),ke||(_e.oldCssProps={})}}function er(_e,ke){var bt=y.createEvent("Event");bt.initEvent(_e,!0,!0),bt.gesture=ke,ke.target.dispatchEvent(bt)}Pt(Lu,{INPUT_START:In,INPUT_MOVE:gn,INPUT_END:nn,INPUT_CANCEL:fi,STATE_POSSIBLE:ka,STATE_BEGAN:Ci,STATE_CHANGED:yi,STATE_ENDED:Ri,STATE_RECOGNIZED:Da,STATE_CANCELLED:gu,STATE_FAILED:_a,DIRECTION_NONE:Lr,DIRECTION_LEFT:Vn,DIRECTION_RIGHT:Hr,DIRECTION_UP:hn,DIRECTION_DOWN:qi,DIRECTION_HORIZONTAL:xi,DIRECTION_VERTICAL:ia,DIRECTION_ALL:ea,Manager:wa,Input:aa,TouchAction:wi,TouchInput:Ne,MouseInput:$t,PointerEventInput:N,TouchMouseInput:xr,SingleTouchInput:Ze,Recognizer:Ia,AttrRecognizer:_i,Tap:Qo,Pan:La,Swipe:us,Pinch:fa,Rotate:ga,Press:Ho,on:ut,off:we,each:St,merge:pt,extend:Ct,assign:Pt,inherit:mt,bindFn:pr,prefixed:Q});var Cn=typeof de!="undefined"?de:typeof self!="undefined"?self:{};Cn.Hammer=Lu,ne=function(){return Lu}.call(re,B,re,Ht),ne!==L&&(Ht.exports=ne)})(window,document,"Hammer")},7375:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0});var B=Symbol.for("INJECTION");function ne(ue,oe,Be,se){function ze(){return se&&!Reflect.hasMetadata(B,this,oe)&&Reflect.defineMetadata(B,Be(),this,oe),Reflect.hasMetadata(B,this,oe)?Reflect.getMetadata(B,this,oe):Be()}function Ge(Ke){Reflect.defineMetadata(B,Ke,this,oe)}Object.defineProperty(ue,oe,{configurable:!0,enumerable:!0,get:ze,set:Ge})}function de(ue,oe){return function(Be){return function(se,ze){var Ge=function(){return ue.get(Be)};ne(se,ze,Ge,oe)}}}re.makePropertyInjectDecorator=de;function y(ue,oe){return function(Be,se){return function(ze,Ge){var Ke=function(){return ue.getNamed(Be,se)};ne(ze,Ge,Ke,oe)}}}re.makePropertyInjectNamedDecorator=y;function ce(ue,oe){return function(Be,se,ze){return function(Ge,Ke){var Rt=function(){return ue.getTagged(Be,se,ze)};ne(Ge,Ke,Rt,oe)}}}re.makePropertyInjectTaggedDecorator=ce;function L(ue,oe){return function(Be){return function(se,ze){var Ge=function(){return ue.getAll(Be)};ne(se,ze,Ge,oe)}}}re.makePropertyMultiInjectDecorator=L},84879:function(Ht,re,B){"use strict";var ne;ne={value:!0};var de=B(7375);function y(ce,L){L===void 0&&(L=!0);var ue=de.makePropertyInjectDecorator(ce,L),oe=de.makePropertyInjectNamedDecorator(ce,L),Be=de.makePropertyInjectTaggedDecorator(ce,L),se=de.makePropertyMultiInjectDecorator(ce,L);return{lazyInject:ue,lazyInjectNamed:oe,lazyInjectTagged:Be,lazyMultiInject:se}}re.Z=y},99934:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagProperty=re.tagParameter=re.decorate=void 0;var ne=B(16674),de=B(6867);function y(se,ze,Ge,Ke){var Rt=de.TAGGED;L(Rt,se,ze,Ke,Ge)}re.tagParameter=y;function ce(se,ze,Ge){var Ke=de.TAGGED_PROP;L(Ke,se.constructor,ze,Ge)}re.tagProperty=ce;function L(se,ze,Ge,Ke,Rt){var St={},Nt=typeof Rt=="number",Pt=Rt!==void 0&&Nt?Rt.toString():Ge;if(Nt&&Ge!==void 0)throw new Error(ne.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(se,ze)&&(St=Reflect.getMetadata(se,ze));var Ct=St[Pt];if(!Array.isArray(Ct))Ct=[];else for(var pt=0,mt=Ct;pt<mt.length;pt++){var pr=mt[pt];if(pr.key===Ke.key)throw new Error(ne.DUPLICATED_METADATA+" "+pr.key.toString())}Ct.push(Ke),St[Pt]=Ct,Reflect.defineMetadata(se,St,ze)}function ue(se,ze){Reflect.decorate(se,ze)}function oe(se,ze){return function(Ge,Ke){ze(Ge,Ke,se)}}function Be(se,ze,Ge){typeof Ge=="number"?ue([oe(Ge,se)],ze):typeof Ge=="string"?Reflect.decorate([se],ze,Ge):ue([se],ze)}re.decorate=Be},5744:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.inject=re.LazyServiceIdentifer=void 0;var ne=B(16674),de=B(6867),y=B(47738),ce=B(99934),L=function(){function oe(Be){this._cb=Be}return oe.prototype.unwrap=function(){return this._cb()},oe}();re.LazyServiceIdentifer=L;function ue(oe){return function(Be,se,ze){if(oe===void 0)throw new Error(ne.UNDEFINED_INJECT_ANNOTATION(Be.name));var Ge=new y.Metadata(de.INJECT_TAG,oe);typeof ze=="number"?ce.tagParameter(Be,se,ze,Ge):ce.tagProperty(Be,se,Ge)}}re.inject=ue},64315:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.injectable=void 0;var ne=B(16674),de=B(6867);function y(){return function(ce){if(Reflect.hasOwnMetadata(de.PARAM_TYPES,ce))throw new Error(ne.DUPLICATED_INJECTABLE_DECORATOR);var L=Reflect.getMetadata(de.DESIGN_PARAM_TYPES,ce)||[];return Reflect.defineMetadata(de.PARAM_TYPES,L,ce),ce}}re.injectable=y},71693:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiInject=void 0;var ne=B(6867),de=B(47738),y=B(99934);function ce(L){return function(ue,oe,Be){var se=new de.Metadata(ne.MULTI_INJECT_TAG,L);typeof Be=="number"?y.tagParameter(ue,oe,Be,se):y.tagProperty(ue,oe,se)}}re.multiInject=ce},38085:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.named=void 0;var ne=B(6867),de=B(47738),y=B(99934);function ce(L){return function(ue,oe,Be){var se=new de.Metadata(ne.NAMED_TAG,L);typeof Be=="number"?y.tagParameter(ue,oe,Be,se):y.tagProperty(ue,oe,se)}}re.named=ce},6515:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.optional=void 0;var ne=B(6867),de=B(47738),y=B(99934);function ce(){return function(L,ue,oe){var Be=new de.Metadata(ne.OPTIONAL_TAG,!0);typeof oe=="number"?y.tagParameter(L,ue,oe,Be):y.tagProperty(L,ue,Be)}}re.optional=ce},7014:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.postConstruct=void 0;var ne=B(16674),de=B(6867),y=B(47738);function ce(){return function(L,ue,oe){var Be=new y.Metadata(de.POST_CONSTRUCT,ue);if(Reflect.hasOwnMetadata(de.POST_CONSTRUCT,L.constructor))throw new Error(ne.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(de.POST_CONSTRUCT,Be,L.constructor)}}re.postConstruct=ce},32052:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagged=void 0;var ne=B(47738),de=B(99934);function y(ce,L){return function(ue,oe,Be){var se=new ne.Metadata(ce,L);typeof Be=="number"?de.tagParameter(ue,oe,Be,se):de.tagProperty(ue,oe,se)}}re.tagged=y},55638:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.targetName=void 0;var ne=B(6867),de=B(47738),y=B(99934);function ce(L){return function(ue,oe,Be){var se=new de.Metadata(ne.NAME_TAG,L);y.tagParameter(ue,oe,Be,se)}}re.targetName=ce},86757:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.unmanaged=void 0;var ne=B(6867),de=B(47738),y=B(99934);function ce(){return function(L,ue,oe){var Be=new de.Metadata(ne.UNMANAGED_TAG,!0);y.tagParameter(L,ue,oe,Be)}}re.unmanaged=ce},44290:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Binding=void 0;var ne=B(28421),de=B(37791),y=function(){function ce(L,ue){this.id=de.id(),this.activated=!1,this.serviceIdentifier=L,this.scope=ue,this.type=ne.BindingTypeEnum.Invalid,this.constraint=function(oe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ce.prototype.clone=function(){var L=new ce(this.serviceIdentifier,this.scope);return L.activated=L.scope===ne.BindingScopeEnum.Singleton?this.activated:!1,L.implementationType=this.implementationType,L.dynamicValue=this.dynamicValue,L.scope=this.scope,L.type=this.type,L.factory=this.factory,L.provider=this.provider,L.constraint=this.constraint,L.onActivation=this.onActivation,L.cache=this.cache,L},ce}();re.Binding=y},23184:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingCount=void 0;var B={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};re.BindingCount=B},16674:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.STACK_OVERFLOW=re.CIRCULAR_DEPENDENCY_IN_FACTORY=re.POST_CONSTRUCT_ERROR=re.MULTIPLE_POST_CONSTRUCT_METHODS=re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=re.ARGUMENTS_LENGTH_MISMATCH=re.INVALID_DECORATOR_OPERATION=re.INVALID_TO_SELF_VALUE=re.INVALID_FUNCTION_BINDING=re.INVALID_MIDDLEWARE_RETURN=re.NO_MORE_SNAPSHOTS_AVAILABLE=re.INVALID_BINDING_TYPE=re.NOT_IMPLEMENTED=re.CIRCULAR_DEPENDENCY=re.UNDEFINED_INJECT_ANNOTATION=re.MISSING_INJECT_ANNOTATION=re.MISSING_INJECTABLE_ANNOTATION=re.NOT_REGISTERED=re.CANNOT_UNBIND=re.AMBIGUOUS_MATCH=re.KEY_NOT_FOUND=re.NULL_ARGUMENT=re.DUPLICATED_METADATA=re.DUPLICATED_INJECTABLE_DECORATOR=void 0,re.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",re.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",re.NULL_ARGUMENT="NULL argument",re.KEY_NOT_FOUND="Key Not Found",re.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",re.CANNOT_UNBIND="Could not unbind serviceIdentifier:",re.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",re.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",re.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var B=function(ce){return"@inject called with undefined this could mean that the class "+ce+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};re.UNDEFINED_INJECT_ANNOTATION=B,re.CIRCULAR_DEPENDENCY="Circular dependency found:",re.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",re.INVALID_BINDING_TYPE="Invalid binding type:",re.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",re.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",re.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",re.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",re.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ne=function(){for(var ce=[],L=0;L<arguments.length;L++)ce[L]=arguments[L];return"The number of constructor arguments in the derived class "+(ce[0]+" must be >= than the number of constructor arguments of its base class.")};re.ARGUMENTS_LENGTH_MISMATCH=ne,re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",re.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var de=function(){for(var ce=[],L=0;L<arguments.length;L++)ce[L]=arguments[L];return"@postConstruct error in class "+ce[0]+": "+ce[1]};re.POST_CONSTRUCT_ERROR=de;var y=function(){for(var ce=[],L=0;L<arguments.length;L++)ce[L]=arguments[L];return"It looks like there is a circular dependency "+("in one of the '"+ce[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ce[1]+"'.")};re.CIRCULAR_DEPENDENCY_IN_FACTORY=y,re.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.TargetTypeEnum=re.BindingTypeEnum=re.BindingScopeEnum=void 0;var B={Request:"Request",Singleton:"Singleton",Transient:"Transient"};re.BindingScopeEnum=B;var ne={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};re.BindingTypeEnum=ne;var de={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};re.TargetTypeEnum=de},6867:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.NON_CUSTOM_TAG_KEYS=re.POST_CONSTRUCT=re.DESIGN_PARAM_TYPES=re.PARAM_TYPES=re.TAGGED_PROP=re.TAGGED=re.MULTI_INJECT_TAG=re.INJECT_TAG=re.OPTIONAL_TAG=re.UNMANAGED_TAG=re.NAME_TAG=re.NAMED_TAG=void 0,re.NAMED_TAG="named",re.NAME_TAG="name",re.UNMANAGED_TAG="unmanaged",re.OPTIONAL_TAG="optional",re.INJECT_TAG="inject",re.MULTI_INJECT_TAG="multi_inject",re.TAGGED="inversify:tagged",re.TAGGED_PROP="inversify:tagged_props",re.PARAM_TYPES="inversify:paramtypes",re.DESIGN_PARAM_TYPES="design:paramtypes",re.POST_CONSTRUCT="post_construct";function B(){return[re.INJECT_TAG,re.MULTI_INJECT_TAG,re.NAME_TAG,re.UNMANAGED_TAG,re.NAMED_TAG,re.OPTIONAL_TAG]}re.NON_CUSTOM_TAG_KEYS=B()},51389:function(Ht,re,B){"use strict";var ne=this&&this.__awaiter||function(Ct,pt,mt,pr){function gr(lr){return lr instanceof mt?lr:new mt(function(ut){ut(lr)})}return new(mt||(mt=Promise))(function(lr,ut){function we(Zt){try{Fe(pr.next(Zt))}catch(vr){ut(vr)}}function At(Zt){try{Fe(pr.throw(Zt))}catch(vr){ut(vr)}}function Fe(Zt){Zt.done?lr(Zt.value):gr(Zt.value).then(we,At)}Fe((pr=pr.apply(Ct,pt||[])).next())})},de=this&&this.__generator||function(Ct,pt){var mt={label:0,sent:function(){if(lr[0]&1)throw lr[1];return lr[1]},trys:[],ops:[]},pr,gr,lr,ut;return ut={next:we(0),throw:we(1),return:we(2)},typeof Symbol=="function"&&(ut[Symbol.iterator]=function(){return this}),ut;function we(Fe){return function(Zt){return At([Fe,Zt])}}function At(Fe){if(pr)throw new TypeError("Generator is already executing.");for(;mt;)try{if(pr=1,gr&&(lr=Fe[0]&2?gr.return:Fe[0]?gr.throw||((lr=gr.return)&&lr.call(gr),0):gr.next)&&!(lr=lr.call(gr,Fe[1])).done)return lr;switch(gr=0,lr&&(Fe=[Fe[0]&2,lr.value]),Fe[0]){case 0:case 1:lr=Fe;break;case 4:return mt.label++,{value:Fe[1],done:!1};case 5:mt.label++,gr=Fe[1],Fe=[0];continue;case 7:Fe=mt.ops.pop(),mt.trys.pop();continue;default:if(lr=mt.trys,!(lr=lr.length>0&&lr[lr.length-1])&&(Fe[0]===6||Fe[0]===2)){mt=0;continue}if(Fe[0]===3&&(!lr||Fe[1]>lr[0]&&Fe[1]<lr[3])){mt.label=Fe[1];break}if(Fe[0]===6&&mt.label<lr[1]){mt.label=lr[1],lr=Fe;break}if(lr&&mt.label<lr[2]){mt.label=lr[2],mt.ops.push(Fe);break}lr[2]&&mt.ops.pop(),mt.trys.pop();continue}Fe=pt.call(Ct,mt)}catch(Zt){Fe=[6,Zt],gr=0}finally{pr=lr=0}if(Fe[0]&5)throw Fe[1];return{value:Fe[0]?Fe[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Ct,pt){for(var mt=0,pr=pt.length,gr=Ct.length;mt<pr;mt++,gr++)Ct[gr]=pt[mt];return Ct};Object.defineProperty(re,"__esModule",{value:!0}),re.Container=void 0;var ce=B(44290),L=B(16674),ue=B(28421),oe=B(6867),Be=B(51377),se=B(86311),ze=B(7478),Ge=B(51860),Ke=B(37791),Rt=B(55800),St=B(85700),Nt=B(80175),Pt=function(){function Ct(pt){this._appliedMiddleware=[];var mt=pt||{};if(typeof mt!="object")throw new Error(""+L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(mt.defaultScope===void 0)mt.defaultScope=ue.BindingScopeEnum.Transient;else if(mt.defaultScope!==ue.BindingScopeEnum.Singleton&&mt.defaultScope!==ue.BindingScopeEnum.Transient&&mt.defaultScope!==ue.BindingScopeEnum.Request)throw new Error(""+L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(mt.autoBindInjectable===void 0)mt.autoBindInjectable=!1;else if(typeof mt.autoBindInjectable!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(mt.skipBaseClassChecks===void 0)mt.skipBaseClassChecks=!1;else if(typeof mt.skipBaseClassChecks!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:mt.autoBindInjectable,defaultScope:mt.defaultScope,skipBaseClassChecks:mt.skipBaseClassChecks},this.id=Ke.id(),this._bindingDictionary=new Nt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Be.MetadataReader}return Ct.merge=function(pt,mt){for(var pr=[],gr=2;gr<arguments.length;gr++)pr[gr-2]=arguments[gr];var lr=new Ct,ut=y([pt,mt],pr).map(function(Fe){return se.getBindingDictionary(Fe)}),we=se.getBindingDictionary(lr);function At(Fe,Zt){Fe.traverse(function(vr,ee){ee.forEach(function(V){Zt.add(V.serviceIdentifier,V.clone())})})}return ut.forEach(function(Fe){At(Fe,we)}),lr},Ct.prototype.load=function(){for(var pt=[],mt=0;mt<arguments.length;mt++)pt[mt]=arguments[mt];for(var pr=this._getContainerModuleHelpersFactory(),gr=0,lr=pt;gr<lr.length;gr++){var ut=lr[gr],we=pr(ut.id);ut.registry(we.bindFunction,we.unbindFunction,we.isboundFunction,we.rebindFunction)}},Ct.prototype.loadAsync=function(){for(var pt=[],mt=0;mt<arguments.length;mt++)pt[mt]=arguments[mt];return ne(this,void 0,void 0,function(){var pr,gr,lr,ut,we;return de(this,function(At){switch(At.label){case 0:pr=this._getContainerModuleHelpersFactory(),gr=0,lr=pt,At.label=1;case 1:return gr<lr.length?(ut=lr[gr],we=pr(ut.id),[4,ut.registry(we.bindFunction,we.unbindFunction,we.isboundFunction,we.rebindFunction)]):[3,4];case 2:At.sent(),At.label=3;case 3:return gr++,[3,1];case 4:return[2]}})})},Ct.prototype.unload=function(){for(var pt=this,mt=[],pr=0;pr<arguments.length;pr++)mt[pr]=arguments[pr];var gr=function(lr){return function(ut){return ut.moduleId===lr}};mt.forEach(function(lr){var ut=gr(lr.id);pt._bindingDictionary.removeByCondition(ut)})},Ct.prototype.bind=function(pt){var mt=this.options.defaultScope||ue.BindingScopeEnum.Transient,pr=new ce.Binding(pt,mt);return this._bindingDictionary.add(pt,pr),new Ge.BindingToSyntax(pr)},Ct.prototype.rebind=function(pt){return this.unbind(pt),this.bind(pt)},Ct.prototype.unbind=function(pt){try{this._bindingDictionary.remove(pt)}catch(mt){throw new Error(L.CANNOT_UNBIND+" "+Rt.getServiceIdentifierAsString(pt))}},Ct.prototype.unbindAll=function(){this._bindingDictionary=new Nt.Lookup},Ct.prototype.isBound=function(pt){var mt=this._bindingDictionary.hasKey(pt);return!mt&&this.parent&&(mt=this.parent.isBound(pt)),mt},Ct.prototype.isBoundNamed=function(pt,mt){return this.isBoundTagged(pt,oe.NAMED_TAG,mt)},Ct.prototype.isBoundTagged=function(pt,mt,pr){var gr=!1;if(this._bindingDictionary.hasKey(pt)){var lr=this._bindingDictionary.get(pt),ut=se.createMockRequest(this,pt,mt,pr);gr=lr.some(function(we){return we.constraint(ut)})}return!gr&&this.parent&&(gr=this.parent.isBoundTagged(pt,mt,pr)),gr},Ct.prototype.snapshot=function(){this._snapshots.push(St.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ct.prototype.restore=function(){var pt=this._snapshots.pop();if(pt===void 0)throw new Error(L.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=pt.bindings,this._middleware=pt.middleware},Ct.prototype.createChild=function(pt){var mt=new Ct(pt||this.options);return mt.parent=this,mt},Ct.prototype.applyMiddleware=function(){for(var pt=[],mt=0;mt<arguments.length;mt++)pt[mt]=arguments[mt];this._appliedMiddleware=this._appliedMiddleware.concat(pt);var pr=this._middleware?this._middleware:this._planAndResolve();this._middleware=pt.reduce(function(gr,lr){return lr(gr)},pr)},Ct.prototype.applyCustomMetadataReader=function(pt){this._metadataReader=pt},Ct.prototype.get=function(pt){return this._get(!1,!1,ue.TargetTypeEnum.Variable,pt)},Ct.prototype.getTagged=function(pt,mt,pr){return this._get(!1,!1,ue.TargetTypeEnum.Variable,pt,mt,pr)},Ct.prototype.getNamed=function(pt,mt){return this.getTagged(pt,oe.NAMED_TAG,mt)},Ct.prototype.getAll=function(pt){return this._get(!0,!0,ue.TargetTypeEnum.Variable,pt)},Ct.prototype.getAllTagged=function(pt,mt,pr){return this._get(!1,!0,ue.TargetTypeEnum.Variable,pt,mt,pr)},Ct.prototype.getAllNamed=function(pt,mt){return this.getAllTagged(pt,oe.NAMED_TAG,mt)},Ct.prototype.resolve=function(pt){var mt=this.createChild();return mt.bind(pt).toSelf(),this._appliedMiddleware.forEach(function(pr){mt.applyMiddleware(pr)}),mt.get(pt)},Ct.prototype._getContainerModuleHelpersFactory=function(){var pt=this,mt=function(we,At){we._binding.moduleId=At},pr=function(we){return function(At){var Fe=pt.bind.bind(pt),Zt=Fe(At);return mt(Zt,we),Zt}},gr=function(we){return function(At){var Fe=pt.unbind.bind(pt);Fe(At)}},lr=function(we){return function(At){var Fe=pt.isBound.bind(pt);return Fe(At)}},ut=function(we){return function(At){var Fe=pt.rebind.bind(pt),Zt=Fe(At);return mt(Zt,we),Zt}};return function(we){return{bindFunction:pr(we),isboundFunction:lr(we),rebindFunction:ut(we),unbindFunction:gr(we)}}},Ct.prototype._get=function(pt,mt,pr,gr,lr,ut){var we=null,At={avoidConstraints:pt,contextInterceptor:function(Fe){return Fe},isMultiInject:mt,key:lr,serviceIdentifier:gr,targetType:pr,value:ut};if(this._middleware){if(we=this._middleware(At),we==null)throw new Error(L.INVALID_MIDDLEWARE_RETURN)}else we=this._planAndResolve()(At);return we},Ct.prototype._planAndResolve=function(){var pt=this;return function(mt){var pr=se.plan(pt._metadataReader,pt,mt.isMultiInject,mt.targetType,mt.serviceIdentifier,mt.key,mt.value,mt.avoidConstraints);pr=mt.contextInterceptor(pr);var gr=ze.resolve(pr);return gr}},Ct}();re.Container=Pt},33244:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.AsyncContainerModule=re.ContainerModule=void 0;var ne=B(37791),de=function(){function ce(L){this.id=ne.id(),this.registry=L}return ce}();re.ContainerModule=de;var y=function(){function ce(L){this.id=ne.id(),this.registry=L}return ce}();re.AsyncContainerModule=y},85700:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.ContainerSnapshot=void 0;var B=function(){function ne(){}return ne.of=function(de,y){var ce=new ne;return ce.bindings=de,ce.middleware=y,ce},ne}();re.ContainerSnapshot=B},80175:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Lookup=void 0;var ne=B(16674),de=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(ce,L){if(ce==null)throw new Error(ne.NULL_ARGUMENT);if(L==null)throw new Error(ne.NULL_ARGUMENT);var ue=this._map.get(ce);ue!==void 0?(ue.push(L),this._map.set(ce,ue)):this._map.set(ce,[L])},y.prototype.get=function(ce){if(ce==null)throw new Error(ne.NULL_ARGUMENT);var L=this._map.get(ce);if(L!==void 0)return L;throw new Error(ne.KEY_NOT_FOUND)},y.prototype.remove=function(ce){if(ce==null)throw new Error(ne.NULL_ARGUMENT);if(!this._map.delete(ce))throw new Error(ne.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(ce){var L=this;this._map.forEach(function(ue,oe){var Be=ue.filter(function(se){return!ce(se)});Be.length>0?L._map.set(oe,Be):L._map.delete(oe)})},y.prototype.hasKey=function(ce){if(ce==null)throw new Error(ne.NULL_ARGUMENT);return this._map.has(ce)},y.prototype.clone=function(){var ce=new y;return this._map.forEach(function(L,ue){L.forEach(function(oe){return ce.add(ue,oe.clone())})}),ce},y.prototype.traverse=function(ce){this._map.forEach(function(L,ue){ce(ue,L)})},y}();re.Lookup=de},86700:function(Ht,re,B){"use strict";var ne;ne={value:!0},ne=ne=ne=ne=ne=ne=re.GW=ne=ne=re.zY=ne=ne=ne=ne=ne=re.f3=ne=ne=re.b2=ne=ne=ne=ne=ne=re.W2=ne=void 0;var de=B(6867);ne=de;var y=B(51389);Object.defineProperty(re,"W2",{enumerable:!0,get:function(){return y.Container}});var ce=B(28421);ne={enumerable:!0,get:function(){return ce.BindingScopeEnum}},ne={enumerable:!0,get:function(){return ce.BindingTypeEnum}},ne={enumerable:!0,get:function(){return ce.TargetTypeEnum}};var L=B(33244);ne={enumerable:!0,get:function(){return L.AsyncContainerModule}},ne={enumerable:!0,get:function(){return L.ContainerModule}};var ue=B(64315);Object.defineProperty(re,"b2",{enumerable:!0,get:function(){return ue.injectable}});var oe=B(32052);ne={enumerable:!0,get:function(){return oe.tagged}};var Be=B(38085);ne={enumerable:!0,get:function(){return Be.named}};var se=B(5744);Object.defineProperty(re,"f3",{enumerable:!0,get:function(){return se.inject}}),ne={enumerable:!0,get:function(){return se.LazyServiceIdentifer}};var ze=B(6515);ne={enumerable:!0,get:function(){return ze.optional}};var Ge=B(86757);ne={enumerable:!0,get:function(){return Ge.unmanaged}};var Ke=B(71693);ne={enumerable:!0,get:function(){return Ke.multiInject}};var Rt=B(55638);ne={enumerable:!0,get:function(){return Rt.targetName}};var St=B(7014);Object.defineProperty(re,"zY",{enumerable:!0,get:function(){return St.postConstruct}});var Nt=B(51377);ne={enumerable:!0,get:function(){return Nt.MetadataReader}};var Pt=B(37791);ne={enumerable:!0,get:function(){return Pt.id}};var Ct=B(99934);Object.defineProperty(re,"GW",{enumerable:!0,get:function(){return Ct.decorate}});var pt=B(80758);ne={enumerable:!0,get:function(){return pt.traverseAncerstors}},ne={enumerable:!0,get:function(){return pt.taggedConstraint}},ne={enumerable:!0,get:function(){return pt.namedConstraint}},ne={enumerable:!0,get:function(){return pt.typeConstraint}};var mt=B(55800);ne={enumerable:!0,get:function(){return mt.getServiceIdentifierAsString}};var pr=B(70600);ne={enumerable:!0,get:function(){return pr.multiBindToService}}},95228:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Context=void 0;var ne=B(37791),de=function(){function y(ce){this.id=ne.id(),this.container=ce}return y.prototype.addPlan=function(ce){this.plan=ce},y.prototype.setCurrentRequest=function(ce){this.currentRequest=ce},y}();re.Context=de},47738:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Metadata=void 0;var ne=B(6867),de=function(){function y(ce,L){this.key=ce,this.value=L}return y.prototype.toString=function(){return this.key===ne.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();re.Metadata=de},51377:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.MetadataReader=void 0;var ne=B(6867),de=function(){function y(){}return y.prototype.getConstructorMetadata=function(ce){var L=Reflect.getMetadata(ne.PARAM_TYPES,ce),ue=Reflect.getMetadata(ne.TAGGED,ce);return{compilerGeneratedMetadata:L,userGeneratedMetadata:ue||{}}},y.prototype.getPropertiesMetadata=function(ce){var L=Reflect.getMetadata(ne.TAGGED_PROP,ce)||[];return L},y}();re.MetadataReader=de},55314:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Plan=void 0;var B=function(){function ne(de,y){this.parentContext=de,this.rootRequest=y}return ne}();re.Plan=B},86311:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.getBindingDictionary=re.createMockRequest=re.plan=void 0;var ne=B(23184),de=B(16674),y=B(28421),ce=B(6867),L=B(54623),ue=B(55800),oe=B(95228),Be=B(47738),se=B(55314),ze=B(6e3),Ge=B(6748),Ke=B(18924);function Rt(gr){return gr._bindingDictionary}re.getBindingDictionary=Rt;function St(gr,lr,ut,we,At,Fe){var Zt=gr?ce.MULTI_INJECT_TAG:ce.INJECT_TAG,vr=new Be.Metadata(Zt,ut),ee=new Ke.Target(lr,we,ut,vr);if(At!==void 0){var V=new Be.Metadata(At,Fe);ee.metadata.push(V)}return ee}function Nt(gr,lr,ut,we,At){var Fe=pt(ut.container,At.serviceIdentifier),Zt=[];return Fe.length===ne.BindingCount.NoBindingsAvailable&&ut.container.options.autoBindInjectable&&typeof At.serviceIdentifier=="function"&&gr.getConstructorMetadata(At.serviceIdentifier).compilerGeneratedMetadata&&(ut.container.bind(At.serviceIdentifier).toSelf(),Fe=pt(ut.container,At.serviceIdentifier)),lr?Zt=Fe:Zt=Fe.filter(function(vr){var ee=new Ge.Request(vr.serviceIdentifier,ut,we,vr,At);return vr.constraint(ee)}),Pt(At.serviceIdentifier,Zt,At,ut.container),Zt}function Pt(gr,lr,ut,we){switch(lr.length){case ne.BindingCount.NoBindingsAvailable:if(ut.isOptional())return lr;var At=ue.getServiceIdentifierAsString(gr),Fe=de.NOT_REGISTERED;throw Fe+=ue.listMetadataForTarget(At,ut),Fe+=ue.listRegisteredBindingsForServiceIdentifier(we,At,pt),new Error(Fe);case ne.BindingCount.OnlyOneBindingAvailable:if(!ut.isArray())return lr;case ne.BindingCount.MultipleBindingsAvailable:default:if(ut.isArray())return lr;var At=ue.getServiceIdentifierAsString(gr),Fe=de.AMBIGUOUS_MATCH+" "+At;throw Fe+=ue.listRegisteredBindingsForServiceIdentifier(we,At,pt),new Error(Fe)}}function Ct(gr,lr,ut,we,At,Fe){var Zt,vr;if(At===null){Zt=Nt(gr,lr,we,null,Fe),vr=new Ge.Request(ut,we,null,Zt,Fe);var ee=new se.Plan(we,vr);we.addPlan(ee)}else Zt=Nt(gr,lr,we,At,Fe),vr=At.addChildRequest(Fe.serviceIdentifier,Zt,Fe);Zt.forEach(function(V){var Q=null;if(Fe.isArray())Q=vr.addChildRequest(V.serviceIdentifier,V,Fe);else{if(V.cache)return;Q=vr}if(V.type===y.BindingTypeEnum.Instance&&V.implementationType!==null){var Re=ze.getDependencies(gr,V.implementationType);if(!we.container.options.skipBaseClassChecks){var xe=ze.getBaseClassDependencyCount(gr,V.implementationType);if(Re.length<xe){var nt=de.ARGUMENTS_LENGTH_MISMATCH(ze.getFunctionName(V.implementationType));throw new Error(nt)}}Re.forEach(function(Le){Ct(gr,!1,Le.serviceIdentifier,we,Q,Le)})}})}function pt(gr,lr){var ut=[],we=Rt(gr);return we.hasKey(lr)?ut=we.get(lr):gr.parent!==null&&(ut=pt(gr.parent,lr)),ut}function mt(gr,lr,ut,we,At,Fe,Zt,vr){vr===void 0&&(vr=!1);var ee=new oe.Context(lr),V=St(ut,we,At,"",Fe,Zt);try{return Ct(gr,vr,At,ee,null,V),ee}catch(Q){throw L.isStackOverflowExeption(Q)&&ee.plan&&ue.circularDependencyToException(ee.plan.rootRequest),Q}}re.plan=mt;function pr(gr,lr,ut,we){var At=new Ke.Target(y.TargetTypeEnum.Variable,"",lr,new Be.Metadata(ut,we)),Fe=new oe.Context(gr),Zt=new Ge.Request(lr,Fe,null,[],At);return Zt}re.createMockRequest=pr},88460:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.QueryableString=void 0;var B=function(){function ne(de){this.str=de}return ne.prototype.startsWith=function(de){return this.str.indexOf(de)===0},ne.prototype.endsWith=function(de){var y="",ce=de.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},ce)},ne.prototype.contains=function(de){return this.str.indexOf(de)!==-1},ne.prototype.equals=function(de){return this.str===de},ne.prototype.value=function(){return this.str},ne}();re.QueryableString=B},6e3:function(Ht,re,B){"use strict";var ne=this&&this.__spreadArray||function(Nt,Pt){for(var Ct=0,pt=Pt.length,mt=Nt.length;Ct<pt;Ct++,mt++)Nt[mt]=Pt[Ct];return Nt};Object.defineProperty(re,"__esModule",{value:!0}),re.getFunctionName=re.getBaseClassDependencyCount=re.getDependencies=void 0;var de=B(5744),y=B(16674),ce=B(28421),L=B(6867),ue=B(55800);Object.defineProperty(re,"getFunctionName",{enumerable:!0,get:function(){return ue.getFunctionName}});var oe=B(18924);function Be(Nt,Pt){var Ct=ue.getFunctionName(Pt),pt=se(Nt,Ct,Pt,!1);return pt}re.getDependencies=Be;function se(Nt,Pt,Ct,pt){var mt=Nt.getConstructorMetadata(Ct),pr=mt.compilerGeneratedMetadata;if(pr===void 0){var gr=y.MISSING_INJECTABLE_ANNOTATION+" "+Pt+".";throw new Error(gr)}var lr=mt.userGeneratedMetadata,ut=Object.keys(lr),we=Ct.length===0&&ut.length>0,At=ut.length>Ct.length,Fe=we||At?ut.length:Ct.length,Zt=Ge(pt,Pt,pr,lr,Fe),vr=Ke(Nt,Ct),ee=ne(ne([],Zt),vr);return ee}function ze(Nt,Pt,Ct,pt,mt){var pr=mt[Nt.toString()]||[],gr=St(pr),lr=gr.unmanaged!==!0,ut=pt[Nt],we=gr.inject||gr.multiInject;if(ut=we||ut,ut instanceof de.LazyServiceIdentifer&&(ut=ut.unwrap()),lr){var At=ut===Object,Fe=ut===Function,Zt=ut===void 0,vr=At||Fe||Zt;if(!Pt&&vr){var ee=y.MISSING_INJECT_ANNOTATION+" argument "+Nt+" in class "+Ct+".";throw new Error(ee)}var V=new oe.Target(ce.TargetTypeEnum.ConstructorArgument,gr.targetName,ut);return V.metadata=pr,V}return null}function Ge(Nt,Pt,Ct,pt,mt){for(var pr=[],gr=0;gr<mt;gr++){var lr=gr,ut=ze(lr,Nt,Pt,Ct,pt);ut!==null&&pr.push(ut)}return pr}function Ke(Nt,Pt){for(var Ct=Nt.getPropertiesMetadata(Pt),pt=[],mt=Object.keys(Ct),pr=0,gr=mt;pr<gr.length;pr++){var lr=gr[pr],ut=Ct[lr],we=St(Ct[lr]),At=we.targetName||lr,Fe=we.inject||we.multiInject,Zt=new oe.Target(ce.TargetTypeEnum.ClassProperty,At,Fe);Zt.metadata=ut,pt.push(Zt)}var vr=Object.getPrototypeOf(Pt.prototype).constructor;if(vr!==Object){var ee=Ke(Nt,vr);pt=ne(ne([],pt),ee)}return pt}function Rt(Nt,Pt){var Ct=Object.getPrototypeOf(Pt.prototype).constructor;if(Ct!==Object){var pt=ue.getFunctionName(Ct),mt=se(Nt,pt,Ct,!0),pr=mt.map(function(ut){return ut.metadata.filter(function(we){return we.key===L.UNMANAGED_TAG})}),gr=[].concat.apply([],pr).length,lr=mt.length-gr;return lr>0?lr:Rt(Nt,Ct)}else return 0}re.getBaseClassDependencyCount=Rt;function St(Nt){var Pt={};return Nt.forEach(function(Ct){Pt[Ct.key.toString()]=Ct.value}),{inject:Pt[L.INJECT_TAG],multiInject:Pt[L.MULTI_INJECT_TAG],targetName:Pt[L.NAME_TAG],unmanaged:Pt[L.UNMANAGED_TAG]}}},6748:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Request=void 0;var ne=B(37791),de=function(){function y(ce,L,ue,oe,Be){this.id=ne.id(),this.serviceIdentifier=ce,this.parentContext=L,this.parentRequest=ue,this.target=Be,this.childRequests=[],this.bindings=Array.isArray(oe)?oe:[oe],this.requestScope=ue===null?new Map:null}return y.prototype.addChildRequest=function(ce,L,ue){var oe=new y(ce,this.parentContext,this,L,ue);return this.childRequests.push(oe),oe},y}();re.Request=de},18924:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Target=void 0;var ne=B(6867),de=B(37791),y=B(47738),ce=B(88460),L=function(){function ue(oe,Be,se,ze){this.id=de.id(),this.type=oe,this.serviceIdentifier=se,this.name=new ce.QueryableString(Be||""),this.metadata=new Array;var Ge=null;typeof ze=="string"?Ge=new y.Metadata(ne.NAMED_TAG,ze):ze instanceof y.Metadata&&(Ge=ze),Ge!==null&&this.metadata.push(Ge)}return ue.prototype.hasTag=function(oe){for(var Be=0,se=this.metadata;Be<se.length;Be++){var ze=se[Be];if(ze.key===oe)return!0}return!1},ue.prototype.isArray=function(){return this.hasTag(ne.MULTI_INJECT_TAG)},ue.prototype.matchesArray=function(oe){return this.matchesTag(ne.MULTI_INJECT_TAG)(oe)},ue.prototype.isNamed=function(){return this.hasTag(ne.NAMED_TAG)},ue.prototype.isTagged=function(){return this.metadata.some(function(oe){return ne.NON_CUSTOM_TAG_KEYS.every(function(Be){return oe.key!==Be})})},ue.prototype.isOptional=function(){return this.matchesTag(ne.OPTIONAL_TAG)(!0)},ue.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(oe){return oe.key===ne.NAMED_TAG})[0]:null},ue.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(oe){return ne.NON_CUSTOM_TAG_KEYS.every(function(Be){return oe.key!==Be})}):null},ue.prototype.matchesNamedTag=function(oe){return this.matchesTag(ne.NAMED_TAG)(oe)},ue.prototype.matchesTag=function(oe){var Be=this;return function(se){for(var ze=0,Ge=Be.metadata;ze<Ge.length;ze++){var Ke=Ge[ze];if(Ke.key===oe&&Ke.value===se)return!0}return!1}},ue}();re.Target=L},52279:function(Ht,re,B){"use strict";var ne=this&&this.__spreadArray||function(se,ze){for(var Ge=0,Ke=ze.length,Rt=se.length;Ge<Ke;Ge++,Rt++)se[Rt]=ze[Ge];return se};Object.defineProperty(re,"__esModule",{value:!0}),re.resolveInstance=void 0;var de=B(16674),y=B(28421),ce=B(6867);function L(se,ze,Ge){var Ke=ze.filter(function(St){return St.target!==null&&St.target.type===y.TargetTypeEnum.ClassProperty}),Rt=Ke.map(Ge);return Ke.forEach(function(St,Nt){var Pt="";Pt=St.target.name.value();var Ct=Rt[Nt];se[Pt]=Ct}),se}function ue(se,ze){return new(se.bind.apply(se,ne([void 0],ze)))}function oe(se,ze){if(Reflect.hasMetadata(ce.POST_CONSTRUCT,se)){var Ge=Reflect.getMetadata(ce.POST_CONSTRUCT,se);try{ze[Ge.value]()}catch(Ke){throw new Error(de.POST_CONSTRUCT_ERROR(se.name,Ke.message))}}}function Be(se,ze,Ge){var Ke=null;if(ze.length>0){var Rt=ze.filter(function(Nt){return Nt.target!==null&&Nt.target.type===y.TargetTypeEnum.ConstructorArgument}),St=Rt.map(Ge);Ke=ue(se,St),Ke=L(Ke,ze,Ge)}else Ke=new se;return oe(se,Ke),Ke}re.resolveInstance=Be},7478:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.resolve=void 0;var ne=B(16674),de=B(28421),y=B(54623),ce=B(55800),L=B(52279),ue=function(se,ze,Ge){try{return Ge()}catch(Ke){throw y.isStackOverflowExeption(Ke)?new Error(ne.CIRCULAR_DEPENDENCY_IN_FACTORY(se,ze.toString())):Ke}},oe=function(se){return function(ze){ze.parentContext.setCurrentRequest(ze);var Ge=ze.bindings,Ke=ze.childRequests,Rt=ze.target&&ze.target.isArray(),St=!ze.parentRequest||!ze.parentRequest.target||!ze.target||!ze.parentRequest.target.matchesArray(ze.target.serviceIdentifier);if(Rt&&St)return Ke.map(function(pr){var gr=oe(se);return gr(pr)});var Nt=null;if(ze.target.isOptional()&&Ge.length===0)return;var Pt=Ge[0],Ct=Pt.scope===de.BindingScopeEnum.Singleton,pt=Pt.scope===de.BindingScopeEnum.Request;if(Ct&&Pt.activated)return Pt.cache;if(pt&&se!==null&&se.has(Pt.id))return se.get(Pt.id);if(Pt.type===de.BindingTypeEnum.ConstantValue)Nt=Pt.cache,Pt.activated=!0;else if(Pt.type===de.BindingTypeEnum.Function)Nt=Pt.cache,Pt.activated=!0;else if(Pt.type===de.BindingTypeEnum.Constructor)Nt=Pt.implementationType;else if(Pt.type===de.BindingTypeEnum.DynamicValue&&Pt.dynamicValue!==null)Nt=ue("toDynamicValue",Pt.serviceIdentifier,function(){return Pt.dynamicValue(ze.parentContext)});else if(Pt.type===de.BindingTypeEnum.Factory&&Pt.factory!==null)Nt=ue("toFactory",Pt.serviceIdentifier,function(){return Pt.factory(ze.parentContext)});else if(Pt.type===de.BindingTypeEnum.Provider&&Pt.provider!==null)Nt=ue("toProvider",Pt.serviceIdentifier,function(){return Pt.provider(ze.parentContext)});else if(Pt.type===de.BindingTypeEnum.Instance&&Pt.implementationType!==null)Nt=L.resolveInstance(Pt.implementationType,Ke,oe(se));else{var mt=ce.getServiceIdentifierAsString(ze.serviceIdentifier);throw new Error(ne.INVALID_BINDING_TYPE+" "+mt)}return typeof Pt.onActivation=="function"&&(Nt=Pt.onActivation(ze.parentContext,Nt)),Ct&&(Pt.cache=Nt,Pt.activated=!0),pt&&se!==null&&!se.has(Pt.id)&&se.set(Pt.id,Nt),Nt}};function Be(se){var ze=oe(se.plan.rootRequest.requestScope);return ze(se.plan.rootRequest)}re.resolve=Be},83366:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInSyntax=void 0;var ne=B(28421),de=B(71325),y=function(){function ce(L){this._binding=L}return ce.prototype.inRequestScope=function(){return this._binding.scope=ne.BindingScopeEnum.Request,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.inSingletonScope=function(){return this._binding.scope=ne.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.inTransientScope=function(){return this._binding.scope=ne.BindingScopeEnum.Transient,new de.BindingWhenOnSyntax(this._binding)},ce}();re.BindingInSyntax=y},99812:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInWhenOnSyntax=void 0;var ne=B(83366),de=B(51811),y=B(98370),ce=function(){function L(ue){this._binding=ue,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new de.BindingOnSyntax(this._binding),this._bindingInSyntax=new ne.BindingInSyntax(ue)}return L.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},L.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},L.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},L.prototype.when=function(ue){return this._bindingWhenSyntax.when(ue)},L.prototype.whenTargetNamed=function(ue){return this._bindingWhenSyntax.whenTargetNamed(ue)},L.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},L.prototype.whenTargetTagged=function(ue,oe){return this._bindingWhenSyntax.whenTargetTagged(ue,oe)},L.prototype.whenInjectedInto=function(ue){return this._bindingWhenSyntax.whenInjectedInto(ue)},L.prototype.whenParentNamed=function(ue){return this._bindingWhenSyntax.whenParentNamed(ue)},L.prototype.whenParentTagged=function(ue,oe){return this._bindingWhenSyntax.whenParentTagged(ue,oe)},L.prototype.whenAnyAncestorIs=function(ue){return this._bindingWhenSyntax.whenAnyAncestorIs(ue)},L.prototype.whenNoAncestorIs=function(ue){return this._bindingWhenSyntax.whenNoAncestorIs(ue)},L.prototype.whenAnyAncestorNamed=function(ue){return this._bindingWhenSyntax.whenAnyAncestorNamed(ue)},L.prototype.whenAnyAncestorTagged=function(ue,oe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ue,oe)},L.prototype.whenNoAncestorNamed=function(ue){return this._bindingWhenSyntax.whenNoAncestorNamed(ue)},L.prototype.whenNoAncestorTagged=function(ue,oe){return this._bindingWhenSyntax.whenNoAncestorTagged(ue,oe)},L.prototype.whenAnyAncestorMatches=function(ue){return this._bindingWhenSyntax.whenAnyAncestorMatches(ue)},L.prototype.whenNoAncestorMatches=function(ue){return this._bindingWhenSyntax.whenNoAncestorMatches(ue)},L.prototype.onActivation=function(ue){return this._bindingOnSyntax.onActivation(ue)},L}();re.BindingInWhenOnSyntax=ce},51811:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingOnSyntax=void 0;var ne=B(98370),de=function(){function y(ce){this._binding=ce}return y.prototype.onActivation=function(ce){return this._binding.onActivation=ce,new ne.BindingWhenSyntax(this._binding)},y}();re.BindingOnSyntax=de},51860:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingToSyntax=void 0;var ne=B(16674),de=B(28421),y=B(99812),ce=B(71325),L=function(){function ue(oe){this._binding=oe}return ue.prototype.to=function(oe){return this._binding.type=de.BindingTypeEnum.Instance,this._binding.implementationType=oe,new y.BindingInWhenOnSyntax(this._binding)},ue.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ne.INVALID_TO_SELF_VALUE);var oe=this._binding.serviceIdentifier;return this.to(oe)},ue.prototype.toConstantValue=function(oe){return this._binding.type=de.BindingTypeEnum.ConstantValue,this._binding.cache=oe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=de.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ue.prototype.toDynamicValue=function(oe){return this._binding.type=de.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=oe,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ue.prototype.toConstructor=function(oe){return this._binding.type=de.BindingTypeEnum.Constructor,this._binding.implementationType=oe,this._binding.scope=de.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ue.prototype.toFactory=function(oe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=oe,this._binding.scope=de.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ue.prototype.toFunction=function(oe){if(typeof oe!="function")throw new Error(ne.INVALID_FUNCTION_BINDING);var Be=this.toConstantValue(oe);return this._binding.type=de.BindingTypeEnum.Function,this._binding.scope=de.BindingScopeEnum.Singleton,Be},ue.prototype.toAutoFactory=function(oe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=function(Be){var se=function(){return Be.container.get(oe)};return se},this._binding.scope=de.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ue.prototype.toProvider=function(oe){return this._binding.type=de.BindingTypeEnum.Provider,this._binding.provider=oe,this._binding.scope=de.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ue.prototype.toService=function(oe){this.toDynamicValue(function(Be){return Be.container.get(oe)})},ue}();re.BindingToSyntax=L},71325:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenOnSyntax=void 0;var ne=B(51811),de=B(98370),y=function(){function ce(L){this._binding=L,this._bindingWhenSyntax=new de.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ne.BindingOnSyntax(this._binding)}return ce.prototype.when=function(L){return this._bindingWhenSyntax.when(L)},ce.prototype.whenTargetNamed=function(L){return this._bindingWhenSyntax.whenTargetNamed(L)},ce.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ce.prototype.whenTargetTagged=function(L,ue){return this._bindingWhenSyntax.whenTargetTagged(L,ue)},ce.prototype.whenInjectedInto=function(L){return this._bindingWhenSyntax.whenInjectedInto(L)},ce.prototype.whenParentNamed=function(L){return this._bindingWhenSyntax.whenParentNamed(L)},ce.prototype.whenParentTagged=function(L,ue){return this._bindingWhenSyntax.whenParentTagged(L,ue)},ce.prototype.whenAnyAncestorIs=function(L){return this._bindingWhenSyntax.whenAnyAncestorIs(L)},ce.prototype.whenNoAncestorIs=function(L){return this._bindingWhenSyntax.whenNoAncestorIs(L)},ce.prototype.whenAnyAncestorNamed=function(L){return this._bindingWhenSyntax.whenAnyAncestorNamed(L)},ce.prototype.whenAnyAncestorTagged=function(L,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(L,ue)},ce.prototype.whenNoAncestorNamed=function(L){return this._bindingWhenSyntax.whenNoAncestorNamed(L)},ce.prototype.whenNoAncestorTagged=function(L,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(L,ue)},ce.prototype.whenAnyAncestorMatches=function(L){return this._bindingWhenSyntax.whenAnyAncestorMatches(L)},ce.prototype.whenNoAncestorMatches=function(L){return this._bindingWhenSyntax.whenNoAncestorMatches(L)},ce.prototype.onActivation=function(L){return this._bindingOnSyntax.onActivation(L)},ce}();re.BindingWhenOnSyntax=y},98370:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenSyntax=void 0;var ne=B(51811),de=B(80758),y=function(){function ce(L){this._binding=L}return ce.prototype.when=function(L){return this._binding.constraint=L,new ne.BindingOnSyntax(this._binding)},ce.prototype.whenTargetNamed=function(L){return this._binding.constraint=de.namedConstraint(L),new ne.BindingOnSyntax(this._binding)},ce.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(L){var ue=L.target!==null&&!L.target.isNamed()&&!L.target.isTagged();return ue},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenTargetTagged=function(L,ue){return this._binding.constraint=de.taggedConstraint(L)(ue),new ne.BindingOnSyntax(this._binding)},ce.prototype.whenInjectedInto=function(L){return this._binding.constraint=function(ue){return de.typeConstraint(L)(ue.parentRequest)},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenParentNamed=function(L){return this._binding.constraint=function(ue){return de.namedConstraint(L)(ue.parentRequest)},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenParentTagged=function(L,ue){return this._binding.constraint=function(oe){return de.taggedConstraint(L)(ue)(oe.parentRequest)},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorIs=function(L){return this._binding.constraint=function(ue){return de.traverseAncerstors(ue,de.typeConstraint(L))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorIs=function(L){return this._binding.constraint=function(ue){return!de.traverseAncerstors(ue,de.typeConstraint(L))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorNamed=function(L){return this._binding.constraint=function(ue){return de.traverseAncerstors(ue,de.namedConstraint(L))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorNamed=function(L){return this._binding.constraint=function(ue){return!de.traverseAncerstors(ue,de.namedConstraint(L))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorTagged=function(L,ue){return this._binding.constraint=function(oe){return de.traverseAncerstors(oe,de.taggedConstraint(L)(ue))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorTagged=function(L,ue){return this._binding.constraint=function(oe){return!de.traverseAncerstors(oe,de.taggedConstraint(L)(ue))},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorMatches=function(L){return this._binding.constraint=function(ue){return de.traverseAncerstors(ue,L)},new ne.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorMatches=function(L){return this._binding.constraint=function(ue){return!de.traverseAncerstors(ue,L)},new ne.BindingOnSyntax(this._binding)},ce}();re.BindingWhenSyntax=y},80758:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.typeConstraint=re.namedConstraint=re.taggedConstraint=re.traverseAncerstors=void 0;var ne=B(6867),de=B(47738),y=function(oe,Be){var se=oe.parentRequest;return se!==null?Be(se)?!0:y(se,Be):!1};re.traverseAncerstors=y;var ce=function(oe){return function(Be){var se=function(ze){return ze!==null&&ze.target!==null&&ze.target.matchesTag(oe)(Be)};return se.metaData=new de.Metadata(oe,Be),se}};re.taggedConstraint=ce;var L=ce(ne.NAMED_TAG);re.namedConstraint=L;var ue=function(oe){return function(Be){var se=null;if(Be!==null)if(se=Be.bindings[0],typeof oe=="string"){var ze=se.serviceIdentifier;return ze===oe}else{var Ge=Be.bindings[0].implementationType;return oe===Ge}return!1}};re.typeConstraint=ue},70600:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiBindToService=void 0;var B=function(ne){return function(de){return function(){for(var y=[],ce=0;ce<arguments.length;ce++)y[ce]=arguments[ce];return y.forEach(function(L){return ne.bind(L).toService(de)})}}};re.multiBindToService=B},54623:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.isStackOverflowExeption=void 0;var ne=B(16674);function de(y){return y instanceof RangeError||y.message===ne.STACK_OVERFLOW}re.isStackOverflowExeption=de},37791:function(Ht,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.id=void 0;var B=0;function ne(){return B++}re.id=ne},55800:function(Ht,re,B){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.circularDependencyToException=re.listMetadataForTarget=re.listRegisteredBindingsForServiceIdentifier=re.getServiceIdentifierAsString=re.getFunctionName=void 0;var ne=B(16674);function de(se){if(typeof se=="function"){var ze=se;return ze.name}else{if(typeof se=="symbol")return se.toString();var ze=se;return ze}}re.getServiceIdentifierAsString=de;function y(se,ze,Ge){var Ke="",Rt=Ge(se,ze);return Rt.length!==0&&(Ke=`
Registered bindings:`,Rt.forEach(function(St){var Nt="Object";St.implementationType!==null&&(Nt=Be(St.implementationType)),Ke=Ke+`
 `+Nt,St.constraint.metaData&&(Ke=Ke+" - "+St.constraint.metaData)})),Ke}re.listRegisteredBindingsForServiceIdentifier=y;function ce(se,ze){return se.parentRequest===null?!1:se.parentRequest.serviceIdentifier===ze?!0:ce(se.parentRequest,ze)}function L(se){function ze(Ke,Rt){Rt===void 0&&(Rt=[]);var St=de(Ke.serviceIdentifier);return Rt.push(St),Ke.parentRequest!==null?ze(Ke.parentRequest,Rt):Rt}var Ge=ze(se);return Ge.reverse().join(" --> ")}function ue(se){se.childRequests.forEach(function(ze){if(ce(ze,ze.serviceIdentifier)){var Ge=L(ze);throw new Error(ne.CIRCULAR_DEPENDENCY+" "+Ge)}else ue(ze)})}re.circularDependencyToException=ue;function oe(se,ze){if(ze.isTagged()||ze.isNamed()){var Ge="",Ke=ze.getNamedTag(),Rt=ze.getCustomTags();return Ke!==null&&(Ge+=Ke.toString()+`
`),Rt!==null&&Rt.forEach(function(St){Ge+=St.toString()+`
`})," "+se+`
 `+se+" - "+Ge}else return" "+se}re.listMetadataForTarget=oe;function Be(se){if(se.name)return se.name;var ze=se.toString(),Ge=ze.match(/^function\s*([^\s(]+)/);return Ge?Ge[1]:"Anonymous function: "+ze}re.getFunctionName=Be},47443:function(Ht,re,B){var ne=B(42118);function de(y,ce){var L=y==null?0:y.length;return!!L&&ne(y,ce,0)>-1}Ht.exports=de},1196:function(Ht){function re(B,ne,de){for(var y=-1,ce=B==null?0:B.length;++y<ce;)if(de(ne,B[y]))return!0;return!1}Ht.exports=re},29750:function(Ht){function re(B,ne,de){return B===B&&(de!==void 0&&(B=B<=de?B:de),ne!==void 0&&(B=B>=ne?B:ne)),B}Ht.exports=re},41848:function(Ht){function re(B,ne,de,y){for(var ce=B.length,L=de+(y?1:-1);y?L--:++L<ce;)if(ne(B[L],L,B))return L;return-1}Ht.exports=re},42118:function(Ht,re,B){var ne=B(41848),de=B(62722),y=B(39375);function ce(L,ue,oe){return ue===ue?y(L,ue,oe):ne(L,de,oe)}Ht.exports=ce},74221:function(Ht){function re(B,ne,de,y){for(var ce=de-1,L=B.length;++ce<L;)if(y(B[ce],ne))return ce;return-1}Ht.exports=re},62722:function(Ht){function re(B){return B!==B}Ht.exports=re},65464:function(Ht,re,B){var ne=B(29932),de=B(42118),y=B(74221),ce=B(51717),L=B(6450),ue=Array.prototype,oe=ue.splice;function Be(se,ze,Ge,Ke){var Rt=Ke?y:de,St=-1,Nt=ze.length,Pt=se;for(se===ze&&(ze=L(ze)),Ge&&(Pt=ne(se,ce(Ge)));++St<Nt;)for(var Ct=0,pt=ze[St],mt=Ge?Ge(pt):pt;(Ct=Rt(Pt,mt,Ct,Ke))>-1;)Pt!==se&&oe.call(Pt,Ct,1),oe.call(se,Ct,1);return se}Ht.exports=Be},45652:function(Ht,re,B){var ne=B(88668),de=B(47443),y=B(1196),ce=B(74757),L=B(23593),ue=B(21814),oe=200;function Be(se,ze,Ge){var Ke=-1,Rt=de,St=se.length,Nt=!0,Pt=[],Ct=Pt;if(Ge)Nt=!1,Rt=y;else if(St>=oe){var pt=ze?null:L(se);if(pt)return ue(pt);Nt=!1,Rt=ce,Ct=new ne}else Ct=ze?[]:Pt;e:for(;++Ke<St;){var mt=se[Ke],pr=ze?ze(mt):mt;if(mt=Ge||mt!==0?mt:0,Nt&&pr===pr){for(var gr=Ct.length;gr--;)if(Ct[gr]===pr)continue e;ze&&Ct.push(pr),Pt.push(mt)}else Rt(Ct,pr,Ge)||(Ct!==Pt&&Ct.push(pr),Pt.push(mt))}return Pt}Ht.exports=Be},23593:function(Ht,re,B){var ne=B(58525),de=B(28117),y=B(21814),ce=1/0,L=ne&&1/y(new ne([,-0]))[1]==ce?function(ue){return new ne(ue)}:de;Ht.exports=L},39375:function(Ht){function re(B,ne,de){for(var y=de-1,ce=B.length;++y<ce;)if(B[y]===ne)return y;return-1}Ht.exports=re},74691:function(Ht,re,B){var ne=B(29750),de=B(14841);function y(ce,L,ue){return ue===void 0&&(ue=L,L=void 0),ue!==void 0&&(ue=de(ue),ue=ue===ue?ue:0),L!==void 0&&(L=de(L),L=L===L?L:0),ne(de(ce),L,ue)}Ht.exports=y},51584:function(Ht,re,B){var ne=B(44239),de=B(37005),y="[object Boolean]";function ce(L){return L===!0||L===!1||de(L)&&ne(L)==y}Ht.exports=ce},18446:function(Ht,re,B){var ne=B(90939);function de(y,ce){return ne(y,ce)}Ht.exports=de},14293:function(Ht){function re(B){return B==null}Ht.exports=re},81763:function(Ht,re,B){var ne=B(44239),de=B(37005),y="[object Number]";function ce(L){return typeof L=="number"||de(L)&&ne(L)==y}Ht.exports=ce},52353:function(Ht){function re(B){return B===void 0}Ht.exports=re},30236:function(Ht,re,B){var ne=B(42980),de=B(21463),y=de(function(ce,L,ue,oe){ne(ce,L,ue,oe)});Ht.exports=y},28117:function(Ht){function re(){}Ht.exports=re},97019:function(Ht,re,B){var ne=B(5976),de=B(45604),y=ne(de);Ht.exports=y},45604:function(Ht,re,B){var ne=B(65464);function de(y,ce){return y&&y.length&&ce&&ce.length?ne(y,ce):y}Ht.exports=de},44908:function(Ht,re,B){var ne=B(45652);function de(y){return y&&y.length?ne(y):[]}Ht.exports=de},6158:function(Ht){(function(re,B){Ht.exports=B()})(this,function(){"use strict";var re,B,ne;function de(y,ce){if(!re)re=ce;else if(!B)B=ce;else{var L="var sharedChunk = {}; ("+re+")(sharedChunk); ("+B+")(sharedChunk);",ue={};re(ue),ne=ce(ue),typeof window!="undefined"&&(ne.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}return de(["exports"],function(y){"use strict";function ce(o,u){return o(u={exports:{}},u.exports),u.exports}var L=ue;function ue(o,u,c,m){this.cx=3*o,this.bx=3*(c-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=c,this.p2y=m}ue.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},ue.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},ue.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},ue.prototype.solveCurveX=function(o,u){var c,m,b,E,T;for(u===void 0&&(u=1e-6),b=o,T=0;T<8;T++){if(E=this.sampleCurveX(b)-o,Math.abs(E)<u)return b;var M=this.sampleCurveDerivativeX(b);if(Math.abs(M)<1e-6)break;b-=E/M}if((b=o)<(c=0))return c;if(b>(m=1))return m;for(;c<m;){if(E=this.sampleCurveX(b),Math.abs(E-o)<u)return b;o>E?c=b:m=b,b=.5*(m-c)+c}return b},ue.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var oe=Be;function Be(o,u){this.x=o,this.y=u}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,c=o.y-this.y;return u*u+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),c=Math.sin(o),m=c*this.x+u*this.y;return this.x=u*this.x-c*this.y,this.y=m,this},_rotateAround:function(o,u){var c=Math.cos(o),m=Math.sin(o),b=u.y+m*(this.x-u.x)+c*(this.y-u.y);return this.x=u.x+c*(this.x-u.x)-m*(this.y-u.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(o){return o instanceof Be?o:Array.isArray(o)?new Be(o[0],o[1]):o};var se=typeof self!="undefined"?self:{},ze=Math.pow(2,53)-1;function Ge(o,u,c,m){var b=new L(o,u,c,m);return function(E){return b.solve(E)}}var Ke=Ge(.25,.1,.25,1);function Rt(o,u,c){return Math.min(c,Math.max(u,o))}function St(o,u,c){var m=c-u,b=((o-u)%m+m)%m+u;return b===u?c:b}function Nt(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,b=u;m<b.length;m+=1){var E=b[m];for(var T in E)o[T]=E[T]}return o}var Pt=1;function Ct(){return Pt++}function pt(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function mt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function pr(o,u){o.forEach(function(c){u[c]&&(u[c]=u[c].bind(u))})}function gr(o,u){return o.indexOf(u,o.length-u.length)!==-1}function lr(o,u,c){var m={};for(var b in o)m[b]=u.call(c||this,o[b],b,o);return m}function ut(o,u,c){var m={};for(var b in o)u.call(c||this,o[b],b,o)&&(m[b]=o[b]);return m}function we(o){return Array.isArray(o)?o.map(we):typeof o=="object"&&o?lr(o,we):o}var At={};function Fe(o){At[o]||(typeof console!="undefined"&&console.warn(o),At[o]=!0)}function Zt(o,u,c){return(c.y-o.y)*(u.x-o.x)>(u.y-o.y)*(c.x-o.x)}function vr(o){for(var u=0,c=0,m=o.length,b=m-1,E=void 0,T=void 0;c<m;b=c++)u+=((T=o[b]).x-(E=o[c]).x)*(E.y+T.y);return u}function ee(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function V(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,b,E,T){var M=E||T;return u[b]=!M||M.toLowerCase(),""}),u["max-age"]){var c=parseInt(u["max-age"],10);isNaN(c)?delete u["max-age"]:u["max-age"]=c}return u}var Q=null;function Re(o){if(Q==null){var u=o.navigator?o.navigator.userAgent:null;Q=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Q}function xe(o){try{var u=se[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var nt,Le,Ye,rt,Tt=se.performance&&se.performance.now?se.performance.now.bind(se.performance):Date.now.bind(Date),dr=se.requestAnimationFrame||se.mozRequestAnimationFrame||se.webkitRequestAnimationFrame||se.msRequestAnimationFrame,Ot=se.cancelAnimationFrame||se.mozCancelAnimationFrame||se.webkitCancelAnimationFrame||se.msCancelAnimationFrame,Vr={now:Tt,frame:function(o){var u=dr(o);return{cancel:function(){return Ot(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var c=se.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=o.width,c.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return nt||(nt=se.document.createElement("a")),nt.href=o,nt.href},hardwareConcurrency:se.navigator&&se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return se.devicePixelRatio},get prefersReducedMotion(){return!!se.matchMedia&&(Le==null&&(Le=se.matchMedia("(prefers-reduced-motion: reduce)")),Le.matches)}},Kr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Or={supported:!1,testSupport:function(o){!In&&rt&&(gn?nn(o):Ye=o)}},In=!1,gn=!1;function nn(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,rt),o.isContextLost())return;Or.supported=!0}catch(c){}o.deleteTexture(u),In=!0}se.document&&((rt=se.document.createElement("img")).onload=function(){Ye&&nn(Ye),Ye=null,gn=!0},rt.onerror=function(){In=!0,Ye=null},rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var fi="01",Lr=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function Vn(o){return o.indexOf("mapbox:")===0}Lr.prototype._createSkuToken=function(){var o=function(){for(var u="",c=0;c<10;c++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",fi,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},Lr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Lr.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},Lr.prototype.normalizeStyleURL=function(o,u){if(!Vn(o))return o;var c=xi(o);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeGlyphsURL=function(o,u){if(!Vn(o))return o;var c=xi(o);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeSourceURL=function(o,u){if(!Vn(o))return o;var c=xi(o);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeSpriteURL=function(o,u,c,m){var b=xi(o);return Vn(o)?(b.path="/styles/v1"+b.path+"/sprite"+u+c,this._makeAPIURL(b,this._customAccessToken||m)):(b.path+=""+u+c,ia(b))},Lr.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Vn(o))return o;var c=xi(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vr.devicePixelRatio>=2||u===512?"@2x":"")+(Or.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(b){for(var E=0,T=b;E<T.length;E+=1){var M=T[E].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||Kr.ACCESS_TOKEN;return Kr.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Lr.prototype.canonicalizeTileURL=function(o,u){var c=xi(o);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var b=c.params;return u&&(b=b.filter(function(E){return!E.match(/^access_token=/)})),b.length&&(m+="?"+b.join("&")),m},Lr.prototype.canonicalizeTileset=function(o,u){for(var c=!!u&&Vn(u),m=[],b=0,E=o.tiles||[];b<E.length;b+=1){var T=E[b];hn(T)?m.push(this.canonicalizeTileURL(T,c)):m.push(T)}return m},Lr.prototype._makeAPIURL=function(o,u){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=xi(Kr.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var b=o.params.indexOf("secure");b>=0&&o.params.splice(b,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!Kr.REQUIRE_ACCESS_TOKEN)return ia(o);if(!(u=u||Kr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),ia(o)};var Hr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function hn(o){return Hr.test(o)}var qi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xi(o){var u=o.match(qi);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function ia(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function ea(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(se.atob(u[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var be=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};be.prototype.getStorageKey=function(o){var u,c=ea(Kr.ACCESS_TOKEN);return u=c&&c.u?se.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,b){return String.fromCharCode(+("0x"+b))})):Kr.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},be.prototype.fetchEventData=function(){var o=xe("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{var m=se.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var b=se.localStorage.getItem(c);b&&(this.anonId=b)}catch(E){Fe("Unable to read from LocalStorage")}},be.prototype.saveEventData=function(){var o=xe("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{se.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&se.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){Fe("Unable to write to LocalStorage")}},be.prototype.processRequests=function(o){},be.prototype.postEvent=function(o,u,c,m){var b=this;if(Kr.EVENTS_URL){var E=xi(Kr.EVENTS_URL);E.params.push("access_token="+(m||Kr.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:fi,userId:this.anonId},M=u?Nt(T,u):T,D={url:ia(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=yt(D,function(H){b.pendingRequest=null,c(H),b.saveEventData(),b.processRequests(m)})}},be.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var Fi,aa,va=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(c,m,b,E){this.skuToken=b;var T=!(!E&&!Kr.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(D){return Vn(D)||hn(D)});Kr.EVENTS_URL&&T&&M&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),E=b.id,T=b.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),mt(this.anonId)||(this.anonId=pt()),this.postEvent(T,{skuToken:this.skuToken},function(M){M||E&&(m.success[E]=!0)},c))}},u}(be),oo=new(function(o){function u(c){o.call(this,"appUserTurnstile"),this._customAccessToken=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(c,m){Kr.EVENTS_URL&&Kr.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(b){return Vn(b)||hn(b)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=ea(Kr.ACCESS_TOKEN),E=b?b.u:Kr.ACCESS_TOKEN,T=E!==this.eventData.tokenU;mt(this.anonId)||(this.anonId=pt(),T=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),H=new Date(M),q=(M-this.eventData.lastSuccess)/864e5;T=T||q>=1||q<-1||D.getDate()!==H.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(K){K||(m.eventData.lastSuccess=M,m.eventData.tokenU=E)},c)}},u}(be)),po=oo.postTurnstileEvent.bind(oo),Mo=new va,Gt=Mo.postMapLoadEvent.bind(Mo),_r=500,Gr=50;function rn(){se.caches&&!Fi&&(Fi=se.caches.open("mapbox-tiles"))}function yn(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Ti,fe=1/0;function k(){return Ti==null&&(Ti=se.OffscreenCanvas&&new se.OffscreenCanvas(1,1).getContext("2d")&&typeof se.createImageBitmap=="function"),Ti}var z={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(z);var le=function(o){function u(c,m,b){m===401&&hn(b)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,c),this.status=m,this.url=b,this.name=this.constructor.name,this.message=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),Se=ee()?function(){return self.worker&&self.worker.referrer}:function(){return(se.location.protocol==="blob:"?se.parent:se).location.href},De,$t,Dt=function(o,u){if(!(/^file:/.test(c=o.url)||/^file:/.test(Se())&&!/^\w+:/.test(c))){if(se.fetch&&se.Request&&se.AbortController&&se.Request.prototype.hasOwnProperty("signal"))return function(m,b){var E,T=new se.AbortController,M=new se.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Se(),signal:T.signal}),D=!1,H=!1,q=(E=M.url).indexOf("sku=")>0&&hn(E);m.type==="json"&&M.headers.set("Accept","application/json");var K=function(me,je,He){if(!H){if(me&&me.message!=="SecurityError"&&Fe(me),je&&He)return he(je);var dt=Date.now();se.fetch(M).then(function(ot){if(ot.ok){var kt=q?ot.clone():null;return he(ot,kt,dt)}return b(new le(ot.statusText,ot.status,m.url))}).catch(function(ot){ot.code!==20&&b(new Error(ot.message))})}},he=function(me,je,He){(m.type==="arrayBuffer"?me.arrayBuffer():m.type==="json"?me.json():me.text()).then(function(dt){H||(je&&He&&function(ot,kt,jt){if(rn(),Fi){var ar={status:kt.status,statusText:kt.statusText,headers:new se.Headers};kt.headers.forEach(function(br,Nr){return ar.headers.set(Nr,br)});var sr=V(kt.headers.get("Cache-Control")||"");sr["no-store"]||(sr["max-age"]&&ar.headers.set("Expires",new Date(jt+1e3*sr["max-age"]).toUTCString()),new Date(ar.headers.get("Expires")).getTime()-jt<42e4||function(br,Nr){if(aa===void 0)try{new Response(new ReadableStream),aa=!0}catch(on){aa=!1}aa?Nr(br.body):br.blob().then(Nr)}(kt,function(br){var Nr=new se.Response(br,ar);rn(),Fi&&Fi.then(function(on){return on.put(yn(ot.url),Nr)}).catch(function(on){return Fe(on.message)})}))}}(M,je,He),D=!0,b(null,dt,me.headers.get("Cache-Control"),me.headers.get("Expires")))}).catch(function(dt){H||b(new Error(dt.message))})};return q?function(me,je){if(rn(),!Fi)return je(null);var He=yn(me.url);Fi.then(function(dt){dt.match(He).then(function(ot){var kt=function(jt){if(!jt)return!1;var ar=new Date(jt.headers.get("Expires")||0),sr=V(jt.headers.get("Cache-Control")||"");return ar>Date.now()&&!sr["no-cache"]}(ot);dt.delete(He),kt&&dt.put(He,ot.clone()),je(null,ot,kt)}).catch(je)}).catch(je)}(M,K):K(null,null),{cancel:function(){H=!0,D||T.abort()}}}(o,u);if(ee()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var c;return function(m,b){var E=new se.XMLHttpRequest;for(var T in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){b(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var M=E.response;if(m.type==="json")try{M=JSON.parse(E.response)}catch(D){return b(D)}b(null,M,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else b(new le(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},Bt=function(o,u){return Dt(Nt(o,{type:"arrayBuffer"}),u)},yt=function(o,u){return Dt(Nt(o,{method:"POST"}),u)},U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";De=[],$t=0;var N=function(o,u){if(Or.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),$t>=Kr.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return De.push(c),c}$t++;var m=!1,b=function(){if(!m)for(m=!0,$t--;De.length&&$t<Kr.MAX_PARALLEL_IMAGE_REQUESTS;){var T=De.shift();T.cancelled||(T.cancel=N(T.requestParameters,T.callback).cancel)}},E=Bt(o,function(T,M,D,H){b(),T?u(T):M&&(k()?function(q,K){var he=new se.Blob([new Uint8Array(q)],{type:"image/png"});se.createImageBitmap(he).then(function(me){K(null,me)}).catch(function(me){K(new Error("Could not load image because of "+me.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,u):function(q,K,he,me){var je=new se.Image,He=se.URL;je.onload=function(){K(null,je),He.revokeObjectURL(je.src),je.onload=null,se.requestAnimationFrame(function(){je.src=U})},je.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var dt=new se.Blob([new Uint8Array(q)],{type:"image/png"});je.cacheControl=he,je.expires=me,je.src=q.byteLength?He.createObjectURL(dt):U}(M,u,D,H))});return{cancel:function(){E.cancel(),b()}}};function $(o,u,c){c[o]&&c[o].indexOf(u)!==-1||(c[o]=c[o]||[],c[o].push(u))}function ae(o,u,c){if(c&&c[o]){var m=c[o].indexOf(u);m!==-1&&c[o].splice(m,1)}}var Ae=function(o,u){u===void 0&&(u={}),Nt(this,u),this.type=o},Ze=function(o){function u(c,m){m===void 0&&(m={}),o.call(this,"error",Nt({error:c},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Ae),at=function(){};at.prototype.on=function(o,u){return this._listeners=this._listeners||{},$(o,u,this._listeners),this},at.prototype.off=function(o,u){return ae(o,u,this._listeners),ae(o,u,this._oneTimeListeners),this},at.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},$(o,u,this._oneTimeListeners),this},at.prototype.fire=function(o,u){typeof o=="string"&&(o=new Ae(o,u||{}));var c=o.type;if(this.listens(c)){o.target=this;for(var m=0,b=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<b.length;m+=1)b[m].call(this,o);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];E<T.length;E+=1){var M=T[E];ae(c,M,this._oneTimeListeners),M.call(this,o)}var D=this._eventedParent;D&&(Nt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(o))}else o instanceof Ze&&console.error(o.error);return this},at.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},at.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var j={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},J=function(o,u,c,m){this.message=(o?o+": ":"")+c,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function Ne(o){var u=o.value;return u?[new J(o.key,u,"constants have been deprecated as of v8")]:[]}function st(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,b=u;m<b.length;m+=1){var E=b[m];for(var T in E)o[T]=E[T]}return o}function Te(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Kt(o){if(Array.isArray(o))return o.map(Kt);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var c in o)u[c]=Kt(o[c]);return u}return Te(o)}var xr=function(o){function u(c,m){o.call(this,m),this.message=m,this.key=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),sn=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var c=0,m=u;c<m.length;c+=1){var b=m[c];this.bindings[b[0]]=b[1]}};sn.prototype.concat=function(o){return new sn(this,o)},sn.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},sn.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var un={kind:"null"},nr={kind:"number"},Qr={kind:"string"},Wr={kind:"boolean"},$r={kind:"color"},ii={kind:"object"},pn={kind:"value"},mi={kind:"collator"},Gi={kind:"formatted"},di={kind:"resolvedImage"};function Ui(o,u){return{kind:"array",itemType:o,N:u}}function wi(o){if(o.kind==="array"){var u=wi(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var ss=[un,nr,Qr,Wr,$r,Gi,ii,Ui(pn),di];function oa(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!oa(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var c=0,m=ss;c<m.length;c+=1)if(!oa(m[c],u))return null}}return"Expected "+wi(o)+" but found "+wi(u)+" instead."}function ka(o,u){return u.some(function(c){return c.kind===o.kind})}function Ci(o,u){return u.some(function(c){return c==="null"?o===null:c==="array"?Array.isArray(o):c==="object"?o&&!Array.isArray(o)&&typeof o=="object":c===typeof o})}var yi=ce(function(o,u){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function b(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function E(M){return(D=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:D>1?1:D;var D}function T(M,D,H){return H<0?H+=1:H>1&&(H-=1),6*H<1?M+(D-M)*H*6:2*H<1?D:3*H<2?M+(D-M)*(2/3-H)*6:M}try{u.parseCSSColor=function(M){var D,H=M.replace(/ /g,"").toLowerCase();if(H in c)return c[H].slice();if(H[0]==="#")return H.length===4?(D=parseInt(H.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:H.length===7&&(D=parseInt(H.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var q=H.indexOf("("),K=H.indexOf(")");if(q!==-1&&K+1===H.length){var he=H.substr(0,q),me=H.substr(q+1,K-(q+1)).split(","),je=1;switch(he){case"rgba":if(me.length!==4)return null;je=E(me.pop());case"rgb":return me.length!==3?null:[b(me[0]),b(me[1]),b(me[2]),je];case"hsla":if(me.length!==4)return null;je=E(me.pop());case"hsl":if(me.length!==3)return null;var He=(parseFloat(me[0])%360+360)%360/360,dt=E(me[1]),ot=E(me[2]),kt=ot<=.5?ot*(dt+1):ot+dt-ot*dt,jt=2*ot-kt;return[m(255*T(jt,kt,He+1/3)),m(255*T(jt,kt,He)),m(255*T(jt,kt,He-1/3)),je];default:return null}}return null}}catch(M){}}).parseCSSColor,Ri=function(o,u,c,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=c,this.a=m};Ri.parse=function(o){if(o){if(o instanceof Ri)return o;if(typeof o=="string"){var u=yi(o);if(u)return new Ri(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ri.prototype.toString=function(){var o=this.toArray(),u=o[1],c=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(c)+","+m+")"},Ri.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1);var Da=function(o,u,c){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Da.prototype.compare=function(o,u){return this.collator.compare(o,u)},Da.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var gu=function(o,u,c,m,b){this.text=o,this.image=u,this.scale=c,this.fontStack=m,this.textColor=b},_a=function(o){this.sections=o};_a.fromString=function(o){return new _a([new gu(o,null,null,null,null)])},_a.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},_a.factory=function(o){return o instanceof _a?o:_a.fromString(o)},_a.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},_a.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var b={};m.fontStack&&(b["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(b["font-scale"]=m.scale),m.textColor&&(b["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(b)}}return o};var Ia=function(o){this.name=o.name,this.available=o.available};function Zl(o,u,c,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,c,m]:[o,u,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function vs(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ri||o instanceof Da||o instanceof _a||o instanceof Ia)return!0;if(Array.isArray(o)){for(var u=0,c=o;u<c.length;u+=1)if(!vs(c[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!vs(o[m]))return!1;return!0}return!1}function Pa(o){if(o===null)return un;if(typeof o=="string")return Qr;if(typeof o=="boolean")return Wr;if(typeof o=="number")return nr;if(o instanceof Ri)return $r;if(o instanceof Da)return mi;if(o instanceof _a)return Gi;if(o instanceof Ia)return di;if(Array.isArray(o)){for(var u,c=o.length,m=0,b=o;m<b.length;m+=1){var E=Pa(b[m]);if(u){if(u===E)continue;u=pn;break}u=E}return Ui(u||pn,c)}return ii}function _i(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ri||o instanceof _a||o instanceof Ia?o.toString():JSON.stringify(o)}Ia.prototype.toString=function(){return this.name},Ia.fromString=function(o){return o?new Ia({name:o,available:!1}):null},Ia.prototype.serialize=function(){return["image",this.name]};var La=function(o,u){this.type=o,this.value=u};La.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!vs(o[1]))return u.error("invalid value");var c=o[1],m=Pa(c),b=u.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new La(m,c)},La.prototype.evaluate=function(){return this.value},La.prototype.eachChild=function(){},La.prototype.outputDefined=function(){return!0},La.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ri?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value};var fa=function(o){this.name="ExpressionEvaluationError",this.message=o};fa.prototype.toJSON=function(){return this.message};var Ho={string:Qr,number:nr,boolean:Wr,object:ii},ga=function(o,u){this.type=o,this.args=u};ga.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c,m=1,b=o[0];if(b==="array"){var E,T;if(o.length>2){var M=o[1];if(typeof M!="string"||!(M in Ho)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ho[M],m++}else E=pn;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}c=Ui(E,T)}else c=Ho[b];for(var D=[];m<o.length;m++){var H=u.parse(o[m],m,pn);if(!H)return null;D.push(H)}return new ga(c,D)},ga.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var c=this.args[u].evaluate(o);if(!oa(this.type,Pa(c)))return c;if(u===this.args.length-1)throw new fa("Expected value to be of type "+wi(this.type)+", but found "+wi(Pa(c))+" instead.")}return null},ga.prototype.eachChild=function(o){this.args.forEach(o)},ga.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},ga.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var c=o.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){u.push(c.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(b){return b.serialize()}))};var us=function(o){this.type=Gi,this.sections=o};us.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[1];if(!Array.isArray(c)&&typeof c=="object")return u.error("First argument must be an image or text section.");for(var m=[],b=!1,E=1;E<=o.length-1;++E){var T=o[E];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;var M=null;if(T["font-scale"]&&!(M=u.parse(T["font-scale"],1,nr)))return null;var D=null;if(T["text-font"]&&!(D=u.parse(T["text-font"],1,Ui(Qr))))return null;var H=null;if(T["text-color"]&&!(H=u.parse(T["text-color"],1,$r)))return null;var q=m[m.length-1];q.scale=M,q.font=D,q.textColor=H}else{var K=u.parse(o[E],1,pn);if(!K)return null;var he=K.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:K,scale:null,font:null,textColor:null})}}return new us(m)},us.prototype.evaluate=function(o){return new _a(this.sections.map(function(u){var c=u.content.evaluate(o);return Pa(c)===di?new gu("",c,null,null,null):new gu(_i(c),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},us.prototype.eachChild=function(o){for(var u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o.push(m.content.serialize());var b={};m.scale&&(b["font-scale"]=m.scale.serialize()),m.font&&(b["text-font"]=m.font.serialize()),m.textColor&&(b["text-color"]=m.textColor.serialize()),o.push(b)}return o};var Qo=function(o){this.type=di,this.input=o};Qo.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var c=u.parse(o[1],1,Qr);return c?new Qo(c):u.error("No image name provided.")},Qo.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=Ia.fromString(u);return c&&o.availableImages&&(c.available=o.availableImages.indexOf(u)>-1),c},Qo.prototype.eachChild=function(o){o(this.input)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){return["image",this.input.serialize()]};var Lu={"to-boolean":Wr,"to-color":$r,"to-number":nr,"to-string":Qr},ms=function(o,u){this.type=o,this.args=u};ms.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[0];if((c==="to-boolean"||c==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Lu[c],b=[],E=1;E<o.length;E++){var T=u.parse(o[E],E,pn);if(!T)return null;b.push(T)}return new ms(m,b)},ms.prototype.evaluate=function(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){for(var u,c,m=0,b=this.args;m<b.length;m+=1){if(c=null,(u=b[m].evaluate(o))instanceof Ri)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(c=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Zl(u[0],u[1],u[2],u[3])))return new Ri(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new fa(c||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,M=0,D=this.args;M<D.length;M+=1){if((T=D[M].evaluate(o))===null)return 0;var H=Number(T);if(!isNaN(H))return H}throw new fa("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?_a.fromString(_i(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ia.fromString(_i(this.args[0].evaluate(o))):_i(this.args[0].evaluate(o))},ms.prototype.eachChild=function(o){this.args.forEach(o)},ms.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},ms.prototype.serialize=function(){if(this.type.kind==="formatted")return new us([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qo(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var gc=["Unknown","Point","LineString","Polygon"],wa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};wa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},wa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?gc[this.feature.type]:this.feature.type:null},wa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},wa.prototype.canonicalID=function(){return this.canonical},wa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},wa.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ri.parse(o)),u};var sa=function(o,u,c,m){this.name=o,this.type=u,this._evaluate=c,this.args=m};sa.prototype.evaluate=function(o){return this._evaluate(o,this.args)},sa.prototype.eachChild=function(o){this.args.forEach(o)},sa.prototype.outputDefined=function(){return!1},sa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},sa.parse=function(o,u){var c,m=o[0],b=sa.definitions[m];if(!b)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=T.filter(function(Wn){var Sn=Wn[0];return!Array.isArray(Sn)||Sn.length===o.length-1}),D=null,H=0,q=M;H<q.length;H+=1){var K=q[H],he=K[0],me=K[1];D=new Qu(u.registry,u.path,null,u.scope);for(var je=[],He=!1,dt=1;dt<o.length;dt++){var ot=o[dt],kt=Array.isArray(he)?he[dt-1]:he.type,jt=D.parse(ot,1+je.length,kt);if(!jt){He=!0;break}je.push(jt)}if(!He)if(Array.isArray(he)&&he.length!==je.length)D.error("Expected "+he.length+" arguments, but found "+je.length+" instead.");else{for(var ar=0;ar<je.length;ar++){var sr=Array.isArray(he)?he[ar]:he.type,br=je[ar];D.concat(ar+1).checkSubtype(sr,br.type)}if(D.errors.length===0)return new sa(m,E,me,je)}}if(M.length===1)(c=u.errors).push.apply(c,D.errors);else{for(var Nr=(M.length?M:T).map(function(Wn){var Sn;return Sn=Wn[0],Array.isArray(Sn)?"("+Sn.map(wi).join(", ")+")":"("+wi(Sn.type)+"...)"}).join(" | "),on=[],Zn=1;Zn<o.length;Zn++){var En=u.parse(o[Zn],1+on.length);if(!En)return null;on.push(wi(En.type))}u.error("Expected arguments of type "+Nr+", but found ("+on.join(", ")+") instead.")}return null},sa.register=function(o,u){for(var c in sa.definitions=u,u)o[c]=sa};var er=function(o,u,c){this.type=mi,this.locale=c,this.caseSensitive=o,this.diacriticSensitive=u};function Cn(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function _e(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function ke(o,u){var c=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,b=Math.pow(2,u.z);return[Math.round(c*b*8192),Math.round(m*b*8192)]}function bt(o,u,c){return u[1]>o[1]!=c[1]>o[1]&&o[0]<(c[0]-u[0])*(o[1]-u[1])/(c[1]-u[1])+u[0]}function cr(o,u){for(var c,m,b,E,T,M,D,H=!1,q=0,K=u.length;q<K;q++)for(var he=u[q],me=0,je=he.length;me<je-1;me++){if((E=(c=o)[0]-(m=he[me])[0])*(D=c[1]-(b=he[me+1])[1])-(M=c[0]-b[0])*(T=c[1]-m[1])==0&&E*M<=0&&T*D<=0)return!1;bt(o,he[me],he[me+1])&&(H=!H)}return H}function tn(o,u){for(var c=0;c<u.length;c++)if(cr(o,u[c]))return!0;return!1}function Bn(o,u,c,m){var b=m[0]-c[0],E=m[1]-c[1],T=(o[0]-c[0])*E-b*(o[1]-c[1]),M=(u[0]-c[0])*E-b*(u[1]-c[1]);return T>0&&M<0||T<0&&M>0}function Xi(o,u,c){for(var m=0,b=c;m<b.length;m+=1)for(var E=b[m],T=0;T<E.length-1;++T)if((K=[(q=E[T+1])[0]-(H=E[T])[0],q[1]-H[1]])[0]*(he=[(D=u)[0]-(M=o)[0],D[1]-M[1]])[1]-K[1]*he[0]!=0&&Bn(M,D,H,q)&&Bn(H,q,M,D))return!0;var M,D,H,q,K,he;return!1}function yo(o,u){for(var c=0;c<o.length;++c)if(!cr(o[c],u))return!1;for(var m=0;m<o.length-1;++m)if(Xi(o[m],o[m+1],u))return!1;return!0}function Io(o,u){for(var c=0;c<u.length;c++)if(yo(o,u[c]))return!0;return!1}function vo(o,u,c){for(var m=[],b=0;b<o.length;b++){for(var E=[],T=0;T<o[b].length;T++){var M=ke(o[b][T],c);Cn(u,M),E.push(M)}m.push(E)}return m}function Ds(o,u,c){for(var m=[],b=0;b<o.length;b++){var E=vo(o[b],u,c);m.push(E)}return m}function Ms(o,u,c,m){if(o[0]<c[0]||o[0]>c[2]){var b=.5*m,E=o[0]-c[0]>b?-m:c[0]-o[0]>b?m:0;E===0&&(E=o[0]-c[2]>b?-m:c[2]-o[0]>b?m:0),o[0]+=E}Cn(u,o)}function tp(o,u,c,m){for(var b=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],T=[],M=0,D=o;M<D.length;M+=1)for(var H=0,q=D[M];H<q.length;H+=1){var K=q[H],he=[K.x+E[0],K.y+E[1]];Ms(he,u,c,b),T.push(he)}return T}function Tf(o,u,c,m){for(var b,E=8192*Math.pow(2,m.z),T=[8192*m.x,8192*m.y],M=[],D=0,H=o;D<H.length;D+=1){for(var q=[],K=0,he=H[D];K<he.length;K+=1){var me=he[K],je=[me.x+T[0],me.y+T[1]];Cn(u,je),q.push(je)}M.push(q)}if(u[2]-u[0]<=E/2){(b=u)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(var He=0,dt=M;He<dt.length;He+=1)for(var ot=0,kt=dt[He];ot<kt.length;ot+=1)Ms(kt[ot],u,c,E)}return M}er.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var c=o[1];if(typeof c!="object"||Array.isArray(c))return u.error("Collator options argument must be an object.");var m=u.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Wr);if(!m)return null;var b=u.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Wr);if(!b)return null;var E=null;return c.locale&&!(E=u.parse(c.locale,1,Qr))?null:new er(m,b,E)},er.prototype.evaluate=function(o){return new Da(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},er.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},er.prototype.outputDefined=function(){return!1},er.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Jo=function(o,u){this.type=Wr,this.geojson=o,this.geometries=u};function xl(o){if(o instanceof sa&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Jo)return!1;var u=!0;return o.eachChild(function(c){u&&!xl(c)&&(u=!1)}),u}function El(o){if(o instanceof sa&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(c){u&&!El(c)&&(u=!1)}),u}function Bu(o,u){if(o instanceof sa&&u.indexOf(o.name)>=0)return!1;var c=!0;return o.eachChild(function(m){c&&!Bu(m,u)&&(c=!1)}),c}Jo.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(vs(o[1])){var c=o[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var b=c.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Jo(c,c.features[m].geometry)}else if(c.type==="Feature"){var E=c.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Jo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Jo(c,c)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Jo.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=vo(c.coordinates,b,E),M=tp(u.geometry(),m,b,E);if(!_e(m,b))return!1;for(var D=0,H=M;D<H.length;D+=1)if(!cr(H[D],T))return!1}if(c.type==="MultiPolygon"){var q=Ds(c.coordinates,b,E),K=tp(u.geometry(),m,b,E);if(!_e(m,b))return!1;for(var he=0,me=K;he<me.length;he+=1)if(!tn(me[he],q))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=vo(c.coordinates,b,E),M=Tf(u.geometry(),m,b,E);if(!_e(m,b))return!1;for(var D=0,H=M;D<H.length;D+=1)if(!yo(H[D],T))return!1}if(c.type==="MultiPolygon"){var q=Ds(c.coordinates,b,E),K=Tf(u.geometry(),m,b,E);if(!_e(m,b))return!1;for(var he=0,me=K;he<me.length;he+=1)if(!Io(me[he],q))return!1}return!0}(o,this.geometries)}return!1},Jo.prototype.eachChild=function(){},Jo.prototype.outputDefined=function(){return!0},Jo.prototype.serialize=function(){return["within",this.geojson]};var Fu=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};Fu.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var c=o[1];return u.scope.has(c)?new Fu(c,u.scope.get(c)):u.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Fu.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},Fu.prototype.eachChild=function(){},Fu.prototype.outputDefined=function(){return!1},Fu.prototype.serialize=function(){return["var",this.name]};var Qu=function(o,u,c,m,b){u===void 0&&(u=[]),m===void 0&&(m=new sn),b===void 0&&(b=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=b,this.expectedType=c};function Yc(o,u){for(var c,m=o.length-1,b=0,E=m,T=0;b<=E;)if((c=o[T=Math.floor((b+E)/2)])<=u){if(T===m||u<o[T+1])return T;b=T+1}else{if(!(c>u))throw new fa("Input is not a number.");E=T-1}return 0}Qu.prototype.parse=function(o,u,c,m,b){return b===void 0&&(b={}),u?this.concat(u,c,m)._parse(o,b):this._parse(o,b)},Qu.prototype._parse=function(o,u){function c(H,q,K){return K==="assert"?new ga(q,[H]):K==="coerce"?new ms(q,[H]):H}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[m];if(b){var E=b.parse(o,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,M=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else E=c(E,T,u.typeAnnotation||"coerce");else E=c(E,T,u.typeAnnotation||"assert")}if(!(E instanceof La)&&E.type.kind!=="resolvedImage"&&function H(q){if(q instanceof Fu)return H(q.boundExpression);if(q instanceof sa&&q.name==="error"||q instanceof er||q instanceof Jo)return!1;var K=q instanceof ms||q instanceof ga,he=!0;return q.eachChild(function(me){he=K?he&&H(me):he&&me instanceof La}),!!he&&xl(q)&&Bu(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var D=new wa;try{E=new La(E.type,E.evaluate(D))}catch(H){return this.error(H.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},Qu.prototype.concat=function(o,u,c){var m=typeof o=="number"?this.path.concat(o):this.path,b=c?this.scope.concat(c):this.scope;return new Qu(this.registry,m,u||null,b,this.errors)},Qu.prototype.error=function(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];var m=""+this.key+u.map(function(b){return"["+b+"]"}).join("");this.errors.push(new xr(m,o))},Qu.prototype.checkSubtype=function(o,u){var c=oa(o,u);return c&&this.error(c),c};var Ls=function(o,u,c){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,b=c;m<b.length;m+=1){var E=b[m],T=E[1];this.labels.push(E[0]),this.outputs.push(T)}};function Ja(o,u,c){return o*(1-c)+u*c}Ls.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var c=u.parse(o[1],1,nr);if(!c)return null;var m=[],b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(var E=1;E<o.length;E+=2){var T=E===1?-1/0:o[E],M=o[E+1],D=E,H=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var q=u.parse(M,H,b);if(!q)return null;b=b||q.type,m.push([T,q])}return new Ls(b,c,m)},Ls.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var b=u.length;return m>=u[b-1]?c[b-1].evaluate(o):c[Yc(u,m)].evaluate(o)},Ls.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},Ls.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Ls.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var Sl=Object.freeze({__proto__:null,number:Ja,color:function(o,u,c){return new Ri(Ja(o.r,u.r,c),Ja(o.g,u.g,c),Ja(o.b,u.b,c),Ja(o.a,u.a,c))},array:function(o,u,c){return o.map(function(m,b){return Ja(m,u[b],c)})}}),Ju=6/29*3*(6/29),wf=Math.PI/180,rp=180/Math.PI;function Cf(o){return o>.008856451679035631?Math.pow(o,1/3):o/Ju+4/29}function gh(o){return o>6/29?o*o*o:Ju*(o-4/29)}function yh(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function _h(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function np(o){var u=_h(o.r),c=_h(o.g),m=_h(o.b),b=Cf((.4124564*u+.3575761*c+.1804375*m)/.95047),E=Cf((.2126729*u+.7151522*c+.072175*m)/1);return{l:116*E-16,a:500*(b-E),b:200*(E-Cf((.0193339*u+.119192*c+.9503041*m)/1.08883)),alpha:o.a}}function ip(o){var u=(o.l+16)/116,c=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*gh(u),c=.95047*gh(c),m=1.08883*gh(m),new Ri(yh(3.2404542*c-1.5371385*u-.4985314*m),yh(-.969266*c+1.8760108*u+.041556*m),yh(.0556434*c-.2040259*u+1.0572252*m),o.alpha)}function Wp(o,u,c){var m=u-o;return o+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var qc={forward:np,reverse:ip,interpolate:function(o,u,c){return{l:Ja(o.l,u.l,c),a:Ja(o.a,u.a,c),b:Ja(o.b,u.b,c),alpha:Ja(o.alpha,u.alpha,c)}}},Nu={forward:function(o){var u=np(o),c=u.l,m=u.a,b=u.b,E=Math.atan2(b,m)*rp;return{h:E<0?E+360:E,c:Math.sqrt(m*m+b*b),l:c,alpha:o.a}},reverse:function(o){var u=o.h*wf,c=o.c;return ip({l:o.l,a:Math.cos(u)*c,b:Math.sin(u)*c,alpha:o.alpha})},interpolate:function(o,u,c){return{h:Wp(o.h,u.h,c),c:Ja(o.c,u.c,c),l:Ja(o.l,u.l,c),alpha:Ja(o.alpha,u.alpha,c)}}},ap=Object.freeze({__proto__:null,lab:qc,hcl:Nu}),es=function(o,u,c,m,b){this.type=o,this.operator=u,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var E=0,T=b;E<T.length;E+=1){var M=T[E],D=M[1];this.labels.push(M[0]),this.outputs.push(D)}};function Vl(o,u,c,m){var b=m-c,E=o-c;return b===0?0:u===1?E/b:(Math.pow(u,E)-1)/(Math.pow(u,b)-1)}es.interpolationFactor=function(o,u,c,m){var b=0;if(o.name==="exponential")b=Vl(u,o.base,c,m);else if(o.name==="linear")b=Vl(u,1,c,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;b=new L(E[0],E[1],E[2],E[3]).solve(Vl(u,1,c,m))}return b},es.parse=function(o,u){var c=o[0],m=o[1],b=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var T=m[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(dt){return typeof dt!="number"||dt<0||dt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(b=u.parse(b,2,nr)))return null;var D=[],H=null;c==="interpolate-hcl"||c==="interpolate-lab"?H=$r:u.expectedType&&u.expectedType.kind!=="value"&&(H=u.expectedType);for(var q=0;q<E.length;q+=2){var K=E[q],he=E[q+1],me=q+3,je=q+4;if(typeof K!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(D.length&&D[D.length-1][0]>=K)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);var He=u.parse(he,je,H);if(!He)return null;H=H||He.type,D.push([K,He])}return H.kind==="number"||H.kind==="color"||H.kind==="array"&&H.itemType.kind==="number"&&typeof H.N=="number"?new es(H,c,m,b,D):u.error("Type "+wi(H)+" is not interpolatable.")},es.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var b=u.length;if(m>=u[b-1])return c[b-1].evaluate(o);var E=Yc(u,m),T=es.interpolationFactor(this.interpolation,m,u[E],u[E+1]),M=c[E].evaluate(o),D=c[E+1].evaluate(o);return this.operator==="interpolate"?Sl[this.type.kind.toLowerCase()](M,D,T):this.operator==="interpolate-hcl"?Nu.reverse(Nu.interpolate(Nu.forward(M),Nu.forward(D),T)):qc.reverse(qc.interpolate(qc.forward(M),qc.forward(D),T))},es.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},es.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},es.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],c=0;c<this.labels.length;c++)u.push(this.labels[c],this.outputs[c].serialize());return u};var Al=function(o,u){this.type=o,this.args=u};Al.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var c=null,m=u.expectedType;m&&m.kind!=="value"&&(c=m);for(var b=[],E=0,T=o.slice(1);E<T.length;E+=1){var M=u.parse(T[E],1+b.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,b.push(M)}var D=m&&b.some(function(H){return oa(m,H.type)});return new Al(D?pn:c,b)},Al.prototype.evaluate=function(o){for(var u,c=null,m=0,b=0,E=this.args;b<E.length&&(m++,(c=E[b].evaluate(o))&&c instanceof Ia&&!c.available&&(u||(u=c.name),c=null,m===this.args.length&&(c=u)),c===null);b+=1);return c},Al.prototype.eachChild=function(o){this.args.forEach(o)},Al.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Al.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Ys=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};Ys.prototype.evaluate=function(o){return this.result.evaluate(o)},Ys.prototype.eachChild=function(o){for(var u=0,c=this.bindings;u<c.length;u+=1)o(c[u][1]);o(this.result)},Ys.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var c=[],m=1;m<o.length-1;m+=2){var b=o[m];if(typeof b!="string")return u.error("Expected string, but found "+typeof b+" instead.",m);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;c.push([b,E])}var T=u.parse(o[o.length-1],o.length-1,u.expectedType,c);return T?new Ys(c,T):null},Ys.prototype.outputDefined=function(){return this.result.outputDefined()},Ys.prototype.serialize=function(){for(var o=["let"],u=0,c=this.bindings;u<c.length;u+=1){var m=c[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var Tl=function(o,u,c){this.type=o,this.index=u,this.input=c};Tl.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,nr),m=u.parse(o[2],2,Ui(u.expectedType||pn));return c&&m?new Tl(m.type.itemType,c,m):null},Tl.prototype.evaluate=function(o){var u=this.index.evaluate(o),c=this.input.evaluate(o);if(u<0)throw new fa("Array index out of bounds: "+u+" < 0.");if(u>=c.length)throw new fa("Array index out of bounds: "+u+" > "+(c.length-1)+".");if(u!==Math.floor(u))throw new fa("Array index must be an integer, but found "+u+" instead.");return c[u]},Tl.prototype.eachChild=function(o){o(this.index),o(this.input)},Tl.prototype.outputDefined=function(){return!1},Tl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hi=function(o,u){this.type=Wr,this.needle=o,this.haystack=u};hi.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,pn);return c&&m?ka(c.type,[Wr,Qr,nr,un,pn])?new hi(c,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+wi(c.type)+" instead"):null},hi.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!c)return!1;if(!Ci(u,["boolean","string","number","null"]))throw new fa("Expected first argument to be of type boolean, string, number or null, but found "+wi(Pa(u))+" instead.");if(!Ci(c,["string","array"]))throw new fa("Expected second argument to be of type array or string, but found "+wi(Pa(c))+" instead.");return c.indexOf(u)>=0},hi.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},hi.prototype.outputDefined=function(){return!0},hi.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var el=function(o,u,c){this.type=nr,this.needle=o,this.haystack=u,this.fromIndex=c};el.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,pn);if(!c||!m)return null;if(!ka(c.type,[Wr,Qr,nr,un,pn]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+wi(c.type)+" instead");if(o.length===4){var b=u.parse(o[3],3,nr);return b?new el(c,m,b):null}return new el(c,m)},el.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!Ci(u,["boolean","string","number","null"]))throw new fa("Expected first argument to be of type boolean, string, number or null, but found "+wi(Pa(u))+" instead.");if(!Ci(c,["string","array"]))throw new fa("Expected second argument to be of type array or string, but found "+wi(Pa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return c.indexOf(u,m)}return c.indexOf(u)},el.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},el.prototype.outputDefined=function(){return!1},el.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Bs=function(o,u,c,m,b,E){this.inputType=o,this.type=u,this.input=c,this.cases=m,this.outputs=b,this.otherwise=E};Bs.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var c,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var b={},E=[],T=2;T<o.length-1;T+=2){var M=o[T],D=o[T+1];Array.isArray(M)||(M=[M]);var H=u.concat(T);if(M.length===0)return H.error("Expected at least one branch label.");for(var q=0,K=M;q<K.length;q+=1){var he=K[q];if(typeof he!="number"&&typeof he!="string")return H.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return H.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return H.error("Numeric branch labels must be integer values.");if(c){if(H.checkSubtype(c,Pa(he)))return null}else c=Pa(he);if(b[String(he)]!==void 0)return H.error("Branch labels must be unique.");b[String(he)]=E.length}var me=u.parse(D,T,m);if(!me)return null;m=m||me.type,E.push(me)}var je=u.parse(o[1],1,pn);if(!je)return null;var He=u.parse(o[o.length-1],o.length-1,m);return He?je.type.kind!=="value"&&u.concat(1).checkSubtype(c,je.type)?null:new Bs(c,m,je,b,E,He):null},Bs.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(Pa(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},Bs.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},Bs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},Bs.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],c=[],m={},b=0,E=Object.keys(this.cases).sort();b<E.length;b+=1){var T=E[b];(K=m[this.cases[T]])===void 0?(m[this.cases[T]]=c.length,c.push([this.cases[T],[T]])):c[K][1].push(T)}for(var M=function(me){return o.inputType.kind==="number"?Number(me):me},D=0,H=c;D<H.length;D+=1){var q=H[D],K=q[0],he=q[1];u.push(he.length===1?M(he[0]):he.map(M)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Uu=function(o,u,c){this.type=o,this.branches=u,this.otherwise=c};Uu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var c;u.expectedType&&u.expectedType.kind!=="value"&&(c=u.expectedType);for(var m=[],b=1;b<o.length-1;b+=2){var E=u.parse(o[b],b,Wr);if(!E)return null;var T=u.parse(o[b+1],b+1,c);if(!T)return null;m.push([E,T]),c=c||T.type}var M=u.parse(o[o.length-1],o.length-1,c);return M?new Uu(c,m,M):null},Uu.prototype.evaluate=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],b=m[1];if(m[0].evaluate(o))return b.evaluate(o)}return this.otherwise.evaluate(o)},Uu.prototype.eachChild=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],b=m[1];o(m[0]),o(b)}o(this.otherwise)},Uu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},Uu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var tl=function(o,u,c,m){this.type=o,this.input=u,this.beginIndex=c,this.endIndex=m};function op(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function ta(o,u,c,m){return m.compare(u,c)===0}function Oi(o,u,c){var m=o!=="=="&&o!=="!=";return function(){function b(E,T,M){this.type=Wr,this.lhs=E,this.rhs=T,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return b.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var M=E[0],D=T.parse(E[1],1,pn);if(!D)return null;if(!op(M,D.type))return T.concat(1).error('"'+M+`" comparisons are not supported for type '`+wi(D.type)+"'.");var H=T.parse(E[2],2,pn);if(!H)return null;if(!op(M,H.type))return T.concat(2).error('"'+M+`" comparisons are not supported for type '`+wi(H.type)+"'.");if(D.type.kind!==H.type.kind&&D.type.kind!=="value"&&H.type.kind!=="value")return T.error("Cannot compare types '"+wi(D.type)+"' and '"+wi(H.type)+"'.");m&&(D.type.kind==="value"&&H.type.kind!=="value"?D=new ga(H.type,[D]):D.type.kind!=="value"&&H.type.kind==="value"&&(H=new ga(D.type,[H])));var q=null;if(E.length===4){if(D.type.kind!=="string"&&H.type.kind!=="string"&&D.type.kind!=="value"&&H.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!(q=T.parse(E[3],3,mi)))return null}return new b(D,H,q)},b.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var D=Pa(T),H=Pa(M);if(D.kind!==H.kind||D.kind!=="string"&&D.kind!=="number")throw new fa('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+D.kind+", "+H.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var q=Pa(T),K=Pa(M);if(q.kind!=="string"||K.kind!=="string")return u(E,T,M)}return this.collator?c(E,T,M,this.collator.evaluate(E)):u(E,T,M)},b.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},b.prototype.outputDefined=function(){return!0},b.prototype.serialize=function(){var E=[o];return this.eachChild(function(T){E.push(T.serialize())}),E},b}()}tl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,nr);if(!c||!m)return null;if(!ka(c.type,[Ui(pn),Qr,pn]))return u.error("Expected first argument to be of type array or string, but found "+wi(c.type)+" instead");if(o.length===4){var b=u.parse(o[3],3,nr);return b?new tl(c.type,c,m,b):null}return new tl(c.type,c,m)},tl.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=this.beginIndex.evaluate(o);if(!Ci(u,["string","array"]))throw new fa("Expected first argument to be of type array or string, but found "+wi(Pa(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(c,m)}return u.slice(c)},tl.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},tl.prototype.outputDefined=function(){return!1},tl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var uu=Oi("==",function(o,u,c){return u===c},ta),yu=Oi("!=",function(o,u,c){return u!==c},function(o,u,c,m){return!ta(0,u,c,m)}),Rf=Oi("<",function(o,u,c){return u<c},function(o,u,c,m){return m.compare(u,c)<0}),Wa=Oi(">",function(o,u,c){return u>c},function(o,u,c,m){return m.compare(u,c)>0}),bh=Oi("<=",function(o,u,c){return u<=c},function(o,u,c,m){return m.compare(u,c)<=0}),Mf=Oi(">=",function(o,u,c){return u>=c},function(o,u,c,m){return m.compare(u,c)>=0}),Fs=function(o,u,c,m,b){this.type=Qr,this.number=o,this.locale=u,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=b};Fs.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var c=u.parse(o[1],1,nr);if(!c)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var b=null;if(m.locale&&!(b=u.parse(m.locale,1,Qr)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,Qr)))return null;var T=null;if(m["min-fraction-digits"]&&!(T=u.parse(m["min-fraction-digits"],1,nr)))return null;var M=null;return m["max-fraction-digits"]&&!(M=u.parse(m["max-fraction-digits"],1,nr))?null:new Fs(c,b,E,T,M)},Fs.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},Fs.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},Fs.prototype.outputDefined=function(){return!1},Fs.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var rl=function(o){this.type=nr,this.input=o};rl.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+wi(c.type)+" instead."):new rl(c):null},rl.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new fa("Expected value to be of type string or array, but found "+wi(Pa(u))+" instead.")},rl.prototype.eachChild=function(o){o(this.input)},rl.prototype.outputDefined=function(){return!1},rl.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var _u={"==":uu,"!=":yu,">":Wa,"<":Rf,">=":Mf,"<=":bh,array:ga,at:Tl,boolean:ga,case:Uu,coalesce:Al,collator:er,format:us,image:Qo,in:hi,"index-of":el,interpolate:es,"interpolate-hcl":es,"interpolate-lab":es,length:rl,let:Ys,literal:La,match:Bs,number:ga,"number-format":Fs,object:ga,slice:tl,step:Ls,string:ga,"to-boolean":ms,"to-color":ms,"to-number":ms,"to-string":ms,var:Fu,within:Jo};function jl(o,u){var c=u[0],m=u[1],b=u[2],E=u[3];c=c.evaluate(o),m=m.evaluate(o),b=b.evaluate(o);var T=E?E.evaluate(o):1,M=Zl(c,m,b,T);if(M)throw new fa(M);return new Ri(c/255*T,m/255*T,b/255*T,T)}function xh(o,u){return o in u}function yc(o,u){var c=u[o];return c===void 0?null:c}function ma(o){return{type:o}}function _c(o){return{result:"success",value:o}}function nl(o){return{result:"error",value:o}}function wl(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Eh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Kc(o){return!!o.expression&&o.expression.interpolated}function ba(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Cl(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function sp(o){return o}function il(o,u,c){return o!==void 0?o:u!==void 0?u:c!==void 0?c:void 0}function Qc(o,u,c,m,b){return il(typeof c===b?m[c]:void 0,o.default,u.default)}function Jc(o,u,c){if(ba(c)!=="number")return il(o.default,u.default);var m=o.stops.length;if(m===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[m-1][0])return o.stops[m-1][1];var b=Yc(o.stops.map(function(E){return E[0]}),c);return o.stops[b][1]}function If(o,u,c){var m=o.base!==void 0?o.base:1;if(ba(c)!=="number")return il(o.default,u.default);var b=o.stops.length;if(b===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[b-1][0])return o.stops[b-1][1];var E=Yc(o.stops.map(function(K){return K[0]}),c),T=function(K,he,me,je){var He=je-me,dt=K-me;return He===0?0:he===1?dt/He:(Math.pow(he,dt)-1)/(Math.pow(he,He)-1)}(c,m,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],D=o.stops[E+1][1],H=Sl[u.type]||sp;if(o.colorSpace&&o.colorSpace!=="rgb"){var q=ap[o.colorSpace];H=function(K,he){return q.reverse(q.interpolate(q.forward(K),q.forward(he),T))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var K=[],he=arguments.length;he--;)K[he]=arguments[he];var me=M.evaluate.apply(void 0,K),je=D.evaluate.apply(void 0,K);if(me!==void 0&&je!==void 0)return H(me,je,T)}}:H(M,D,T)}function al(o,u,c){return u.type==="color"?c=Ri.parse(c):u.type==="formatted"?c=_a.fromString(c.toString()):u.type==="resolvedImage"?c=Ia.fromString(c.toString()):ba(c)===u.type||u.type==="enum"&&u.values[c]||(c=void 0),il(c,o.default,u.default)}sa.register(_u,{error:[{kind:"error"},[Qr],function(o,u){throw new fa(u[0].evaluate(o))}],typeof:[Qr,[pn],function(o,u){return wi(Pa(u[0].evaluate(o)))}],"to-rgba":[Ui(nr,4),[$r],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[$r,[nr,nr,nr],jl],rgba:[$r,[nr,nr,nr,nr],jl],has:{type:Wr,overloads:[[[Qr],function(o,u){return xh(u[0].evaluate(o),o.properties())}],[[Qr,ii],function(o,u){var c=u[1];return xh(u[0].evaluate(o),c.evaluate(o))}]]},get:{type:pn,overloads:[[[Qr],function(o,u){return yc(u[0].evaluate(o),o.properties())}],[[Qr,ii],function(o,u){var c=u[1];return yc(u[0].evaluate(o),c.evaluate(o))}]]},"feature-state":[pn,[Qr],function(o,u){return yc(u[0].evaluate(o),o.featureState||{})}],properties:[ii,[],function(o){return o.properties()}],"geometry-type":[Qr,[],function(o){return o.geometryType()}],id:[pn,[],function(o){return o.id()}],zoom:[nr,[],function(o){return o.globals.zoom}],"heatmap-density":[nr,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[nr,[],function(o){return o.globals.lineProgress||0}],accumulated:[pn,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[nr,ma(nr),function(o,u){for(var c=0,m=0,b=u;m<b.length;m+=1)c+=b[m].evaluate(o);return c}],"*":[nr,ma(nr),function(o,u){for(var c=1,m=0,b=u;m<b.length;m+=1)c*=b[m].evaluate(o);return c}],"-":{type:nr,overloads:[[[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)-c.evaluate(o)}],[[nr],function(o,u){return-u[0].evaluate(o)}]]},"/":[nr,[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)/c.evaluate(o)}],"%":[nr,[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)%c.evaluate(o)}],ln2:[nr,[],function(){return Math.LN2}],pi:[nr,[],function(){return Math.PI}],e:[nr,[],function(){return Math.E}],"^":[nr,[nr,nr],function(o,u){var c=u[1];return Math.pow(u[0].evaluate(o),c.evaluate(o))}],sqrt:[nr,[nr],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[nr,[nr],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[nr,[nr],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[nr,[nr],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[nr,[nr],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[nr,[nr],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[nr,[nr],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[nr,ma(nr),function(o,u){return Math.min.apply(Math,u.map(function(c){return c.evaluate(o)}))}],max:[nr,ma(nr),function(o,u){return Math.max.apply(Math,u.map(function(c){return c.evaluate(o)}))}],abs:[nr,[nr],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[nr,[nr],function(o,u){var c=u[0].evaluate(o);return c<0?-Math.round(-c):Math.round(c)}],floor:[nr,[nr],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[nr,[nr],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[Wr,[Qr,pn],function(o,u){var c=u[0],m=u[1];return o.properties()[c.value]===m.value}],"filter-id-==":[Wr,[pn],function(o,u){var c=u[0];return o.id()===c.value}],"filter-type-==":[Wr,[Qr],function(o,u){var c=u[0];return o.geometryType()===c.value}],"filter-<":[Wr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b<E}],"filter-id-<":[Wr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m<b}],"filter->":[Wr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b>E}],"filter-id->":[Wr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m>b}],"filter-<=":[Wr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b<=E}],"filter-id-<=":[Wr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m<=b}],"filter->=":[Wr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b>=E}],"filter-id->=":[Wr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m>=b}],"filter-has":[Wr,[pn],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[Wr,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[Wr,[Ui(Qr)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[Wr,[Ui(pn)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[Wr,[Qr,Ui(pn)],function(o,u){var c=u[0];return u[1].value.indexOf(o.properties()[c.value])>=0}],"filter-in-large":[Wr,[Qr,Ui(pn)],function(o,u){var c=u[0],m=u[1];return function(b,E,T,M){for(;T<=M;){var D=T+M>>1;if(E[D]===b)return!0;E[D]>b?M=D-1:T=D+1}return!1}(o.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Wr,overloads:[[[Wr,Wr],function(o,u){var c=u[1];return u[0].evaluate(o)&&c.evaluate(o)}],[ma(Wr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(!m[c].evaluate(o))return!1;return!0}]]},any:{type:Wr,overloads:[[[Wr,Wr],function(o,u){var c=u[1];return u[0].evaluate(o)||c.evaluate(o)}],[ma(Wr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(m[c].evaluate(o))return!0;return!1}]]},"!":[Wr,[Wr],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[Wr,[Qr],function(o,u){var c=o.globals&&o.globals.isSupportedScript;return!c||c(u[0].evaluate(o))}],upcase:[Qr,[Qr],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[Qr,[Qr],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[Qr,ma(pn),function(o,u){return u.map(function(c){return _i(c.evaluate(o))}).join("")}],"resolved-locale":[Qr,[mi],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var Hl=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new wa,this._defaultValue=u?function(c){return c.type==="color"&&Cl(c.default)?new Ri(0,0,0,0):c.type==="color"?Ri.parse(c.default)||null:c.default===void 0?null:c.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function zu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in _u}function ef(o,u){var c=new Qu(_u,[],u?function(b){var E={color:$r,string:Qr,number:nr,enum:Qr,boolean:Wr,formatted:Gi,resolvedImage:di};return b.type==="array"?Ui(E[b.value]||pn,b.length):E[b.type]}(u):void 0),m=c.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?_c(new Hl(m,u)):nl(c.errors)}Hl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Hl.prototype.evaluate=function(o,u,c,m,b,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new fa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var bc=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!El(u.expression)};bc.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,b,E)},bc.prototype.evaluate=function(o,u,c,m,b,E){return this._styleExpression.evaluate(o,u,c,m,b,E)};var Wl=function(o,u,c,m){this.kind=o,this.zoomStops=c,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!El(u.expression),this.interpolationType=m};function Sh(o,u){if((o=ef(o,u)).result==="error")return o;var c=o.value.expression,m=xl(c);if(!m&&!wl(u))return nl([new xr("","data expressions not supported")]);var b=Bu(c,["zoom"]);if(!b&&!Eh(u))return nl([new xr("","zoom expressions not supported")]);var E=function T(M){var D=null;if(M instanceof Ys)D=T(M.result);else if(M instanceof Al)for(var H=0,q=M.args;H<q.length&&!(D=T(q[H]));H+=1);else(M instanceof Ls||M instanceof es)&&M.input instanceof sa&&M.input.name==="zoom"&&(D=M);return D instanceof xr||M.eachChild(function(K){var he=T(K);he instanceof xr?D=he:!D&&he?D=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&he&&D!==he&&(D=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(c);return E||b?E instanceof xr?nl([E]):E instanceof es&&!Kc(u)?nl([new xr("",'"interpolate" expressions cannot be used with this property')]):_c(E?new Wl(m?"camera":"composite",o.value,E.labels,E instanceof es?E.interpolation:void 0):new bc(m?"constant":"source",o.value)):nl([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Wl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,b,E)},Wl.prototype.evaluate=function(o,u,c,m,b,E){return this._styleExpression.evaluate(o,u,c,m,b,E)},Wl.prototype.interpolationFactor=function(o,u,c){return this.interpolationType?es.interpolationFactor(this.interpolationType,o,u,c):0};var xc=function(o,u){this._parameters=o,this._specification=u,st(this,function c(m,b){var E,T,M,D=b.type==="color",H=m.stops&&typeof m.stops[0][0]=="object",q=H||!(H||m.property!==void 0),K=m.type||(Kc(b)?"exponential":"interval");if(D&&((m=st({},m)).stops&&(m.stops=m.stops.map(function(En){return[En[0],Ri.parse(En[1])]})),m.default=Ri.parse(m.default?m.default:b.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ap[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(K==="exponential")E=If;else if(K==="interval")E=Jc;else if(K==="categorical"){E=Qc,T=Object.create(null);for(var he=0,me=m.stops;he<me.length;he+=1){var je=me[he];T[je[0]]=je[1]}M=typeof m.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');E=al}if(H){for(var He={},dt=[],ot=0;ot<m.stops.length;ot++){var kt=m.stops[ot],jt=kt[0].zoom;He[jt]===void 0&&(He[jt]={zoom:jt,type:m.type,property:m.property,default:m.default,stops:[]},dt.push(jt)),He[jt].stops.push([kt[0].value,kt[1]])}for(var ar=[],sr=0,br=dt;sr<br.length;sr+=1){var Nr=br[sr];ar.push([He[Nr].zoom,c(He[Nr],b)])}var on={name:"linear"};return{kind:"composite",interpolationType:on,interpolationFactor:es.interpolationFactor.bind(void 0,on),zoomStops:ar.map(function(En){return En[0]}),evaluate:function(En,Wn){var Sn=En.zoom;return If({stops:ar,base:m.base},b,Sn).evaluate(Sn,Wn)}}}if(q){var Zn=K==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Zn,interpolationFactor:es.interpolationFactor.bind(void 0,Zn),zoomStops:m.stops.map(function(En){return En[0]}),evaluate:function(En){return E(m,b,En.zoom,T,M)}}}return{kind:"source",evaluate:function(En,Wn){var Sn=Wn&&Wn.properties?Wn.properties[m.property]:void 0;return Sn===void 0?il(m.default,b.default):E(m,b,Sn,T,M)}}}(this._parameters,this._specification))};function Ns(o){var u=o.key,c=o.value,m=o.valueSpec||{},b=o.objectElementValidators||{},E=o.style,T=o.styleSpec,M=[],D=ba(c);if(D!=="object")return[new J(u,c,"object expected, "+D+" found")];for(var H in c){var q=H.split(".")[0],K=m[q]||m["*"],he=void 0;if(b[q])he=b[q];else if(m[q])he=zi;else if(b["*"])he=b["*"];else{if(!m["*"]){M.push(new J(u,c[H],'unknown property "'+H+'"'));continue}he=zi}M=M.concat(he({key:(u&&u+".")+H,value:c[H],valueSpec:K,style:E,styleSpec:T,object:c,objectKey:H},c))}for(var me in m)b[me]||m[me].required&&m[me].default===void 0&&c[me]===void 0&&M.push(new J(u,c,'missing required property "'+me+'"'));return M}function Ah(o){var u=o.value,c=o.valueSpec,m=o.style,b=o.styleSpec,E=o.key,T=o.arrayElementValidator||zi;if(ba(u)!=="array")return[new J(E,u,"array expected, "+ba(u)+" found")];if(c.length&&u.length!==c.length)return[new J(E,u,"array length "+c.length+" expected, length "+u.length+" found")];if(c["min-length"]&&u.length<c["min-length"])return[new J(E,u,"array length at least "+c["min-length"]+" expected, length "+u.length+" found")];var M={type:c.value,values:c.values};b.$version<7&&(M.function=c.function),ba(c.value)==="object"&&(M=c.value);for(var D=[],H=0;H<u.length;H++)D=D.concat(T({array:u,arrayIndex:H,value:u[H],valueSpec:M,style:m,styleSpec:b,key:E+"["+H+"]"}));return D}function tf(o){var u=o.key,c=o.value,m=o.valueSpec,b=ba(c);return b==="number"&&c!=c&&(b="NaN"),b!=="number"?[new J(u,c,"number expected, "+b+" found")]:"minimum"in m&&c<m.minimum?[new J(u,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new J(u,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Ec(o){var u,c,m,b=o.valueSpec,E=Te(o.value.type),T={},M=E!=="categorical"&&o.value.property===void 0,D=!M,H=ba(o.value.stops)==="array"&&ba(o.value.stops[0])==="array"&&ba(o.value.stops[0][0])==="object",q=Ns({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(me){if(E==="identity")return[new J(me.key,me.value,'identity function may not have a "stops" property')];var je=[],He=me.value;return je=je.concat(Ah({key:me.key,value:He,valueSpec:me.valueSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:K})),ba(He)==="array"&&He.length===0&&je.push(new J(me.key,He,"array must have at least one stop")),je},default:function(me){return zi({key:me.key,value:me.value,valueSpec:b,style:me.style,styleSpec:me.styleSpec})}}});return E==="identity"&&M&&q.push(new J(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||q.push(new J(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!Kc(o.valueSpec)&&q.push(new J(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(D&&!wl(o.valueSpec)?q.push(new J(o.key,o.value,"property functions not supported")):M&&!Eh(o.valueSpec)&&q.push(new J(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!H||o.value.property!==void 0||q.push(new J(o.key,o.value,'"property" property is required')),q;function K(me){var je=[],He=me.value,dt=me.key;if(ba(He)!=="array")return[new J(dt,He,"array expected, "+ba(He)+" found")];if(He.length!==2)return[new J(dt,He,"array length 2 expected, length "+He.length+" found")];if(H){if(ba(He[0])!=="object")return[new J(dt,He,"object expected, "+ba(He[0])+" found")];if(He[0].zoom===void 0)return[new J(dt,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new J(dt,He,"object stop key must have value")];if(m&&m>Te(He[0].zoom))return[new J(dt,He[0].zoom,"stop zoom values must appear in ascending order")];Te(He[0].zoom)!==m&&(m=Te(He[0].zoom),c=void 0,T={}),je=je.concat(Ns({key:dt+"[0]",value:He[0],valueSpec:{zoom:{}},style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:tf,value:he}}))}else je=je.concat(he({key:dt+"[0]",value:He[0],valueSpec:{},style:me.style,styleSpec:me.styleSpec},He));return zu(Kt(He[1]))?je.concat([new J(dt+"[1]",He[1],"expressions are not allowed in function stops.")]):je.concat(zi({key:dt+"[1]",value:He[1],valueSpec:b,style:me.style,styleSpec:me.styleSpec}))}function he(me,je){var He=ba(me.value),dt=Te(me.value),ot=me.value!==null?me.value:je;if(u){if(He!==u)return[new J(me.key,ot,He+" stop domain type must match previous stop domain type "+u)]}else u=He;if(He!=="number"&&He!=="string"&&He!=="boolean")return[new J(me.key,ot,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&E!=="categorical"){var kt="number expected, "+He+" found";return wl(b)&&E===void 0&&(kt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new J(me.key,ot,kt)]}return E!=="categorical"||He!=="number"||isFinite(dt)&&Math.floor(dt)===dt?E!=="categorical"&&He==="number"&&c!==void 0&&dt<c?[new J(me.key,ot,"stop domain values must appear in ascending order")]:(c=dt,E==="categorical"&&dt in T?[new J(me.key,ot,"stop domain values must be unique")]:(T[dt]=!0,[])):[new J(me.key,ot,"integer expected, found "+dt)]}}function Rl(o){var u=(o.expressionContext==="property"?Sh:ef)(Kt(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new J(""+o.key+m.key,o.value,m.message)});var c=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!c.outputDefined())return[new J(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!El(c))return[new J(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!El(c))return[new J(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Bu(c,["zoom","feature-state"]))return[new J(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!xl(c))return[new J(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zu(o){var u=o.key,c=o.value,m=o.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(Te(c))===-1&&b.push(new J(u,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(Te(c))===-1&&b.push(new J(u,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),b}function Gl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,c=o.slice(1);u<c.length;u+=1){var m=c[u];if(!Gl(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}xc.deserialize=function(o){return new xc(o._parameters,o._specification)},xc.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var Pf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ol(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};Gl(o)||(o=wh(o));var u=ef(o,Pf);if(u.result==="error")throw new Error(u.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,b){return u.value.evaluate(c,m,{},b)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var b=1;b<m.length;b++)if(c(m[b]))return!0;return!1}(o)}}function Th(o,u){return o<u?-1:o>u?1:0}function wh(o){if(!o)return!0;var u,c=o[0];return o.length<=1?c!=="any":c==="=="?Ch(o[1],o[2],"=="):c==="!="?Ga(Ch(o[1],o[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Ch(o[1],o[2],c):c==="any"?(u=o.slice(1),["any"].concat(u.map(wh))):c==="all"?["all"].concat(o.slice(1).map(wh)):c==="none"?["all"].concat(o.slice(1).map(wh).map(Ga)):c==="in"?Of(o[1],o.slice(2)):c==="!in"?Ga(Of(o[1],o.slice(2))):c==="has"?up(o[1]):c==="!has"?Ga(up(o[1])):c!=="within"||o}function Ch(o,u,c){switch(o){case"$type":return["filter-type-"+c,u];case"$id":return["filter-id-"+c,u];default:return["filter-"+c,o,u]}}function Of(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(c){return typeof c!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(Th)]]:["filter-in-small",o,["literal",u]]}}function up(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ga(o){return["!",o]}function lp(o){return Gl(Kt(o.value))?Rl(st({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(c){var m=c.value,b=c.key;if(ba(m)!=="array")return[new J(b,m,"array expected, "+ba(m)+" found")];var E,T=c.styleSpec,M=[];if(m.length<1)return[new J(b,m,"filter array must have at least 1 element")];switch(M=M.concat(Zu({key:b+"[0]",value:m[0],valueSpec:T.filter_operator,style:c.style,styleSpec:c.styleSpec})),Te(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Te(m[1])==="$type"&&M.push(new J(b,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new J(b,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ba(m[1]))!=="string"&&M.push(new J(b+"[1]",m[1],"string expected, "+E+" found"));for(var D=2;D<m.length;D++)E=ba(m[D]),Te(m[1])==="$type"?M=M.concat(Zu({key:b+"["+D+"]",value:m[D],valueSpec:T.geometry_type,style:c.style,styleSpec:c.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new J(b+"["+D+"]",m[D],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var H=1;H<m.length;H++)M=M.concat(u({key:b+"["+H+"]",value:m[H],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=ba(m[1]),m.length!==2?M.push(new J(b,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&M.push(new J(b+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ba(m[1]),m.length!==2?M.push(new J(b,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&M.push(new J(b+"[1]",m[1],"object expected, "+E+" found"))}return M}(o)}function kf(o,u){var c=o.key,m=o.style,b=o.styleSpec,E=o.value,T=o.objectKey,M=b[u+"_"+o.layerType];if(!M)return[];var D=T.match(/^(.*)-transition$/);if(u==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return zi({key:c,value:E,valueSpec:b.transition,style:m,styleSpec:b});var H,q=o.valueSpec||M[T];if(!q)return[new J(c,E,'unknown property "'+T+'"')];if(ba(E)==="string"&&wl(q)&&!q.tokens&&(H=/^{([^}]+)}$/.exec(E)))return[new J(c,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(H[1])+" }`.")];var K=[];return o.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&K.push(new J(c,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Cl(Kt(E))&&Te(E.type)==="identity"&&K.push(new J(c,E,'"text-font" does not support identity functions'))),K.concat(zi({key:o.key,value:E,valueSpec:q,style:m,styleSpec:b,expressionContext:"property",propertyType:u,propertyKey:T}))}function cp(o){return kf(o,"paint")}function Xl(o){return kf(o,"layout")}function fp(o){var u=[],c=o.value,m=o.key,b=o.style,E=o.styleSpec;c.type||c.ref||u.push(new J(m,c,'either "type" or "ref" is required'));var T,M=Te(c.type),D=Te(c.ref);if(c.id)for(var H=Te(c.id),q=0;q<o.arrayIndex;q++){var K=b.layers[q];Te(K.id)===H&&u.push(new J(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+K.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(je){je in c&&u.push(new J(m,c[je],'"'+je+'" is prohibited for ref layers'))}),b.layers.forEach(function(je){Te(je.id)===D&&(T=je)}),T?T.ref?u.push(new J(m,c.ref,"ref cannot reference another ref layer")):M=Te(T.type):u.push(new J(m,c.ref,'ref layer "'+D+'" not found'));else if(M!=="background")if(c.source){var he=b.sources&&b.sources[c.source],me=he&&Te(he.type);he?me==="vector"&&M==="raster"?u.push(new J(m,c.source,'layer "'+c.id+'" requires a raster source')):me==="raster"&&M!=="raster"?u.push(new J(m,c.source,'layer "'+c.id+'" requires a vector source')):me!=="vector"||c["source-layer"]?me==="raster-dem"&&M!=="hillshade"?u.push(new J(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||me==="geojson"&&he.lineMetrics||u.push(new J(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new J(m,c,'layer "'+c.id+'" must specify a "source-layer"')):u.push(new J(m,c.source,'source "'+c.source+'" not found'))}else u.push(new J(m,c,'missing required property "source"'));return u=u.concat(Ns({key:m,value:c,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return zi({key:m+".type",value:c.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:c,objectKey:"type"})},filter:lp,layout:function(je){return Ns({layer:c,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(He){return Xl(st({layerType:M},He))}}})},paint:function(je){return Ns({layer:c,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(He){return cp(st({layerType:M},He))}}})}}}))}function Vu(o){var u=o.value,c=o.key,m=ba(u);return m!=="string"?[new J(c,u,"string expected, "+m+" found")]:[]}var Ea={promoteId:function(o){var u=o.key,c=o.value;if(ba(c)==="string")return Vu({key:u,value:c});var m=[];for(var b in c)m.push.apply(m,Vu({key:u+"."+b,value:c[b]}));return m}};function $l(o){var u=o.value,c=o.key,m=o.styleSpec,b=o.style;if(!u.type)return[new J(c,u,'"type" is required')];var E,T=Te(u.type);switch(T){case"vector":case"raster":case"raster-dem":return Ns({key:c,value:u,valueSpec:m["source_"+T.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:Ea});case"geojson":if(E=Ns({key:c,value:u,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:Ea}),u.cluster)for(var M in u.clusterProperties){var D=u.clusterProperties[M],H=D[0],q=typeof H=="string"?[H,["accumulated"],["get",M]]:H;E.push.apply(E,Rl({key:c+"."+M+".map",value:D[1],expressionContext:"cluster-map"})),E.push.apply(E,Rl({key:c+"."+M+".reduce",value:q,expressionContext:"cluster-reduce"}))}return E;case"video":return Ns({key:c,value:u,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return Ns({key:c,value:u,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new J(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zu({key:c+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:m})}}function ju(o){var u=o.value,c=o.styleSpec,m=c.light,b=o.style,E=[],T=ba(u);if(u===void 0)return E;if(T!=="object")return E.concat([new J("light",u,"object expected, "+T+" found")]);for(var M in u){var D=M.match(/^(.*)-transition$/);E=E.concat(D&&m[D[1]]&&m[D[1]].transition?zi({key:M,value:u[M],valueSpec:c.transition,style:b,styleSpec:c}):m[M]?zi({key:M,value:u[M],valueSpec:m[M],style:b,styleSpec:c}):[new J(M,u[M],'unknown property "'+M+'"')])}return E}var sl={"*":function(){return[]},array:Ah,boolean:function(o){var u=o.value,c=o.key,m=ba(u);return m!=="boolean"?[new J(c,u,"boolean expected, "+m+" found")]:[]},number:tf,color:function(o){var u=o.key,c=o.value,m=ba(c);return m!=="string"?[new J(u,c,"color expected, "+m+" found")]:yi(c)===null?[new J(u,c,'color expected, "'+c+'" found')]:[]},constants:Ne,enum:Zu,filter:lp,function:Ec,layer:fp,object:Ns,source:$l,light:ju,string:Vu,formatted:function(o){return Vu(o).length===0?[]:Rl(o)},resolvedImage:function(o){return Vu(o).length===0?[]:Rl(o)}};function zi(o){var u=o.value,c=o.valueSpec,m=o.styleSpec;return c.expression&&Cl(Te(u))?Ec(o):c.expression&&zu(Kt(u))?Rl(o):c.type&&sl[c.type]?sl[c.type](o):Ns(st({},o,{valueSpec:c.type?m[c.type]:c}))}function Sa(o){var u=o.value,c=o.key,m=Vu(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new J(c,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new J(c,u,'"glyphs" url must include a "{range}" token'))),m}function lu(o,u){u===void 0&&(u=j);var c=[];return c=c.concat(zi({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:Sa,"*":function(){return[]}}})),o.constants&&(c=c.concat(Ne({key:"constants",value:o.constants,style:o,styleSpec:u}))),rf(c)}function rf(o){return[].concat(o).sort(function(u,c){return u.line-c.line})}function nf(o){return function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return rf(o.apply(this,u))}}lu.source=nf($l),lu.light=nf(ju),lu.layer=nf(fp),lu.filter=nf(lp),lu.paintProperty=nf(cp),lu.layoutProperty=nf(Xl);var qs=lu,hp=qs.light,Df=qs.paintProperty,Lf=qs.layoutProperty;function Yl(o,u){var c=!1;if(u&&u.length)for(var m=0,b=u;m<b.length;m+=1)o.fire(new Ze(new Error(b[m].message))),c=!0;return c}var Po=Xa;function Xa(o,u,c){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var b=new Int32Array(this.arrayBuffer);o=b[0],this.d=(u=b[1])+2*(c=b[2]);for(var E=0;E<this.d*this.d;E++){var T=b[3+E],M=b[3+E+1];m.push(T===M?null:b.subarray(T,M))}var D=b[3+m.length+1];this.keys=b.subarray(b[3+m.length],D),this.bboxes=b.subarray(D),this.insert=this._insertReadonly}else{this.d=u+2*c;for(var H=0;H<this.d*this.d;H++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=c,this.scale=u/o,this.uid=0;var q=c/u*o;this.min=-q,this.max=o+q}Xa.prototype.insert=function(o,u,c,m,b){this._forEachCell(u,c,m,b,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(b)},Xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xa.prototype._insertCell=function(o,u,c,m,b,E){this.cells[b].push(E)},Xa.prototype.query=function(o,u,c,m,b){var E=this.min,T=this.max;if(o<=E&&u<=E&&T<=c&&T<=m&&!b)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,c,m,this._queryCell,M,{},b),M},Xa.prototype._queryCell=function(o,u,c,m,b,E,T,M){var D=this.cells[b];if(D!==null)for(var H=this.keys,q=this.bboxes,K=0;K<D.length;K++){var he=D[K];if(T[he]===void 0){var me=4*he;(M?M(q[me+0],q[me+1],q[me+2],q[me+3]):o<=q[me+2]&&u<=q[me+3]&&c>=q[me+0]&&m>=q[me+1])?(T[he]=!0,E.push(H[he])):T[he]=!1}}},Xa.prototype._forEachCell=function(o,u,c,m,b,E,T,M){for(var D=this._convertToCellCoord(o),H=this._convertToCellCoord(u),q=this._convertToCellCoord(c),K=this._convertToCellCoord(m),he=D;he<=q;he++)for(var me=H;me<=K;me++){var je=this.d*me+he;if((!M||M(this._convertFromCellCoord(he),this._convertFromCellCoord(me),this._convertFromCellCoord(he+1),this._convertFromCellCoord(me+1)))&&b.call(this,o,u,c,m,je,E,T,M))return}},Xa.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Xa.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var b=new Int32Array(u+c+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var E=u,T=0;T<o.length;T++){var M=o[T];b[3+T]=E,b.set(M,E),E+=M.length}return b[3+o.length]=E,b.set(this.keys,E),b[3+o.length+1]=E+=this.keys.length,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer};var af=se.ImageData,Sc=se.ImageBitmap,so={};function Rn(o,u,c){c===void 0&&(c={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),so[o]={klass:u,omit:c.omit||[],shallow:c.shallow||[]}}for(var gs in Rn("Object",Object),Po.serialize=function(o,u){var c=o.toArrayBuffer();return u&&u.push(c),{buffer:c}},Po.deserialize=function(o){return new Po(o.buffer)},Rn("Grid",Po),Rn("Color",Ri),Rn("Error",Error),Rn("ResolvedImage",Ia),Rn("StylePropertyFunction",xc),Rn("StyleExpression",Hl,{omit:["_evaluator"]}),Rn("ZoomDependentExpression",Wl),Rn("ZoomConstantExpression",bc),Rn("CompoundExpression",sa,{omit:["_evaluate"]}),_u)_u[gs]._classRegistryKey||Rn("Expression_"+gs,_u[gs]);function Bf(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Ac(o){return Sc&&o instanceof Sc}function ls(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Bf(o)||Ac(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var c=o;return u&&u.push(c.buffer),c}if(o instanceof af)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],b=0,E=o;b<E.length;b+=1)m.push(ls(E[b],u));return m}if(typeof o=="object"){var T=o.constructor,M=T._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var D=T.serialize?T.serialize(o,u):{};if(!T.serialize){for(var H in o)if(o.hasOwnProperty(H)&&!(so[M].omit.indexOf(H)>=0)){var q=o[H];D[H]=so[M].shallow.indexOf(H)>=0?q:ls(q,u)}o instanceof Error&&(D.message=o.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(D.$name=M),D}throw new Error("can't serialize object of type "+typeof o)}function xa(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Bf(o)||Ac(o)||ArrayBuffer.isView(o)||o instanceof af)return o;if(Array.isArray(o))return o.map(xa);if(typeof o=="object"){var u=o.$name||"Object",c=so[u].klass;if(!c)throw new Error("can't deserialize unregistered class "+u);if(c.deserialize)return c.deserialize(o);for(var m=Object.create(c.prototype),b=0,E=Object.keys(o);b<E.length;b+=1){var T=E[b];if(T!=="$name"){var M=o[T];m[T]=so[u].shallow.indexOf(T)>=0?M:xa(M)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var Ff=function(){this.first=!0};Ff.prototype.update=function(o,u){var c=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=c,!0))};var cn={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function ul(o){for(var u=0,c=o;u<c.length;u+=1)if(of(c[u].charCodeAt(0)))return!0;return!1}function of(o){return!(o!==746&&o!==747&&(o<4352||!(cn["Bopomofo Extended"](o)||cn.Bopomofo(o)||cn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||cn["CJK Compatibility Ideographs"](o)||cn["CJK Compatibility"](o)||cn["CJK Radicals Supplement"](o)||cn["CJK Strokes"](o)||!(!cn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||cn["CJK Unified Ideographs Extension A"](o)||cn["CJK Unified Ideographs"](o)||cn["Enclosed CJK Letters and Months"](o)||cn["Hangul Compatibility Jamo"](o)||cn["Hangul Jamo Extended-A"](o)||cn["Hangul Jamo Extended-B"](o)||cn["Hangul Jamo"](o)||cn["Hangul Syllables"](o)||cn.Hiragana(o)||cn["Ideographic Description Characters"](o)||cn.Kanbun(o)||cn["Kangxi Radicals"](o)||cn["Katakana Phonetic Extensions"](o)||cn.Katakana(o)&&o!==12540||!(!cn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!cn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||cn["Unified Canadian Aboriginal Syllabics"](o)||cn["Unified Canadian Aboriginal Syllabics Extended"](o)||cn["Vertical Forms"](o)||cn["Yijing Hexagram Symbols"](o)||cn["Yi Syllables"](o)||cn["Yi Radicals"](o))))}function sf(o){return!(of(o)||function(u){return!!(cn["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||cn["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||cn["Letterlike Symbols"](u)||cn["Number Forms"](u)||cn["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||cn["Control Pictures"](u)&&u!==9251||cn["Optical Character Recognition"](u)||cn["Enclosed Alphanumerics"](u)||cn["Geometric Shapes"](u)||cn["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||cn["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||cn["CJK Symbols and Punctuation"](u)||cn.Katakana(u)||cn["Private Use Area"](u)||cn["CJK Compatibility Forms"](u)||cn["Small Form Variants"](u)||cn["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function bu(o){return o>=1424&&o<=2303||cn["Arabic Presentation Forms-A"](o)||cn["Arabic Presentation Forms-B"](o)}function Us(o,u){return!(!u&&bu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||cn.Khmer(o))}function Nf(o){for(var u=0,c=o;u<c.length;u+=1)if(bu(c[u].charCodeAt(0)))return!0;return!1}var Uf=null,ys="unavailable",xu=null,pp=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ys="error"),Uf&&Uf(o)};function Tc(){wc.fire(new Ae("pluginStateChange",{pluginStatus:ys,pluginURL:xu}))}var wc=new at,zf=function(){return ys},Ks=function(){if(ys!=="deferred"||!xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ys="loading",Tc(),xu&&Bt({url:xu},function(o){o?pp(o):(ys="loaded",Tc())})},Ut={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ys==="loaded"||Ut.applyArabicShaping!=null},isLoading:function(){return ys==="loading"},setState:function(o){ys=o.pluginStatus,xu=o.pluginURL},isParsed:function(){return Ut.applyArabicShaping!=null&&Ut.processBidirectionalText!=null&&Ut.processStyledBidirectionalText!=null},getPluginURL:function(){return xu}},Me=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ff,this.transition={})};Me.prototype.isSupportedScript=function(o){return function(u,c){for(var m=0,b=u;m<b.length;m+=1)if(!Us(b[m].charCodeAt(0),c))return!1;return!0}(o,Ut.isLoaded())},Me.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Me.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),c=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*u}};var F=function(o,u){this.property=o,this.value=u,this.expression=function(c,m){if(Cl(c))return new xc(c,m);if(zu(c)){var b=Sh(c,m);if(b.result==="error")throw new Error(b.value.map(function(T){return T.key+": "+T.message}).join(", "));return b.value}var E=c;return typeof c=="string"&&m.type==="color"&&(E=Ri.parse(c)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};F.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},F.prototype.possiblyEvaluate=function(o,u,c){return this.property.possiblyEvaluate(this,o,u,c)};var Qs=function(o){this.property=o,this.value=new F(o,void 0)};Qs.prototype.transitioned=function(o,u){return new Ml(this.property,this.value,u,Nt({},o.transition,this.transition),o.now)},Qs.prototype.untransitioned=function(){return new Ml(this.property,this.value,null,{},0)};var pe=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};pe.prototype.getValue=function(o){return we(this._values[o].value.value)},pe.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Qs(this._values[o].property)),this._values[o].value=new F(this._values[o].property,u===null?void 0:we(u))},pe.prototype.getTransition=function(o){return we(this._values[o].transition)},pe.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Qs(this._values[o].property)),this._values[o].transition=we(u)||void 0},pe.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],b=this.getValue(m);b!==void 0&&(o[m]=b);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},pe.prototype.transitioned=function(o,u){for(var c=new eo(this._properties),m=0,b=Object.keys(this._values);m<b.length;m+=1){var E=b[m];c._values[E]=this._values[E].transitioned(o,u._values[E])}return c},pe.prototype.untransitioned=function(){for(var o=new eo(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u];o._values[m]=this._values[m].untransitioned()}return o};var Ml=function(o,u,c,m,b){this.property=o,this.value=u,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Ml.prototype.possiblyEvaluate=function(o,u,c){var m=o.now||0,b=this.value.possiblyEvaluate(o,u,c),E=this.prior;if(E){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return E.possiblyEvaluate(o,u,c);var T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,c),b,function(M){if(M<=0)return 0;if(M>=1)return 1;var D=M*M,H=D*M;return 4*(M<.5?H:3*(M-D)+H-.75)}(T))}return b};var eo=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};eo.prototype.possiblyEvaluate=function(o,u,c){for(var m=new _s(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m},eo.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var zs=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};zs.prototype.getValue=function(o){return we(this._values[o].value)},zs.prototype.setValue=function(o,u){this._values[o]=new F(this._values[o].property,u===null?void 0:we(u))},zs.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],b=this.getValue(m);b!==void 0&&(o[m]=b)}return o},zs.prototype.possiblyEvaluate=function(o,u,c){for(var m=new _s(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m};var Oo=function(o,u,c){this.property=o,this.value=u,this.parameters=c};Oo.prototype.isConstant=function(){return this.value.kind==="constant"},Oo.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},Oo.prototype.evaluate=function(o,u,c,m){return this.property.evaluate(this.value,this.parameters,o,u,c,m)};var _s=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};_s.prototype.get=function(o){return this._values[o]};var Un=function(o){this.specification=o};Un.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},Un.prototype.interpolate=function(o,u,c){var m=Sl[this.specification.type];return m?m(o,u,c):o};var Pn=function(o,u){this.specification=o,this.overrides=u};Pn.prototype.possiblyEvaluate=function(o,u,c,m){return new Oo(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},c,m)}:o.expression,u)},Pn.prototype.interpolate=function(o,u,c){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new Oo(this,{kind:"constant",value:void 0},o.parameters);var m=Sl[this.specification.type];return m?new Oo(this,{kind:"constant",value:m(o.value.value,u.value.value,c)},o.parameters):o},Pn.prototype.evaluate=function(o,u,c,m,b,E){return o.kind==="constant"?o.value:o.evaluate(u,c,m,b,E)};var cs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m,b,E){if(c.value===void 0)return new Oo(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var T=c.expression.evaluate(m,null,{},b,E),M=c.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,D=this._calculate(M,M,M,m);return new Oo(this,{kind:"constant",value:D},m)}if(c.expression.kind==="camera"){var H=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new Oo(this,{kind:"constant",value:H},m)}return new Oo(this,c.expression,m)},u.prototype.evaluate=function(c,m,b,E,T,M){if(c.kind==="source"){var D=c.evaluate(m,b,E,T,M);return this._calculate(D,D,D,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},b,E),c.evaluate({zoom:Math.floor(m.zoom)},b,E),c.evaluate({zoom:Math.floor(m.zoom)+1},b,E),m):c.value},u.prototype._calculate=function(c,m,b,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:b,to:m}},u.prototype.interpolate=function(c){return c},u}(Pn),fs=function(o){this.specification=o};fs.prototype.possiblyEvaluate=function(o,u,c,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var b=o.expression.evaluate(u,null,{},c,m);return this._calculate(b,b,b,u)}return this._calculate(o.expression.evaluate(new Me(Math.floor(u.zoom-1),u)),o.expression.evaluate(new Me(Math.floor(u.zoom),u)),o.expression.evaluate(new Me(Math.floor(u.zoom+1),u)),u)}},fs.prototype._calculate=function(o,u,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:c,to:u}},fs.prototype.interpolate=function(o){return o};var Eu=function(o){this.specification=o};Eu.prototype.possiblyEvaluate=function(o,u,c,m){return!!o.expression.evaluate(u,null,{},c,m)},Eu.prototype.interpolate=function(){return!1};var Na=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var c=o[u];c.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new F(c,void 0),b=this.defaultTransitionablePropertyValues[u]=new Qs(c);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};Rn("DataDrivenProperty",Pn),Rn("DataConstantProperty",Un),Rn("CrossFadedDataDrivenProperty",cs),Rn("CrossFadedProperty",fs),Rn("ColorRampProperty",Eu);var Js=function(o){function u(c,m){if(o.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new zs(m.layout)),m.paint)){for(var b in this._transitionablePaint=new pe(m.paint),c.paint)this.setPaintProperty(b,c.paint[b],{validate:!1});for(var E in c.layout)this.setLayoutProperty(E,c.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _s(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},u.prototype.setLayoutProperty=function(c,m,b){b===void 0&&(b={}),m!=null&&this._validate(Lf,"layers."+this.id+".layout."+c,c,m,b)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},u.prototype.getPaintProperty=function(c){return gr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)},u.prototype.setPaintProperty=function(c,m,b){if(b===void 0&&(b={}),m!=null&&this._validate(Df,"layers."+this.id+".paint."+c,c,m,b))return!1;if(gr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-11),m||void 0),!1;var E=this._transitionablePaint._values[c],T=E.property.specification["property-type"]==="cross-faded-data-driven",M=E.value.isDataDriven(),D=E.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var H=this._transitionablePaint._values[c].value;return H.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(c,D,H)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,b){return!1},u.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},u.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ut(c,function(m,b){return!(m===void 0||b==="layout"&&!Object.keys(m).length||b==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(c,m,b,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Yl(this,c.call(qs,{key:m,layerType:this.type,objectKey:b,value:E,styleSpec:j,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof Oo&&wl(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(at),Su={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Au=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},da=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _o(o,u){u===void 0&&(u=1);var c=0,m=0;return{members:o.map(function(b){var E=Su[b.type].BYTES_PER_ELEMENT,T=c=Rh(c,Math.max(u,E)),M=b.components||1;return m=Math.max(m,E),c+=E*M,{name:b.name,type:b.type,components:M,offset:T}}),size:Rh(c,Math.max(m,u)),alignment:u}}function Rh(o,u){return Math.ceil(o/u)*u}da.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},da.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},da.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},da.prototype.clear=function(){this.length=0},da.prototype.resize=function(o){this.reserve(o),this.length=o},da.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},da.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Il=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.int16[E+0]=m,this.int16[E+1]=b,c},u}(da);Il.prototype.bytesPerElement=4,Rn("StructArrayLayout2i4",Il);var Zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=b,this.int16[M+2]=E,this.int16[M+3]=T,c},u}(da);Zf.prototype.bytesPerElement=8,Rn("StructArrayLayout4i8",Zf);var ll=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,D){var H=6*c;return this.int16[H+0]=m,this.int16[H+1]=b,this.int16[H+2]=E,this.int16[H+3]=T,this.int16[H+4]=M,this.int16[H+5]=D,c},u}(da);ll.prototype.bytesPerElement=12,Rn("StructArrayLayout2i4i12",ll);var bs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,D){var H=4*c,q=8*c;return this.int16[H+0]=m,this.int16[H+1]=b,this.uint8[q+4]=E,this.uint8[q+5]=T,this.uint8[q+6]=M,this.uint8[q+7]=D,c},u}(da);bs.prototype.bytesPerElement=8,Rn("StructArrayLayout2i4ub8",bs);var ql=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.float32[E+0]=m,this.float32[E+1]=b,c},u}(da);ql.prototype.bytesPerElement=8,Rn("StructArrayLayout2f8",ql);var Tu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,D,H,q,K){var he=this.length;return this.resize(he+1),this.emplace(he,c,m,b,E,T,M,D,H,q,K)},u.prototype.emplace=function(c,m,b,E,T,M,D,H,q,K,he){var me=10*c;return this.uint16[me+0]=m,this.uint16[me+1]=b,this.uint16[me+2]=E,this.uint16[me+3]=T,this.uint16[me+4]=M,this.uint16[me+5]=D,this.uint16[me+6]=H,this.uint16[me+7]=q,this.uint16[me+8]=K,this.uint16[me+9]=he,c},u}(da);Tu.prototype.bytesPerElement=20,Rn("StructArrayLayout10ui20",Tu);var Vf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,D,H,q,K,he,me){var je=this.length;return this.resize(je+1),this.emplace(je,c,m,b,E,T,M,D,H,q,K,he,me)},u.prototype.emplace=function(c,m,b,E,T,M,D,H,q,K,he,me,je){var He=12*c;return this.int16[He+0]=m,this.int16[He+1]=b,this.int16[He+2]=E,this.int16[He+3]=T,this.uint16[He+4]=M,this.uint16[He+5]=D,this.uint16[He+6]=H,this.uint16[He+7]=q,this.int16[He+8]=K,this.int16[He+9]=he,this.int16[He+10]=me,this.int16[He+11]=je,c},u}(da);Vf.prototype.bytesPerElement=24,Rn("StructArrayLayout4i4ui4i24",Vf);var Cc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.float32[T+0]=m,this.float32[T+1]=b,this.float32[T+2]=E,c},u}(da);Cc.prototype.bytesPerElement=12,Rn("StructArrayLayout3f12",Cc);var uf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},u}(da);uf.prototype.bytesPerElement=4,Rn("StructArrayLayout1ul4",uf);var jf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,D,H,q){var K=this.length;return this.resize(K+1),this.emplace(K,c,m,b,E,T,M,D,H,q)},u.prototype.emplace=function(c,m,b,E,T,M,D,H,q,K){var he=10*c,me=5*c;return this.int16[he+0]=m,this.int16[he+1]=b,this.int16[he+2]=E,this.int16[he+3]=T,this.int16[he+4]=M,this.int16[he+5]=D,this.uint32[me+3]=H,this.uint16[he+8]=q,this.uint16[he+9]=K,c},u}(da);jf.prototype.bytesPerElement=20,Rn("StructArrayLayout6i1ul2ui20",jf);var Kl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,D){var H=6*c;return this.int16[H+0]=m,this.int16[H+1]=b,this.int16[H+2]=E,this.int16[H+3]=T,this.int16[H+4]=M,this.int16[H+5]=D,c},u}(da);Kl.prototype.bytesPerElement=12,Rn("StructArrayLayout2i2i2i12",Kl);var Ql=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,b,E,T)},u.prototype.emplace=function(c,m,b,E,T,M){var D=4*c,H=8*c;return this.float32[D+0]=m,this.float32[D+1]=b,this.float32[D+2]=E,this.int16[H+6]=T,this.int16[H+7]=M,c},u}(da);Ql.prototype.bytesPerElement=16,Rn("StructArrayLayout2f1f2i16",Ql);var Mh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=12*c,D=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=b,this.float32[D+1]=E,this.float32[D+2]=T,c},u}(da);Mh.prototype.bytesPerElement=12,Rn("StructArrayLayout2ub2f12",Mh);var hs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.uint16[T+0]=m,this.uint16[T+1]=b,this.uint16[T+2]=E,c},u}(da);hs.prototype.bytesPerElement=6,Rn("StructArrayLayout3ui6",hs);var wu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt){var jt=this.length;return this.resize(jt+1),this.emplace(jt,c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt)},u.prototype.emplace=function(c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt,jt){var ar=24*c,sr=12*c,br=48*c;return this.int16[ar+0]=m,this.int16[ar+1]=b,this.uint16[ar+2]=E,this.uint16[ar+3]=T,this.uint32[sr+2]=M,this.uint32[sr+3]=D,this.uint32[sr+4]=H,this.uint16[ar+10]=q,this.uint16[ar+11]=K,this.uint16[ar+12]=he,this.float32[sr+7]=me,this.float32[sr+8]=je,this.uint8[br+36]=He,this.uint8[br+37]=dt,this.uint8[br+38]=ot,this.uint32[sr+10]=kt,this.int16[ar+22]=jt,c},u}(da);wu.prototype.bytesPerElement=48,Rn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",wu);var lf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt,jt,ar,sr,br,Nr,on,Zn,En,Wn,Sn,Ii){var ai=this.length;return this.resize(ai+1),this.emplace(ai,c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt,jt,ar,sr,br,Nr,on,Zn,En,Wn,Sn,Ii)},u.prototype.emplace=function(c,m,b,E,T,M,D,H,q,K,he,me,je,He,dt,ot,kt,jt,ar,sr,br,Nr,on,Zn,En,Wn,Sn,Ii,ai){var Dn=34*c,Bi=17*c;return this.int16[Dn+0]=m,this.int16[Dn+1]=b,this.int16[Dn+2]=E,this.int16[Dn+3]=T,this.int16[Dn+4]=M,this.int16[Dn+5]=D,this.int16[Dn+6]=H,this.int16[Dn+7]=q,this.uint16[Dn+8]=K,this.uint16[Dn+9]=he,this.uint16[Dn+10]=me,this.uint16[Dn+11]=je,this.uint16[Dn+12]=He,this.uint16[Dn+13]=dt,this.uint16[Dn+14]=ot,this.uint16[Dn+15]=kt,this.uint16[Dn+16]=jt,this.uint16[Dn+17]=ar,this.uint16[Dn+18]=sr,this.uint16[Dn+19]=br,this.uint16[Dn+20]=Nr,this.uint16[Dn+21]=on,this.uint16[Dn+22]=Zn,this.uint32[Bi+12]=En,this.float32[Bi+13]=Wn,this.float32[Bi+14]=Sn,this.float32[Bi+15]=Ii,this.float32[Bi+16]=ai,c},u}(da);lf.prototype.bytesPerElement=68,Rn("StructArrayLayout8i15ui1ul4f68",lf);var Pl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},u}(da);Pl.prototype.bytesPerElement=4,Rn("StructArrayLayout1f4",Pl);var cu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.int16[T+0]=m,this.int16[T+1]=b,this.int16[T+2]=E,c},u}(da);cu.prototype.bytesPerElement=6,Rn("StructArrayLayout3i6",cu);var Ih=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=4*c;return this.uint32[2*c+0]=m,this.uint16[T+2]=b,this.uint16[T+3]=E,c},u}(da);Ih.prototype.bytesPerElement=8,Rn("StructArrayLayout1ul2ui8",Ih);var Hu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.uint16[E+0]=m,this.uint16[E+1]=b,c},u}(da);Hu.prototype.bytesPerElement=4,Rn("StructArrayLayout2ui4",Hu);var Hf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},u}(da);Hf.prototype.bytesPerElement=2,Rn("StructArrayLayout1ui2",Hf);var Ph=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=b,this.float32[M+2]=E,this.float32[M+3]=T,c},u}(da);Ph.prototype.bytesPerElement=16,Rn("StructArrayLayout4f16",Ph);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,c),u}(Au);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new h(this,c)},u}(jf);Rn("CollisionBoxArray",v);var p=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,c),u}(Au);p.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new p(this,c)},u}(wu);Rn("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,c),u}(Au);S.prototype.size=68;var w=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new S(this,c)},u}(lf);Rn("SymbolInstanceArray",w);var R=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(c){return this.float32[1*c+0]},u}(Pl);Rn("GlyphOffsetArray",R);var P=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(c){return this.int16[3*c+0]},u.prototype.gety=function(c){return this.int16[3*c+1]},u.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},u}(cu);Rn("SymbolLineVertexArray",P);var X=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,c),u}(Au);X.prototype.size=8;var te=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new X(this,c)},u}(Ih);Rn("FeatureIndexArray",te);var ye=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,Ee=function(o){o===void 0&&(o=[]),this.segments=o};function Ce(o,u){return 256*(o=Rt(Math.floor(o),0,255))+Rt(Math.floor(u),0,255)}Ee.prototype.prepareSegment=function(o,u,c,m){var b=this.segments[this.segments.length-1];return o>Ee.MAX_VERTEX_ARRAY_LENGTH&&Fe("Max vertices per segment is "+Ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!b||b.vertexLength+o>Ee.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:u.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b},Ee.prototype.get=function(){return this.segments},Ee.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var c=u[o];for(var m in c.vaos)c.vaos[m].destroy()}},Ee.simpleSegment=function(o,u,c,m){return new Ee([{vertexOffset:o,primitiveOffset:u,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},Ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rn("SegmentVector",Ee);var Xe=_o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),We=ce(function(o){o.exports=function(u,c){var m,b,E,T,M,D,H,q;for(b=u.length-(m=3&u.length),E=c,M=3432918353,D=461845907,q=0;q<b;)H=255&u.charCodeAt(q)|(255&u.charCodeAt(++q))<<8|(255&u.charCodeAt(++q))<<16|(255&u.charCodeAt(++q))<<24,++q,E=27492+(65535&(T=5*(65535&(E=(E^=H=(65535&(H=(H=(65535&H)*M+(((H>>>16)*M&65535)<<16)&4294967295)<<15|H>>>17))*D+(((H>>>16)*D&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(H=0,m){case 3:H^=(255&u.charCodeAt(q+2))<<16;case 2:H^=(255&u.charCodeAt(q+1))<<8;case 1:E^=H=(65535&(H=(H=(65535&(H^=255&u.charCodeAt(q)))*M+(((H>>>16)*M&65535)<<16)&4294967295)<<15|H>>>17))*D+(((H>>>16)*D&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),ft=ce(function(o){o.exports=function(u,c){for(var m,b=u.length,E=c^b,T=0;b>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Ue=We,ct=ft;Ue.murmur3=We,Ue.murmur2=ct;var Et=function(){this.ids=[],this.positions=[],this.indexed=!1};Et.prototype.add=function(o,u,c,m){this.ids.push(or(o)),this.positions.push(u,c,m)},Et.prototype.getPositions=function(o){for(var u=or(o),c=0,m=this.ids.length-1;c<m;){var b=c+m>>1;this.ids[b]>=u?m=b:c=b+1}for(var E=[];this.ids[c]===u;)E.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return E},Et.serialize=function(o,u){var c=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function b(E,T,M,D){for(;M<D;){for(var H=E[M+D>>1],q=M-1,K=D+1;;){do q++;while(E[q]<H);do K--;while(E[K]>H);if(q>=K)break;Qt(E,q,K),Qt(T,3*q,3*K),Qt(T,3*q+1,3*K+1),Qt(T,3*q+2,3*K+2)}K-M<D-K?(b(E,T,M,K),M=K+1):(b(E,T,K+1,D),D=K)}}(c,m,0,c.length-1),u&&u.push(c.buffer,m.buffer),{ids:c,positions:m}},Et.deserialize=function(o){var u=new Et;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var zt=Math.pow(2,53)-1;function or(o){var u=+o;return!isNaN(u)&&u<=zt?u:Ue(String(o))}function Qt(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}Rn("FeaturePositionMap",Et);var fr=function(o,u){this.gl=o.gl,this.location=u},Ar=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},u}(fr),Yr=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},u}(fr),zr=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},u}(fr),_n=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},u}(fr),jn=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},u}(fr),zn=function(o){function u(c,m){o.call(this,c,m),this.current=Ri.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},u}(fr),Hn=new Float32Array(16),Wi=function(o){function u(c,m){o.call(this,c,m),this.current=Hn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},u}(fr);function An(o){return[Ce(255*o.r,255*o.g),Ce(255*o.b,255*o.a)]}var ui=function(o,u,c){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=c};ui.prototype.setUniform=function(o,u,c){o.set(c.constantOr(this.value))},ui.prototype.getBinding=function(o,u,c){return this.type==="color"?new zn(o,u):new Yr(o,u)};var gi=function(o,u){this.uniformNames=u.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};gi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},gi.prototype.setUniform=function(o,u,c,m){var b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&o.set(b)},gi.prototype.getBinding=function(o,u,c){return c.substr(0,9)==="u_pattern"?new jn(o,u):new Yr(o,u)};var oi=function(o,u,c,m){this.expression=o,this.type=c,this.maxValue=0,this.paintVertexAttributes=u.map(function(b){return{name:"a_"+b,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};oi.prototype.populatePaintArray=function(o,u,c,m,b){var E=this.paintVertexArray.length,T=this.expression.evaluate(new Me(0),u,{},m,[],b);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)},oi.prototype.updatePaintArray=function(o,u,c,m){var b=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(o,u,b)},oi.prototype._setPaintValue=function(o,u,c){if(this.type==="color")for(var m=An(c),b=o;b<u;b++)this.paintVertexArray.emplace(b,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},oi.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},oi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ri=function(o,u,c,m,b,E){this.expression=o,this.uniformNames=u.map(function(T){return"u_"+T+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ri.prototype.populatePaintArray=function(o,u,c,m,b){var E=this.expression.evaluate(new Me(this.zoom),u,{},m,[],b),T=this.expression.evaluate(new Me(this.zoom+1),u,{},m,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(M,o,E,T)},ri.prototype.updatePaintArray=function(o,u,c,m){var b=this.expression.evaluate({zoom:this.zoom},c,m),E=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(o,u,b,E)},ri.prototype._setPaintValue=function(o,u,c,m){if(this.type==="color")for(var b=An(c),E=An(m),T=o;T<u;T++)this.paintVertexArray.emplace(T,b[0],b[1],E[0],E[1]);else{for(var M=o;M<u;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},ri.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ri.prototype.setUniform=function(o,u){var c=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=Rt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);o.set(m)},ri.prototype.getBinding=function(o,u,c){return new Yr(o,u)};var vi=function(o,u,c,m,b,E){this.expression=o,this.type=u,this.useIntegerZoom=c,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b};vi.prototype.populatePaintArray=function(o,u,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],c)},vi.prototype.updatePaintArray=function(o,u,c,m,b){this._setPaintValues(o,u,c.patterns&&c.patterns[this.layerId],b)},vi.prototype._setPaintValues=function(o,u,c,m){if(m&&c){var b=m[c.min],E=m[c.mid],T=m[c.max];if(b&&E&&T)for(var M=o;M<u;M++)this.zoomInPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},vi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Xe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Xe.members,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ni=function(o,u,c){this.binders={},this._buffers=[];var m=[];for(var b in o.paint._values)if(c(b)){var E=o.paint.get(b);if(E instanceof Oo&&wl(E.property.specification)){var T=ko(b,o.type),M=E.value,D=E.property.specification.type,H=E.property.useIntegerZoom,q=E.property.specification["property-type"],K=q==="cross-faded"||q==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=K?new gi(M.value,T):new ui(M.value,T,D),m.push("/u_"+b);else if(M.kind==="source"||K){var he=to(b,D,"source");this.binders[b]=K?new vi(M,D,H,u,he,o.id):new oi(M,T,D,he),m.push("/a_"+b)}else{var me=to(b,D,"composite");this.binders[b]=new ri(M,T,D,H,u,me),m.push("/z_"+b)}}}this.cacheKey=m.sort().join("")};ni.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof oi||u instanceof ri?u.maxValue:0},ni.prototype.populatePaintArrays=function(o,u,c,m,b){for(var E in this.binders){var T=this.binders[E];(T instanceof oi||T instanceof ri||T instanceof vi)&&T.populatePaintArray(o,u,c,m,b)}},ni.prototype.setConstantPatternPositions=function(o,u){for(var c in this.binders){var m=this.binders[c];m instanceof gi&&m.setConstantPatternPositions(o,u)}},ni.prototype.updatePaintArrays=function(o,u,c,m,b){var E=!1;for(var T in o)for(var M=0,D=u.getPositions(T);M<D.length;M+=1){var H=D[M],q=c.feature(H.index);for(var K in this.binders){var he=this.binders[K];if((he instanceof oi||he instanceof ri||he instanceof vi)&&he.expression.isStateDependent===!0){var me=m.paint.get(K);he.expression=me.value,he.updatePaintArray(H.start,H.end,q,o[T],b),E=!0}}}return E},ni.prototype.defines=function(){var o=[];for(var u in this.binders){var c=this.binders[u];(c instanceof ui||c instanceof gi)&&o.push.apply(o,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},ni.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof oi||c instanceof ri)for(var m=0;m<c.paintVertexAttributes.length;m++)o.push(c.paintVertexAttributes[m].name);else if(c instanceof vi)for(var b=0;b<Xe.members.length;b++)o.push(Xe.members[b].name)}return o},ni.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ui||c instanceof gi||c instanceof ri)for(var m=0,b=c.uniformNames;m<b.length;m+=1)o.push(b[m])}return o},ni.prototype.getPaintVertexBuffers=function(){return this._buffers},ni.prototype.getUniforms=function(o,u){var c=[];for(var m in this.binders){var b=this.binders[m];if(b instanceof ui||b instanceof gi||b instanceof ri)for(var E=0,T=b.uniformNames;E<T.length;E+=1){var M=T[E];if(u[M]){var D=b.getBinding(o,u[M],M);c.push({name:M,property:m,binding:D})}}}return c},ni.prototype.setUniforms=function(o,u,c,m){for(var b=0,E=u;b<E.length;b+=1){var T=E[b],M=T.name,D=T.property;this.binders[D].setUniform(T.binding,m,c.get(D),M)}},ni.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var c=this.binders[u];if(o&&c instanceof vi){var m=o.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof oi||c instanceof ri)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},ni.prototype.upload=function(o){for(var u in this.binders){var c=this.binders[u];(c instanceof oi||c instanceof ri||c instanceof vi)&&c.upload(o)}this.updatePaintBuffers()},ni.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof oi||u instanceof ri||u instanceof vi)&&u.destroy()}};var Kn=function(o,u,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,b=o;m<b.length;m+=1){var E=b[m];this.programConfigurations[E.id]=new ni(E,u,c)}this.needsUpload=!1,this._featureMap=new Et,this._bufferOffset=0};function ko(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function to(o,u,c){var m={color:{source:ql,composite:Ph},number:{source:Pl,composite:ql}},b=function(E){return{"line-pattern":{source:Tu,composite:Tu},"fill-pattern":{source:Tu,composite:Tu},"fill-extrusion-pattern":{source:Tu,composite:Tu}}[E]}(o);return b&&b[c]||m[u][c]}Kn.prototype.populatePaintArrays=function(o,u,c,m,b,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,u,m,b,E);u.id!==void 0&&this._featureMap.add(u.id,c,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},Kn.prototype.updatePaintArrays=function(o,u,c,m){for(var b=0,E=c;b<E.length;b+=1){var T=E[b];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,u,T,m)||this.needsUpload}},Kn.prototype.get=function(o){return this.programConfigurations[o]},Kn.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},Kn.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},Rn("ConstantBinder",ui),Rn("CrossFadedConstantBinder",gi),Rn("SourceExpressionBinder",oi),Rn("CrossFadedCompositeBinder",vi),Rn("CompositeExpressionBinder",ri),Rn("ProgramConfiguration",ni,{omit:["_buffers"]}),Rn("ProgramConfigurationSet",Kn);var Do=Math.pow(2,14)-1,bo=-Do-1;function $a(o){for(var u=8192/o.extent,c=o.loadGeometry(),m=0;m<c.length;m++)for(var b=c[m],E=0;E<b.length;E++){var T=b[E],M=Math.round(T.x*u),D=Math.round(T.y*u);T.x=Rt(M,bo,Do),T.y=Rt(D,bo,Do),(M<T.x||M>T.x+1||D<T.y||D>T.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function ro(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?$a(o):[]}}function xs(o,u,c,m,b){o.emplaceBack(2*u+(m+1)/2,2*c+(b+1)/2)}var Es=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Il,this.indexArray=new hs,this.segments=new Ee,this.programConfigurations=new Kn(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function cl(o,u){for(var c=0;c<o.length;c++)if(hu(u,o[c]))return!0;for(var m=0;m<u.length;m++)if(hu(o,u[m]))return!0;return!!Rc(o,u)}function Ss(o,u,c){return!!hu(o,u)||!!Cu(u,o,c)}function fu(o,u){if(o.length===1)return fl(u,o[0]);for(var c=0;c<u.length;c++)for(var m=u[c],b=0;b<m.length;b++)if(hu(o,m[b]))return!0;for(var E=0;E<o.length;E++)if(fl(u,o[E]))return!0;for(var T=0;T<u.length;T++)if(Rc(o,u[T]))return!0;return!1}function Zs(o,u,c){if(o.length>1){if(Rc(o,u))return!0;for(var m=0;m<u.length;m++)if(Cu(u[m],o,c))return!0}for(var b=0;b<o.length;b++)if(Cu(o[b],u,c))return!0;return!1}function Rc(o,u){if(o.length===0||u.length===0)return!1;for(var c=0;c<o.length-1;c++)for(var m=o[c],b=o[c+1],E=0;E<u.length-1;E++)if(Wu(m,b,u[E],u[E+1]))return!0;return!1}function Wu(o,u,c,m){return Zt(o,c,m)!==Zt(u,c,m)&&Zt(o,u,c)!==Zt(o,u,m)}function Cu(o,u,c){var m=c*c;if(u.length===1)return o.distSqr(u[0])<m;for(var b=1;b<u.length;b++)if(Jl(o,u[b-1],u[b])<m)return!0;return!1}function Jl(o,u,c){var m=u.distSqr(c);if(m===0)return o.distSqr(u);var b=((o.x-u.x)*(c.x-u.x)+(o.y-u.y)*(c.y-u.y))/m;return o.distSqr(b<0?u:b>1?c:c.sub(u)._mult(b)._add(u))}function fl(o,u){for(var c,m,b,E=!1,T=0;T<o.length;T++)for(var M=0,D=(c=o[T]).length-1;M<c.length;D=M++)(m=c[M]).y>u.y!=(b=c[D]).y>u.y&&u.x<(b.x-m.x)*(u.y-m.y)/(b.y-m.y)+m.x&&(E=!E);return E}function hu(o,u){for(var c=!1,m=0,b=o.length-1;m<o.length;b=m++){var E=o[m],T=o[b];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(c=!c)}return c}function hl(o,u,c){var m=c[0],b=c[2];if(o.x<m.x&&u.x<m.x||o.x>b.x&&u.x>b.x||o.y<m.y&&u.y<m.y||o.y>b.y&&u.y>b.y)return!1;var E=Zt(o,u,c[0]);return E!==Zt(o,u,c[1])||E!==Zt(o,u,c[2])||E!==Zt(o,u,c[3])}function Lo(o,u,c){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:c.programConfigurations.get(u.id).getMaxValue(o)}function uo(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Is(o,u,c,m,b){if(!u[0]&&!u[1])return o;var E=oe.convert(u)._mult(b);c==="viewport"&&E._rotate(-m);for(var T=[],M=0;M<o.length;M++)T.push(o[M].sub(E));return T}Es.prototype.populate=function(o,u,c){var m=this.layers[0],b=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var T=0,M=o;T<M.length;T+=1){var D=M[T],H=D.feature,q=D.id,K=D.index,he=D.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,je=ro(H,me);if(this.layers[0]._featureFilter.filter(new Me(this.zoom),je,c)){var He=E?E.evaluate(je,{},c):void 0,dt={id:q,properties:H.properties,type:H.type,sourceLayerIndex:he,index:K,geometry:me?je.geometry:$a(H),patterns:{},sortKey:He};b.push(dt)}}E&&b.sort(function(on,Zn){return on.sortKey-Zn.sortKey});for(var ot=0,kt=b;ot<kt.length;ot+=1){var jt=kt[ot],ar=jt.geometry,sr=jt.index,br=jt.sourceLayerIndex,Nr=o[sr].feature;this.addFeature(jt,ar,sr,c),u.featureIndex.insert(Nr,ar,sr,br,this.index)}},Es.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Es.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ye),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(o,u,c,m){for(var b=0,E=u;b<E.length;b+=1)for(var T=0,M=E[b];T<M.length;T+=1){var D=M[T],H=D.x,q=D.y;if(!(H<0||H>=8192||q<0||q>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),he=K.vertexLength;xs(this.layoutVertexArray,H,q,-1,-1),xs(this.layoutVertexArray,H,q,1,-1),xs(this.layoutVertexArray,H,q,1,1),xs(this.layoutVertexArray,H,q,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,{},m)},Rn("CircleBucket",Es,{omit:["layers"]});var pu=new Na({"circle-sort-key":new Pn(j.layout_circle["circle-sort-key"])}),Ru={paint:new Na({"circle-radius":new Pn(j.paint_circle["circle-radius"]),"circle-color":new Pn(j.paint_circle["circle-color"]),"circle-blur":new Pn(j.paint_circle["circle-blur"]),"circle-opacity":new Pn(j.paint_circle["circle-opacity"]),"circle-translate":new Un(j.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(j.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(j.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(j.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(j.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(j.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(j.paint_circle["circle-stroke-opacity"])}),layout:pu},Zi=typeof Float32Array!="undefined"?Float32Array:Array;function ts(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function lo(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3],M=u[4],D=u[5],H=u[6],q=u[7],K=u[8],he=u[9],me=u[10],je=u[11],He=u[12],dt=u[13],ot=u[14],kt=u[15],jt=c[0],ar=c[1],sr=c[2],br=c[3];return o[0]=jt*m+ar*M+sr*K+br*He,o[1]=jt*b+ar*D+sr*he+br*dt,o[2]=jt*E+ar*H+sr*me+br*ot,o[3]=jt*T+ar*q+sr*je+br*kt,o[4]=(jt=c[4])*m+(ar=c[5])*M+(sr=c[6])*K+(br=c[7])*He,o[5]=jt*b+ar*D+sr*he+br*dt,o[6]=jt*E+ar*H+sr*me+br*ot,o[7]=jt*T+ar*q+sr*je+br*kt,o[8]=(jt=c[8])*m+(ar=c[9])*M+(sr=c[10])*K+(br=c[11])*He,o[9]=jt*b+ar*D+sr*he+br*dt,o[10]=jt*E+ar*H+sr*me+br*ot,o[11]=jt*T+ar*q+sr*je+br*kt,o[12]=(jt=c[12])*m+(ar=c[13])*M+(sr=c[14])*K+(br=c[15])*He,o[13]=jt*b+ar*D+sr*he+br*dt,o[14]=jt*E+ar*H+sr*me+br*ot,o[15]=jt*T+ar*q+sr*je+br*kt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,c=arguments.length;c--;)u+=o[c]*o[c];return Math.sqrt(u)});var du,Mc=lo;function Gu(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3];return o[0]=c[0]*m+c[4]*b+c[8]*E+c[12]*T,o[1]=c[1]*m+c[5]*b+c[9]*E+c[13]*T,o[2]=c[2]*m+c[6]*b+c[10]*E+c[14]*T,o[3]=c[3]*m+c[7]*b+c[11]*E+c[15]*T,o}du=new Zi(3),Zi!=Float32Array&&(du[0]=0,du[1]=0,du[2]=0),function(){var o=new Zi(4);Zi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var Oh=(function(){var o=new Zi(2);Zi!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(c){o.call(this,c,Ru)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Es(c)},u.prototype.queryRadius=function(c){var m=c;return Lo("circle-radius",this,m)+Lo("circle-stroke-width",this,m)+uo(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,D,H){for(var q=Is(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),K=this.paint.get("circle-radius").evaluate(m,b)+this.paint.get("circle-stroke-width").evaluate(m,b),he=this.paint.get("circle-pitch-alignment")==="map",me=he?q:function(Nr,on){return Nr.map(function(Zn){return Bo(Zn,on)})}(q,H),je=he?K*D:K,He=0,dt=E;He<dt.length;He+=1)for(var ot=0,kt=dt[He];ot<kt.length;ot+=1){var jt=kt[ot],ar=he?jt:Bo(jt,H),sr=je,br=Gu([],[jt.x,jt.y,0,1],H);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?sr*=br[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(sr*=M.cameraToCenterDistance/br[3]),Ss(me,ar,sr))return!0}return!1},u}(Js));function Bo(o,u){var c=Gu([],[o.x,o.y,0,1],u);return new oe(c[0]/c[3],c[1]/c[3])}var Br=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Es);function Vs(o,u,c,m){var b=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==b*E*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(b*E*c);return o.width=b,o.height=E,o.data=m,o}function kh(o,u,c){var m=u.width,b=u.height;if(m!==o.width||b!==o.height){var E=Vs({},{width:m,height:b},c);Fo(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,b)},c),o.width=m,o.height=b,o.data=E.data}}function Fo(o,u,c,m,b,E){if(b.width===0||b.height===0)return u;if(b.width>o.width||b.height>o.height||c.x>o.width-b.width||c.y>o.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>u.width||b.height>u.height||m.x>u.width-b.width||m.y>u.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=o.data,M=u.data,D=0;D<b.height;D++)for(var H=((c.y+D)*o.width+c.x)*E,q=((m.y+D)*u.width+m.x)*E,K=0;K<b.width*E;K++)M[q+K]=T[H+K];return u}Rn("HeatmapBucket",Br,{omit:["layers"]});var eu=function(o,u){Vs(this,o,1,u)};eu.prototype.resize=function(o){kh(this,o,1)},eu.prototype.clone=function(){return new eu({width:this.width,height:this.height},new Uint8Array(this.data))},eu.copy=function(o,u,c,m,b){Fo(o,u,c,m,b,1)};var No=function(o,u){Vs(this,o,4,u)};No.prototype.resize=function(o){kh(this,o,4)},No.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},No.prototype.clone=function(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))},No.copy=function(o,u,c,m,b){Fo(o,u,c,m,b,4)},Rn("AlphaImage",eu),Rn("RGBAImage",No);var dp={paint:new Na({"heatmap-radius":new Pn(j.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(j.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(j.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eu(j.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(j.paint_heatmap["heatmap-opacity"])})};function ec(o){var u={},c=o.resolution||256,m=o.clips?o.clips.length:1,b=o.image||new No({width:c,height:m}),E=function(je,He,dt){u[o.evaluationKey]=dt;var ot=o.expression.evaluate(u);b.data[je+He+0]=Math.floor(255*ot.r/ot.a),b.data[je+He+1]=Math.floor(255*ot.g/ot.a),b.data[je+He+2]=Math.floor(255*ot.b/ot.a),b.data[je+He+3]=Math.floor(255*ot.a)};if(o.clips)for(var T=0,M=0;T<m;++T,M+=4*c)for(var D=0,H=0;D<c;D++,H+=4){var q=D/(c-1),K=o.clips[T];E(M,H,K.start*(1-q)+K.end*q)}else for(var he=0,me=0;he<c;he++,me+=4)E(0,me,he/(c-1));return b}var pl=function(o){function u(c){o.call(this,c,dp),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Br(c)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=ec({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Js),Gp={paint:new Na({"hillshade-illumination-direction":new Un(j.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(j.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(j.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(j.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(j.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(j.paint_hillshade["hillshade-accent-color"])})},sg=function(o){function u(c){o.call(this,c,Gp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Js),Vv=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,Wf=Dh,vp=Dh;function Dh(o,u,c){c=c||2;var m,b,E,T,M,D,H,q=u&&u.length,K=q?u[0]*c:o.length,he=zd(o,0,K,c,!0),me=[];if(!he||he.next===he.prev)return me;if(q&&(he=function(He,dt,ot,kt){var jt,ar,sr,br=[];for(jt=0,ar=dt.length;jt<ar;jt++)(sr=zd(He,dt[jt]*kt,jt<ar-1?dt[jt+1]*kt:He.length,kt,!1))===sr.next&&(sr.steiner=!0),br.push(mp(sr));for(br.sort(Vd),jt=0;jt<br.length;jt++)jd(br[jt],ot),ot=Ic(ot,ot.next);return ot}(o,u,he,c)),o.length>80*c){m=E=o[0],b=T=o[1];for(var je=c;je<K;je+=c)(M=o[je])<m&&(m=M),(D=o[je+1])<b&&(b=D),M>E&&(E=M),D>T&&(T=D);H=(H=Math.max(E-m,T-b))!==0?1/H:0}return Lh(he,me,c,m,b,H),me}function zd(o,u,c,m,b){var E,T;if(b===tc(o,u,c,m)>0)for(E=u;E<c;E+=m)T=Yf(E,o[E],o[E+1],T);else for(E=c-m;E>=u;E-=m)T=Yf(E,o[E],o[E+1],T);return T&&Gf(T,T.next)&&(kc(T),T=T.next),T}function Ic(o,u){if(!o)return o;u||(u=o);var c,m=o;do if(c=!1,m.steiner||!Gf(m,m.next)&&no(m.prev,m,m.next)!==0)m=m.next;else{if(kc(m),(m=u=m.prev)===m.next)break;c=!0}while(c||m!==u);return u}function Lh(o,u,c,m,b,E,T){if(o){!T&&E&&function(q,K,he,me){var je=q;do je.z===null&&(je.z=Ol(je.x,je.y,K,he,me)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==q);je.prevZ.nextZ=null,je.prevZ=null,function(He){var dt,ot,kt,jt,ar,sr,br,Nr,on=1;do{for(ot=He,He=null,ar=null,sr=0;ot;){for(sr++,kt=ot,br=0,dt=0;dt<on&&(br++,kt=kt.nextZ);dt++);for(Nr=on;br>0||Nr>0&&kt;)br!==0&&(Nr===0||!kt||ot.z<=kt.z)?(jt=ot,ot=ot.nextZ,br--):(jt=kt,kt=kt.nextZ,Nr--),ar?ar.nextZ=jt:He=jt,jt.prevZ=ar,ar=jt;ot=kt}ar.nextZ=null,on*=2}while(sr>1)}(je)}(o,m,b,E);for(var M,D,H=o;o.prev!==o.next;)if(M=o.prev,D=o.next,E?Zd(o,m,b,E):jv(o))u.push(M.i/c),u.push(o.i/c),u.push(D.i/c),kc(o),o=D.next,H=D.next;else if((o=D)===H){T?T===1?Lh(o=ug(Ic(o),u,c),u,c,m,b,E,2):T===2&&Xp(o,u,c,m,b,E):Lh(Ic(o),u,c,m,b,E,1);break}}}function jv(o){var u=o.prev,c=o,m=o.next;if(no(u,c,m)>=0)return!1;for(var b=o.next.next;b!==o.prev;){if(Pc(u.x,u.y,c.x,c.y,m.x,m.y,b.x,b.y)&&no(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Zd(o,u,c,m){var b=o.prev,E=o,T=o.next;if(no(b,E,T)>=0)return!1;for(var M=b.x>E.x?b.x>T.x?b.x:T.x:E.x>T.x?E.x:T.x,D=b.y>E.y?b.y>T.y?b.y:T.y:E.y>T.y?E.y:T.y,H=Ol(b.x<E.x?b.x<T.x?b.x:T.x:E.x<T.x?E.x:T.x,b.y<E.y?b.y<T.y?b.y:T.y:E.y<T.y?E.y:T.y,u,c,m),q=Ol(M,D,u,c,m),K=o.prevZ,he=o.nextZ;K&&K.z>=H&&he&&he.z<=q;){if(K!==o.prev&&K!==o.next&&Pc(b.x,b.y,E.x,E.y,T.x,T.y,K.x,K.y)&&no(K.prev,K,K.next)>=0||(K=K.prevZ,he!==o.prev&&he!==o.next&&Pc(b.x,b.y,E.x,E.y,T.x,T.y,he.x,he.y)&&no(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;K&&K.z>=H;){if(K!==o.prev&&K!==o.next&&Pc(b.x,b.y,E.x,E.y,T.x,T.y,K.x,K.y)&&no(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;he&&he.z<=q;){if(he!==o.prev&&he!==o.next&&Pc(b.x,b.y,E.x,E.y,T.x,T.y,he.x,he.y)&&no(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function ug(o,u,c){var m=o;do{var b=m.prev,E=m.next.next;!Gf(b,E)&&Xf(b,m,m.next,E)&&Oc(b,E)&&Oc(E,b)&&(u.push(b.i/c),u.push(m.i/c),u.push(E.i/c),kc(m),kc(m.next),m=o=E),m=m.next}while(m!==o);return Ic(m)}function Xp(o,u,c,m,b,E){var T=o;do{for(var M=T.next.next;M!==T.prev;){if(T.i!==M.i&&Yp(T,M)){var D=$f(T,M);return T=Ic(T,T.next),D=Ic(D,D.next),Lh(T,u,c,m,b,E),void Lh(D,u,c,m,b,E)}M=M.next}T=T.next}while(T!==o)}function Vd(o,u){return o.x-u.x}function jd(o,u){if(u=function(m,b){var E,T=b,M=m.x,D=m.y,H=-1/0;do{if(D<=T.y&&D>=T.next.y&&T.next.y!==T.y){var q=T.x+(D-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(q<=M&&q>H){if(H=q,q===M){if(D===T.y)return T;if(D===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==b);if(!E)return null;if(M===H)return E;var K,he=E,me=E.x,je=E.y,He=1/0;T=E;do M>=T.x&&T.x>=me&&M!==T.x&&Pc(D<je?M:H,D,me,je,D<je?H:M,D,T.x,T.y)&&(K=Math.abs(D-T.y)/(M-T.x),Oc(T,m)&&(K<He||K===He&&(T.x>E.x||T.x===E.x&&$p(E,T)))&&(E=T,He=K)),T=T.next;while(T!==he);return E}(o,u)){var c=$f(u,o);Ic(u,u.next),Ic(c,c.next)}}function $p(o,u){return no(o.prev,o,u.prev)<0&&no(u.next,o,o.next)<0}function Ol(o,u,c,m,b){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-c)*b)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*b)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function mp(o){var u=o,c=o;do(u.x<c.x||u.x===c.x&&u.y<c.y)&&(c=u),u=u.next;while(u!==o);return c}function Pc(o,u,c,m,b,E,T,M){return(b-T)*(u-M)-(o-T)*(E-M)>=0&&(o-T)*(m-M)-(c-T)*(u-M)>=0&&(c-T)*(E-M)-(b-T)*(m-M)>=0}function Yp(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(c,m){var b=c;do{if(b.i!==c.i&&b.next.i!==c.i&&b.i!==m.i&&b.next.i!==m.i&&Xf(b,b.next,c,m))return!0;b=b.next}while(b!==c);return!1}(o,u)&&(Oc(o,u)&&Oc(u,o)&&function(c,m){var b=c,E=!1,T=(c.x+m.x)/2,M=(c.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&T<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(E=!E),b=b.next;while(b!==c);return E}(o,u)&&(no(o.prev,o,u.prev)||no(o,u.prev,u))||Gf(o,u)&&no(o.prev,o,o.next)>0&&no(u.prev,u,u.next)>0)}function no(o,u,c){return(u.y-o.y)*(c.x-u.x)-(u.x-o.x)*(c.y-u.y)}function Gf(o,u){return o.x===u.x&&o.y===u.y}function Xf(o,u,c,m){var b=cf(no(o,u,c)),E=cf(no(o,u,m)),T=cf(no(c,m,o)),M=cf(no(c,m,u));return b!==E&&T!==M||!(b!==0||!dl(o,c,u))||!(E!==0||!dl(o,m,u))||!(T!==0||!dl(c,o,m))||!(M!==0||!dl(c,u,m))}function dl(o,u,c){return u.x<=Math.max(o.x,c.x)&&u.x>=Math.min(o.x,c.x)&&u.y<=Math.max(o.y,c.y)&&u.y>=Math.min(o.y,c.y)}function cf(o){return o>0?1:o<0?-1:0}function Oc(o,u){return no(o.prev,o,o.next)<0?no(o,u,o.next)>=0&&no(o,o.prev,u)>=0:no(o,u,o.prev)<0||no(o,o.next,u)<0}function $f(o,u){var c=new Dc(o.i,o.x,o.y),m=new Dc(u.i,u.x,u.y),b=o.next,E=u.prev;return o.next=u,u.prev=o,c.next=b,b.prev=c,m.next=c,c.prev=m,E.next=m,m.prev=E,m}function Yf(o,u,c,m){var b=new Dc(o,u,c);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function kc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Dc(o,u,c){this.i=o,this.x=u,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tc(o,u,c,m){for(var b=0,E=u,T=c-m;E<c;E+=m)b+=(o[T]-o[E])*(o[E+1]+o[T+1]),T=E;return b}function qp(o,u,c,m,b){(function E(T,M,D,H,q){for(;H>D;){if(H-D>600){var K=H-D+1,he=M-D+1,me=Math.log(K),je=.5*Math.exp(2*me/3),He=.5*Math.sqrt(me*je*(K-je)/K)*(he-K/2<0?-1:1);E(T,M,Math.max(D,Math.floor(M-he*je/K+He)),Math.min(H,Math.floor(M+(K-he)*je/K+He)),q)}var dt=T[M],ot=D,kt=H;for(rc(T,D,M),q(T[H],dt)>0&&rc(T,D,H);ot<kt;){for(rc(T,ot,kt),ot++,kt--;q(T[ot],dt)<0;)ot++;for(;q(T[kt],dt)>0;)kt--}q(T[D],dt)===0?rc(T,D,kt):rc(T,++kt,H),kt<=M&&(D=kt+1),M<=kt&&(H=kt-1)}})(o,u,c||0,m||o.length-1,b||ff)}function rc(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}function ff(o,u){return o<u?-1:o>u?1:0}function gp(o,u){var c=o.length;if(c<=1)return[o];for(var m,b,E=[],T=0;T<c;T++){var M=vr(o[T]);M!==0&&(o[T].area=Math.abs(M),b===void 0&&(b=M<0),b===M<0?(m&&E.push(m),m=[o[T]]):m.push(o[T]))}if(m&&E.push(m),u>1)for(var D=0;D<E.length;D++)E[D].length<=u||(qp(E[D],u,1,E[D].length-1,Kp),E[D]=E[D].slice(0,u));return E}function Kp(o,u){return u.area-o.area}function Bh(o,u,c){for(var m=c.patternDependencies,b=!1,E=0,T=u;E<T.length;E+=1){var M=T[E].paint.get(o+"-pattern");M.isConstant()||(b=!0);var D=M.constantOr(null);D&&(b=!0,m[D.to]=!0,m[D.from]=!0)}return b}function Qp(o,u,c,m,b){for(var E=b.patternDependencies,T=0,M=u;T<M.length;T+=1){var D=M[T],H=D.paint.get(o+"-pattern").value;if(H.kind!=="constant"){var q=H.evaluate({zoom:m-1},c,{},b.availableImages),K=H.evaluate({zoom:m},c,{},b.availableImages),he=H.evaluate({zoom:m+1},c,{},b.availableImages);K=K&&K.name?K.name:K,he=he&&he.name?he.name:he,E[q=q&&q.name?q.name:q]=!0,E[K]=!0,E[he]=!0,c.patterns[D.id]={min:q,mid:K,max:he}}}return c}Dh.deviation=function(o,u,c,m){var b=u&&u.length,E=Math.abs(tc(o,0,b?u[0]*c:o.length,c));if(b)for(var T=0,M=u.length;T<M;T++)E-=Math.abs(tc(o,u[T]*c,T<M-1?u[T+1]*c:o.length,c));var D=0;for(T=0;T<m.length;T+=3){var H=m[T]*c,q=m[T+1]*c,K=m[T+2]*c;D+=Math.abs((o[H]-o[K])*(o[q+1]-o[H+1])-(o[H]-o[q])*(o[K+1]-o[H+1]))}return E===0&&D===0?0:Math.abs((D-E)/E)},Dh.flatten=function(o){for(var u=o[0][0].length,c={vertices:[],holes:[],dimensions:u},m=0,b=0;b<o.length;b++){for(var E=0;E<o[b].length;E++)for(var T=0;T<u;T++)c.vertices.push(o[b][E][T]);b>0&&c.holes.push(m+=o[b-1].length)}return c},Wf.default=vp;var tu=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Il,this.indexArray=new hs,this.indexArray2=new Hu,this.programConfigurations=new Kn(o.layers,o.zoom),this.segments=new Ee,this.segments2=new Ee,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};tu.prototype.populate=function(o,u,c){this.hasPattern=Bh("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),b=[],E=0,T=o;E<T.length;E+=1){var M=T[E],D=M.feature,H=M.id,q=M.index,K=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,me=ro(D,he);if(this.layers[0]._featureFilter.filter(new Me(this.zoom),me,c)){var je=m?m.evaluate(me,{},c,u.availableImages):void 0,He={id:H,properties:D.properties,type:D.type,sourceLayerIndex:K,index:q,geometry:he?me.geometry:$a(D),patterns:{},sortKey:je};b.push(He)}}m&&b.sort(function(Nr,on){return Nr.sortKey-on.sortKey});for(var dt=0,ot=b;dt<ot.length;dt+=1){var kt=ot[dt],jt=kt.geometry,ar=kt.index,sr=kt.sourceLayerIndex;if(this.hasPattern){var br=Qp("fill",this.layers,kt,this.zoom,u);this.patternFeatures.push(br)}else this.addFeature(kt,jt,ar,c,{});u.featureIndex.insert(o[ar].feature,jt,ar,sr,this.index)}},tu.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},tu.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.patternFeatures;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},tu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},tu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},tu.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Vv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},tu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},tu.prototype.addFeature=function(o,u,c,m,b){for(var E=0,T=gp(u,500);E<T.length;E+=1){for(var M=T[E],D=0,H=0,q=M;H<q.length;H+=1)D+=q[H].length;for(var K=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),he=K.vertexLength,me=[],je=[],He=0,dt=M;He<dt.length;He+=1){var ot=dt[He];if(ot.length!==0){ot!==M[0]&&je.push(me.length/2);var kt=this.segments2.prepareSegment(ot.length,this.layoutVertexArray,this.indexArray2),jt=kt.vertexLength;this.layoutVertexArray.emplaceBack(ot[0].x,ot[0].y),this.indexArray2.emplaceBack(jt+ot.length-1,jt),me.push(ot[0].x),me.push(ot[0].y);for(var ar=1;ar<ot.length;ar++)this.layoutVertexArray.emplaceBack(ot[ar].x,ot[ar].y),this.indexArray2.emplaceBack(jt+ar-1,jt+ar),me.push(ot[ar].x),me.push(ot[ar].y);kt.vertexLength+=ot.length,kt.primitiveLength+=ot.length}}for(var sr=Wf(me,je),br=0;br<sr.length;br+=3)this.indexArray.emplaceBack(he+sr[br],he+sr[br+1],he+sr[br+2]);K.vertexLength+=D,K.primitiveLength+=sr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},Rn("FillBucket",tu,{omit:["layers","patternFeatures"]});var Lc=new Na({"fill-sort-key":new Pn(j.layout_fill["fill-sort-key"])}),yp={paint:new Na({"fill-antialias":new Un(j.paint_fill["fill-antialias"]),"fill-opacity":new Pn(j.paint_fill["fill-opacity"]),"fill-color":new Pn(j.paint_fill["fill-color"]),"fill-outline-color":new Pn(j.paint_fill["fill-outline-color"]),"fill-translate":new Un(j.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(j.paint_fill["fill-translate-anchor"]),"fill-pattern":new cs(j.paint_fill["fill-pattern"])}),layout:Lc},Hd=function(o){function u(c){o.call(this,c,yp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(c){return new tu(c)},u.prototype.queryRadius=function(){return uo(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,D){return fu(Is(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),E)},u.prototype.isTileClipped=function(){return!0},u}(Js),Fh=_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Jp=nc;function nc(o,u,c,m,b){this.properties={},this.extent=c,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=b,o.readFields(ed,this,u)}function ed(o,u,c){o==1?u.id=c.readVarint():o==2?function(m,b){for(var E=m.readVarint()+m.pos;m.pos<E;){var T=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[T]=M}}(c,u):o==3?u.type=c.readVarint():o==4&&(u._geometry=c.pos)}function vl(o){for(var u,c,m=0,b=0,E=o.length,T=E-1;b<E;T=b++)m+=((c=o[T]).x-(u=o[b]).x)*(u.y+c.y);return m}nc.types=["Unknown","Point","LineString","Polygon"],nc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,c=o.readVarint()+o.pos,m=1,b=0,E=0,T=0,M=[];o.pos<c;){if(b<=0){var D=o.readVarint();m=7&D,b=D>>3}if(b--,m===1||m===2)E+=o.readSVarint(),T+=o.readSVarint(),m===1&&(u&&M.push(u),u=[]),u.push(new oe(E,T));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&M.push(u),M},nc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,c=1,m=0,b=0,E=0,T=1/0,M=-1/0,D=1/0,H=-1/0;o.pos<u;){if(m<=0){var q=o.readVarint();c=7&q,m=q>>3}if(m--,c===1||c===2)(b+=o.readSVarint())<T&&(T=b),b>M&&(M=b),(E+=o.readSVarint())<D&&(D=E),E>H&&(H=E);else if(c!==7)throw new Error("unknown command "+c)}return[T,D,M,H]},nc.prototype.toGeoJSON=function(o,u,c){var m,b,E=this.extent*Math.pow(2,c),T=this.extent*o,M=this.extent*u,D=this.loadGeometry(),H=nc.types[this.type];function q(me){for(var je=0;je<me.length;je++){var He=me[je];me[je]=[360*(He.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(He.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<D.length;m++)K[m]=D[m][0];q(D=K);break;case 2:for(m=0;m<D.length;m++)q(D[m]);break;case 3:for(D=function(me){var je=me.length;if(je<=1)return[me];for(var He,dt,ot=[],kt=0;kt<je;kt++){var jt=vl(me[kt]);jt!==0&&(dt===void 0&&(dt=jt<0),dt===jt<0?(He&&ot.push(He),He=[me[kt]]):He.push(me[kt]))}return He&&ot.push(He),ot}(D),m=0;m<D.length;m++)for(b=0;b<D[m].length;b++)q(D[m][b])}D.length===1?D=D[0]:H="Multi"+H;var he={type:"Feature",geometry:{type:H,coordinates:D},properties:this.properties};return"id"in this&&(he.id=this.id),he};var _p=ru;function ru(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Bc,this,u),this.length=this._features.length}function Bc(o,u,c){o===15?u.version=c.readVarint():o===1?u.name=c.readString():o===5?u.extent=c.readVarint():o===2?u._features.push(c.pos):o===3?u._keys.push(c.readString()):o===4&&u._values.push(function(m){for(var b=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;b=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return b}(c))}function td(o,u,c){if(o===3){var m=new _p(c,c.readVarint()+c.pos);m.length&&(u[m.name]=m)}}ru.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new Jp(this._pbf,u,this.extent,this._keys,this._values)};var ic={VectorTile:function(o,u){this.layers=o.readFields(td,{},u)},VectorTileFeature:Jp,VectorTileLayer:_p},qf=ic.VectorTileFeature.types,Kf=Math.pow(2,13);function Ps(o,u,c,m,b,E,T,M){o.emplaceBack(u,c,2*Math.floor(m*Kf)+T,b*Kf*2,E*Kf*2,Math.round(M))}var As=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.indexArray=new hs,this.programConfigurations=new Kn(o.layers,o.zoom),this.segments=new Ee,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Uo(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}As.prototype.populate=function(o,u,c){this.features=[],this.hasPattern=Bh("fill-extrusion",this.layers,u);for(var m=0,b=o;m<b.length;m+=1){var E=b[m],T=E.feature,M=E.id,D=E.index,H=E.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,K=ro(T,q);if(this.layers[0]._featureFilter.filter(new Me(this.zoom),K,c)){var he={id:M,sourceLayerIndex:H,index:D,geometry:q?K.geometry:$a(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Qp("fill-extrusion",this.layers,he,this.zoom,u)):this.addFeature(he,he.geometry,D,c,{}),u.featureIndex.insert(T,he.geometry,D,H,this.index,!0)}}},As.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.features;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},As.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},As.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},As.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},As.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fh),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},As.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},As.prototype.addFeature=function(o,u,c,m,b){for(var E=0,T=gp(u,500);E<T.length;E+=1){for(var M=T[E],D=0,H=0,q=M;H<q.length;H+=1)D+=q[H].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,me=M;he<me.length;he+=1){var je=me[he];if(je.length!==0&&!((Bi=je).every(function(bi){return bi.x<0})||Bi.every(function(bi){return bi.x>8192})||Bi.every(function(bi){return bi.y<0})||Bi.every(function(bi){return bi.y>8192})))for(var He=0,dt=0;dt<je.length;dt++){var ot=je[dt];if(dt>=1){var kt=je[dt-1];if(!Uo(ot,kt)){K.vertexLength+4>Ee.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var jt=ot.sub(kt)._perp()._unit(),ar=kt.dist(ot);He+ar>32768&&(He=0),Ps(this.layoutVertexArray,ot.x,ot.y,jt.x,jt.y,0,0,He),Ps(this.layoutVertexArray,ot.x,ot.y,jt.x,jt.y,0,1,He),Ps(this.layoutVertexArray,kt.x,kt.y,jt.x,jt.y,0,0,He+=ar),Ps(this.layoutVertexArray,kt.x,kt.y,jt.x,jt.y,0,1,He);var sr=K.vertexLength;this.indexArray.emplaceBack(sr,sr+2,sr+1),this.indexArray.emplaceBack(sr+1,sr+2,sr+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+D>Ee.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),qf[o.type]==="Polygon"){for(var br=[],Nr=[],on=K.vertexLength,Zn=0,En=M;Zn<En.length;Zn+=1){var Wn=En[Zn];if(Wn.length!==0){Wn!==M[0]&&Nr.push(br.length/2);for(var Sn=0;Sn<Wn.length;Sn++){var Ii=Wn[Sn];Ps(this.layoutVertexArray,Ii.x,Ii.y,0,0,1,1,0),br.push(Ii.x),br.push(Ii.y)}}}for(var ai=Wf(br,Nr),Dn=0;Dn<ai.length;Dn+=3)this.indexArray.emplaceBack(on+ai[Dn],on+ai[Dn+2],on+ai[Dn+1]);K.primitiveLength+=ai.length/3,K.vertexLength+=D}}var Bi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},Rn("FillExtrusionBucket",As,{omit:["layers","features"]});var nu={paint:new Na({"fill-extrusion-opacity":new Un(j["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(j["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(j["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(j["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cs(j["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(j["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(j["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(j["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},bp=function(o){function u(c){o.call(this,c,nu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new As(c)},u.prototype.queryRadius=function(){return uo(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,D,H){var q=Is(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),K=this.paint.get("fill-extrusion-height").evaluate(m,b),he=this.paint.get("fill-extrusion-base").evaluate(m,b),me=function(He,dt,ot,kt){for(var jt=[],ar=0,sr=He;ar<sr.length;ar+=1){var br=sr[ar],Nr=[br.x,br.y,0,1];Gu(Nr,Nr,dt),jt.push(new oe(Nr[0]/Nr[3],Nr[1]/Nr[3]))}return jt}(q,H),je=function(He,dt,ot,kt){for(var jt=[],ar=[],sr=kt[8]*dt,br=kt[9]*dt,Nr=kt[10]*dt,on=kt[11]*dt,Zn=kt[8]*ot,En=kt[9]*ot,Wn=kt[10]*ot,Sn=kt[11]*ot,Ii=0,ai=He;Ii<ai.length;Ii+=1){for(var Dn=[],Bi=[],bi=0,$i=ai[Ii];bi<$i.length;bi+=1){var $n=$i[bi],ua=$n.x,Ua=$n.y,co=kt[0]*ua+kt[4]*Ua+kt[12],Ba=kt[1]*ua+kt[5]*Ua+kt[13],za=kt[2]*ua+kt[6]*Ua+kt[14],fo=kt[3]*ua+kt[7]*Ua+kt[15],Go=za+Nr,wo=fo+on,js=co+Zn,is=Ba+En,Hs=za+Wn,Co=fo+Sn,as=new oe((co+sr)/wo,(Ba+br)/wo);as.z=Go/wo,Dn.push(as);var Vi=new oe(js/Co,is/Co);Vi.z=Hs/Co,Bi.push(Vi)}jt.push(Dn),ar.push(Bi)}return[jt,ar]}(E,he,K,H);return function(He,dt,ot){var kt=1/0;fu(ot,dt)&&(kt=rd(ot,dt[0]));for(var jt=0;jt<dt.length;jt++)for(var ar=dt[jt],sr=He[jt],br=0;br<ar.length-1;br++){var Nr=ar[br],on=[Nr,ar[br+1],sr[br+1],sr[br],Nr];cl(ot,on)&&(kt=Math.min(kt,rd(ot,on)))}return kt!==1/0&&kt}(je[0],je[1],me)},u}(Js);function Qf(o,u){return o.x*u.x+o.y*u.y}function rd(o,u){if(o.length===1){for(var c,m=0,b=u[m++];!c||b.equals(c);)if(!(c=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],T=o[0],M=c.sub(b),D=E.sub(b),H=T.sub(b),q=Qf(M,M),K=Qf(M,D),he=Qf(D,D),me=Qf(H,M),je=Qf(H,D),He=q*he-K*K,dt=(he*me-K*je)/He,ot=(q*je-K*me)/He,kt=b.z*(1-dt-ot)+c.z*dt+E.z*ot;if(isFinite(kt))return kt}return 1/0}for(var jt=1/0,ar=0,sr=u;ar<sr.length;ar+=1)jt=Math.min(jt,sr[ar].z);return jt}var Hv=_o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wv=_o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,xp=ic.VectorTileFeature.types,Gv=Math.cos(Math.PI/180*37.5),Wd=Math.pow(2,14)/.5,rs=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){u.gradients[c.id]={}}),this.layoutVertexArray=new bs,this.layoutVertexArray2=new ql,this.indexArray=new hs,this.programConfigurations=new Kn(o.layers,o.zoom),this.segments=new Ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};rs.prototype.populate=function(o,u,c){this.hasPattern=Bh("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),b=[],E=0,T=o;E<T.length;E+=1){var M=T[E],D=M.feature,H=M.id,q=M.index,K=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,me=ro(D,he);if(this.layers[0]._featureFilter.filter(new Me(this.zoom),me,c)){var je=m?m.evaluate(me,{},c):void 0,He={id:H,properties:D.properties,type:D.type,sourceLayerIndex:K,index:q,geometry:he?me.geometry:$a(D),patterns:{},sortKey:je};b.push(He)}}m&&b.sort(function(Nr,on){return Nr.sortKey-on.sortKey});for(var dt=0,ot=b;dt<ot.length;dt+=1){var kt=ot[dt],jt=kt.geometry,ar=kt.index,sr=kt.sourceLayerIndex;if(this.hasPattern){var br=Qp("line",this.layers,kt,this.zoom,u);this.patternFeatures.push(br)}else this.addFeature(kt,jt,ar,c,{});u.featureIndex.insert(o[ar].feature,jt,ar,sr,this.index)}},rs.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},rs.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.patternFeatures;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},rs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},rs.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Wv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Hv),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},rs.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},rs.prototype.addFeature=function(o,u,c,m,b){var E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),M=E.get("line-cap"),D=E.get("line-miter-limit"),H=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var q=0,K=u;q<K.length;q+=1)this.addLine(K[q],o,T,M,D,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},rs.prototype.addLine=function(o,u,c,m,b,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<o.length-1;T++)this.totalDistance+=o[T].dist(o[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=xp[u.type]==="Polygon",D=o.length;D>=2&&o[D-1].equals(o[D-2]);)D--;for(var H=0;H<D-1&&o[H].equals(o[H+1]);)H++;if(!(D<(M?3:2))){c==="bevel"&&(b=1.05);var q,K=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),me=void 0,je=void 0,He=void 0,dt=void 0;this.e1=this.e2=-1,M&&(dt=o[H].sub(q=o[D-2])._unit()._perp());for(var ot=H;ot<D;ot++)if(!(je=ot===D-1?M?o[H+1]:void 0:o[ot+1])||!o[ot].equals(je)){dt&&(He=dt),q&&(me=q),q=o[ot],dt=je?je.sub(q)._unit()._perp():He;var kt=(He=He||dt).add(dt);kt.x===0&&kt.y===0||kt._unit();var jt=He.x*dt.x+He.y*dt.y,ar=kt.x*dt.x+kt.y*dt.y,sr=ar!==0?1/ar:1/0,br=2*Math.sqrt(2-2*ar),Nr=ar<Gv&&me&&je,on=He.x*dt.y-He.y*dt.x>0;if(Nr&&ot>H){var Zn=q.dist(me);if(Zn>2*K){var En=q.sub(q.sub(me)._mult(K/Zn)._round());this.updateDistance(me,En),this.addCurrentVertex(En,He,0,0,he),me=En}}var Wn=me&&je,Sn=Wn?c:M?"butt":m;if(Wn&&Sn==="round"&&(sr<E?Sn="miter":sr<=2&&(Sn="fakeround")),Sn==="miter"&&sr>b&&(Sn="bevel"),Sn==="bevel"&&(sr>2&&(Sn="flipbevel"),sr<b&&(Sn="miter")),me&&this.updateDistance(me,q),Sn==="miter")kt._mult(sr),this.addCurrentVertex(q,kt,0,0,he);else if(Sn==="flipbevel"){if(sr>100)kt=dt.mult(-1);else{var Ii=sr*He.add(dt).mag()/He.sub(dt).mag();kt._perp()._mult(Ii*(on?-1:1))}this.addCurrentVertex(q,kt,0,0,he),this.addCurrentVertex(q,kt.mult(-1),0,0,he)}else if(Sn==="bevel"||Sn==="fakeround"){var ai=-Math.sqrt(sr*sr-1),Dn=on?ai:0,Bi=on?0:ai;if(me&&this.addCurrentVertex(q,He,Dn,Bi,he),Sn==="fakeround")for(var bi=Math.round(180*br/Math.PI/20),$i=1;$i<bi;$i++){var $n=$i/bi;if($n!==.5){var ua=$n-.5;$n+=$n*ua*($n-1)*((1.0904+jt*(jt*(3.55645-1.43519*jt)-3.2452))*ua*ua+(.848013+jt*(.215638*jt-1.06021)))}var Ua=dt.sub(He)._mult($n)._add(He)._unit()._mult(on?-1:1);this.addHalfVertex(q,Ua.x,Ua.y,!1,on,0,he)}je&&this.addCurrentVertex(q,dt,-Dn,-Bi,he)}else if(Sn==="butt")this.addCurrentVertex(q,kt,0,0,he);else if(Sn==="square"){var co=me?1:-1;this.addCurrentVertex(q,kt,co,co,he)}else Sn==="round"&&(me&&(this.addCurrentVertex(q,He,0,0,he),this.addCurrentVertex(q,He,1,1,he,!0)),je&&(this.addCurrentVertex(q,dt,-1,-1,he,!0),this.addCurrentVertex(q,dt,0,0,he)));if(Nr&&ot<D-1){var Ba=q.dist(je);if(Ba>2*K){var za=q.add(je.sub(q)._mult(K/Ba)._round());this.updateDistance(q,za),this.addCurrentVertex(za,dt,0,0,he),q=za}}}}},rs.prototype.addCurrentVertex=function(o,u,c,m,b,E){E===void 0&&(E=!1);var T=u.y*m-u.x,M=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*c,u.y-u.x*c,E,!1,c,b),this.addHalfVertex(o,T,M,E,!0,-m,b),this.distance>Wd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,c,m,b,E))},rs.prototype.addHalfVertex=function(o,u,c,m,b,E,T){var M=.5*(this.lineClips?this.scaledDistance*(Wd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*c)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),b?this.e2=D:this.e1=D},rs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},rs.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},Rn("LineBucket",rs,{omit:["layers","patternFeatures"]});var nd=new Na({"line-cap":new Un(j.layout_line["line-cap"]),"line-join":new Pn(j.layout_line["line-join"]),"line-miter-limit":new Un(j.layout_line["line-miter-limit"]),"line-round-limit":new Un(j.layout_line["line-round-limit"]),"line-sort-key":new Pn(j.layout_line["line-sort-key"])}),Gd={paint:new Na({"line-opacity":new Pn(j.paint_line["line-opacity"]),"line-color":new Pn(j.paint_line["line-color"]),"line-translate":new Un(j.paint_line["line-translate"]),"line-translate-anchor":new Un(j.paint_line["line-translate-anchor"]),"line-width":new Pn(j.paint_line["line-width"]),"line-gap-width":new Pn(j.paint_line["line-gap-width"]),"line-offset":new Pn(j.paint_line["line-offset"]),"line-blur":new Pn(j.paint_line["line-blur"]),"line-dasharray":new fs(j.paint_line["line-dasharray"]),"line-pattern":new cs(j.paint_line["line-pattern"]),"line-gradient":new Eu(j.paint_line["line-gradient"])}),layout:nd},hf=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m){return m=new Me(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,c,m)},u.prototype.evaluate=function(c,m,b,E){return m=Nt({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,c,m,b,E)},u}(Pn))(Gd.paint.properties["line-width"].specification);hf.useIntegerZoom=!0;var Xd=function(o){function u(c){o.call(this,c,Gd),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%ze)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=hf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},u.prototype.createBucket=function(c){return new rs(c)},u.prototype.queryRadius=function(c){var m=c,b=id(Lo("line-width",this,m),Lo("line-gap-width",this,m)),E=Lo("line-offset",this,m);return b/2+Math.abs(E)+uo(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,D){var H=Is(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),q=D/2*id(this.paint.get("line-width").evaluate(m,b),this.paint.get("line-gap-width").evaluate(m,b)),K=this.paint.get("line-offset").evaluate(m,b);return K&&(E=function(he,me){for(var je=[],He=new oe(0,0),dt=0;dt<he.length;dt++){for(var ot=he[dt],kt=[],jt=0;jt<ot.length;jt++){var ar=ot[jt],sr=ot[jt+1],br=jt===0?He:ar.sub(ot[jt-1])._unit()._perp(),Nr=jt===ot.length-1?He:sr.sub(ar)._unit()._perp(),on=br._add(Nr)._unit();on._mult(1/(on.x*Nr.x+on.y*Nr.y)),kt.push(on._mult(me)._add(ar))}je.push(kt)}return je}(E,K*D)),function(he,me,je){for(var He=0;He<me.length;He++){var dt=me[He];if(he.length>=3){for(var ot=0;ot<dt.length;ot++)if(hu(he,dt[ot]))return!0}if(Zs(he,dt,je))return!0}return!1}(H,E,q)},u.prototype.isTileClipped=function(){return!0},u}(Js);function id(o,u){return u>0?u+2*o:o}var Xv=_o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$v=_o([{name:"a_projected_pos",components:3,type:"Float32"}],4),$d=(_o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Yd=(_o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),W=_o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ie(o,u,c){return o.sections.forEach(function(m){m.text=function(b,E,T){var M=E.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Ut.applyArabicShaping&&(b=Ut.applyArabicShaping(b)),b}(m.text,u,c)}),o}_o([{name:"triangle",components:3,type:"Uint16"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_o([{type:"Float32",name:"offsetX"}]),_o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var et={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Jt=function(o,u,c,m,b){var E,T,M=8*b-m-1,D=(1<<M)-1,H=D>>1,q=-7,K=c?b-1:0,he=c?-1:1,me=o[u+K];for(K+=he,E=me&(1<<-q)-1,me>>=-q,q+=M;q>0;E=256*E+o[u+K],K+=he,q-=8);for(T=E&(1<<-q)-1,E>>=-q,q+=m;q>0;T=256*T+o[u+K],K+=he,q-=8);if(E===0)E=1-H;else{if(E===D)return T?NaN:1/0*(me?-1:1);T+=Math.pow(2,m),E-=H}return(me?-1:1)*T*Math.pow(2,E-m)},yr=function(o,u,c,m,b,E){var T,M,D,H=8*E-b-1,q=(1<<H)-1,K=q>>1,he=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=m?0:E-1,je=m?1:-1,He=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(M=isNaN(u)?1:0,T=q):(T=Math.floor(Math.log(u)/Math.LN2),u*(D=Math.pow(2,-T))<1&&(T--,D*=2),(u+=T+K>=1?he/D:he*Math.pow(2,1-K))*D>=2&&(T++,D/=2),T+K>=q?(M=0,T=q):T+K>=1?(M=(u*D-1)*Math.pow(2,b),T+=K):(M=u*Math.pow(2,K-1)*Math.pow(2,b),T=0));b>=8;o[c+me]=255&M,me+=je,M/=256,b-=8);for(T=T<<b|M,H+=b;H>0;o[c+me]=255&T,me+=je,T/=256,H-=8);o[c+me-je]|=128*He},tr=Xt;function Xt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Xt.Varint=0,Xt.Fixed64=1,Xt.Bytes=2,Xt.Fixed32=5;var Ur=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Dr(o){return o.type===Xt.Bytes?o.readVarint()+o.pos:o.pos+1}function Jr(o,u,c){return c?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function jr(o,u,c){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));c.realloc(m);for(var b=c.pos-1;b>=o;b--)c.buf[b+m]=c.buf[b]}function qr(o,u){for(var c=0;c<o.length;c++)u.writeVarint(o[c])}function an(o,u){for(var c=0;c<o.length;c++)u.writeSVarint(o[c])}function Mr(o,u){for(var c=0;c<o.length;c++)u.writeFloat(o[c])}function en(o,u){for(var c=0;c<o.length;c++)u.writeDouble(o[c])}function Ft(o,u){for(var c=0;c<o.length;c++)u.writeBoolean(o[c])}function ur(o,u){for(var c=0;c<o.length;c++)u.writeFixed32(o[c])}function Zr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed32(o[c])}function dn(o,u){for(var c=0;c<o.length;c++)u.writeFixed64(o[c])}function Cr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed64(o[c])}function bn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function kr(o,u,c){o[c]=u,o[c+1]=u>>>8,o[c+2]=u>>>16,o[c+3]=u>>>24}function vn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function wr(o,u,c){o===1&&c.readMessage(fn,u)}function fn(o,u,c){if(o===3){var m=c.readMessage(Xn,{}),b=m.width,E=m.height,T=m.left,M=m.top,D=m.advance;u.push({id:m.id,bitmap:new eu({width:b+6,height:E+6},m.bitmap),metrics:{width:b,height:E,left:T,top:M,advance:D}})}}function Xn(o,u,c){o===1?u.id=c.readVarint():o===2?u.bitmap=c.readBytes():o===3?u.width=c.readVarint():o===4?u.height=c.readVarint():o===5?u.left=c.readSVarint():o===6?u.top=c.readSVarint():o===7&&(u.advance=c.readVarint())}function li(o){for(var u=0,c=0,m=0,b=o;m<b.length;m+=1){var E=b[m];u+=E.w*E.h,c=Math.max(c,E.w)}o.sort(function(He,dt){return dt.h-He.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),c),h:1/0}],M=0,D=0,H=0,q=o;H<q.length;H+=1)for(var K=q[H],he=T.length-1;he>=0;he--){var me=T[he];if(!(K.w>me.w||K.h>me.h)){if(K.x=me.x,K.y=me.y,D=Math.max(D,K.y+K.h),M=Math.max(M,K.x+K.w),K.w===me.w&&K.h===me.h){var je=T.pop();he<T.length&&(T[he]=je)}else K.h===me.h?(me.x+=K.w,me.w-=K.w):K.w===me.w?(me.y+=K.h,me.h-=K.h):(T.push({x:me.x+K.w,y:me.y,w:me.w-K.w,h:K.h}),me.y+=K.h,me.h-=K.h);break}}return{w:M,h:D,fill:u/(M*D)||0}}Xt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),b=m>>3,E=this.pos;this.type=7&m,o(b,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=bn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=vn(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=bn(this.buf,this.pos)+4294967296*bn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=bn(this.buf,this.pos)+4294967296*vn(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Jt(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Jt(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,c,m=this.buf;return u=127&(c=m[this.pos++]),c<128?u:(u|=(127&(c=m[this.pos++]))<<7,c<128?u:(u|=(127&(c=m[this.pos++]))<<14,c<128?u:(u|=(127&(c=m[this.pos++]))<<21,c<128?u:function(b,E,T){var M,D,H=T.buf;if(M=(112&(D=H[T.pos++]))>>4,D<128||(M|=(127&(D=H[T.pos++]))<<3,D<128)||(M|=(127&(D=H[T.pos++]))<<10,D<128)||(M|=(127&(D=H[T.pos++]))<<17,D<128)||(M|=(127&(D=H[T.pos++]))<<24,D<128)||(M|=(1&(D=H[T.pos++]))<<31,D<128))return Jr(b,M,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(c=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Ur?function(c,m,b){return Ur.decode(c.subarray(m,b))}(this.buf,u,o):function(c,m,b){for(var E="",T=m;T<b;){var M,D,H,q=c[T],K=null,he=q>239?4:q>223?3:q>191?2:1;if(T+he>b)break;he===1?q<128&&(K=q):he===2?(192&(M=c[T+1]))==128&&(K=(31&q)<<6|63&M)<=127&&(K=null):he===3?(D=c[T+2],(192&(M=c[T+1]))==128&&(192&D)==128&&((K=(15&q)<<12|(63&M)<<6|63&D)<=2047||K>=55296&&K<=57343)&&(K=null)):he===4&&(D=c[T+2],H=c[T+3],(192&(M=c[T+1]))==128&&(192&D)==128&&(192&H)==128&&((K=(15&q)<<18|(63&M)<<12|(63&D)<<6|63&H)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,he=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),T+=he}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==Xt.Bytes)return o.push(this.readVarint(u));var c=Dr(this);for(o=o||[];this.pos<c;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSVarint());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Xt.Bytes)return o.push(this.readBoolean());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFloat());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Xt.Bytes)return o.push(this.readDouble());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFixed32());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSFixed32());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFixed64());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSFixed64());var u=Dr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===Xt.Varint)for(;this.buf[this.pos++]>127;);else if(u===Xt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Xt.Fixed32)this.pos+=4;else{if(u!==Xt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var c=new Uint8Array(u);c.set(this.buf),this.buf=c,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),kr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),kr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),kr(this.buf,-1&o,this.pos),kr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),kr(this.buf,-1&o,this.pos),kr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,c){var m,b;if(u>=0?(m=u%4294967296|0,b=u/4294967296|0):(b=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,b=b+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(E,T,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(m,0,c),function(E,T){var M=(7&E)<<4;T.buf[T.pos++]|=M|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(b,c)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,b,E){for(var T,M,D=0;D<b.length;D++){if((T=b.charCodeAt(D))>55295&&T<57344){if(!M){T>56319||D+1===b.length?(m[E++]=239,m[E++]=191,m[E++]=189):M=T;continue}if(T<56320){m[E++]=239,m[E++]=191,m[E++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[E++]=239,m[E++]=191,m[E++]=189,M=null);T<128?m[E++]=T:(T<2048?m[E++]=T>>6|192:(T<65536?m[E++]=T>>12|224:(m[E++]=T>>18|240,m[E++]=T>>12&63|128),m[E++]=T>>6&63|128),m[E++]=63&T|128)}return E}(this.buf,o,this.pos);var c=this.pos-u;c>=128&&jr(u,c,this),this.pos=u-1,this.writeVarint(c),this.pos+=c},writeFloat:function(o){this.realloc(4),yr(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),yr(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var c=0;c<u;c++)this.buf[this.pos++]=o[c]},writeRawMessage:function(o,u){this.pos++;var c=this.pos;o(u,this);var m=this.pos-c;m>=128&&jr(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,c){this.writeTag(o,Xt.Bytes),this.writeRawMessage(u,c)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,qr,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,an,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,Ft,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,Mr,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,en,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,ur,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,Zr,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,dn,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Cr,u)},writeBytesField:function(o,u){this.writeTag(o,Xt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,Xt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,Xt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,Xt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,!!u)}};var ln=function(o,u){var c=u.pixelRatio,m=u.version,b=u.stretchX,E=u.stretchY,T=u.content;this.paddedRect=o,this.pixelRatio=c,this.stretchX=b,this.stretchY=E,this.content=T,this.version=m},Fr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Fr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Fr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Fr.tlbr.get=function(){return this.tl.concat(this.br)},Fr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ln.prototype,Fr);var Er=function(o,u){var c={},m={};this.haveRenderCallbacks=[];var b=[];this.addImages(o,c,b),this.addImages(u,m,b);var E=li(b),T=new No({width:E.w||1,height:E.h||1});for(var M in o){var D=o[M],H=c[M].paddedRect;No.copy(D.data,T,{x:0,y:0},{x:H.x+1,y:H.y+1},D.data)}for(var q in u){var K=u[q],he=m[q].paddedRect,me=he.x+1,je=he.y+1,He=K.data.width,dt=K.data.height;No.copy(K.data,T,{x:0,y:0},{x:me,y:je},K.data),No.copy(K.data,T,{x:0,y:dt-1},{x:me,y:je-1},{width:He,height:1}),No.copy(K.data,T,{x:0,y:0},{x:me,y:je+dt},{width:He,height:1}),No.copy(K.data,T,{x:He-1,y:0},{x:me-1,y:je},{width:1,height:dt}),No.copy(K.data,T,{x:0,y:0},{x:me+He,y:je},{width:1,height:dt})}this.image=T,this.iconPositions=c,this.patternPositions=m};Er.prototype.addImages=function(o,u,c){for(var m in o){var b=o[m],E={x:0,y:0,w:b.data.width+2,h:b.data.height+2};c.push(E),u[m]=new ln(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Er.prototype.patchUpdatedImages=function(o,u){for(var c in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[c],o.getImage(c),u),this.patchUpdatedImage(this.patternPositions[c],o.getImage(c),u)},Er.prototype.patchUpdatedImage=function(o,u,c){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;c.update(u.data,void 0,{x:m[0],y:m[1]})}},Rn("ImagePosition",ln),Rn("ImageAtlas",Er);var rr={horizontal:1,vertical:2,horizontalOnly:3},Mi=function(){this.scale=1,this.fontStack="",this.imageName=null};Mi.forText=function(o,u){var c=new Mi;return c.scale=o||1,c.fontStack=u,c},Mi.forImage=function(o){var u=new Mi;return u.imageName=o,u};var it=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Si(o,u,c,m,b,E,T,M,D,H,q,K,he,me,je,He){var dt,ot=it.fromFeature(o,b);K===rr.vertical&&ot.verticalizePunctuation();var kt=Ut.processBidirectionalText,jt=Ut.processStyledBidirectionalText;if(kt&&ot.sections.length===1){dt=[];for(var ar=0,sr=kt(ot.toString(),xo(ot,H,E,u,m,me,je));ar<sr.length;ar+=1){var br=sr[ar],Nr=new it;Nr.text=br,Nr.sections=ot.sections;for(var on=0;on<br.length;on++)Nr.sectionIndex.push(0);dt.push(Nr)}}else if(jt){dt=[];for(var Zn=0,En=jt(ot.text,ot.sectionIndex,xo(ot,H,E,u,m,me,je));Zn<En.length;Zn+=1){var Wn=En[Zn],Sn=new it;Sn.text=Wn[0],Sn.sectionIndex=Wn[1],Sn.sections=ot.sections,dt.push(Sn)}}else dt=function(Dn,Bi){for(var bi=[],$i=Dn.text,$n=0,ua=0,Ua=Bi;ua<Ua.length;ua+=1){var co=Ua[ua];bi.push(Dn.substring($n,co)),$n=co}return $n<$i.length&&bi.push(Dn.substring($n,$i.length)),bi}(ot,xo(ot,H,E,u,m,me,je));var Ii=[],ai={positionedLines:Ii,text:ot.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Dn,Bi,bi,$i,$n,ua,Ua,co,Ba,za,fo,Go){for(var wo=0,js=-17,is=0,Hs=0,Co=co==="right"?1:co==="left"?0:.5,as=0,Vi=0,ji=$n;Vi<ji.length;Vi+=1){var G=ji[Vi];G.trim();var na=G.getMaxScale(),iu=24*(na-1),Os={positionedGlyphs:[],lineOffset:0};Dn.positionedLines[as]=Os;var Za=Os.positionedGlyphs,ao=0;if(G.length()){for(var ws=0;ws<G.length();ws++){var la=G.getSection(ws),oc=G.getSectionIndex(ws),vu=G.getCharCode(ws),sc=0,Ro=null,Nc=null,Yu=null,rh=24,vf=!(Ba===rr.horizontal||!fo&&!of(vu)||fo&&(pi[vu]||(uc=vu,cn.Arabic(uc)||cn["Arabic Supplement"](uc)||cn["Arabic Extended-A"](uc)||cn["Arabic Presentation Forms-A"](uc)||cn["Arabic Presentation Forms-B"](uc))));if(la.imageName){var mf=$i[la.imageName];if(!mf)continue;Yu=la.imageName,Dn.iconsInText=Dn.iconsInText||!0,Nc=mf.paddedRect;var Dl=mf.displaySize;la.scale=24*la.scale/Go,sc=iu+(24-Dl[1]*la.scale),rh=(Ro={width:Dl[0],height:Dl[1],left:1,top:-3,advance:vf?Dl[1]:Dl[0]}).advance;var nh=vf?Dl[0]*la.scale-24*na:Dl[1]*la.scale-24*na;nh>0&&nh>ao&&(ao=nh)}else{var Sp=bi[la.fontStack],gf=Sp&&Sp[vu];if(gf&&gf.rect)Nc=gf.rect,Ro=gf.metrics;else{var yf=Bi[la.fontStack],au=yf&&yf[vu];if(!au)continue;Ro=au.metrics}sc=24*(na-la.scale)}vf?(Dn.verticalizable=!0,Za.push({glyph:vu,imageName:Yu,x:wo,y:js+sc,vertical:vf,scale:la.scale,fontStack:la.fontStack,sectionIndex:oc,metrics:Ro,rect:Nc}),wo+=rh*la.scale+za):(Za.push({glyph:vu,imageName:Yu,x:wo,y:js+sc,vertical:vf,scale:la.scale,fontStack:la.fontStack,sectionIndex:oc,metrics:Ro,rect:Nc}),wo+=Ro.advance*la.scale+za)}Za.length!==0&&(is=Math.max(wo-za,is),Eo(Za,0,Za.length-1,Co,ao)),wo=0;var Ap=ua*na+ao;Os.lineOffset=Math.max(ao,iu),js+=Ap,Hs=Math.max(Ap,Hs),++as}else js+=ua,++as}var uc,Ll=js- -17,Tp=Ca(Ua),ih=Tp.horizontalAlign,wp=Tp.verticalAlign;(function(hd,pd,_f,dd,qd,vd,Cp,md,Kd){var Rp,Uc=(pd-_f)*qd;Rp=vd!==Cp?-md*dd- -17:(-dd*Kd+.5)*Cp;for(var ah=0,oh=hd;ah<oh.length;ah+=1)for(var bf=0,xf=oh[ah].positionedGlyphs;bf<xf.length;bf+=1){var sh=xf[bf];sh.x+=Uc,sh.y+=Rp}})(Dn.positionedLines,Co,ih,wp,is,Hs,ua,Ll,$n.length),Dn.top+=-wp*Ll,Dn.bottom=Dn.top+Ll,Dn.left+=-ih*is,Dn.right=Dn.left+is}(ai,u,c,m,dt,T,M,D,K,H,he,He),!function(Dn){for(var Bi=0,bi=Dn;Bi<bi.length;Bi+=1)if(bi[Bi].positionedGlyphs.length!==0)return!1;return!0}(Ii)&&ai}it.fromFeature=function(o,u){for(var c=new it,m=0;m<o.sections.length;m++){var b=o.sections[m];b.image?c.addImageSection(b):c.addTextSection(b,u)}return c},it.prototype.length=function(){return this.text.length},it.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},it.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},it.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},it.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",c=0;c<o.length;c++){var m=o.charCodeAt(c+1)||null,b=o.charCodeAt(c-1)||null;u+=m&&sf(m)&&!et[o[c+1]]||b&&sf(b)&&!et[o[c-1]]||!et[o[c]]?o[c]:et[o[c]]}return u}(this.text)},it.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&pi[this.text.charCodeAt(u)];u++)o++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=o&&pi[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)},it.prototype.substring=function(o,u){var c=new it;return c.text=this.text.substring(o,u),c.sectionIndex=this.sectionIndex.slice(o,u),c.sections=this.sections,c},it.prototype.toString=function(){return this.text},it.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,c){return Math.max(u,o.sections[c].scale)},0)},it.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(Mi.forText(o.scale,o.fontStack||u));for(var c=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(c)},it.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Mi.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}else Fe("Can't add FormattedSection with an empty image.")},it.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var pi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ei={};function ra(o,u,c,m,b,E){if(u.imageName){var T=m[u.imageName];return T?T.displaySize[0]*u.scale*24/E+b:0}var M=c[u.fontStack],D=M&&M[o];return D?D.metrics.advance*u.scale+b:0}function mo(o,u,c,m){var b=Math.pow(o-u,2);return m?o<u?b/2:2*b:b+Math.abs(c)*c}function go(o,u,c){var m=0;return o===10&&(m-=1e4),c&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Di(o,u,c,m,b,E){for(var T=null,M=mo(u,c,b,E),D=0,H=m;D<H.length;D+=1){var q=H[D],K=mo(u-q.x,c,b,E)+q.badness;K<=M&&(T=q,M=K)}return{index:o,x:u,priorBreak:T,badness:M}}function xo(o,u,c,m,b,E,T){if(E!=="point")return[];if(!o)return[];for(var M,D=[],H=function(dt,ot,kt,jt,ar,sr){for(var br=0,Nr=0;Nr<dt.length();Nr++){var on=dt.getSection(Nr);br+=ra(dt.getCharCode(Nr),on,jt,ar,ot,sr)}return br/Math.max(1,Math.ceil(br/kt))}(o,u,c,m,b,T),q=o.text.indexOf("\u200B")>=0,K=0,he=0;he<o.length();he++){var me=o.getSection(he),je=o.getCharCode(he);if(pi[je]||(K+=ra(je,me,m,b,u,T)),he<o.length()-1){var He=!((M=je)<11904||!(cn["Bopomofo Extended"](M)||cn.Bopomofo(M)||cn["CJK Compatibility Forms"](M)||cn["CJK Compatibility Ideographs"](M)||cn["CJK Compatibility"](M)||cn["CJK Radicals Supplement"](M)||cn["CJK Strokes"](M)||cn["CJK Symbols and Punctuation"](M)||cn["CJK Unified Ideographs Extension A"](M)||cn["CJK Unified Ideographs"](M)||cn["Enclosed CJK Letters and Months"](M)||cn["Halfwidth and Fullwidth Forms"](M)||cn.Hiragana(M)||cn["Ideographic Description Characters"](M)||cn["Kangxi Radicals"](M)||cn["Katakana Phonetic Extensions"](M)||cn.Katakana(M)||cn["Vertical Forms"](M)||cn["Yi Radicals"](M)||cn["Yi Syllables"](M)));(ei[je]||He||me.imageName)&&D.push(Di(he+1,K,H,D,go(je,o.getCharCode(he+1),He&&q),!1))}}return function dt(ot){return ot?dt(ot.priorBreak).concat(ot.index):[]}(Di(o.length(),K,H,D,0,!0))}function Ca(o){var u=.5,c=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:u,verticalAlign:c}}function Eo(o,u,c,m,b){if(m||b)for(var E=o[c],T=(o[c].x+E.metrics.advance*E.scale)*m,M=u;M<=c;M++)o[M].x-=T,o[M].y+=b}function So(o,u,c,m,b,E){var T,M=o.image;if(M.content){var D=M.content,H=M.pixelRatio||1;T=[D[0]/H,D[1]/H,M.displaySize[0]-D[2]/H,M.displaySize[1]-D[3]/H]}var q,K,he,me,je=u.left*E,He=u.right*E;c==="width"||c==="both"?(me=b[0]+je-m[3],K=b[0]+He+m[1]):K=(me=b[0]+(je+He-M.displaySize[0])/2)+M.displaySize[0];var dt=u.top*E,ot=u.bottom*E;return c==="height"||c==="both"?(q=b[1]+dt-m[0],he=b[1]+ot+m[2]):he=(q=b[1]+(dt+ot-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:q,right:K,bottom:he,left:me,collisionPadding:T}}ei[10]=!0,ei[32]=!0,ei[38]=!0,ei[40]=!0,ei[41]=!0,ei[43]=!0,ei[45]=!0,ei[47]=!0,ei[173]=!0,ei[183]=!0,ei[8203]=!0,ei[8208]=!0,ei[8211]=!0,ei[8231]=!0;var Ya=function(o){function u(c,m,b,E){o.call(this,c,m),this.angle=b,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(oe);function zo(o,u){var c=u.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Me(o+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,b=c.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var T=E=Math.max(0,E-1);T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);var M=m[E],D=m[T];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:D,minSize:c.evaluate(new Me(M)),maxSize:c.evaluate(new Me(D)),interpolationType:b}}function Ts(o,u,c){var m=u.uSize,b=c.lowerSize;return o.kind==="source"?b/128:o.kind==="composite"?Ja(b/128,c.upperSize/128,u.uSizeT):m}function Ao(o,u){var c=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var b=o.interpolationType,E=b?Rt(es.interpolationFactor(b,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=Ja(o.minSize,o.maxSize,E):c=E}return{uSizeT:c,uSize:m}}Rn("Anchor",Ya);var Ei=Object.freeze({__proto__:null,getSizeData:zo,evaluateSizeForFeature:Ts,evaluateSizeForZoom:Ao,SIZE_PACK_FACTOR:128});function ps(o,u,c,m,b){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,M=0;M>-c/2;){if(--T<0)return!1;M-=o[T].dist(E),E=o[T]}M+=o[T].dist(o[T+1]),T++;for(var D=[],H=0;M<c/2;){var q=o[T],K=o[T+1];if(!K)return!1;var he=o[T-1].angleTo(q)-q.angleTo(K);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:he}),H+=he;M-D[0].distance>m;)H-=D.shift().angleDelta;if(H>b)return!1;T++,M+=q.dist(K)}return!0}function ha(o){for(var u=0,c=0;c<o.length-1;c++)u+=o[c].dist(o[c+1]);return u}function Qn(o,u,c){return o?.6*u*c:0}function ki(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function Ki(o,u,c,m,b,E){for(var T=Qn(c,b,E),M=ki(c,m)*E,D=0,H=ha(o)/2,q=0;q<o.length-1;q++){var K=o[q],he=o[q+1],me=K.dist(he);if(D+me>H){var je=(H-D)/me,He=Ja(K.x,he.x,je),dt=Ja(K.y,he.y,je),ot=new Ya(He,dt,he.angleTo(K),q);return ot._round(),!T||ps(o,ot,M,T,u)?ot:void 0}D+=me}}function To(o,u,c,m,b,E,T,M,D){var H=Qn(m,E,T),q=ki(m,b),K=q*T,he=o[0].x===0||o[0].x===D||o[0].y===0||o[0].y===D;return u-K<u/4&&(u=K+u/4),function me(je,He,dt,ot,kt,jt,ar,sr,br){for(var Nr=jt/2,on=ha(je),Zn=0,En=He-dt,Wn=[],Sn=0;Sn<je.length-1;Sn++){for(var Ii=je[Sn],ai=je[Sn+1],Dn=Ii.dist(ai),Bi=ai.angleTo(Ii);En+dt<Zn+Dn;){var bi=((En+=dt)-Zn)/Dn,$i=Ja(Ii.x,ai.x,bi),$n=Ja(Ii.y,ai.y,bi);if($i>=0&&$i<br&&$n>=0&&$n<br&&En-Nr>=0&&En+Nr<=on){var ua=new Ya($i,$n,Bi,Sn);ua._round(),ot&&!ps(je,ua,jt,ot,kt)||Wn.push(ua)}}Zn+=Dn}return sr||Wn.length||ar||(Wn=me(je,Zn/2,dt,ot,kt,jt,ar,!0,br)),Wn}(o,he?u/2*M%u:(q/2+2*E)*T*M%u,u,H,c,K,he,!1,D)}function ml(o,u,c,m,b){for(var E=[],T=0;T<o.length;T++)for(var M=o[T],D=void 0,H=0;H<M.length-1;H++){var q=M[H],K=M[H+1];q.x<u&&K.x<u||(q.x<u?q=new oe(u,q.y+(u-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x<u&&(K=new oe(u,q.y+(u-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y<c&&K.y<c||(q.y<c?q=new oe(q.x+(c-q.y)/(K.y-q.y)*(K.x-q.x),c)._round():K.y<c&&(K=new oe(q.x+(c-q.y)/(K.y-q.y)*(K.x-q.x),c)._round()),q.x>=m&&K.x>=m||(q.x>=m?q=new oe(m,q.y+(m-q.x)/(K.x-q.x)*(K.y-q.y))._round():K.x>=m&&(K=new oe(m,q.y+(m-q.x)/(K.x-q.x)*(K.y-q.y))._round()),q.y>=b&&K.y>=b||(q.y>=b?q=new oe(q.x+(b-q.y)/(K.y-q.y)*(K.x-q.x),b)._round():K.y>=b&&(K=new oe(q.x+(b-q.y)/(K.y-q.y)*(K.x-q.x),b)._round()),D&&q.equals(D[D.length-1])||E.push(D=[q]),D.push(K)))))}return E}function $e(o,u,c,m){var b=[],E=o.image,T=E.pixelRatio,M=E.paddedRect.w-2,D=E.paddedRect.h-2,H=o.right-o.left,q=o.bottom-o.top,K=E.stretchX||[[0,M]],he=E.stretchY||[[0,D]],me=function($i,$n){return $i+$n[1]-$n[0]},je=K.reduce(me,0),He=he.reduce(me,0),dt=M-je,ot=D-He,kt=0,jt=je,ar=0,sr=He,br=0,Nr=dt,on=0,Zn=ot;if(E.content&&m){var En=E.content;kt=ir(K,0,En[0]),ar=ir(he,0,En[1]),jt=ir(K,En[0],En[2]),sr=ir(he,En[1],En[3]),br=En[0]-kt,on=En[1]-ar,Nr=En[2]-En[0]-jt,Zn=En[3]-En[1]-sr}var Wn=function($i,$n,ua,Ua){var co=xn($i.stretch-kt,jt,H,o.left),Ba=Ai($i.fixed-br,Nr,$i.stretch,je),za=xn($n.stretch-ar,sr,q,o.top),fo=Ai($n.fixed-on,Zn,$n.stretch,He),Go=xn(ua.stretch-kt,jt,H,o.left),wo=Ai(ua.fixed-br,Nr,ua.stretch,je),js=xn(Ua.stretch-ar,sr,q,o.top),is=Ai(Ua.fixed-on,Zn,Ua.stretch,He),Hs=new oe(co,za),Co=new oe(Go,za),as=new oe(Go,js),Vi=new oe(co,js),ji=new oe(Ba/T,fo/T),G=new oe(wo/T,is/T),na=u*Math.PI/180;if(na){var iu=Math.sin(na),Os=Math.cos(na),Za=[Os,-iu,iu,Os];Hs._matMult(Za),Co._matMult(Za),Vi._matMult(Za),as._matMult(Za)}var ao=$i.stretch+$i.fixed,ws=$n.stretch+$n.fixed;return{tl:Hs,tr:Co,bl:Vi,br:as,tex:{x:E.paddedRect.x+1+ao,y:E.paddedRect.y+1+ws,w:ua.stretch+ua.fixed-ao,h:Ua.stretch+Ua.fixed-ws},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:G,minFontScaleX:Nr/T/H,minFontScaleY:Zn/T/q,isSDF:c}};if(m&&(E.stretchX||E.stretchY))for(var Sn=Yt(K,dt,je),Ii=Yt(he,ot,He),ai=0;ai<Sn.length-1;ai++)for(var Dn=Sn[ai],Bi=Sn[ai+1],bi=0;bi<Ii.length-1;bi++)b.push(Wn(Dn,Ii[bi],Bi,Ii[bi+1]));else b.push(Wn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return b}function ir(o,u,c){for(var m=0,b=0,E=o;b<E.length;b+=1){var T=E[b];m+=Math.max(u,Math.min(c,T[1]))-Math.max(u,Math.min(c,T[0]))}return m}function Yt(o,u,c){for(var m=[{fixed:-1,stretch:0}],b=0,E=o;b<E.length;b+=1){var T=E[b],M=T[0],D=T[1],H=m[m.length-1];m.push({fixed:M-H.stretch,stretch:H.stretch}),m.push({fixed:M-H.stretch,stretch:H.stretch+(D-M)})}return m.push({fixed:u+1,stretch:c}),m}function xn(o,u,c,m){return o/u*c+m}function Ai(o,u,c,m){return o-u*c/m}var Aa=function(o,u,c,m,b,E,T,M,D,H){if(this.boxStartIndex=o.length,D){var q=E.top,K=E.bottom,he=E.collisionPadding;he&&(q-=he[1],K+=he[3]);var me=K-q;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{var je=E.top*T-M,He=E.bottom*T+M,dt=E.left*T-M,ot=E.right*T+M,kt=E.collisionPadding;if(kt&&(dt-=kt[0]*T,je-=kt[1]*T,ot+=kt[2]*T,He+=kt[3]*T),H){var jt=new oe(dt,je),ar=new oe(ot,je),sr=new oe(dt,He),br=new oe(ot,He),Nr=H*Math.PI/180;jt._rotate(Nr),ar._rotate(Nr),sr._rotate(Nr),br._rotate(Nr),dt=Math.min(jt.x,ar.x,sr.x,br.x),ot=Math.max(jt.x,ar.x,sr.x,br.x),je=Math.min(jt.y,ar.y,sr.y,br.y),He=Math.max(jt.y,ar.y,sr.y,br.y)}o.emplaceBack(u.x,u.y,dt,je,ot,He,c,m,b)}this.boxEndIndex=o.length},ve=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Oe),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Oe(o,u){return o<u?-1:o>u?1:0}function tt(o,u,c){u===void 0&&(u=1),c===void 0&&(c=!1);for(var m=1/0,b=1/0,E=-1/0,T=-1/0,M=o[0],D=0;D<M.length;D++){var H=M[D];(!D||H.x<m)&&(m=H.x),(!D||H.y<b)&&(b=H.y),(!D||H.x>E)&&(E=H.x),(!D||H.y>T)&&(T=H.y)}var q=Math.min(E-m,T-b),K=q/2,he=new ve([],qt);if(q===0)return new oe(m,b);for(var me=m;me<E;me+=q)for(var je=b;je<T;je+=q)he.push(new Wt(me+K,je+K,K,o));for(var He=function(kt){for(var jt=0,ar=0,sr=0,br=kt[0],Nr=0,on=br.length,Zn=on-1;Nr<on;Zn=Nr++){var En=br[Nr],Wn=br[Zn],Sn=En.x*Wn.y-Wn.x*En.y;ar+=(En.x+Wn.x)*Sn,sr+=(En.y+Wn.y)*Sn,jt+=3*Sn}return new Wt(ar/jt,sr/jt,0,kt)}(o),dt=he.length;he.length;){var ot=he.pop();(ot.d>He.d||!He.d)&&(He=ot,c&&console.log("found best %d after %d probes",Math.round(1e4*ot.d)/1e4,dt)),ot.max-He.d<=u||(he.push(new Wt(ot.p.x-(K=ot.h/2),ot.p.y-K,K,o)),he.push(new Wt(ot.p.x+K,ot.p.y-K,K,o)),he.push(new Wt(ot.p.x-K,ot.p.y+K,K,o)),he.push(new Wt(ot.p.x+K,ot.p.y+K,K,o)),dt+=4)}return c&&(console.log("num probes: "+dt),console.log("best distance: "+He.d)),He.p}function qt(o,u){return u.max-o.max}function Wt(o,u,c,m){this.p=new oe(o,u),this.h=c,this.d=function(b,E){for(var T=!1,M=1/0,D=0;D<E.length;D++)for(var H=E[D],q=0,K=H.length,he=K-1;q<K;he=q++){var me=H[q],je=H[he];me.y>b.y!=je.y>b.y&&b.x<(je.x-me.x)*(b.y-me.y)/(je.y-me.y)+me.x&&(T=!T),M=Math.min(M,Jl(b,me,je))}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}ve.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},ve.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},ve.prototype.peek=function(){return this.data[0]},ve.prototype._up=function(o){for(var u=this.data,c=this.compare,m=u[o];o>0;){var b=o-1>>1,E=u[b];if(c(m,E)>=0)break;u[o]=E,o=b}u[o]=m},ve.prototype._down=function(o){for(var u=this.data,c=this.compare,m=this.length>>1,b=u[o];o<m;){var E=1+(o<<1),T=u[E],M=E+1;if(M<this.length&&c(u[M],T)<0&&(E=M,T=u[M]),c(T,b)>=0)break;u[o]=T,o=E}u[o]=b};var ht=Number.POSITIVE_INFINITY;function xt(o,u){return u[1]!==ht?function(c,m,b){var E=0,T=0;switch(m=Math.abs(m),b=Math.abs(b),c){case"top-right":case"top-left":case"top":T=b-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-b}switch(c){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,T]}(o,u[0],u[1]):function(c,m){var b=0,E=0;m<0&&(m=0);var T=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(c){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=m;break;case"right":b=-m}return[b,E]}(o,u[0])}function wt(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qe(o,u,c,m,b,E,T,M,D,H,q,K,he,me,je){var He=function(ar,sr,br,Nr,on,Zn,En,Wn){for(var Sn=Nr.layout.get("text-rotate").evaluate(Zn,{})*Math.PI/180,Ii=[],ai=0,Dn=sr.positionedLines;ai<Dn.length;ai+=1)for(var Bi=Dn[ai],bi=0,$i=Bi.positionedGlyphs;bi<$i.length;bi+=1){var $n=$i[bi];if($n.rect){var ua=$n.rect||{},Ua=4,co=!0,Ba=1,za=0,fo=(on||Wn)&&$n.vertical,Go=$n.metrics.advance*$n.scale/2;if(Wn&&sr.verticalizable&&(za=Bi.lineOffset/2-($n.imageName?-(24-$n.metrics.width*$n.scale)/2:24*($n.scale-1))),$n.imageName){var wo=En[$n.imageName];co=wo.sdf,Ua=1/(Ba=wo.pixelRatio)}var js=on?[$n.x+Go,$n.y]:[0,0],is=on?[0,0]:[$n.x+Go+br[0],$n.y+br[1]-za],Hs=[0,0];fo&&(Hs=is,is=[0,0]);var Co=($n.metrics.left-Ua)*$n.scale-Go+is[0],as=(-$n.metrics.top-Ua)*$n.scale+is[1],Vi=Co+ua.w*$n.scale/Ba,ji=as+ua.h*$n.scale/Ba,G=new oe(Co,as),na=new oe(Vi,as),iu=new oe(Co,ji),Os=new oe(Vi,ji);if(fo){var Za=new oe(-Go,Go- -17),ao=-Math.PI/2,ws=12-Go,la=new oe(22-ws,-($n.imageName?ws:0)),oc=new(Function.prototype.bind.apply(oe,[null].concat(Hs)));G._rotateAround(ao,Za)._add(la)._add(oc),na._rotateAround(ao,Za)._add(la)._add(oc),iu._rotateAround(ao,Za)._add(la)._add(oc),Os._rotateAround(ao,Za)._add(la)._add(oc)}if(Sn){var vu=Math.sin(Sn),sc=Math.cos(Sn),Ro=[sc,-vu,vu,sc];G._matMult(Ro),na._matMult(Ro),iu._matMult(Ro),Os._matMult(Ro)}var Nc=new oe(0,0),Yu=new oe(0,0);Ii.push({tl:G,tr:na,bl:iu,br:Os,tex:ua,writingMode:sr.writingMode,glyphOffset:js,sectionIndex:$n.sectionIndex,isSDF:co,pixelOffsetTL:Nc,pixelOffsetBR:Yu,minFontScaleX:0,minFontScaleY:0})}}return Ii}(0,c,M,b,E,T,m,o.allowVerticalPlacement),dt=o.textSizeData,ot=null;dt.kind==="source"?(ot=[128*b.layout.get("text-size").evaluate(T,{})])[0]>32640&&Fe(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):dt.kind==="composite"&&((ot=[128*me.compositeTextSizes[0].evaluate(T,{},je),128*me.compositeTextSizes[1].evaluate(T,{},je)])[0]>32640||ot[1]>32640)&&Fe(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,He,ot,M,E,T,H,u,D.lineStartIndex,D.lineLength,he,je);for(var kt=0,jt=q;kt<jt.length;kt+=1)K[jt[kt]]=o.text.placedSymbolArray.length-1;return 4*He.length}function vt(o){for(var u in o)return o[u];return null}function Pe(o,u,c,m){var b=o.compareText;if(u in b){for(var E=b[u],T=E.length-1;T>=0;T--)if(m.dist(E[T])<c)return!0}else b[u]=[];return b[u].push(m),!1}var _t=ic.VectorTileFeature.types,Lt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hr(o,u,c,m,b,E,T,M,D,H,q,K,he){var me=M?Math.min(32640,Math.round(M[0])):0,je=M?Math.min(32640,Math.round(M[1])):0;o.emplaceBack(u,c,Math.round(32*m),Math.round(32*b),E,T,(me<<1)+(D?1:0),je,16*H,16*q,256*K,256*he)}function Pr(o,u,c){o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c)}function Tr(o){for(var u=0,c=o.sections;u<c.length;u+=1)if(Nf(c[u].text))return!0;return!1}var Ir=function(o){this.layoutVertexArray=new Vf,this.indexArray=new hs,this.programConfigurations=o,this.segments=new Ee,this.dynamicLayoutVertexArray=new Cc,this.opacityVertexArray=new uf,this.placedSymbolArray=new g};Ir.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ir.prototype.upload=function(o,u,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Xv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,$v.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Lt,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(o))},Ir.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Rn("SymbolBuffers",Ir);var Ln=function(o,u,c){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new c,this.segments=new Ee,this.collisionVertexArray=new Mh};Ln.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,$d.members,!0)},Ln.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Rn("CollisionBuffers",Ln);var Mn=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ts([]),this.placementViewportMatrix=ts([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zo(this.zoom,u["text-size"]),this.iconSizeData=zo(this.zoom,u["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),b=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(E){return rr[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};Mn.prototype.createArrays=function(){this.text=new Ir(new Kn(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new Ir(new Kn(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new R,this.lineVertexArray=new P,this.symbolInstances=new w},Mn.prototype.calculateGlyphDependencies=function(o,u,c,m,b){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(c||m)&&b){var T=et[o.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},Mn.prototype.populate=function(o,u,c){var m=this.layers[0],b=m.layout,E=b.get("text-font"),T=b.get("text-field"),M=b.get("icon-image"),D=(T.value.kind!=="constant"||T.value.value instanceof _a&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),H=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,q=b.get("symbol-sort-key");if(this.features=[],D||H){for(var K=u.iconDependencies,he=u.glyphDependencies,me=u.availableImages,je=new Me(this.zoom),He=0,dt=o;He<dt.length;He+=1){var ot=dt[He],kt=ot.feature,jt=ot.id,ar=ot.index,sr=ot.sourceLayerIndex,br=m._featureFilter.needGeometry,Nr=ro(kt,br);if(m._featureFilter.filter(je,Nr,c)){br||(Nr.geometry=$a(kt));var on=void 0;if(D){var Zn=m.getValueAndResolveTokens("text-field",Nr,c,me),En=_a.factory(Zn);Tr(En)&&(this.hasRTLText=!0),(!this.hasRTLText||zf()==="unavailable"||this.hasRTLText&&Ut.isParsed())&&(on=Ie(En,m,Nr))}var Wn=void 0;if(H){var Sn=m.getValueAndResolveTokens("icon-image",Nr,c,me);Wn=Sn instanceof Ia?Sn:Ia.fromString(Sn)}if(on||Wn){var Ii=this.sortFeaturesByKey?q.evaluate(Nr,{},c):void 0;if(this.features.push({id:jt,text:on,icon:Wn,index:ar,sourceLayerIndex:sr,geometry:Nr.geometry,properties:kt.properties,type:_t[kt.type],sortKey:Ii}),Wn&&(K[Wn.name]=!0),on){var ai=E.evaluate(Nr,{},c).join(","),Dn=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rr.vertical)>=0;for(var Bi=0,bi=on.sections;Bi<bi.length;Bi+=1){var $i=bi[Bi];if($i.image)K[$i.image.name]=!0;else{var $n=ul(on.toString()),ua=$i.fontStack||ai,Ua=he[ua]=he[ua]||{};this.calculateGlyphDependencies($i.text,Ua,Dn,this.allowVerticalPlacement,$n)}}}}}}b.get("symbol-placement")==="line"&&(this.features=function(co){var Ba={},za={},fo=[],Go=0;function wo(Za){fo.push(co[Za]),Go++}function js(Za,ao,ws){var la=za[Za];return delete za[Za],za[ao]=la,fo[la].geometry[0].pop(),fo[la].geometry[0]=fo[la].geometry[0].concat(ws[0]),la}function is(Za,ao,ws){var la=Ba[ao];return delete Ba[ao],Ba[Za]=la,fo[la].geometry[0].shift(),fo[la].geometry[0]=ws[0].concat(fo[la].geometry[0]),la}function Hs(Za,ao,ws){var la=ws?ao[0][ao[0].length-1]:ao[0][0];return Za+":"+la.x+":"+la.y}for(var Co=0;Co<co.length;Co++){var as=co[Co],Vi=as.geometry,ji=as.text?as.text.toString():null;if(ji){var G=Hs(ji,Vi),na=Hs(ji,Vi,!0);if(G in za&&na in Ba&&za[G]!==Ba[na]){var iu=is(G,na,Vi),Os=js(G,na,fo[iu].geometry);delete Ba[G],delete za[na],za[Hs(ji,fo[Os].geometry,!0)]=Os,fo[iu].geometry=null}else G in za?js(G,na,Vi):na in Ba?is(G,na,Vi):(wo(Co),Ba[G]=Go-1,za[na]=Go-1)}else wo(Co)}return fo.filter(function(Za){return Za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(co,Ba){return co.sortKey-Ba.sortKey})}},Mn.prototype.update=function(o,u,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,c),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,c))},Mn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Mn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Mn.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Mn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Mn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Mn.prototype.addToLineVertexArray=function(o,u){var c=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),b=o.dist(u[o.segment]),E={},T=o.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:m},T<u.length-1&&(m+=u[T+1].dist(u[T]));for(var M=o.segment||0;M>=0;M--)E[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:b},M>0&&(b+=u[M-1].dist(u[M]));for(var D=0;D<u.length;D++){var H=E[D];this.lineVertexArray.emplaceBack(H.x,H.y,H.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},Mn.prototype.addSymbols=function(o,u,c,m,b,E,T,M,D,H,q,K){for(var he=o.indexArray,me=o.layoutVertexArray,je=o.segments.prepareSegment(4*u.length,me,he,this.canOverlap?E.sortKey:void 0),He=this.glyphOffsetArray.length,dt=je.vertexLength,ot=this.allowVerticalPlacement&&T===rr.vertical?Math.PI/2:0,kt=E.text&&E.text.sections,jt=0;jt<u.length;jt++){var ar=u[jt],sr=ar.tl,br=ar.tr,Nr=ar.bl,on=ar.br,Zn=ar.tex,En=ar.pixelOffsetTL,Wn=ar.pixelOffsetBR,Sn=ar.minFontScaleX,Ii=ar.minFontScaleY,ai=ar.glyphOffset,Dn=ar.isSDF,Bi=ar.sectionIndex,bi=je.vertexLength,$i=ai[1];hr(me,M.x,M.y,sr.x,$i+sr.y,Zn.x,Zn.y,c,Dn,En.x,En.y,Sn,Ii),hr(me,M.x,M.y,br.x,$i+br.y,Zn.x+Zn.w,Zn.y,c,Dn,Wn.x,En.y,Sn,Ii),hr(me,M.x,M.y,Nr.x,$i+Nr.y,Zn.x,Zn.y+Zn.h,c,Dn,En.x,Wn.y,Sn,Ii),hr(me,M.x,M.y,on.x,$i+on.y,Zn.x+Zn.w,Zn.y+Zn.h,c,Dn,Wn.x,Wn.y,Sn,Ii),Pr(o.dynamicLayoutVertexArray,M,ot),he.emplaceBack(bi,bi+1,bi+2),he.emplaceBack(bi+1,bi+2,bi+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),jt!==u.length-1&&Bi===u[jt+1].sectionIndex||o.programConfigurations.populatePaintArrays(me.length,E,E.index,{},K,kt&&kt[Bi])}o.placedSymbolArray.emplaceBack(M.x,M.y,He,this.glyphOffsetArray.length-He,dt,D,H,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],T,0,!1,0,q)},Mn.prototype._addCollisionDebugVertex=function(o,u,c,m,b,E){return u.emplaceBack(0,0),o.emplaceBack(c.x,c.y,m,b,Math.round(E.x),Math.round(E.y))},Mn.prototype.addCollisionDebugVertices=function(o,u,c,m,b,E,T){var M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),D=M.vertexLength,H=b.layoutVertexArray,q=b.collisionVertexArray,K=T.anchorX,he=T.anchorY;this._addCollisionDebugVertex(H,q,E,K,he,new oe(o,u)),this._addCollisionDebugVertex(H,q,E,K,he,new oe(c,u)),this._addCollisionDebugVertex(H,q,E,K,he,new oe(c,m)),this._addCollisionDebugVertex(H,q,E,K,he,new oe(o,m)),M.vertexLength+=4;var me=b.indexArray;me.emplaceBack(D,D+1),me.emplaceBack(D+1,D+2),me.emplaceBack(D+2,D+3),me.emplaceBack(D+3,D),M.primitiveLength+=4},Mn.prototype.addDebugCollisionBoxes=function(o,u,c,m){for(var b=o;b<u;b++){var E=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,c)}},Mn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ln(Kl,Yd.members,Hu),this.iconCollisionBox=new Ln(Kl,Yd.members,Hu);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Mn.prototype._deserializeCollisionBoxesForSymbol=function(o,u,c,m,b,E,T,M,D){for(var H={},q=u;q<c;q++){var K=o.get(q);H.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},H.textFeatureIndex=K.featureIndex;break}for(var he=m;he<b;he++){var me=o.get(he);H.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},H.verticalTextFeatureIndex=me.featureIndex;break}for(var je=E;je<T;je++){var He=o.get(je);H.iconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},H.iconFeatureIndex=He.featureIndex;break}for(var dt=M;dt<D;dt++){var ot=o.get(dt);H.verticalIconBox={x1:ot.x1,y1:ot.y1,x2:ot.x2,y2:ot.y2,anchorPointX:ot.anchorPointX,anchorPointY:ot.anchorPointY},H.verticalIconFeatureIndex=ot.featureIndex;break}return H},Mn.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var c=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},Mn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Mn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Mn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Mn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Mn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Mn.prototype.addIndicesForPlacedSymbol=function(o,u){for(var c=o.placedSymbolArray.get(u),m=c.vertexStartIndex+4*c.numGlyphs,b=c.vertexStartIndex;b<m;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)},Mn.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),c=Math.cos(o),m=[],b=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var M=this.symbolInstances.get(T);m.push(0|Math.round(u*M.anchorX+c*M.anchorY)),b.push(M.featureIndex)}return E.sort(function(D,H){return m[D]-m[H]||b[H]-b[D]}),E},Mn.prototype.addToSortKeyRanges=function(o,u){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===u?c.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},Mn.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var b=this.symbolInstances.get(m[c]);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(E,T,M){E>=0&&M.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Rn("SymbolBucket",Mn,{omit:["layers","collisionBoxArray","features","compareText"]}),Mn.MAX_GLYPHS=65535,Mn.addDynamicAttributes=Pr;var On=new Na({"symbol-placement":new Un(j.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(j.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(j.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(j.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(j.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(j.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(j.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(j.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(j.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(j.layout_symbol["icon-size"]),"icon-text-fit":new Un(j.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(j.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(j.layout_symbol["icon-image"]),"icon-rotate":new Pn(j.layout_symbol["icon-rotate"]),"icon-padding":new Un(j.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(j.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(j.layout_symbol["icon-offset"]),"icon-anchor":new Pn(j.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(j.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(j.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(j.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(j.layout_symbol["text-field"]),"text-font":new Pn(j.layout_symbol["text-font"]),"text-size":new Pn(j.layout_symbol["text-size"]),"text-max-width":new Pn(j.layout_symbol["text-max-width"]),"text-line-height":new Un(j.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(j.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(j.layout_symbol["text-justify"]),"text-radial-offset":new Pn(j.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(j.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(j.layout_symbol["text-anchor"]),"text-max-angle":new Un(j.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(j.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(j.layout_symbol["text-rotate"]),"text-padding":new Un(j.layout_symbol["text-padding"]),"text-keep-upright":new Un(j.layout_symbol["text-keep-upright"]),"text-transform":new Pn(j.layout_symbol["text-transform"]),"text-offset":new Pn(j.layout_symbol["text-offset"]),"text-allow-overlap":new Un(j.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(j.layout_symbol["text-ignore-placement"]),"text-optional":new Un(j.layout_symbol["text-optional"])}),Jn={paint:new Na({"icon-opacity":new Pn(j.paint_symbol["icon-opacity"]),"icon-color":new Pn(j.paint_symbol["icon-color"]),"icon-halo-color":new Pn(j.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(j.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(j.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(j.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(j.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pn(j.paint_symbol["text-opacity"]),"text-color":new Pn(j.paint_symbol["text-color"],{runtimeType:$r,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new Pn(j.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(j.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(j.paint_symbol["text-halo-blur"]),"text-translate":new Un(j.paint_symbol["text-translate"]),"text-translate-anchor":new Un(j.paint_symbol["text-translate-anchor"])}),layout:On},si=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:un,this.defaultValue=o};si.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},si.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},si.prototype.outputDefined=function(){return!1},si.prototype.serialize=function(){return null},Rn("FormatSectionOverride",si,{omit:["defaultValue"]});var pa=function(o){function u(c){o.call(this,c,Jn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){if(o.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var E=[],T=0,M=b;T<M.length;T+=1){var D=M[T];E.indexOf(D)<0&&E.push(D)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(c,m,b,E){var T=this.layout.get(c).evaluate(m,{},b,E),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||zu(M.value)||!T?T:function(D,H){return H.replace(/{([^{}]+)}/g,function(q,K){return K in D?String(D[K]):""})}(m.properties,T)},u.prototype.createBucket=function(c){return new Mn(c)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var c=0,m=Jn.paint.overridableProperties;c<m.length;c+=1){var b=m[c];if(u.hasPaintOverride(this.layout,b)){var E,T=this.paint.get(b),M=new si(T),D=new Hl(M,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new bc("source",D):new Wl("composite",D,T.value.zoomStops,T.value._interpolationType),this.paint._values[b]=new Oo(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,b){return!(!this.layout||m.isDataDriven()||b.isDataDriven())&&u.hasPaintOverride(this.layout,c)},u.hasPaintOverride=function(c,m){var b=c.get("text-field"),E=Jn.paint.properties[m],T=!1,M=function(q){for(var K=0,he=q;K<he.length;K+=1)if(E.overrides&&E.overrides.hasOverride(he[K]))return void(T=!0)};if(b.value.kind==="constant"&&b.value.value instanceof _a)M(b.value.value.sections);else if(b.value.kind==="source"){var D=function(q){T||(q instanceof La&&Pa(q.value)===Gi?M(q.value.sections):q instanceof us?M(q.sections):q.eachChild(D))},H=b.value;H._styleExpression&&D(H._styleExpression.expression)}return T},u}(Js),Zo={paint:new Na({"background-color":new Un(j.paint_background["background-color"]),"background-pattern":new fs(j.paint_background["background-pattern"]),"background-opacity":new Un(j.paint_background["background-opacity"])})},Xu=function(o){function u(c){o.call(this,c,Zo)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Js),Ep={paint:new Na({"raster-opacity":new Un(j.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(j.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(j.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(j.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(j.paint_raster["raster-saturation"]),"raster-contrast":new Un(j.paint_raster["raster-contrast"]),"raster-resampling":new Un(j.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(j.paint_raster["raster-fade-duration"])})},$u=function(o){function u(c){o.call(this,c,Ep)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Js),ad=function(o){function u(c){o.call(this,c,{}),this.implementation=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},u.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},u}(Js),kl={circle:Oh,heatmap:pl,hillshade:sg,fill:Hd,"fill-extrusion":bp,line:Xd,symbol:pa,background:Xu,raster:$u},od=se.HTMLImageElement,pf=se.HTMLCanvasElement,Jf=se.HTMLVideoElement,sd=se.ImageData,ns=se.ImageBitmap,Nh=function(o,u,c,m){this.context=o,this.format=c,this.texture=o.gl.createTexture(),this.update(u,m)};Nh.prototype.update=function(o,u,c){var m=o.width,b=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===b||c),T=this.context,M=T.gl;if(this.useMipmap=!!(u&&u.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,b],o instanceof od||o instanceof pf||o instanceof Jf||o instanceof sd||ns&&o instanceof ns?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,m,b,0,this.format,M.UNSIGNED_BYTE,o.data);else{var D=c||{x:0,y:0},H=D.x,q=D.y;o instanceof od||o instanceof pf||o instanceof Jf||o instanceof sd||ns&&o instanceof ns?M.texSubImage2D(M.TEXTURE_2D,0,H,q,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,H,q,m,b,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Nh.prototype.bind=function(o,u,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Nh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Nh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Yv=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Yv.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},Yv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Uh=function(o,u,c){this.target=o,this.parent=u,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},pr(["receive","process"],this),this.invoker=new Yv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ee()?o:se};function qv(o,u,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}Uh.prototype.send=function(o,u,c,m,b){var E=this;b===void 0&&(b=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[T]=c);var M=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:o,hasCallback:!!c,targetMapId:m,mustQueue:b,sourceMapId:this.mapId,data:ls(u,M)},M),{cancel:function(){c&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},Uh.prototype.receive=function(o){var u=o.data,c=u.id;if(c&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else ee()||u.mustQueue?(this.tasks[c]=u,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,u)},Uh.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},Uh.prototype.processTask=function(o,u){var c=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(xa(u.error)):m(null,xa(u.data)))}else{var b=!1,E=Re(this.globalScope)?void 0:[],T=u.hasCallback?function(q,K){b=!0,delete c.cancelCallbacks[o],c.target.postMessage({id:o,type:"<response>",sourceMapId:c.mapId,error:q?ls(q):null,data:ls(K,E)},E)}:function(q){b=!0},M=null,D=xa(u.data);if(this.parent[u.type])M=this.parent[u.type](u.sourceMapId,D,T);else if(this.parent.getWorkerSource){var H=u.type.split(".");M=this.parent.getWorkerSource(u.sourceMapId,H[0],D.source)[H[1]](D,T)}else T(new Error("Could not find function "+u.type));!b&&M&&M.cancel&&(this.cancelCallbacks[o]=M.cancel)}},Uh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Wo=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Wo.prototype.setNorthEast=function(o){return this._ne=o instanceof qa?new qa(o.lng,o.lat):qa.convert(o),this},Wo.prototype.setSouthWest=function(o){return this._sw=o instanceof qa?new qa(o.lng,o.lat):qa.convert(o),this},Wo.prototype.extend=function(o){var u,c,m=this._sw,b=this._ne;if(o instanceof qa)u=o,c=o;else{if(!(o instanceof Wo))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Wo.convert(o)):this.extend(qa.convert(o)):this;if(c=o._ne,!(u=o._sw)||!c)return this}return m||b?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),b.lng=Math.max(c.lng,b.lng),b.lat=Math.max(c.lat,b.lat)):(this._sw=new qa(u.lng,u.lat),this._ne=new qa(c.lng,c.lat)),this},Wo.prototype.getCenter=function(){return new qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Wo.prototype.getSouthWest=function(){return this._sw},Wo.prototype.getNorthEast=function(){return this._ne},Wo.prototype.getNorthWest=function(){return new qa(this.getWest(),this.getNorth())},Wo.prototype.getSouthEast=function(){return new qa(this.getEast(),this.getSouth())},Wo.prototype.getWest=function(){return this._sw.lng},Wo.prototype.getSouth=function(){return this._sw.lat},Wo.prototype.getEast=function(){return this._ne.lng},Wo.prototype.getNorth=function(){return this._ne.lat},Wo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Wo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Wo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Wo.prototype.contains=function(o){var u=qa.convert(o),c=u.lng,m=u.lat,b=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&b},Wo.convert=function(o){return!o||o instanceof Wo?o:new Wo(o)};var qa=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qa.prototype.wrap=function(){return new qa(St(this.lng,-180,180),this.lat)},qa.prototype.toArray=function(){return[this.lng,this.lat]},qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qa.prototype.distanceTo=function(o){var u=Math.PI/180,c=this.lat*u,m=o.lat*u,b=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(b,1))},qa.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,c=u/Math.cos(Math.PI/180*this.lat);return new Wo(new qa(this.lng-c,this.lat-u),new qa(this.lng+c,this.lat+u))},qa.convert=function(o){if(o instanceof qa)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new qa(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new qa(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var lg=2*Math.PI*63710088e-1;function cg(o){return lg*Math.cos(o*Math.PI/180)}function Ni(o){return(180+o)/360}function Li(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function zh(o,u){return o/cg(u)}function ud(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Zh=function(o,u,c){c===void 0&&(c=0),this.x=+o,this.y=+u,this.z=+c};Zh.fromLngLat=function(o,u){u===void 0&&(u=0);var c=qa.convert(o);return new Zh(Ni(c.lng),Li(c.lat),zh(u,c.lat))},Zh.prototype.toLngLat=function(){return new qa(360*this.x-180,ud(this.y))},Zh.prototype.toAltitude=function(){return this.z*cg(ud(this.y))},Zh.prototype.meterInMercatorCoordinateUnits=function(){return 1/lg*(o=ud(this.y),1/Math.cos(o*Math.PI/180));var o};var eh=function(o,u,c){this.z=o,this.x=u,this.y=c,this.key=ac(0,o,o,u,c)};eh.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},eh.prototype.url=function(o,u){var c,m,b,E,T,M=(m=this.y,b=this.z,E=qv(256*(c=this.x),256*(m=Math.pow(2,b)-m-1),b),T=qv(256*(c+1),256*(m+1),b),E[0]+","+E[1]+","+T[0]+","+T[1]),D=function(H,q,K){for(var he,me="",je=H;je>0;je--)me+=(q&(he=1<<je-1)?1:0)+(K&he?2:0);return me}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",M)},eh.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new oe(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},eh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Kv=function(o,u){this.wrap=o,this.canonical=u,this.key=ac(o,u.z,u.z,u.x,u.y)},io=function(o,u,c,m,b){this.overscaledZ=o,this.wrap=u,this.canonical=new eh(c,+m,+b),this.key=ac(u,o,c,m,b)};function ac(o,u,c,m,b){(o*=2)<0&&(o=-1*o-1);var E=1<<c;return(E*E*o+E*b+m).toString(36)+c.toString(36)+u.toString(36)}io.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},io.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new io(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new io(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},io.prototype.calculateScaledKey=function(o,u){var c=this.canonical.z-o;return o>this.canonical.z?ac(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):ac(this.wrap*+u,o,o,this.canonical.x>>c,this.canonical.y>>c)},io.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},io.prototype.children=function(o){if(this.overscaledZ>=o)return[new io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new io(u,this.wrap,u,c,m),new io(u,this.wrap,u,c+1,m),new io(u,this.wrap,u,c,m+1),new io(u,this.wrap,u,c+1,m+1)]},io.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},io.prototype.wrapped=function(){return new io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},io.prototype.unwrapTo=function(o){return new io(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},io.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},io.prototype.toUnwrapped=function(){return new Kv(this.wrap,this.canonical)},io.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},io.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Zh(o.x-this.wrap,o.y))},Rn("CanonicalTileID",eh),Rn("OverscaledTileID",io,{omit:["posMatrix"]});var Fc=function(o,u,c){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Fe('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=c||"mapbox";for(var b=0;b<m;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(m,b)]=this.data[this._idx(m-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,m)]=this.data[this._idx(b,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Fc.prototype.get=function(o,u){var c=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Fc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Fc.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},Fc.prototype._unpackMapbox=function(o,u,c){return(256*o*256+256*u+c)/10-1e4},Fc.prototype._unpackTerrarium=function(o,u,c){return 256*o+u+c/256-32768},Fc.prototype.getPixels=function(){return new No({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Fc.prototype.backfillBorder=function(o,u,c){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,b=u*this.dim+this.dim,E=c*this.dim,T=c*this.dim+this.dim;switch(u){case-1:m=b-1;break;case 1:b=m+1}switch(c){case-1:E=T-1;break;case 1:T=E+1}for(var M=-u*this.dim,D=-c*this.dim,H=E;H<T;H++)for(var q=m;q<b;q++)this.data[this._idx(q,H)]=o.data[this._idx(q+M,H+D)]},Rn("DEMData",Fc);var ld=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var c=o[u];this._stringToNumber[c]=u,this._numberToString[u]=c}};ld.prototype.encode=function(o){return this._stringToNumber[o]},ld.prototype.decode=function(o){return this._numberToString[o]};var cd=function(o,u,c,m,b){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=c,o._y=m,this.properties=o.properties,this.id=b},fd={geometry:{configurable:!0}};fd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},fd.geometry.set=function(o){this._geometry=o},cd.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(cd.prototype,fd);var Vh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Vh.prototype.updateState=function(o,u,c){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},Nt(this.stateChanges[o][m],c),this.deletedStates[o]===null)for(var b in this.deletedStates[o]={},this.state[o])b!==m&&(this.deletedStates[o][b]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])c[E]||(this.deletedStates[o][m][E]=null);else for(var T in c)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][T]===null&&delete this.deletedStates[o][m][T]},Vh.prototype.removeFeatureState=function(o,u,c){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},c&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][c]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(c in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][c]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},Vh.prototype.getState=function(o,u){var c=String(u),m=Nt({},(this.state[o]||{})[c],(this.stateChanges[o]||{})[c]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var b=this.deletedStates[o][u];if(b===null)return{};for(var E in b)delete m[E]}return m},Vh.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},Vh.prototype.coalesceChanges=function(o,u){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var b={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Nt(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];c[m]=b}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var M={};if(this.deletedStates[T]===null)for(var D in this.state[T])M[D]={},this.state[T][D]={};else for(var H in this.deletedStates[T]){if(this.deletedStates[T][H]===null)this.state[T][H]={};else for(var q=0,K=Object.keys(this.deletedStates[T][H]);q<K.length;q+=1)delete this.state[T][H][K[q]];M[H]=this.state[T][H]}c[T]=c[T]||{},Nt(c[T],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var he in o)o[he].setFeatureState(c,u)};var df=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Po(8192,16,0),this.grid3D=new Po(8192,16,0),this.featureIndexArray=new te,this.promoteId=u};function fg(o,u,c,m,b){return lr(o,function(E,T){var M=u instanceof _s?u.get(T):null;return M&&M.evaluate?M.evaluate(c,m,b):M})}function Qv(o){for(var u=1/0,c=1/0,m=-1/0,b=-1/0,E=0,T=o;E<T.length;E+=1){var M=T[E];u=Math.min(u,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),b=Math.max(b,M.y)}return{minX:u,minY:c,maxX:m,maxY:b}}function hg(o,u){return u-o}df.prototype.insert=function(o,u,c,m,b,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,b);for(var M=E?this.grid3D:this.grid,D=0;D<u.length;D++){for(var H=u[D],q=[1/0,1/0,-1/0,-1/0],K=0;K<H.length;K++){var he=H[K];q[0]=Math.min(q[0],he.x),q[1]=Math.min(q[1],he.y),q[2]=Math.max(q[2],he.x),q[3]=Math.max(q[3],he.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&M.insert(T,q[0],q[1],q[2],q[3])}},df.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ic.VectorTile(new tr(this.rawTileData)).layers,this.sourceLayerCoder=new ld(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},df.prototype.query=function(o,u,c,m){var b=this;this.loadVTLayers();for(var E=o.params||{},T=8192/o.tileSize/o.scale,M=ol(E.filter),D=o.queryGeometry,H=o.queryPadding*T,q=Qv(D),K=this.grid.query(q.minX-H,q.minY-H,q.maxX+H,q.maxY+H),he=Qv(o.cameraQueryGeometry),me=this.grid3D.query(he.minX-H,he.minY-H,he.maxX+H,he.maxY+H,function(ar,sr,br,Nr){return function(on,Zn,En,Wn,Sn){for(var Ii=0,ai=on;Ii<ai.length;Ii+=1){var Dn=ai[Ii];if(Zn<=Dn.x&&En<=Dn.y&&Wn>=Dn.x&&Sn>=Dn.y)return!0}var Bi=[new oe(Zn,En),new oe(Zn,Sn),new oe(Wn,Sn),new oe(Wn,En)];if(on.length>2){for(var bi=0,$i=Bi;bi<$i.length;bi+=1)if(hu(on,$i[bi]))return!0}for(var $n=0;$n<on.length-1;$n++)if(hl(on[$n],on[$n+1],Bi))return!0;return!1}(o.cameraQueryGeometry,ar-H,sr-H,br+H,Nr+H)}),je=0,He=me;je<He.length;je+=1)K.push(He[je]);K.sort(hg);for(var dt,ot={},kt=function(ar){var sr=K[ar];if(sr!==dt){dt=sr;var br=b.featureIndexArray.get(sr),Nr=null;b.loadMatchingFeature(ot,br.bucketIndex,br.sourceLayerIndex,br.featureIndex,M,E.layers,E.availableImages,u,c,m,function(on,Zn,En){return Nr||(Nr=$a(on)),Zn.queryIntersectsFeature(D,on,En,Nr,b.z,o.transform,T,o.pixelPosMatrix)})}},jt=0;jt<K.length;jt++)kt(jt);return ot},df.prototype.loadMatchingFeature=function(o,u,c,m,b,E,T,M,D,H,q){var K=this.bucketLayerIDs[u];if(!E||function(on,Zn){for(var En=0;En<on.length;En++)if(Zn.indexOf(on[En])>=0)return!0;return!1}(E,K)){var he=this.sourceLayerCoder.decode(c),me=this.vtLayers[he].feature(m);if(b.needGeometry){var je=ro(me,!0);if(!b.filter(new Me(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!b.filter(new Me(this.tileID.overscaledZ),me))return;for(var He=this.getId(me,he),dt=0;dt<K.length;dt++){var ot=K[dt];if(!(E&&E.indexOf(ot)<0)){var kt=M[ot];if(kt){var jt={};He!==void 0&&H&&(jt=H.getState(kt.sourceLayer||"_geojsonTileLayer",He));var ar=Nt({},D[ot]);ar.paint=fg(ar.paint,kt.paint,me,jt,T),ar.layout=fg(ar.layout,kt.layout,me,jt,T);var sr=!q||q(me,kt,jt);if(sr){var br=new cd(me,this.z,this.x,this.y,He);br.layer=ar;var Nr=o[ot];Nr===void 0&&(Nr=o[ot]=[]),Nr.push({featureIndex:m,feature:br,intersectionZ:sr})}}}}}},df.prototype.lookupSymbolFeatures=function(o,u,c,m,b,E,T,M){var D={};this.loadVTLayers();for(var H=ol(b),q=0,K=o;q<K.length;q+=1)this.loadMatchingFeature(D,c,m,K[q],H,E,T,M,u);return D},df.prototype.hasLayer=function(o){for(var u=0,c=this.bucketLayerIDs;u<c.length;u+=1)for(var m=0,b=c[u];m<b.length;m+=1)if(o===b[m])return!0;return!1},df.prototype.getId=function(o,u){var c=o.id;return this.promoteId&&typeof(c=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(c=Number(c)),c},Rn("FeatureIndex",df,{omit:["rawTileData","sourceLayerCoder"]});var ds=function(o,u){this.tileID=o,this.uid=Ct(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ds.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<Vr.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},ds.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ds.prototype.loadVectorData=function(o,u,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(H,q){var K={};if(!q)return K;for(var he=function(){var He=je[me],dt=He.layerIds.map(function(jt){return q.getLayer(jt)}).filter(Boolean);if(dt.length!==0){He.layers=dt,He.stateDependentLayerIds&&(He.stateDependentLayers=He.stateDependentLayerIds.map(function(jt){return dt.filter(function(ar){return ar.id===jt})[0]}));for(var ot=0,kt=dt;ot<kt.length;ot+=1)K[kt[ot].id]=He}},me=0,je=H;me<je.length;me+=1)he();return K}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[m];if(b instanceof Mn){if(this.hasSymbolBuckets=!0,!c)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof Mn&&T.hasRTLText){this.hasRTLText=!0,Ut.isLoading()||Ut.isLoaded()||zf()!=="deferred"||Ks();break}}for(var M in this.queryPadding=0,this.buckets){var D=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(M).queryRadius(D))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},ds.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ds.prototype.getBucket=function(o){return this.buckets[o.id]},ds.prototype.upload=function(o){for(var u in this.buckets){var c=this.buckets[u];c.uploadPending()&&c.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nh(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nh(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},ds.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},ds.prototype.queryRenderedFeatures=function(o,u,c,m,b,E,T,M,D,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:H,transform:M,params:T,queryPadding:this.queryPadding*D},o,u,c):{}},ds.prototype.querySourceFeatures=function(o,u){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),b=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(E)for(var T=ol(u&&u.filter),M=this.tileID.canonical,D=M.z,H=M.x,q=M.y,K={z:D,x:H,y:q},he=0;he<E.length;he++){var me=E.feature(he);if(T.needGeometry){var je=ro(me,!0);if(!T.filter(new Me(this.tileID.overscaledZ),je,this.tileID.canonical))continue}else if(!T.filter(new Me(this.tileID.overscaledZ),me))continue;var He=c.getId(me,b),dt=new cd(me,D,H,q,He);dt.tile=K,o.push(dt)}}},ds.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ds.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ds.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var c=V(o.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),b=!1;if(this.expirationTime>m)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ds.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ds.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",T=c[E],M=o[E];if(T&&M&&Object.keys(M).length!==0){b.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=u&&u.style&&u.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(b)))}}}},ds.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ds.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vr.now()},ds.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ds.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=Vr.now()+o},ds.prototype.setDependencies=function(o,u){for(var c={},m=0,b=u;m<b.length;m+=1)c[b[m]]=!0;this.dependencies[o]=c},ds.prototype.hasDependency=function(o,u){for(var c=0,m=o;c<m.length;c+=1){var b=this.dependencies[m[c]];if(b){for(var E=0,T=u;E<T.length;E+=1)if(b[T[E]])return!0}}return!1};var th=se.performance,pg=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},th.mark(this._marks.start)};pg.prototype.finish=function(){th.mark(this._marks.end);var o=th.getEntriesByName(this._marks.measure);return o.length===0&&(th.measure(this._marks.measure,this._marks.start,this._marks.end),o=th.getEntriesByName(this._marks.measure),th.clearMarks(this._marks.start),th.clearMarks(this._marks.end),th.clearMeasures(this._marks.measure)),o},y.Actor=Uh,y.AlphaImage=eu,y.CanonicalTileID=eh,y.CollisionBoxArray=v,y.Color=Ri,y.DEMData=Fc,y.DataConstantProperty=Un,y.DictionaryCoder=ld,y.EXTENT=8192,y.ErrorEvent=Ze,y.EvaluationParameters=Me,y.Event=Ae,y.Evented=at,y.FeatureIndex=df,y.FillBucket=tu,y.FillExtrusionBucket=As,y.ImageAtlas=Er,y.ImagePosition=ln,y.LineBucket=rs,y.LngLat=qa,y.LngLatBounds=Wo,y.MercatorCoordinate=Zh,y.ONE_EM=24,y.OverscaledTileID=io,y.Point=oe,y.Point$1=oe,y.Properties=Na,y.Protobuf=tr,y.RGBAImage=No,y.RequestManager=Lr,y.RequestPerformance=pg,y.ResourceType=z,y.SegmentVector=Ee,y.SourceFeatureState=Vh,y.StructArrayLayout1ui2=Hf,y.StructArrayLayout2f1f2i16=Ql,y.StructArrayLayout2i4=Il,y.StructArrayLayout3ui6=hs,y.StructArrayLayout4i8=Zf,y.SymbolBucket=Mn,y.Texture=Nh,y.Tile=ds,y.Transitionable=pe,y.Uniform1f=Yr,y.Uniform1i=Ar,y.Uniform2f=zr,y.Uniform3f=_n,y.Uniform4f=jn,y.UniformColor=zn,y.UniformMatrix4f=Wi,y.UnwrappedTileID=Kv,y.ValidationError=J,y.WritingMode=rr,y.ZoomHistory=Ff,y.add=function(o,u,c){return o[0]=u[0]+c[0],o[1]=u[1]+c[1],o[2]=u[2]+c[2],o},y.addDynamicAttributes=Pr,y.asyncAll=function(o,u,c){if(!o.length)return c(null,[]);var m=o.length,b=new Array(o.length),E=null;o.forEach(function(T,M){u(T,function(D,H){D&&(E=D),b[M]=H,--m==0&&c(E,b)})})},y.bezier=Ge,y.bindAll=pr,y.browser=Vr,y.cacheEntryPossiblyAdded=function(o){++fe>Gr&&(o.getActor().send("enforceCacheSizeLimit",_r),fe=0)},y.clamp=Rt,y.clearTileCache=function(o){var u=se.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},y.clipLine=ml,y.clone=function(o){var u=new Zi(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},y.clone$1=we,y.clone$2=function(o){var u=new Zi(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},y.collisionCircleLayout=W,y.config=Kr,y.create=function(){var o=new Zi(16);return Zi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},y.create$1=function(){var o=new Zi(9);return Zi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},y.create$2=function(){var o=new Zi(4);return Zi!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},y.createCommonjsModule=ce,y.createExpression=ef,y.createLayout=_o,y.createStyleLayer=function(o){return o.type==="custom"?new ad(o):new kl[o.type](o)},y.cross=function(o,u,c){var m=u[0],b=u[1],E=u[2],T=c[0],M=c[1],D=c[2];return o[0]=b*D-E*M,o[1]=E*T-m*D,o[2]=m*M-b*T,o},y.deepEqual=function o(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],c[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(var b in u)if(!o(u[b],c[b]))return!1;return!0}return u===c},y.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},y.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},y.ease=Ke,y.emitValidationErrors=Yl,y.endsWith=gr,y.enforceCacheSizeLimit=function(o){rn(),Fi&&Fi.then(function(u){u.keys().then(function(c){for(var m=0;m<c.length-o;m++)u.delete(c[m])})})},y.evaluateSizeForFeature=Ts,y.evaluateSizeForZoom=Ao,y.evaluateVariableOffset=xt,y.evented=wc,y.extend=Nt,y.featureFilter=ol,y.filterObject=ut,y.fromRotation=function(o,u){var c=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=c,o[2]=0,o[3]=-c,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},y.getAnchorAlignment=Ca,y.getAnchorJustification=wt,y.getArrayBuffer=Bt,y.getImage=N,y.getJSON=function(o,u){return Dt(Nt(o,{type:"json"}),u)},y.getRTLTextPluginStatus=zf,y.getReferrer=Se,y.getVideo=function(o,u){var c,m,b=se.document.createElement("video");b.muted=!0,b.onloadstart=function(){u(null,b)};for(var E=0;E<o.length;E++){var T=se.document.createElement("source");c=o[E],m=void 0,(m=se.document.createElement("a")).href=c,(m.protocol!==se.document.location.protocol||m.host!==se.document.location.host)&&(b.crossOrigin="Anonymous"),T.src=o[E],b.appendChild(T)}return{cancel:function(){}}},y.identity=ts,y.invert=function(o,u){var c=u[0],m=u[1],b=u[2],E=u[3],T=u[4],M=u[5],D=u[6],H=u[7],q=u[8],K=u[9],he=u[10],me=u[11],je=u[12],He=u[13],dt=u[14],ot=u[15],kt=c*M-m*T,jt=c*D-b*T,ar=c*H-E*T,sr=m*D-b*M,br=m*H-E*M,Nr=b*H-E*D,on=q*He-K*je,Zn=q*dt-he*je,En=q*ot-me*je,Wn=K*dt-he*He,Sn=K*ot-me*He,Ii=he*ot-me*dt,ai=kt*Ii-jt*Sn+ar*Wn+sr*En-br*Zn+Nr*on;return ai?(o[0]=(M*Ii-D*Sn+H*Wn)*(ai=1/ai),o[1]=(b*Sn-m*Ii-E*Wn)*ai,o[2]=(He*Nr-dt*br+ot*sr)*ai,o[3]=(he*br-K*Nr-me*sr)*ai,o[4]=(D*En-T*Ii-H*Zn)*ai,o[5]=(c*Ii-b*En+E*Zn)*ai,o[6]=(dt*ar-je*Nr-ot*jt)*ai,o[7]=(q*Nr-he*ar+me*jt)*ai,o[8]=(T*Sn-M*En+H*on)*ai,o[9]=(m*En-c*Sn-E*on)*ai,o[10]=(je*br-He*ar+ot*kt)*ai,o[11]=(K*ar-q*br-me*kt)*ai,o[12]=(M*Zn-T*Wn-D*on)*ai,o[13]=(c*Wn-m*Zn+b*on)*ai,o[14]=(He*jt-je*sr-dt*kt)*ai,o[15]=(q*sr-K*jt+he*kt)*ai,o):null},y.isChar=cn,y.isMapboxURL=Vn,y.keysDifference=function(o,u){var c=[];for(var m in o)m in u||c.push(m);return c},y.makeRequest=Dt,y.mapObject=lr,y.mercatorXfromLng=Ni,y.mercatorYfromLat=Li,y.mercatorZfromAltitude=zh,y.mul=Mc,y.multiply=lo,y.mvt=ic,y.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},y.normalize=function(o,u){var c=u[0],m=u[1],b=u[2],E=c*c+m*m+b*b;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},y.number=Ja,y.offscreenCanvasSupported=k,y.ortho=function(o,u,c,m,b,E,T){var M=1/(u-c),D=1/(m-b),H=1/(E-T);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*D,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*H,o[11]=0,o[12]=(u+c)*M,o[13]=(b+m)*D,o[14]=(T+E)*H,o[15]=1,o},y.parseGlyphPBF=function(o){return new tr(o).readFields(wr,[])},y.pbf=tr,y.performSymbolLayout=function(o,u,c,m,b,E,T){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var M=o.layers[0].layout,D=o.layers[0]._unevaluatedLayout._values,H={};if(o.textSizeData.kind==="composite"){var q=o.textSizeData,K=q.maxZoom;H.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Me(q.minZoom),T),D["text-size"].possiblyEvaluate(new Me(K),T)]}if(o.iconSizeData.kind==="composite"){var he=o.iconSizeData,me=he.maxZoom;H.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Me(he.minZoom),T),D["icon-size"].possiblyEvaluate(new Me(me),T)]}H.layoutTextSize=D["text-size"].possiblyEvaluate(new Me(o.zoom+1),T),H.layoutIconSize=D["icon-size"].possiblyEvaluate(new Me(o.zoom+1),T),H.textMaxSize=D["text-size"].possiblyEvaluate(new Me(18));for(var je=24*M.get("text-line-height"),He=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",dt=M.get("text-keep-upright"),ot=M.get("text-size"),kt=function(){var sr=ar[jt],br=M.get("text-font").evaluate(sr,{},T).join(","),Nr=ot.evaluate(sr,{},T),on=H.layoutTextSize.evaluate(sr,{},T),Zn=H.layoutIconSize.evaluate(sr,{},T),En={horizontal:{},vertical:void 0},Wn=sr.text,Sn=[0,0];if(Wn){var Ii=Wn.toString(),ai=24*M.get("text-letter-spacing").evaluate(sr,{},T),Dn=function(Vi){for(var ji=0,G=Vi;ji<G.length;ji+=1)if(na=G[ji].charCodeAt(0),cn.Arabic(na)||cn["Arabic Supplement"](na)||cn["Arabic Extended-A"](na)||cn["Arabic Presentation Forms-A"](na)||cn["Arabic Presentation Forms-B"](na))return!1;var na;return!0}(Ii)?ai:0,Bi=M.get("text-anchor").evaluate(sr,{},T),bi=M.get("text-variable-anchor");if(!bi){var $i=M.get("text-radial-offset").evaluate(sr,{},T);Sn=$i?xt(Bi,[24*$i,ht]):M.get("text-offset").evaluate(sr,{},T).map(function(Vi){return 24*Vi})}var $n=He?"center":M.get("text-justify").evaluate(sr,{},T),ua=M.get("symbol-placement"),Ua=ua==="point"?24*M.get("text-max-width").evaluate(sr,{},T):0,co=function(){o.allowVerticalPlacement&&ul(Ii)&&(En.vertical=Si(Wn,u,c,b,br,Ua,je,Bi,"left",Dn,Sn,rr.vertical,!0,ua,on,Nr))};if(!He&&bi){for(var Ba=$n==="auto"?bi.map(function(Vi){return wt(Vi)}):[$n],za=!1,fo=0;fo<Ba.length;fo++){var Go=Ba[fo];if(!En.horizontal[Go])if(za)En.horizontal[Go]=En.horizontal[0];else{var wo=Si(Wn,u,c,b,br,Ua,je,"center",Go,Dn,Sn,rr.horizontal,!1,ua,on,Nr);wo&&(En.horizontal[Go]=wo,za=wo.positionedLines.length===1)}}co()}else{$n==="auto"&&($n=wt(Bi));var js=Si(Wn,u,c,b,br,Ua,je,Bi,$n,Dn,Sn,rr.horizontal,!1,ua,on,Nr);js&&(En.horizontal[$n]=js),co(),ul(Ii)&&He&&dt&&(En.vertical=Si(Wn,u,c,b,br,Ua,je,Bi,$n,Dn,Sn,rr.vertical,!1,ua,on,Nr))}}var is=void 0,Hs=!1;if(sr.icon&&sr.icon.name){var Co=m[sr.icon.name];Co&&(is=function(Vi,ji,G){var na=Ca(G),iu=ji[0]-Vi.displaySize[0]*na.horizontalAlign,Os=ji[1]-Vi.displaySize[1]*na.verticalAlign;return{image:Vi,top:Os,bottom:Os+Vi.displaySize[1],left:iu,right:iu+Vi.displaySize[0]}}(b[sr.icon.name],M.get("icon-offset").evaluate(sr,{},T),M.get("icon-anchor").evaluate(sr,{},T)),Hs=Co.sdf,o.sdfIcons===void 0?o.sdfIcons=Co.sdf:o.sdfIcons!==Co.sdf&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Co.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var as=vt(En.horizontal)||En.vertical;o.iconsInText=!!as&&as.iconsInText,(as||is)&&function(Vi,ji,G,na,iu,Os,Za,ao,ws,la,oc){var vu=Os.textMaxSize.evaluate(ji,{});vu===void 0&&(vu=Za);var sc,Ro=Vi.layers[0].layout,Nc=Ro.get("icon-offset").evaluate(ji,{},oc),Yu=vt(G.horizontal),rh=Za/24,vf=Vi.tilePixelRatio*rh,mf=Vi.tilePixelRatio*vu/24,Dl=Vi.tilePixelRatio*ao,nh=Vi.tilePixelRatio*Ro.get("symbol-spacing"),Sp=Ro.get("text-padding")*Vi.tilePixelRatio,gf=Ro.get("icon-padding")*Vi.tilePixelRatio,yf=Ro.get("text-max-angle")/180*Math.PI,au=Ro.get("text-rotation-alignment")==="map"&&Ro.get("symbol-placement")!=="point",Ap=Ro.get("icon-rotation-alignment")==="map"&&Ro.get("symbol-placement")!=="point",uc=Ro.get("symbol-placement"),Ll=nh/2,Tp=Ro.get("icon-text-fit");na&&Tp!=="none"&&(Vi.allowVerticalPlacement&&G.vertical&&(sc=So(na,G.vertical,Tp,Ro.get("icon-text-fit-padding"),Nc,rh)),Yu&&(na=So(na,Yu,Tp,Ro.get("icon-text-fit-padding"),Nc,rh)));var ih=function(zc,jh){jh.x<0||jh.x>=8192||jh.y<0||jh.y>=8192||function(ho,lc,qy,Zc,Qd,P0,_d,Vc,Jd,bd,ev,tv,rv,Jv,Op,em,tm,rm,nm,im,Mu,xd,am,cc,dg){var om,uh,Hh,Wh,Gh,Xo=ho.addToLineVertexArray(lc,qy),sm=0,um=0,lm=0,cm=0,nv=-1,iv=-1,jc={},fm=Ue(""),av=0,ov=0;if(Vc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(av=(om=Vc.layout.get("text-offset").evaluate(Mu,{},cc).map(function(Ad){return 24*Ad}))[0],ov=om[1]):(av=24*Vc.layout.get("text-radial-offset").evaluate(Mu,{},cc),ov=ht),ho.allowVerticalPlacement&&Zc.vertical){var hm=Vc.layout.get("text-rotate").evaluate(Mu,{},cc)+90;Wh=new Aa(Jd,lc,bd,ev,tv,Zc.vertical,rv,Jv,Op,hm),_d&&(Gh=new Aa(Jd,lc,bd,ev,tv,_d,tm,rm,Op,hm))}if(Qd){var sv=Vc.layout.get("icon-rotate").evaluate(Mu,{}),pm=Vc.layout.get("icon-text-fit")!=="none",dm=$e(Qd,sv,am,pm),uv=_d?$e(_d,sv,am,pm):void 0;Hh=new Aa(Jd,lc,bd,ev,tv,Qd,tm,rm,!1,sv),sm=4*dm.length;var vm=ho.iconSizeData,Ed=null;vm.kind==="source"?(Ed=[128*Vc.layout.get("icon-size").evaluate(Mu,{})])[0]>32640&&Fe(ho.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):vm.kind==="composite"&&((Ed=[128*xd.compositeIconSizes[0].evaluate(Mu,{},cc),128*xd.compositeIconSizes[1].evaluate(Mu,{},cc)])[0]>32640||Ed[1]>32640)&&Fe(ho.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ho.addSymbols(ho.icon,dm,Ed,im,nm,Mu,!1,lc,Xo.lineStartIndex,Xo.lineLength,-1,cc),nv=ho.icon.placedSymbolArray.length-1,uv&&(um=4*uv.length,ho.addSymbols(ho.icon,uv,Ed,im,nm,Mu,rr.vertical,lc,Xo.lineStartIndex,Xo.lineLength,-1,cc),iv=ho.icon.placedSymbolArray.length-1)}for(var vg in Zc.horizontal){var lv=Zc.horizontal[vg];if(!uh){fm=Ue(lv.text);var O0=Vc.layout.get("text-rotate").evaluate(Mu,{},cc);uh=new Aa(Jd,lc,bd,ev,tv,lv,rv,Jv,Op,O0)}var mm=lv.positionedLines.length===1;if(lm+=qe(ho,lc,lv,P0,Vc,Op,Mu,em,Xo,Zc.vertical?rr.horizontal:rr.horizontalOnly,mm?Object.keys(Zc.horizontal):[vg],jc,nv,xd,cc),mm)break}Zc.vertical&&(cm+=qe(ho,lc,Zc.vertical,P0,Vc,Op,Mu,em,Xo,rr.vertical,["vertical"],jc,iv,xd,cc));var mg=uh?uh.boxStartIndex:ho.collisionBoxArray.length,gm=uh?uh.boxEndIndex:ho.collisionBoxArray.length,gg=Wh?Wh.boxStartIndex:ho.collisionBoxArray.length,yg=Wh?Wh.boxEndIndex:ho.collisionBoxArray.length,_g=Hh?Hh.boxStartIndex:ho.collisionBoxArray.length,k0=Hh?Hh.boxEndIndex:ho.collisionBoxArray.length,bg=Gh?Gh.boxStartIndex:ho.collisionBoxArray.length,D0=Gh?Gh.boxEndIndex:ho.collisionBoxArray.length,fc=-1,Sd=function(Ad,Eg){return Ad&&Ad.circleDiameter?Math.max(Ad.circleDiameter,Eg):Eg};fc=Sd(uh,fc),fc=Sd(Wh,fc),fc=Sd(Hh,fc);var xg=(fc=Sd(Gh,fc))>-1?1:0;xg&&(fc*=dg/24),ho.glyphOffsetArray.length>=Mn.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mu.sortKey!==void 0&&ho.addToSortKeyRanges(ho.symbolInstances.length,Mu.sortKey),ho.symbolInstances.emplaceBack(lc.x,lc.y,jc.right>=0?jc.right:-1,jc.center>=0?jc.center:-1,jc.left>=0?jc.left:-1,jc.vertical||-1,nv,iv,fm,mg,gm,gg,yg,_g,k0,bg,D0,bd,lm,cm,sm,um,xg,0,rv,av,ov,fc)}(Vi,jh,zc,G,na,iu,sc,Vi.layers[0],Vi.collisionBoxArray,ji.index,ji.sourceLayerIndex,Vi.index,vf,Sp,au,ws,Dl,gf,Ap,Nc,ji,Os,la,oc,Za)};if(uc==="line")for(var wp=0,hd=ml(ji.geometry,0,0,8192,8192);wp<hd.length;wp+=1)for(var pd=hd[wp],_f=0,dd=To(pd,nh,yf,G.vertical||Yu,na,24,mf,Vi.overscaling,8192);_f<dd.length;_f+=1){var qd=dd[_f];Yu&&Pe(Vi,Yu.text,Ll,qd)||ih(pd,qd)}else if(uc==="line-center")for(var vd=0,Cp=ji.geometry;vd<Cp.length;vd+=1){var md=Cp[vd];if(md.length>1){var Kd=Ki(md,yf,G.vertical||Yu,na,24,mf);Kd&&ih(md,Kd)}}else if(ji.type==="Polygon")for(var Rp=0,Uc=gp(ji.geometry,0);Rp<Uc.length;Rp+=1){var ah=Uc[Rp],oh=tt(ah,16);ih(ah[0],new Ya(oh.x,oh.y,0))}else if(ji.type==="LineString")for(var bf=0,xf=ji.geometry;bf<xf.length;bf+=1){var sh=xf[bf];ih(sh,new Ya(sh[0].x,sh[0].y,0))}else if(ji.type==="Point")for(var gd=0,Mp=ji.geometry;gd<Mp.length;gd+=1)for(var yd=0,Ip=Mp[gd];yd<Ip.length;yd+=1){var Pp=Ip[yd];ih([Pp],new Ya(Pp.x,Pp.y,0))}}(o,sr,En,is,m,H,on,Zn,Sn,Hs,T)},jt=0,ar=o.features;jt<ar.length;jt+=1)kt();E&&o.generateCollisionDebugBuffers()},y.perspective=function(o,u,c,m,b){var E,T=1/Math.tan(u/2);return o[0]=T/c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,b!=null&&b!==1/0?(o[10]=(b+m)*(E=1/(m-b)),o[14]=2*b*m*E):(o[10]=-1,o[14]=-2*m),o},y.pick=function(o,u){for(var c={},m=0;m<u.length;m++){var b=u[m];b in o&&(c[b]=o[b])}return c},y.plugin=Ut,y.polygonIntersectsPolygon=cl,y.postMapLoadEvent=Gt,y.postTurnstileEvent=po,y.potpack=li,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Rn,y.registerForPluginStateChange=function(o){return o({pluginStatus:ys,pluginURL:xu}),wc.on("pluginStateChange",o),o},y.renderColorRamp=ec,y.rotate=function(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3],M=Math.sin(c),D=Math.cos(c);return o[0]=m*D+E*M,o[1]=b*D+T*M,o[2]=m*-M+E*D,o[3]=b*-M+T*D,o},y.rotateX=function(o,u,c){var m=Math.sin(c),b=Math.cos(c),E=u[4],T=u[5],M=u[6],D=u[7],H=u[8],q=u[9],K=u[10],he=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*b+H*m,o[5]=T*b+q*m,o[6]=M*b+K*m,o[7]=D*b+he*m,o[8]=H*b-E*m,o[9]=q*b-T*m,o[10]=K*b-M*m,o[11]=he*b-D*m,o},y.rotateZ=function(o,u,c){var m=Math.sin(c),b=Math.cos(c),E=u[0],T=u[1],M=u[2],D=u[3],H=u[4],q=u[5],K=u[6],he=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*b+H*m,o[1]=T*b+q*m,o[2]=M*b+K*m,o[3]=D*b+he*m,o[4]=H*b-E*m,o[5]=q*b-T*m,o[6]=K*b-M*m,o[7]=he*b-D*m,o},y.scale=function(o,u,c){var m=c[0],b=c[1],E=c[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*b,o[5]=u[5]*b,o[6]=u[6]*b,o[7]=u[7]*b,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},y.scale$1=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o[3]=u[3]*c,o},y.scale$2=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o},y.setCacheLimits=function(o,u){_r=o,Gr=u},y.setRTLTextPlugin=function(o,u,c){if(c===void 0&&(c=!1),ys==="deferred"||ys==="loading"||ys==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xu=Vr.resolveURL(o),ys="deferred",Uf=u,Tc(),c||Ks()},y.sphericalToCartesian=function(o){var u=o[0],c=o[1],m=o[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(m),y:u*Math.sin(c)*Math.sin(m),z:u*Math.cos(m)}},y.sqrLen=function(o){var u=o[0],c=o[1];return u*u+c*c},y.styleSpec=j,y.sub=function(o,u,c){return o[0]=u[0]-c[0],o[1]=u[1]-c[1],o[2]=u[2]-c[2],o},y.symbolSize=Ei,y.transformMat3=function(o,u,c){var m=u[0],b=u[1],E=u[2];return o[0]=m*c[0]+b*c[3]+E*c[6],o[1]=m*c[1]+b*c[4]+E*c[7],o[2]=m*c[2]+b*c[5]+E*c[8],o},y.transformMat4=Gu,y.translate=function(o,u,c){var m,b,E,T,M,D,H,q,K,he,me,je,He=c[0],dt=c[1],ot=c[2];return u===o?(o[12]=u[0]*He+u[4]*dt+u[8]*ot+u[12],o[13]=u[1]*He+u[5]*dt+u[9]*ot+u[13],o[14]=u[2]*He+u[6]*dt+u[10]*ot+u[14],o[15]=u[3]*He+u[7]*dt+u[11]*ot+u[15]):(b=u[1],E=u[2],T=u[3],M=u[4],D=u[5],H=u[6],q=u[7],K=u[8],he=u[9],me=u[10],je=u[11],o[0]=m=u[0],o[1]=b,o[2]=E,o[3]=T,o[4]=M,o[5]=D,o[6]=H,o[7]=q,o[8]=K,o[9]=he,o[10]=me,o[11]=je,o[12]=m*He+M*dt+K*ot+u[12],o[13]=b*He+D*dt+he*ot+u[13],o[14]=E*He+H*dt+me*ot+u[14],o[15]=T*He+q*dt+je*ot+u[15]),o},y.triggerPluginCompletionEvent=pp,y.uniqueId=Ct,y.validateCustomStyleLayer=function(o){var u=[],c=o.id;return c===void 0&&u.push({message:"layers."+c+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+c+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),u},y.validateLight=hp,y.validateStyle=qs,y.values=function(o){var u=[];for(var c in o)u.push(o[c]);return u},y.vectorTile=ic,y.version="1.13.3",y.warnOnce=Fe,y.webpSupported=Or,y.window=se,y.wrap=St}),de(["./shared"],function(y){"use strict";function ce(U){var N=typeof U;if(N==="number"||N==="boolean"||N==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){for(var $="[",ae=0,Ae=U;ae<Ae.length;ae+=1)$+=ce(Ae[ae])+",";return $+"]"}for(var Ze=Object.keys(U).sort(),at="{",j=0;j<Ze.length;j++)at+=JSON.stringify(Ze[j])+":"+ce(U[Ze[j]])+",";return at+"}"}function L(U){for(var N="",$=0,ae=y.refProperties;$<ae.length;$+=1)N+="/"+ce(U[ae[$]]);return N}var ue=function(U){this.keyCache={},U&&this.replace(U)};ue.prototype.replace=function(U){this._layerConfigs={},this._layers={},this.update(U,[])},ue.prototype.update=function(U,N){for(var $=this,ae=0,Ae=U;ae<Ae.length;ae+=1){var Ze=Ae[ae];this._layerConfigs[Ze.id]=Ze;var at=this._layers[Ze.id]=y.createStyleLayer(Ze);at._featureFilter=y.featureFilter(at.filter),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id]}for(var j=0,J=N;j<J.length;j+=1){var Ne=J[j];delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne]}this.familiesBySource={};for(var st=0,Te=function(Wr,$r){for(var ii={},pn=0;pn<Wr.length;pn++){var mi=$r&&$r[Wr[pn].id]||L(Wr[pn]);$r&&($r[Wr[pn].id]=mi);var Gi=ii[mi];Gi||(Gi=ii[mi]=[]),Gi.push(Wr[pn])}var di=[];for(var Ui in ii)di.push(ii[Ui]);return di}(y.values(this._layerConfigs),this.keyCache);st<Te.length;st+=1){var Kt=Te[st].map(function(Wr){return $._layers[Wr.id]}),xr=Kt[0];if(xr.visibility!=="none"){var sn=xr.source||"",un=this.familiesBySource[sn];un||(un=this.familiesBySource[sn]={});var nr=xr.sourceLayer||"_geojsonTileLayer",Qr=un[nr];Qr||(Qr=un[nr]=[]),Qr.push(Kt)}}};var oe=function(U){var N={},$=[];for(var ae in U){var Ae=U[ae],Ze=N[ae]={};for(var at in Ae){var j=Ae[+at];if(j&&j.bitmap.width!==0&&j.bitmap.height!==0){var J={x:0,y:0,w:j.bitmap.width+2,h:j.bitmap.height+2};$.push(J),Ze[at]={rect:J,metrics:j.metrics}}}}var Ne=y.potpack($),st=new y.AlphaImage({width:Ne.w||1,height:Ne.h||1});for(var Te in U){var Kt=U[Te];for(var xr in Kt){var sn=Kt[+xr];if(sn&&sn.bitmap.width!==0&&sn.bitmap.height!==0){var un=N[Te][xr].rect;y.AlphaImage.copy(sn.bitmap,st,{x:0,y:0},{x:un.x+1,y:un.y+1},sn.bitmap)}}}this.image=st,this.positions=N};y.register("GlyphAtlas",oe);var Be=function(U){this.tileID=new y.OverscaledTileID(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId};function se(U,N,$){for(var ae=new y.EvaluationParameters(N),Ae=0,Ze=U;Ae<Ze.length;Ae+=1)Ze[Ae].recalculate(ae,$)}function ze(U,N){var $=y.getArrayBuffer(U.request,function(ae,Ae,Ze,at){ae?N(ae):Ae&&N(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Ae)),rawData:Ae,cacheControl:Ze,expires:at})});return function(){$.cancel(),N()}}Be.prototype.parse=function(U,N,$,ae,Ae){var Ze=this;this.status="parsing",this.data=U,this.collisionBoxArray=new y.CollisionBoxArray;var at=new y.DictionaryCoder(Object.keys(U.layers).sort()),j=new y.FeatureIndex(this.tileID,this.promoteId);j.bucketLayerIDs=[];var J,Ne,st,Te,Kt={},xr={featureIndex:j,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},sn=N.familiesBySource[this.source];for(var un in sn){var nr=U.layers[un];if(nr){nr.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Qr=at.encode(un),Wr=[],$r=0;$r<nr.length;$r++){var ii=nr.feature($r),pn=j.getId(ii,un);Wr.push({feature:ii,id:pn,index:$r,sourceLayerIndex:Qr})}for(var mi=0,Gi=sn[un];mi<Gi.length;mi+=1){var di=Gi[mi],Ui=di[0];Ui.minzoom&&this.zoom<Math.floor(Ui.minzoom)||Ui.maxzoom&&this.zoom>=Ui.maxzoom||Ui.visibility!=="none"&&(se(di,this.zoom,$),(Kt[Ui.id]=Ui.createBucket({index:j.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qr,sourceID:this.source})).populate(Wr,xr,this.tileID.canonical),j.bucketLayerIDs.push(di.map(function(Ci){return Ci.id})))}}}var wi=y.mapObject(xr.glyphDependencies,function(Ci){return Object.keys(Ci).map(Number)});Object.keys(wi).length?ae.send("getGlyphs",{uid:this.uid,stacks:wi},function(Ci,yi){J||(J=Ci,Ne=yi,ka.call(Ze))}):Ne={};var ss=Object.keys(xr.iconDependencies);ss.length?ae.send("getImages",{icons:ss,source:this.source,tileID:this.tileID,type:"icons"},function(Ci,yi){J||(J=Ci,st=yi,ka.call(Ze))}):st={};var oa=Object.keys(xr.patternDependencies);function ka(){if(J)return Ae(J);if(Ne&&st&&Te){var Ci=new oe(Ne),yi=new y.ImageAtlas(st,Te);for(var Ri in Kt){var Da=Kt[Ri];Da instanceof y.SymbolBucket?(se(Da.layers,this.zoom,$),y.performSymbolLayout(Da,Ne,Ci.positions,st,yi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Da.hasPattern&&(Da instanceof y.LineBucket||Da instanceof y.FillBucket||Da instanceof y.FillExtrusionBucket)&&(se(Da.layers,this.zoom,$),Da.addFeatures(xr,this.tileID.canonical,yi.patternPositions))}this.status="done",Ae(null,{buckets:y.values(Kt).filter(function(gu){return!gu.isEmpty()}),featureIndex:j,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:yi,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?st:null,glyphPositions:this.returnDependencies?Ci.positions:null})}}oa.length?ae.send("getImages",{icons:oa,source:this.source,tileID:this.tileID,type:"patterns"},function(Ci,yi){J||(J=Ci,Te=yi,ka.call(Ze))}):Te={},ka.call(this)};var Ge=function(U,N,$,ae){this.actor=U,this.layerIndex=N,this.availableImages=$,this.loadVectorData=ae||ze,this.loading={},this.loaded={}};Ge.prototype.loadTile=function(U,N){var $=this,ae=U.uid;this.loading||(this.loading={});var Ae=!!(U&&U.request&&U.request.collectResourceTiming)&&new y.RequestPerformance(U.request),Ze=this.loading[ae]=new Be(U);Ze.abort=this.loadVectorData(U,function(at,j){if(delete $.loading[ae],at||!j)return Ze.status="done",$.loaded[ae]=Ze,N(at);var J=j.rawData,Ne={};j.expires&&(Ne.expires=j.expires),j.cacheControl&&(Ne.cacheControl=j.cacheControl);var st={};if(Ae){var Te=Ae.finish();Te&&(st.resourceTiming=JSON.parse(JSON.stringify(Te)))}Ze.vectorTile=j.vectorTile,Ze.parse(j.vectorTile,$.layerIndex,$.availableImages,$.actor,function(Kt,xr){if(Kt||!xr)return N(Kt);N(null,y.extend({rawTileData:J.slice(0)},xr,Ne,st))}),$.loaded=$.loaded||{},$.loaded[ae]=Ze})},Ge.prototype.reloadTile=function(U,N){var $=this,ae=this.loaded,Ae=U.uid,Ze=this;if(ae&&ae[Ae]){var at=ae[Ae];at.showCollisionBoxes=U.showCollisionBoxes;var j=function(J,Ne){var st=at.reloadCallback;st&&(delete at.reloadCallback,at.parse(at.vectorTile,Ze.layerIndex,$.availableImages,Ze.actor,st)),N(J,Ne)};at.status==="parsing"?at.reloadCallback=j:at.status==="done"&&(at.vectorTile?at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,j):j())}},Ge.prototype.abortTile=function(U,N){var $=this.loading,ae=U.uid;$&&$[ae]&&$[ae].abort&&($[ae].abort(),delete $[ae]),N()},Ge.prototype.removeTile=function(U,N){var $=this.loaded,ae=U.uid;$&&$[ae]&&delete $[ae],N()};var Ke=y.window.ImageBitmap,Rt=function(){this.loaded={}};function St(U,N){if(U.length!==0){Nt(U[0],N);for(var $=1;$<U.length;$++)Nt(U[$],!N)}}function Nt(U,N){for(var $=0,ae=0,Ae=0,Ze=U.length,at=Ze-1;Ae<Ze;at=Ae++){var j=(U[Ae][0]-U[at][0])*(U[at][1]+U[Ae][1]),J=$+j;ae+=Math.abs($)>=Math.abs(j)?$-J+j:j-J+$,$=J}$+ae>=0!=!!N&&U.reverse()}Rt.prototype.loadTile=function(U,N){var $=U.uid,ae=U.encoding,Ae=U.rawImageData,Ze=Ke&&Ae instanceof Ke?this.getImageData(Ae):Ae,at=new y.DEMData($,Ze,ae);this.loaded=this.loaded||{},this.loaded[$]=at,N(null,at)},Rt.prototype.getImageData=function(U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);var N=this.offscreenCanvasContext.getImageData(-1,-1,U.width+2,U.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:N.width,height:N.height},N.data)},Rt.prototype.removeTile=function(U){var N=this.loaded,$=U.uid;N&&N[$]&&delete N[$]};var Pt=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ct=function(U){this._feature=U,this.extent=y.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))};Ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var U=[],N=0,$=this._feature.geometry;N<$.length;N+=1){var ae=$[N];U.push([new y.Point$1(ae[0],ae[1])])}return U}for(var Ae=[],Ze=0,at=this._feature.geometry;Ze<at.length;Ze+=1){for(var j=[],J=0,Ne=at[Ze];J<Ne.length;J+=1){var st=Ne[J];j.push(new y.Point$1(st[0],st[1]))}Ae.push(j)}return Ae},Ct.prototype.toGeoJSON=function(U,N,$){return Pt.call(this,U,N,$)};var pt=function(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=U.length,this._features=U};pt.prototype.feature=function(U){return new Ct(this._features[U])};var mt=y.vectorTile.VectorTileFeature,pr=gr;function gr(U,N){this.options=N||{},this.features=U,this.length=U.length}function lr(U,N){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=N||4096}gr.prototype.feature=function(U){return new lr(this.features[U],this.options.extent)},lr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var N=0;N<U.length;N++){for(var $=U[N],ae=[],Ae=0;Ae<$.length;Ae++)ae.push(new y.Point$1($[Ae][0],$[Ae][1]));this.geometry.push(ae)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,N=1/0,$=-1/0,ae=1/0,Ae=-1/0,Ze=0;Ze<U.length;Ze++)for(var at=U[Ze],j=0;j<at.length;j++){var J=at[j];N=Math.min(N,J.x),$=Math.max($,J.x),ae=Math.min(ae,J.y),Ae=Math.max(Ae,J.y)}return[N,ae,$,Ae]},lr.prototype.toGeoJSON=mt.prototype.toGeoJSON;var ut=At,we=pr;function At(U){var N=new y.pbf;return function($,ae){for(var Ae in $.layers)ae.writeMessage(3,Fe,$.layers[Ae])}(U,N),N.finish()}function Fe(U,N){var $;N.writeVarintField(15,U.version||1),N.writeStringField(1,U.name||""),N.writeVarintField(5,U.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<U.length;$++)ae.feature=U.feature($),N.writeMessage(2,Zt,ae);var Ae=ae.keys;for($=0;$<Ae.length;$++)N.writeStringField(3,Ae[$]);var Ze=ae.values;for($=0;$<Ze.length;$++)N.writeMessage(4,Re,Ze[$])}function Zt(U,N){var $=U.feature;$.id!==void 0&&N.writeVarintField(1,$.id),N.writeMessage(2,vr,U),N.writeVarintField(3,$.type),N.writeMessage(4,Q,$)}function vr(U,N){var $=U.feature,ae=U.keys,Ae=U.values,Ze=U.keycache,at=U.valuecache;for(var j in $.properties){var J=Ze[j];J===void 0&&(ae.push(j),Ze[j]=J=ae.length-1),N.writeVarint(J);var Ne=$.properties[j],st=typeof Ne;st!=="string"&&st!=="boolean"&&st!=="number"&&(Ne=JSON.stringify(Ne));var Te=st+":"+Ne,Kt=at[Te];Kt===void 0&&(Ae.push(Ne),at[Te]=Kt=Ae.length-1),N.writeVarint(Kt)}}function ee(U,N){return(N<<3)+(7&U)}function V(U){return U<<1^U>>31}function Q(U,N){for(var $=U.loadGeometry(),ae=U.type,Ae=0,Ze=0,at=$.length,j=0;j<at;j++){var J=$[j],Ne=1;ae===1&&(Ne=J.length),N.writeVarint(ee(1,Ne));for(var st=ae===3?J.length-1:J.length,Te=0;Te<st;Te++){Te===1&&ae!==1&&N.writeVarint(ee(2,st-1));var Kt=J[Te].x-Ae,xr=J[Te].y-Ze;N.writeVarint(V(Kt)),N.writeVarint(V(xr)),Ae+=Kt,Ze+=xr}ae===3&&N.writeVarint(ee(7,1))}}function Re(U,N){var $=typeof U;$==="string"?N.writeStringField(1,U):$==="boolean"?N.writeBooleanField(7,U):$==="number"&&(U%1!=0?N.writeDoubleField(3,U):U<0?N.writeSVarintField(6,U):N.writeVarintField(5,U))}function xe(U,N,$,ae){nt(U,$,ae),nt(N,2*$,2*ae),nt(N,2*$+1,2*ae+1)}function nt(U,N,$){var ae=U[N];U[N]=U[$],U[$]=ae}function Le(U,N,$,ae){var Ae=U-$,Ze=N-ae;return Ae*Ae+Ze*Ze}ut.fromVectorTileJs=At,ut.fromGeojsonVt=function(U,N){N=N||{};var $={};for(var ae in U)$[ae]=new pr(U[ae].features,N),$[ae].name=ae,$[ae].version=N.version,$[ae].extent=N.extent;return At({layers:$})},ut.GeoJSONWrapper=we;var Ye=function(U){return U[0]},rt=function(U){return U[1]},Tt=function(U,N,$,ae,Ae){N===void 0&&(N=Ye),$===void 0&&($=rt),ae===void 0&&(ae=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=ae,this.points=U;for(var Ze=U.length<65536?Uint16Array:Uint32Array,at=this.ids=new Ze(U.length),j=this.coords=new Ae(2*U.length),J=0;J<U.length;J++)at[J]=J,j[2*J]=N(U[J]),j[2*J+1]=$(U[J]);(function Ne(st,Te,Kt,xr,sn,un){if(!(sn-xr<=Kt)){var nr=xr+sn>>1;(function Qr(Wr,$r,ii,pn,mi,Gi){for(;mi>pn;){if(mi-pn>600){var di=mi-pn+1,Ui=ii-pn+1,wi=Math.log(di),ss=.5*Math.exp(2*wi/3),oa=.5*Math.sqrt(wi*ss*(di-ss)/di)*(Ui-di/2<0?-1:1);Qr(Wr,$r,ii,Math.max(pn,Math.floor(ii-Ui*ss/di+oa)),Math.min(mi,Math.floor(ii+(di-Ui)*ss/di+oa)),Gi)}var ka=$r[2*ii+Gi],Ci=pn,yi=mi;for(xe(Wr,$r,pn,ii),$r[2*mi+Gi]>ka&&xe(Wr,$r,pn,mi);Ci<yi;){for(xe(Wr,$r,Ci,yi),Ci++,yi--;$r[2*Ci+Gi]<ka;)Ci++;for(;$r[2*yi+Gi]>ka;)yi--}$r[2*pn+Gi]===ka?xe(Wr,$r,pn,yi):xe(Wr,$r,++yi,mi),yi<=ii&&(pn=yi+1),ii<=yi&&(mi=yi-1)}})(st,Te,nr,xr,sn,un%2),Ne(st,Te,Kt,xr,nr-1,un+1),Ne(st,Te,Kt,nr+1,sn,un+1)}})(at,j,ae,0,at.length-1,0)};Tt.prototype.range=function(U,N,$,ae){return function(Ae,Ze,at,j,J,Ne,st){for(var Te,Kt,xr=[0,Ae.length-1,0],sn=[];xr.length;){var un=xr.pop(),nr=xr.pop(),Qr=xr.pop();if(nr-Qr<=st)for(var Wr=Qr;Wr<=nr;Wr++)Kt=Ze[2*Wr+1],(Te=Ze[2*Wr])>=at&&Te<=J&&Kt>=j&&Kt<=Ne&&sn.push(Ae[Wr]);else{var $r=Math.floor((Qr+nr)/2);Kt=Ze[2*$r+1],(Te=Ze[2*$r])>=at&&Te<=J&&Kt>=j&&Kt<=Ne&&sn.push(Ae[$r]);var ii=(un+1)%2;(un===0?at<=Te:j<=Kt)&&(xr.push(Qr),xr.push($r-1),xr.push(ii)),(un===0?J>=Te:Ne>=Kt)&&(xr.push($r+1),xr.push(nr),xr.push(ii))}}return sn}(this.ids,this.coords,U,N,$,ae,this.nodeSize)},Tt.prototype.within=function(U,N,$){return function(ae,Ae,Ze,at,j,J){for(var Ne=[0,ae.length-1,0],st=[],Te=j*j;Ne.length;){var Kt=Ne.pop(),xr=Ne.pop(),sn=Ne.pop();if(xr-sn<=J)for(var un=sn;un<=xr;un++)Le(Ae[2*un],Ae[2*un+1],Ze,at)<=Te&&st.push(ae[un]);else{var nr=Math.floor((sn+xr)/2),Qr=Ae[2*nr],Wr=Ae[2*nr+1];Le(Qr,Wr,Ze,at)<=Te&&st.push(ae[nr]);var $r=(Kt+1)%2;(Kt===0?Ze-j<=Qr:at-j<=Wr)&&(Ne.push(sn),Ne.push(nr-1),Ne.push($r)),(Kt===0?Ze+j>=Qr:at+j>=Wr)&&(Ne.push(nr+1),Ne.push(xr),Ne.push($r))}}return st}(this.ids,this.coords,U,N,$,this.nodeSize)};var dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(U){return U}},Ot=function(U){this.options=fi(Object.create(dr),U),this.trees=new Array(this.options.maxZoom+1)};function Vr(U,N,$,ae,Ae){return{x:U,y:N,zoom:1/0,id:$,parentId:-1,numPoints:ae,properties:Ae}}function Kr(U,N){var $=U.geometry.coordinates,ae=$[1];return{x:gn($[0]),y:nn(ae),zoom:1/0,index:N,parentId:-1}}function Or(U){return{type:"Feature",id:U.id,properties:In(U),geometry:{type:"Point",coordinates:[(ae=U.x,360*(ae-.5)),(N=U.y,$=(180-360*N)*Math.PI/180,360*Math.atan(Math.exp($))/Math.PI-90)]}};var N,$,ae}function In(U){var N=U.numPoints,$=N>=1e4?Math.round(N/1e3)+"k":N>=1e3?Math.round(N/100)/10+"k":N;return fi(fi({},U.properties),{cluster:!0,cluster_id:U.id,point_count:N,point_count_abbreviated:$})}function gn(U){return U/360+.5}function nn(U){var N=Math.sin(U*Math.PI/180),$=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return $<0?0:$>1?1:$}function fi(U,N){for(var $ in N)U[$]=N[$];return U}function Lr(U){return U.x}function Vn(U){return U.y}function Hr(U,N,$,ae,Ae,Ze){var at=Ae-$,j=Ze-ae;if(at!==0||j!==0){var J=((U-$)*at+(N-ae)*j)/(at*at+j*j);J>1?($=Ae,ae=Ze):J>0&&($+=at*J,ae+=j*J)}return(at=U-$)*at+(j=N-ae)*j}function hn(U,N,$,ae){var Ae={id:U===void 0?null:U,type:N,geometry:$,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var at=Ze.geometry,j=Ze.type;if(j==="Point"||j==="MultiPoint"||j==="LineString")qi(Ze,at);else if(j==="Polygon"||j==="MultiLineString")for(var J=0;J<at.length;J++)qi(Ze,at[J]);else if(j==="MultiPolygon")for(J=0;J<at.length;J++)for(var Ne=0;Ne<at[J].length;Ne++)qi(Ze,at[J][Ne])}(Ae),Ae}function qi(U,N){for(var $=0;$<N.length;$+=3)U.minX=Math.min(U.minX,N[$]),U.minY=Math.min(U.minY,N[$+1]),U.maxX=Math.max(U.maxX,N[$]),U.maxY=Math.max(U.maxY,N[$+1])}function xi(U,N,$,ae){if(N.geometry){var Ae=N.geometry.coordinates,Ze=N.geometry.type,at=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),j=[],J=N.id;if($.promoteId?J=N.properties[$.promoteId]:$.generateId&&(J=ae||0),Ze==="Point")ia(Ae,j);else if(Ze==="MultiPoint")for(var Ne=0;Ne<Ae.length;Ne++)ia(Ae[Ne],j);else if(Ze==="LineString")ea(Ae,j,at,!1);else if(Ze==="MultiLineString"){if($.lineMetrics){for(Ne=0;Ne<Ae.length;Ne++)ea(Ae[Ne],j=[],at,!1),U.push(hn(J,"LineString",j,N.properties));return}be(Ae,j,at,!1)}else if(Ze==="Polygon")be(Ae,j,at,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(Ne=0;Ne<N.geometry.geometries.length;Ne++)xi(U,{id:J,geometry:N.geometry.geometries[Ne],properties:N.properties},$,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<Ae.length;Ne++){var st=[];be(Ae[Ne],st,at,!0),j.push(st)}}U.push(hn(J,Ze,j,N.properties))}}function ia(U,N){N.push(Fi(U[0])),N.push(aa(U[1])),N.push(0)}function ea(U,N,$,ae){for(var Ae,Ze,at=0,j=0;j<U.length;j++){var J=Fi(U[j][0]),Ne=aa(U[j][1]);N.push(J),N.push(Ne),N.push(0),j>0&&(at+=ae?(Ae*Ne-J*Ze)/2:Math.sqrt(Math.pow(J-Ae,2)+Math.pow(Ne-Ze,2))),Ae=J,Ze=Ne}var st=N.length-3;N[2]=1,function Te(Kt,xr,sn,un){for(var nr,Qr=un,Wr=sn-xr>>1,$r=sn-xr,ii=Kt[xr],pn=Kt[xr+1],mi=Kt[sn],Gi=Kt[sn+1],di=xr+3;di<sn;di+=3){var Ui=Hr(Kt[di],Kt[di+1],ii,pn,mi,Gi);if(Ui>Qr)nr=di,Qr=Ui;else if(Ui===Qr){var wi=Math.abs(di-Wr);wi<$r&&(nr=di,$r=wi)}}Qr>un&&(nr-xr>3&&Te(Kt,xr,nr,un),Kt[nr+2]=Qr,sn-nr>3&&Te(Kt,nr,sn,un))}(N,0,st,$),N[st+2]=1,N.size=Math.abs(at),N.start=0,N.end=N.size}function be(U,N,$,ae){for(var Ae=0;Ae<U.length;Ae++){var Ze=[];ea(U[Ae],Ze,$,ae),N.push(Ze)}}function Fi(U){return U/360+.5}function aa(U){var N=Math.sin(U*Math.PI/180),$=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return $<0?0:$>1?1:$}function va(U,N,$,ae,Ae,Ze,at,j){if(ae/=N,Ze>=($/=N)&&at<ae)return U;if(at<$||Ze>=ae)return null;for(var J=[],Ne=0;Ne<U.length;Ne++){var st=U[Ne],Te=st.geometry,Kt=st.type,xr=Ae===0?st.minX:st.minY,sn=Ae===0?st.maxX:st.maxY;if(xr>=$&&sn<ae)J.push(st);else if(!(sn<$||xr>=ae)){var un=[];if(Kt==="Point"||Kt==="MultiPoint")oo(Te,un,$,ae,Ae);else if(Kt==="LineString")po(Te,un,$,ae,Ae,!1,j.lineMetrics);else if(Kt==="MultiLineString")Gt(Te,un,$,ae,Ae,!1);else if(Kt==="Polygon")Gt(Te,un,$,ae,Ae,!0);else if(Kt==="MultiPolygon")for(var nr=0;nr<Te.length;nr++){var Qr=[];Gt(Te[nr],Qr,$,ae,Ae,!0),Qr.length&&un.push(Qr)}if(un.length){if(j.lineMetrics&&Kt==="LineString"){for(nr=0;nr<un.length;nr++)J.push(hn(st.id,Kt,un[nr],st.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(un.length===1?(Kt="LineString",un=un[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=un.length===3?"Point":"MultiPoint"),J.push(hn(st.id,Kt,un,st.tags))}}}return J.length?J:null}function oo(U,N,$,ae,Ae){for(var Ze=0;Ze<U.length;Ze+=3){var at=U[Ze+Ae];at>=$&&at<=ae&&(N.push(U[Ze]),N.push(U[Ze+1]),N.push(U[Ze+2]))}}function po(U,N,$,ae,Ae,Ze,at){for(var j,J,Ne=Mo(U),st=Ae===0?Gr:rn,Te=U.start,Kt=0;Kt<U.length-3;Kt+=3){var xr=U[Kt],sn=U[Kt+1],un=U[Kt+2],nr=U[Kt+3],Qr=U[Kt+4],Wr=Ae===0?xr:sn,$r=Ae===0?nr:Qr,ii=!1;at&&(j=Math.sqrt(Math.pow(xr-nr,2)+Math.pow(sn-Qr,2))),Wr<$?$r>$&&(J=st(Ne,xr,sn,nr,Qr,$),at&&(Ne.start=Te+j*J)):Wr>ae?$r<ae&&(J=st(Ne,xr,sn,nr,Qr,ae),at&&(Ne.start=Te+j*J)):_r(Ne,xr,sn,un),$r<$&&Wr>=$&&(J=st(Ne,xr,sn,nr,Qr,$),ii=!0),$r>ae&&Wr<=ae&&(J=st(Ne,xr,sn,nr,Qr,ae),ii=!0),!Ze&&ii&&(at&&(Ne.end=Te+j*J),N.push(Ne),Ne=Mo(U)),at&&(Te+=j)}var pn=U.length-3;xr=U[pn],sn=U[pn+1],un=U[pn+2],(Wr=Ae===0?xr:sn)>=$&&Wr<=ae&&_r(Ne,xr,sn,un),pn=Ne.length-3,Ze&&pn>=3&&(Ne[pn]!==Ne[0]||Ne[pn+1]!==Ne[1])&&_r(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&N.push(Ne)}function Mo(U){var N=[];return N.size=U.size,N.start=U.start,N.end=U.end,N}function Gt(U,N,$,ae,Ae,Ze){for(var at=0;at<U.length;at++)po(U[at],N,$,ae,Ae,Ze,!1)}function _r(U,N,$,ae){U.push(N),U.push($),U.push(ae)}function Gr(U,N,$,ae,Ae,Ze){var at=(Ze-N)/(ae-N);return U.push(Ze),U.push($+(Ae-$)*at),U.push(1),at}function rn(U,N,$,ae,Ae,Ze){var at=(Ze-$)/(Ae-$);return U.push(N+(ae-N)*at),U.push(Ze),U.push(1),at}function yn(U,N){for(var $=[],ae=0;ae<U.length;ae++){var Ae,Ze=U[ae],at=Ze.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")Ae=Ti(Ze.geometry,N);else if(at==="MultiLineString"||at==="Polygon"){Ae=[];for(var j=0;j<Ze.geometry.length;j++)Ae.push(Ti(Ze.geometry[j],N))}else if(at==="MultiPolygon")for(Ae=[],j=0;j<Ze.geometry.length;j++){for(var J=[],Ne=0;Ne<Ze.geometry[j].length;Ne++)J.push(Ti(Ze.geometry[j][Ne],N));Ae.push(J)}$.push(hn(Ze.id,at,Ae,Ze.tags))}return $}function Ti(U,N){var $=[];$.size=U.size,U.start!==void 0&&($.start=U.start,$.end=U.end);for(var ae=0;ae<U.length;ae+=3)$.push(U[ae]+N,U[ae+1],U[ae+2]);return $}function fe(U,N){if(U.transformed)return U;var $,ae,Ae,Ze=1<<U.z,at=U.x,j=U.y;for($=0;$<U.features.length;$++){var J=U.features[$],Ne=J.geometry,st=J.type;if(J.geometry=[],st===1)for(ae=0;ae<Ne.length;ae+=2)J.geometry.push(k(Ne[ae],Ne[ae+1],N,Ze,at,j));else for(ae=0;ae<Ne.length;ae++){var Te=[];for(Ae=0;Ae<Ne[ae].length;Ae+=2)Te.push(k(Ne[ae][Ae],Ne[ae][Ae+1],N,Ze,at,j));J.geometry.push(Te)}}return U.transformed=!0,U}function k(U,N,$,ae,Ae,Ze){return[Math.round($*(U*ae-Ae)),Math.round($*(N*ae-Ze))]}function z(U,N,$,ae,Ae){for(var Ze=N===Ae.maxZoom?0:Ae.tolerance/((1<<N)*Ae.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ae,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},j=0;j<U.length;j++){at.numFeatures++,le(at,U[j],Ze,Ae);var J=U[j].minX,Ne=U[j].minY,st=U[j].maxX,Te=U[j].maxY;J<at.minX&&(at.minX=J),Ne<at.minY&&(at.minY=Ne),st>at.maxX&&(at.maxX=st),Te>at.maxY&&(at.maxY=Te)}return at}function le(U,N,$,ae){var Ae=N.geometry,Ze=N.type,at=[];if(Ze==="Point"||Ze==="MultiPoint")for(var j=0;j<Ae.length;j+=3)at.push(Ae[j]),at.push(Ae[j+1]),U.numPoints++,U.numSimplified++;else if(Ze==="LineString")Se(at,Ae,U,$,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(j=0;j<Ae.length;j++)Se(at,Ae[j],U,$,Ze==="Polygon",j===0);else if(Ze==="MultiPolygon")for(var J=0;J<Ae.length;J++){var Ne=Ae[J];for(j=0;j<Ne.length;j++)Se(at,Ne[j],U,$,!0,j===0)}if(at.length){var st=N.tags||null;if(Ze==="LineString"&&ae.lineMetrics){for(var Te in st={},N.tags)st[Te]=N.tags[Te];st.mapbox_clip_start=Ae.start/Ae.size,st.mapbox_clip_end=Ae.end/Ae.size}var Kt={geometry:at,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:st};N.id!==null&&(Kt.id=N.id),U.features.push(Kt)}}function Se(U,N,$,ae,Ae,Ze){var at=ae*ae;if(ae>0&&N.size<(Ae?at:ae))$.numPoints+=N.length/3;else{for(var j=[],J=0;J<N.length;J+=3)(ae===0||N[J+2]>at)&&($.numSimplified++,j.push(N[J]),j.push(N[J+1])),$.numPoints++;Ae&&function(Ne,st){for(var Te=0,Kt=0,xr=Ne.length,sn=xr-2;Kt<xr;sn=Kt,Kt+=2)Te+=(Ne[Kt]-Ne[sn])*(Ne[Kt+1]+Ne[sn+1]);if(Te>0===st)for(Kt=0,xr=Ne.length;Kt<xr/2;Kt+=2){var un=Ne[Kt],nr=Ne[Kt+1];Ne[Kt]=Ne[xr-2-Kt],Ne[Kt+1]=Ne[xr-1-Kt],Ne[xr-2-Kt]=un,Ne[xr-1-Kt]=nr}}(j,Ze),U.push(j)}}function De(U,N){var $=(N=this.options=function(Ae,Ze){for(var at in Ze)Ae[at]=Ze[at];return Ae}(Object.create(this.options),N)).debug;if($&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(Ae,Ze){var at=[];if(Ae.type==="FeatureCollection")for(var j=0;j<Ae.features.length;j++)xi(at,Ae.features[j],Ze,j);else xi(at,Ae.type==="Feature"?Ae:{geometry:Ae},Ze);return at}(U,N);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ae=function(Ae,Ze){var at=Ze.buffer/Ze.extent,j=Ae,J=va(Ae,1,-1-at,at,0,-1,2,Ze),Ne=va(Ae,1,1-at,2+at,0,-1,2,Ze);return(J||Ne)&&(j=va(Ae,1,-at,1+at,0,-1,2,Ze)||[],J&&(j=yn(J,1).concat(j)),Ne&&(j=j.concat(yn(Ne,-1)))),j}(ae,N)).length&&this.splitTile(ae,0,0,0),$&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $t(U,N,$){return 32*((1<<U)*$+N)+U}function Dt(U,N){var $=U.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);var ae=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ae)return N(null,null);var Ae=new pt(ae.features),Ze=ut(Ae);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),N(null,{vectorTile:Ae,rawData:Ze.buffer})}Ot.prototype.load=function(U){var N=this.options,$=N.log,ae=N.minZoom,Ae=N.maxZoom,Ze=N.nodeSize;$&&console.time("total time");var at="prepare "+U.length+" points";$&&console.time(at),this.points=U;for(var j=[],J=0;J<U.length;J++)U[J].geometry&&j.push(Kr(U[J],J));this.trees[Ae+1]=new Tt(j,Lr,Vn,Ze,Float32Array),$&&console.timeEnd(at);for(var Ne=Ae;Ne>=ae;Ne--){var st=+Date.now();j=this._cluster(j,Ne),this.trees[Ne]=new Tt(j,Lr,Vn,Ze,Float32Array),$&&console.log("z%d: %d clusters in %dms",Ne,j.length,+Date.now()-st)}return $&&console.timeEnd("total time"),this},Ot.prototype.getClusters=function(U,N){var $=((U[0]+180)%360+360)%360-180,ae=Math.max(-90,Math.min(90,U[1])),Ae=U[2]===180?180:((U[2]+180)%360+360)%360-180,Ze=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)$=-180,Ae=180;else if($>Ae){var at=this.getClusters([$,ae,180,Ze],N),j=this.getClusters([-180,ae,Ae,Ze],N);return at.concat(j)}for(var J=this.trees[this._limitZoom(N)],Ne=[],st=0,Te=J.range(gn($),nn(Ze),gn(Ae),nn(ae));st<Te.length;st+=1){var Kt=J.points[Te[st]];Ne.push(Kt.numPoints?Or(Kt):this.points[Kt.index])}return Ne},Ot.prototype.getChildren=function(U){var N=this._getOriginId(U),$=this._getOriginZoom(U),ae="No cluster with the specified id.",Ae=this.trees[$];if(!Ae)throw new Error(ae);var Ze=Ae.points[N];if(!Ze)throw new Error(ae);for(var at=this.options.radius/(this.options.extent*Math.pow(2,$-1)),j=[],J=0,Ne=Ae.within(Ze.x,Ze.y,at);J<Ne.length;J+=1){var st=Ae.points[Ne[J]];st.parentId===U&&j.push(st.numPoints?Or(st):this.points[st.index])}if(j.length===0)throw new Error(ae);return j},Ot.prototype.getLeaves=function(U,N,$){var ae=[];return this._appendLeaves(ae,U,N=N||10,$=$||0,0),ae},Ot.prototype.getTile=function(U,N,$){var ae=this.trees[this._limitZoom(U)],Ae=Math.pow(2,U),Ze=this.options,at=Ze.radius/Ze.extent,j=($-at)/Ae,J=($+1+at)/Ae,Ne={features:[]};return this._addTileFeatures(ae.range((N-at)/Ae,j,(N+1+at)/Ae,J),ae.points,N,$,Ae,Ne),N===0&&this._addTileFeatures(ae.range(1-at/Ae,j,1,J),ae.points,Ae,$,Ae,Ne),N===Ae-1&&this._addTileFeatures(ae.range(0,j,at/Ae,J),ae.points,-1,$,Ae,Ne),Ne.features.length?Ne:null},Ot.prototype.getClusterExpansionZoom=function(U){for(var N=this._getOriginZoom(U)-1;N<=this.options.maxZoom;){var $=this.getChildren(U);if(N++,$.length!==1)break;U=$[0].properties.cluster_id}return N},Ot.prototype._appendLeaves=function(U,N,$,ae,Ae){for(var Ze=0,at=this.getChildren(N);Ze<at.length;Ze+=1){var j=at[Ze],J=j.properties;if(J&&J.cluster?Ae+J.point_count<=ae?Ae+=J.point_count:Ae=this._appendLeaves(U,J.cluster_id,$,ae,Ae):Ae<ae?Ae++:U.push(j),U.length===$)break}return Ae},Ot.prototype._addTileFeatures=function(U,N,$,ae,Ae,Ze){for(var at=0,j=U;at<j.length;at+=1){var J=N[j[at]],Ne=J.numPoints,st={type:1,geometry:[[Math.round(this.options.extent*(J.x*Ae-$)),Math.round(this.options.extent*(J.y*Ae-ae))]],tags:Ne?In(J):this.points[J.index].properties},Te=void 0;Ne?Te=J.id:this.options.generateId?Te=J.index:this.points[J.index].id&&(Te=this.points[J.index].id),Te!==void 0&&(st.id=Te),Ze.features.push(st)}},Ot.prototype._limitZoom=function(U){return Math.max(this.options.minZoom,Math.min(+U,this.options.maxZoom+1))},Ot.prototype._cluster=function(U,N){for(var $=[],ae=this.options,Ae=ae.reduce,Ze=ae.minPoints,at=ae.radius/(ae.extent*Math.pow(2,N)),j=0;j<U.length;j++){var J=U[j];if(!(J.zoom<=N)){J.zoom=N;for(var Ne=this.trees[N+1],st=Ne.within(J.x,J.y,at),Te=J.numPoints||1,Kt=Te,xr=0,sn=st;xr<sn.length;xr+=1){var un=Ne.points[sn[xr]];un.zoom>N&&(Kt+=un.numPoints||1)}if(Kt>=Ze){for(var nr=J.x*Te,Qr=J.y*Te,Wr=Ae&&Te>1?this._map(J,!0):null,$r=(j<<5)+(N+1)+this.points.length,ii=0,pn=st;ii<pn.length;ii+=1){var mi=Ne.points[pn[ii]];if(!(mi.zoom<=N)){mi.zoom=N;var Gi=mi.numPoints||1;nr+=mi.x*Gi,Qr+=mi.y*Gi,mi.parentId=$r,Ae&&(Wr||(Wr=this._map(J,!0)),Ae(Wr,this._map(mi)))}}J.parentId=$r,$.push(Vr(nr/Kt,Qr/Kt,$r,Kt,Wr))}else if($.push(J),Kt>1)for(var di=0,Ui=st;di<Ui.length;di+=1){var wi=Ne.points[Ui[di]];wi.zoom<=N||(wi.zoom=N,$.push(wi))}}}return $},Ot.prototype._getOriginId=function(U){return U-this.points.length>>5},Ot.prototype._getOriginZoom=function(U){return(U-this.points.length)%32},Ot.prototype._map=function(U,N){if(U.numPoints)return N?fi({},U.properties):U.properties;var $=this.points[U.index].properties,ae=this.options.map($);return N&&ae===$?fi({},ae):ae},De.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},De.prototype.splitTile=function(U,N,$,ae,Ae,Ze,at){for(var j=[U,N,$,ae],J=this.options,Ne=J.debug;j.length;){ae=j.pop(),$=j.pop(),N=j.pop(),U=j.pop();var st=1<<N,Te=$t(N,$,ae),Kt=this.tiles[Te];if(!Kt&&(Ne>1&&console.time("creation"),Kt=this.tiles[Te]=z(U,N,$,ae,J),this.tileCoords.push({z:N,x:$,y:ae}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,$,ae,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var xr="z"+N;this.stats[xr]=(this.stats[xr]||0)+1,this.total++}if(Kt.source=U,Ae){if(N===J.maxZoom||N===Ae)continue;var sn=1<<Ae-N;if($!==Math.floor(Ze/sn)||ae!==Math.floor(at/sn))continue}else if(N===J.indexMaxZoom||Kt.numPoints<=J.indexMaxPoints)continue;if(Kt.source=null,U.length!==0){Ne>1&&console.time("clipping");var un,nr,Qr,Wr,$r,ii,pn=.5*J.buffer/J.extent,mi=.5-pn,Gi=.5+pn,di=1+pn;un=nr=Qr=Wr=null,$r=va(U,st,$-pn,$+Gi,0,Kt.minX,Kt.maxX,J),ii=va(U,st,$+mi,$+di,0,Kt.minX,Kt.maxX,J),U=null,$r&&(un=va($r,st,ae-pn,ae+Gi,1,Kt.minY,Kt.maxY,J),nr=va($r,st,ae+mi,ae+di,1,Kt.minY,Kt.maxY,J),$r=null),ii&&(Qr=va(ii,st,ae-pn,ae+Gi,1,Kt.minY,Kt.maxY,J),Wr=va(ii,st,ae+mi,ae+di,1,Kt.minY,Kt.maxY,J),ii=null),Ne>1&&console.timeEnd("clipping"),j.push(un||[],N+1,2*$,2*ae),j.push(nr||[],N+1,2*$,2*ae+1),j.push(Qr||[],N+1,2*$+1,2*ae),j.push(Wr||[],N+1,2*$+1,2*ae+1)}}},De.prototype.getTile=function(U,N,$){var ae=this.options,Ae=ae.extent,Ze=ae.debug;if(U<0||U>24)return null;var at=1<<U,j=$t(U,N=(N%at+at)%at,$);if(this.tiles[j])return fe(this.tiles[j],Ae);Ze>1&&console.log("drilling down to z%d-%d-%d",U,N,$);for(var J,Ne=U,st=N,Te=$;!J&&Ne>0;)Ne--,st=Math.floor(st/2),Te=Math.floor(Te/2),J=this.tiles[$t(Ne,st,Te)];return J&&J.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",Ne,st,Te),Ze>1&&console.time("drilling down"),this.splitTile(J.source,Ne,st,Te,U,N,$),Ze>1&&console.timeEnd("drilling down"),this.tiles[j]?fe(this.tiles[j],Ae):null):null};var Bt=function(U){function N($,ae,Ae,Ze){U.call(this,$,ae,Ae,Dt),Ze&&(this.loadGeoJSON=Ze)}return U&&(N.__proto__=U),(N.prototype=Object.create(U&&U.prototype)).constructor=N,N.prototype.loadData=function($,ae){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ae,this._pendingLoadDataParams=$,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},N.prototype._loadData=function(){var $=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ae=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ze=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new y.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,function(at,j){if(at||!j)return ae(at);if(typeof j!="object")return ae(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function Kt(xr,sn){var un,nr=xr&&xr.type;if(nr==="FeatureCollection")for(un=0;un<xr.features.length;un++)Kt(xr.features[un],sn);else if(nr==="GeometryCollection")for(un=0;un<xr.geometries.length;un++)Kt(xr.geometries[un],sn);else if(nr==="Feature")Kt(xr.geometry,sn);else if(nr==="Polygon")St(xr.coordinates,sn);else if(nr==="MultiPolygon")for(un=0;un<xr.coordinates.length;un++)St(xr.coordinates[un],sn);return xr})(j,!0);try{if(Ae.filter){var J=y.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(function(Kt){return Kt.key+": "+Kt.message}).join(", "));var Ne=j.features.filter(function(Kt){return J.value.evaluate({zoom:0},Kt)});j={type:"FeatureCollection",features:Ne}}$._geoJSONIndex=Ae.cluster?new Ot(function(Kt){var xr=Kt.superclusterOptions,sn=Kt.clusterProperties;if(!sn||!xr)return xr;for(var un={},nr={},Qr={accumulated:null,zoom:0},Wr={properties:null},$r=Object.keys(sn),ii=0,pn=$r;ii<pn.length;ii+=1){var mi=pn[ii],Gi=sn[mi],di=Gi[0],Ui=y.createExpression(Gi[1]),wi=y.createExpression(typeof di=="string"?[di,["accumulated"],["get",mi]]:di);un[mi]=Ui.value,nr[mi]=wi.value}return xr.map=function(ss){Wr.properties=ss;for(var oa={},ka=0,Ci=$r;ka<Ci.length;ka+=1){var yi=Ci[ka];oa[yi]=un[yi].evaluate(Qr,Wr)}return oa},xr.reduce=function(ss,oa){Wr.properties=oa;for(var ka=0,Ci=$r;ka<Ci.length;ka+=1){var yi=Ci[ka];Qr.accumulated=ss[yi],ss[yi]=nr[yi].evaluate(Qr,Wr)}},xr}(Ae)).load(j.features):function(Kt,xr){return new De(Kt,xr)}(j,Ae.geojsonVtOptions)}catch(Kt){return ae(Kt)}$.loaded={};var st={};if(Ze){var Te=Ze.finish();Te&&(st.resourceTiming={},st.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Te)))}ae(null,st)})}},N.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},N.prototype.reloadTile=function($,ae){var Ae=this.loaded;return Ae&&Ae[$.uid]?U.prototype.reloadTile.call(this,$,ae):this.loadTile($,ae)},N.prototype.loadGeoJSON=function($,ae){if($.request)y.getJSON($.request,ae);else{if(typeof $.data!="string")return ae(new Error("Input data given to '"+$.source+"' is not a valid GeoJSON object."));try{return ae(null,JSON.parse($.data))}catch(Ae){return ae(new Error("Input data given to '"+$.source+"' is not a valid GeoJSON object."))}}},N.prototype.removeSource=function($,ae){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ae()},N.prototype.getClusterExpansionZoom=function($,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(Ae){ae(Ae)}},N.prototype.getClusterChildren=function($,ae){try{ae(null,this._geoJSONIndex.getChildren($.clusterId))}catch(Ae){ae(Ae)}},N.prototype.getClusterLeaves=function($,ae){try{ae(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(Ae){ae(Ae)}},N}(Ge),yt=function(U){var N=this;this.self=U,this.actor=new y.Actor(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ge,geojson:Bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function($,ae){if(N.workerSourceTypes[$])throw new Error('Worker source with name "'+$+'" already registered.');N.workerSourceTypes[$]=ae},this.self.registerRTLTextPlugin=function($){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=$.applyArabicShaping,y.plugin.processBidirectionalText=$.processBidirectionalText,y.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}};return yt.prototype.setReferrer=function(U,N){this.referrer=N},yt.prototype.setImages=function(U,N,$){for(var ae in this.availableImages[U]=N,this.workerSources[U]){var Ae=this.workerSources[U][ae];for(var Ze in Ae)Ae[Ze].availableImages=N}$()},yt.prototype.setLayers=function(U,N,$){this.getLayerIndex(U).replace(N),$()},yt.prototype.updateLayers=function(U,N,$){this.getLayerIndex(U).update(N.layers,N.removedIds),$()},yt.prototype.loadTile=function(U,N,$){this.getWorkerSource(U,N.type,N.source).loadTile(N,$)},yt.prototype.loadDEMTile=function(U,N,$){this.getDEMWorkerSource(U,N.source).loadTile(N,$)},yt.prototype.reloadTile=function(U,N,$){this.getWorkerSource(U,N.type,N.source).reloadTile(N,$)},yt.prototype.abortTile=function(U,N,$){this.getWorkerSource(U,N.type,N.source).abortTile(N,$)},yt.prototype.removeTile=function(U,N,$){this.getWorkerSource(U,N.type,N.source).removeTile(N,$)},yt.prototype.removeDEMTile=function(U,N){this.getDEMWorkerSource(U,N.source).removeTile(N)},yt.prototype.removeSource=function(U,N,$){if(this.workerSources[U]&&this.workerSources[U][N.type]&&this.workerSources[U][N.type][N.source]){var ae=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],ae.removeSource!==void 0?ae.removeSource(N,$):$()}},yt.prototype.loadWorkerSource=function(U,N,$){try{this.self.importScripts(N.url),$()}catch(ae){$(ae.toString())}},yt.prototype.syncRTLPluginState=function(U,N,$){try{y.plugin.setState(N);var ae=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&ae!=null){this.self.importScripts(ae);var Ae=y.plugin.isParsed();$(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+ae),Ae)}}catch(Ze){$(Ze.toString())}},yt.prototype.getAvailableImages=function(U){var N=this.availableImages[U];return N||(N=[]),N},yt.prototype.getLayerIndex=function(U){var N=this.layerIndexes[U];return N||(N=this.layerIndexes[U]=new ue),N},yt.prototype.getWorkerSource=function(U,N,$){var ae=this;return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][N]||(this.workerSources[U][N]={}),this.workerSources[U][N][$]||(this.workerSources[U][N][$]=new this.workerSourceTypes[N]({send:function(Ae,Ze,at){ae.actor.send(Ae,Ze,at,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][N][$]},yt.prototype.getDEMWorkerSource=function(U,N){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][N]||(this.demWorkerSources[U][N]=new Rt),this.demWorkerSources[U][N]},yt.prototype.enforceCacheSizeLimit=function(U,N){y.enforceCacheSizeLimit(N)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new yt(self)),yt}),de(["./shared"],function(y){"use strict";var ce=y.createCommonjsModule(function(h){function v(S){return!p(S)}function p(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,P,X=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(X);try{P=new Worker(te),R=!0}catch(ye){R=!1}return P&&P.terminate(),URL.revokeObjectURL(te),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var P=R.getContext("2d");if(!P)return!1;var X=P.getImageData(0,0,1,1);return X&&X.width===R.width}()?(g[w=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[w]=function(R){var P=function(te){var ye=document.createElement("canvas"),Ee=Object.create(v.webGLContextAttributes);return Ee.failIfMajorPerformanceCaveat=te,ye.probablySupportsContext?ye.probablySupportsContext("webgl",Ee)||ye.probablySupportsContext("experimental-webgl",Ee):ye.supportsContext?ye.supportsContext("webgl",Ee)||ye.supportsContext("experimental-webgl",Ee):ye.getContext("webgl",Ee)||ye.getContext("experimental-webgl",Ee)}(R);if(!P)return!1;var X=P.createShader(P.VERTEX_SHADER);return!(!X||P.isContextLost())&&(P.shaderSource(X,"void main() {}"),P.compileShader(X),P.getShaderParameter(X,P.COMPILE_STATUS)===!0)}(w)),g[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=p);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),L={create:function(h,v,p){var g=y.window.document.createElement(h);return v!==void 0&&(g.className=v),p&&p.appendChild(g),g},createNS:function(h,v){return y.window.document.createElementNS(h,v)}},ue=y.window.document&&y.window.document.documentElement.style;function oe(h){if(!ue)return h[0];for(var v=0;v<h.length;v++)if(h[v]in ue)return h[v];return h[0]}var Be,se=oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);L.disableDrag=function(){ue&&se&&(Be=ue[se],ue[se]="none")},L.enableDrag=function(){ue&&se&&(ue[se]=Be)};var ze=oe(["transform","WebkitTransform"]);L.setTransform=function(h,v){h.style[ze]=v};var Ge=!1;try{var Ke=Object.defineProperty({},"passive",{get:function(){Ge=!0}});y.window.addEventListener("test",Ke,Ke),y.window.removeEventListener("test",Ke,Ke)}catch(h){Ge=!1}L.addEventListener=function(h,v,p,g){g===void 0&&(g={}),h.addEventListener(v,p,"passive"in g&&Ge?g:g.capture)},L.removeEventListener=function(h,v,p,g){g===void 0&&(g={}),h.removeEventListener(v,p,"passive"in g&&Ge?g:g.capture)};var Rt=function(h){h.preventDefault(),h.stopPropagation(),y.window.removeEventListener("click",Rt,!0)};function St(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}L.suppressClick=function(){y.window.addEventListener("click",Rt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Rt,!0)},0)},L.mousePos=function(h,v){var p=h.getBoundingClientRect();return new y.Point(v.clientX-p.left-h.clientLeft,v.clientY-p.top-h.clientTop)},L.touchPos=function(h,v){for(var p=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new y.Point(v[S].clientX-p.left-h.clientLeft,v[S].clientY-p.top-h.clientTop));return g},L.mouseButton=function(h){return y.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},L.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Nt=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var g=0,S=this.requestors;g<S.length;g+=1){var w=S[g];this._notify(w.ids,w.callback)}this.requestors=[]}},v.prototype.getImage=function(p){return this.images[p]},v.prototype.addImage=function(p,g){this._validate(p,g)&&(this.images[p]=g)},v.prototype._validate=function(p,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(p,g){if(!p)return!0;for(var S=0,w=0,R=p;w<R.length;w+=1){var P=R[w];if(P[0]<S||P[1]<P[0]||g<P[1])return!1;S=P[1]}return!0},v.prototype._validateContent=function(p,g){return!(p&&(p.length!==4||p[0]<0||g.data.width<p[0]||p[1]<0||g.data.height<p[1]||p[2]<0||g.data.width<p[2]||p[3]<0||g.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},v.prototype.updateImage=function(p,g){g.version=this.images[p].version+1,this.images[p]=g,this.updatedImages[p]=!0},v.prototype.removeImage=function(p){var g=this.images[p];delete this.images[p],delete this.patterns[p],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(p,g){var S=!0;if(!this.isLoaded())for(var w=0,R=p;w<R.length;w+=1)this.images[R[w]]||(S=!1);this.isLoaded()||S?this._notify(p,g):this.requestors.push({ids:p,callback:g})},v.prototype._notify=function(p,g){for(var S={},w=0,R=p;w<R.length;w+=1){var P=R[w];this.images[P]||this.fire(new y.Event("styleimagemissing",{id:P}));var X=this.images[P];X?S[P]={data:X.data.clone(),pixelRatio:X.pixelRatio,sdf:X.sdf,version:X.version,stretchX:X.stretchX,stretchY:X.stretchY,content:X.content,hasRenderCallback:!!(X.userImage&&X.userImage.render)}:y.warnOnce('Image "'+P+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},v.prototype.getPattern=function(p){var g=this.patterns[p],S=this.getImage(p);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var w={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(w,S);this.patterns[p]={bin:w,position:R}}return this._updatePatternAtlas(),this.patterns[p].position},v.prototype.bind=function(p){var g=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(p,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var p=[];for(var g in this.patterns)p.push(this.patterns[g].bin);var S=y.potpack(p),w=S.w,R=S.h,P=this.atlasImage;for(var X in P.resize({width:w||1,height:R||1}),this.patterns){var te=this.patterns[X].bin,ye=te.x+1,Ee=te.y+1,Ce=this.images[X].data,Xe=Ce.width,We=Ce.height;y.RGBAImage.copy(Ce,P,{x:0,y:0},{x:ye,y:Ee},{width:Xe,height:We}),y.RGBAImage.copy(Ce,P,{x:0,y:We-1},{x:ye,y:Ee-1},{width:Xe,height:1}),y.RGBAImage.copy(Ce,P,{x:0,y:0},{x:ye,y:Ee+We},{width:Xe,height:1}),y.RGBAImage.copy(Ce,P,{x:Xe-1,y:0},{x:ye-1,y:Ee},{width:1,height:We}),y.RGBAImage.copy(Ce,P,{x:0,y:0},{x:ye+Xe,y:Ee},{width:1,height:We})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(p){for(var g=0,S=p;g<S.length;g+=1){var w=S[g];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var R=this.images[w];St(R)&&this.updateImage(w,R)}}},v}(y.Evented),Pt=mt,Ct=mt,pt=1e20;function mt(h,v,p,g,S,w){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=w||"normal",this.radius=p||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function pr(h,v,p,g,S,w,R){for(var P=0;P<v;P++){for(var X=0;X<p;X++)g[X]=h[X*v+P];for(gr(g,S,w,R,p),X=0;X<p;X++)h[X*v+P]=S[X]}for(X=0;X<p;X++){for(P=0;P<v;P++)g[P]=h[X*v+P];for(gr(g,S,w,R,v),P=0;P<v;P++)h[X*v+P]=Math.sqrt(S[P])}}function gr(h,v,p,g,S){p[0]=0,g[0]=-pt,g[1]=+pt;for(var w=1,R=0;w<S;w++){for(var P=(h[w]+w*w-(h[p[R]]+p[R]*p[R]))/(2*w-2*p[R]);P<=g[R];)R--,P=(h[w]+w*w-(h[p[R]]+p[R]*p[R]))/(2*w-2*p[R]);p[++R]=w,g[R]=P,g[R+1]=+pt}for(w=0,R=0;w<S;w++){for(;g[R+1]<w;)R++;v[w]=(w-p[R])*(w-p[R])+h[p[R]]}}mt.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?pt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?pt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(pr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),pr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)p[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return p},Pt.default=Ct;var lr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};lr.prototype.setURL=function(h){this.url=h},lr.prototype.getGlyphs=function(h,v){var p=this,g=[];for(var S in h)for(var w=0,R=h[S];w<R.length;w+=1)g.push({stack:S,id:R[w]});y.asyncAll(g,function(P,X){var te=P.stack,ye=P.id,Ee=p.entries[te];Ee||(Ee=p.entries[te]={glyphs:{},requests:{},ranges:{}});var Ce=Ee.glyphs[ye];if(Ce===void 0){if(Ce=p._tinySDF(Ee,te,ye))return Ee.glyphs[ye]=Ce,void X(null,{stack:te,id:ye,glyph:Ce});var Xe=Math.floor(ye/256);if(256*Xe>65535)X(new Error("glyphs > 65535 not supported"));else if(Ee.ranges[Xe])X(null,{stack:te,id:ye,glyph:Ce});else{var We=Ee.requests[Xe];We||(We=Ee.requests[Xe]=[],lr.loadGlyphRange(te,Xe,p.url,p.requestManager,function(ft,Ue){if(Ue){for(var ct in Ue)p._doesCharSupportLocalGlyph(+ct)||(Ee.glyphs[+ct]=Ue[+ct]);Ee.ranges[Xe]=!0}for(var Et=0,zt=We;Et<zt.length;Et+=1)(0,zt[Et])(ft,Ue);delete Ee.requests[Xe]})),We.push(function(ft,Ue){ft?X(ft):Ue&&X(null,{stack:te,id:ye,glyph:Ue[ye]||null})})}}else X(null,{stack:te,id:ye,glyph:Ce})},function(P,X){if(P)v(P);else if(X){for(var te={},ye=0,Ee=X;ye<Ee.length;ye+=1){var Ce=Ee[ye],Xe=Ce.stack,We=Ce.id,ft=Ce.glyph;(te[Xe]||(te[Xe]={}))[We]=ft&&{id:ft.id,bitmap:ft.bitmap.clone(),metrics:ft.metrics}}v(null,te)}})},lr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](h)||y.isChar["Hangul Syllables"](h)||y.isChar.Hiragana(h)||y.isChar.Katakana(h))},lr.prototype._tinySDF=function(h,v,p){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(p)){var S=h.tinySDF;if(!S){var w="400";/bold/i.test(v)?w="900":/medium/i.test(v)?w="500":/light/i.test(v)&&(w="200"),S=h.tinySDF=new lr.TinySDF(24,3,8,.25,g,w)}return{id:p,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(h,v,p,g,S){var w=256*v,R=w+255,P=g.transformRequest(g.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",w+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(P,function(X,te){if(X)S(X);else if(te){for(var ye={},Ee=0,Ce=y.parseGlyphPBF(te);Ee<Ce.length;Ee+=1){var Xe=Ce[Ee];ye[Xe.id]=Xe}S(null,ye)}})},lr.TinySDF=Pt;var ut=function(){this.specification=y.styleSpec.light.position};ut.prototype.possiblyEvaluate=function(h,v){return y.sphericalToCartesian(h.expression.evaluate(v))},ut.prototype.interpolate=function(h,v,p){return{x:y.number(h.x,v.x,p),y:y.number(h.y,v.y,p),z:y.number(h.z,v.z,p)}};var we=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new ut,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),At=function(h){function v(p){h.call(this),this._transitionable=new y.Transitionable(we),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(p,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,p,g))for(var S in p){var w=p[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),w):this._transitionable.setValue(S,w)}},v.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},v.prototype._validate=function(p,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,p.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},v}(y.Evented),Fe=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Fe.prototype.getDash=function(h,v){var p=h.join(",")+String(v);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,v)),this.dashEntry[p]},Fe.prototype.getDashRanges=function(h,v,p){var g=[],S=h.length%2==1?-h[h.length-1]*p:0,w=h[0]*p,R=!0;g.push({left:S,right:w,isDash:R,zeroLength:h[0]===0});for(var P=h[0],X=1;X<h.length;X++){var te=h[X];g.push({left:S=P*p,right:w=(P+=te)*p,isDash:R=!R,zeroLength:te===0})}return g},Fe.prototype.addRoundDash=function(h,v,p){for(var g=v/2,S=-p;S<=p;S++)for(var w=this.width*(this.nextRow+p+S),R=0,P=h[R],X=0;X<this.width;X++){X/P.right>1&&(P=h[++R]);var te=Math.abs(X-P.left),ye=Math.abs(X-P.right),Ee=Math.min(te,ye),Ce=void 0,Xe=S/p*(g+1);if(P.isDash){var We=g-Math.abs(Xe);Ce=Math.sqrt(Ee*Ee+We*We)}else Ce=g-Math.sqrt(Ee*Ee+Xe*Xe);this.data[w+X]=Math.max(0,Math.min(255,Ce+128))}},Fe.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var p=h[v],g=h[v+1];p.zeroLength?h.splice(v,1):g&&g.isDash===p.isDash&&(g.left=p.left,h.splice(v,1))}var S=h[0],w=h[h.length-1];S.isDash===w.isDash&&(S.left=w.left-this.width,w.right=S.right+this.width);for(var R=this.width*this.nextRow,P=0,X=h[P],te=0;te<this.width;te++){te/X.right>1&&(X=h[++P]);var ye=Math.abs(te-X.left),Ee=Math.abs(te-X.right),Ce=Math.min(ye,Ee);this.data[R+te]=Math.max(0,Math.min(255,(X.isDash?Ce:-Ce)+128))}},Fe.prototype.addDash=function(h,v){var p=v?7:0,g=2*p+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,w=0;w<h.length;w++)S+=h[w];if(S!==0){var R=this.width/S,P=this.getDashRanges(h,this.width,R);v?this.addRoundDash(P,R,p):this.addRegularDash(P)}var X={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:S};return this.nextRow+=g,this.dirty=!0,X},Fe.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var Zt=function h(v,p){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var w=new h.Actor(g[S],p,this.id);w.name="Worker "+S,this.actors.push(w)}};function vr(h,v,p){var g=function(S,w){if(S)return p(S);if(w){var R=y.pick(y.extend(w,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(R.vectorLayers=w.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(P){return P.id})),R.tiles=v.canonicalizeTileset(R,h.url),p(null,R)}};return h.url?y.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,h)})}Zt.prototype.broadcast=function(h,v,p){y.asyncAll(this.actors,function(g,S){g.send(h,v,S)},p=p||function(){})},Zt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Zt.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},Zt.Actor=y.Actor;var ee=function(h,v,p){this.bounds=y.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=p||24};ee.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},ee.prototype.contains=function(h){var v=Math.pow(2,h.z),p=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*v),w=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=p&&h.x<S&&h.y>=g&&h.y<w};var V=function(h){function v(p,g,S,w){if(h.call(this),this.id=p,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new ee(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles,p.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(p){var g=this;return this.setSourceProperty(function(){g._options.tiles=p}),this},v.prototype.setUrl=function(p){var g=this;return this.setSourceProperty(function(){g.url=p,g._options.url=p}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(P,X){return delete p.request,p.aborted?g(null):P&&P.status!==404?g(P):(X&&X.resourceTiming&&(p.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&p.setExpiryData(X),p.loadVectorData(X,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=g:p.request=p.actor.send("reloadTile",w,R.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",w,R.bind(this)))},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(y.Evented),Q=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new ee(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.loadTile=function(p,g){var S=this,w=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(R,P){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(P){S.map._refreshExpiredTiles&&p.setExpiryData(P),delete P.cacheControl,delete P.expires;var X=S.map.painter.context,te=X.gl;p.texture=S.map.painter.getTileTexture(P.width),p.texture?p.texture.update(P,{useMipmap:!0}):(p.texture=new y.Texture(X,P,te.RGBA,{useMipmap:!0}),p.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),X.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),p.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(p,g){p.request&&(p.request.cancel(),delete p.request),g()},v.prototype.unloadTile=function(p,g){p.texture&&this.map.painter.saveTileTexture(p.texture),g()},v.prototype.hasTransition=function(){return!1},v}(y.Evented),Re=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(R,P){R&&(p.state="errored",g(R)),P&&(p.dem=P,p.needsHillshadePrepare=!0,p.state="loaded",g(null))}p.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,P){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(P){this.map._refreshExpiredTiles&&p.setExpiryData(P),delete P.cacheControl,delete P.expires;var X=y.window.ImageBitmap&&P instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?P:y.browser.getImageData(P,1),te={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:X,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",te,w.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},v.prototype._getNeighboringTiles=function(p){var g=p.canonical,S=Math.pow(2,g.z),w=(g.x-1+S)%S,R=g.x===0?p.wrap-1:p.wrap,P=(g.x+1+S)%S,X=g.x+1===S?p.wrap+1:p.wrap,te={};return te[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y).key]={backfilled:!1},te[new y.OverscaledTileID(p.overscaledZ,X,g.z,P,g.y).key]={backfilled:!1},g.y>0&&(te[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(p.overscaledZ,X,g.z,P,g.y-1).key]={backfilled:!1}),g.y+1<S&&(te[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(p.overscaledZ,X,g.z,P,g.y+1).key]={backfilled:!1}),te},v.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},v}(Q),xe=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(w),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)p.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(S.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new y.Event("data",S))}})},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setData=function(p){var g=this;return this._data=p,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var w={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(w.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",w))}}),this},v.prototype.getClusterExpansionZoom=function(p,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},g),this},v.prototype.getClusterChildren=function(p,g){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},g),this},v.prototype.getClusterLeaves=function(p,g,S,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:g,offset:S},w),this},v.prototype._updateWorkerData=function(p){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),w=this._data;typeof w=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(w),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(w),this.actor.send(this.type+".loadData",S,function(R,P){g._removed||P&&P.abandoned||(g._loaded=!0,P&&P.resourceTiming&&P.resourceTiming[g.id]&&(g._resourceTiming=P.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),p(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(p,g){var S=this,w=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(w,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,P){return delete p.request,p.unloadVectorData(),p.aborted?g(null):R?g(R):(p.loadVectorData(P,S.map.painter,w==="reloadTile"),g(null))})},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},v.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(y.Evented),nt=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Le=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(p,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(w,R){S._loaded=!0,w?S.fire(new y.ErrorEvent(w)):R&&(S.image=R,p&&(S.coordinates=p),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(p){var g=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setCoordinates=function(p){var g=this;this.coordinates=p;var S=p.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var P=1/0,X=1/0,te=-1/0,ye=-1/0,Ee=0,Ce=R;Ee<Ce.length;Ee+=1){var Xe=Ce[Ee];P=Math.min(P,Xe.x),X=Math.min(X,Xe.y),te=Math.max(te,Xe.x),ye=Math.max(ye,Xe.y)}var We=Math.max(te-P,ye-X),ft=Math.max(0,Math.floor(-Math.log(We)/Math.LN2)),Ue=Math.pow(2,ft);return new y.CanonicalTileID(ft,Math.floor((P+te)/2*Ue),Math.floor((X+ye)/2*Ue))}(S),this.minzoom=this.maxzoom=this.tileID.z;var w=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.loadTile=function(p,g){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},g(null)):(p.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(y.Evented),Ye=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,w=g.urls;S<w.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(w[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,P){p._loaded=!0,R?p.fire(new y.ErrorEvent(R)):P&&(p.video=P,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(p){if(this.video){var g=this.video.seekable;p<g.start(0)||p>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=p}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(Le),rt=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(P){return typeof P!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[w];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var p=0,g=[this.canvas.width,this.canvas.height];p<g.length;p+=1){var S=g[p];if(isNaN(S)||S<=0)return!0}return!1},v}(Le),Tt={vector:V,raster:Q,"raster-dem":Re,geojson:xe,video:Ye,image:Le,canvas:rt};function dr(h,v){var p=y.identity([]);return y.translate(p,p,[1,1,0]),y.scale(p,p,[.5*h.width,.5*h.height,1]),y.multiply(p,p,h.calculatePosMatrix(v.toUnwrapped()))}function Ot(h,v,p,g,S,w){var R=function(ft,Ue,ct){if(ft)for(var Et=0,zt=ft;Et<zt.length;Et+=1){var or=Ue[zt[Et]];if(or&&or.source===ct&&or.type==="fill-extrusion")return!0}else for(var Qt in Ue){var fr=Ue[Qt];if(fr.source===ct&&fr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),P=w.maxPitchScaleFactor(),X=h.tilesIn(g,P,R);X.sort(Vr);for(var te=[],ye=0,Ee=X;ye<Ee.length;ye+=1){var Ce=Ee[ye];te.push({wrappedTileID:Ce.tileID.wrapped().key,queryResults:Ce.tile.queryRenderedFeatures(v,p,h._state,Ce.queryGeometry,Ce.cameraQueryGeometry,Ce.scale,S,w,P,dr(h.transform,Ce.tileID))})}var Xe=function(ft){for(var Ue={},ct={},Et=0,zt=ft;Et<zt.length;Et+=1){var or=zt[Et],Qt=or.queryResults,fr=or.wrappedTileID,Ar=ct[fr]=ct[fr]||{};for(var Yr in Qt)for(var zr=Qt[Yr],_n=Ar[Yr]=Ar[Yr]||{},jn=Ue[Yr]=Ue[Yr]||[],zn=0,Hn=zr;zn<Hn.length;zn+=1){var Wi=Hn[zn];_n[Wi.featureIndex]||(_n[Wi.featureIndex]=!0,jn.push(Wi))}}return Ue}(te);for(var We in Xe)Xe[We].forEach(function(ft){var Ue=ft.feature,ct=h.getFeatureState(Ue.layer["source-layer"],Ue.id);Ue.source=Ue.layer.source,Ue.layer["source-layer"]&&(Ue.sourceLayer=Ue.layer["source-layer"]),Ue.state=ct});return Xe}function Vr(h,v){var p=h.tileID,g=v.tileID;return p.overscaledZ-g.overscaledZ||p.canonical.y-g.canonical.y||p.wrap-g.wrap||p.canonical.x-g.canonical.x}var Kr=function(h,v){this.max=h,this.onRemove=v,this.reset()};Kr.prototype.reset=function(){for(var h in this.data)for(var v=0,p=this.data[h];v<p.length;v+=1){var g=p[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Kr.prototype.add=function(h,v,p){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var w={value:v,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(function(){g.remove(h,w)},p)),this.data[S].push(w),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Kr.prototype.has=function(h){return h.wrapped().key in this.data},Kr.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},Kr.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},Kr.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},Kr.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},Kr.prototype.remove=function(h,v){if(!this.has(h))return this;var p=h.wrapped().key,g=v===void 0?0:this.data[p].indexOf(v),S=this.data[p][g];return this.data[p].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this},Kr.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},Kr.prototype.filter=function(h){var v=[];for(var p in this.data)for(var g=0,S=this.data[p];g<S.length;g+=1){var w=S[g];h(w.value)||v.push(w)}for(var R=0,P=v;R<P.length;R+=1){var X=P[R];this.remove(X.value.tileID,X)}};var Or=function(h,v,p){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Or.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Or.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},Or.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var In={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},gn=function(h,v,p,g){this.length=v.length,this.attributes=p,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};gn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},gn.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},gn.prototype.enableAttributes=function(h,v){for(var p=0;p<this.attributes.length;p++){var g=v.attributes[this.attributes[p].name];g!==void 0&&h.enableVertexAttribArray(g)}},gn.prototype.setVertexAttribPointers=function(h,v,p){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],w=v.attributes[S.name];w!==void 0&&h.vertexAttribPointer(w,S.components,h[In[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}},gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var nn=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};nn.prototype.get=function(){return this.current},nn.prototype.set=function(h){},nn.prototype.getDefault=function(){return this.default},nn.prototype.setDefault=function(){this.set(this.default)};var fi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(nn),Lr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},v}(nn),Vn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},v}(nn),Hr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(nn),hn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},v}(nn),qi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},v}(nn),xi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(p){var g=this.current;(p.func!==g.func||p.ref!==g.ref||p.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},v}(nn),ia=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},v}(nn),ea=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=p,this.dirty=!1}},v}(nn),be=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},v}(nn),Fi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=p,this.dirty=!1}},v}(nn),aa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},v}(nn),va=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.BLEND):g.disable(g.BLEND),this.current=p,this.dirty=!1}},v}(nn),oo=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},v}(nn),po=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(nn),Mo=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},v}(nn),Gt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=p,this.dirty=!1}},v}(nn),_r=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},v}(nn),Gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},v}(nn),rn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},v}(nn),yn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},v}(nn),Ti=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(nn),fe=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},v}(nn),k=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(nn),z=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,p),this.current=p,this.dirty=!1}},v}(nn),le=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},v}(nn),Se=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},v}(nn),De=function(h){function v(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},v}(nn),$t=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},v}(nn),Dt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},v}(nn),Bt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},v}(nn),yt=function(h){function v(p,g){h.call(this,p),this.context=p,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(nn),U=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},v}(yt),N=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(yt),$=function(h,v,p,g){this.context=h,this.width=v,this.height=p;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new U(h,S),g&&(this.depthAttachment=new N(h,S))};$.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p)}h.deleteFramebuffer(this.framebuffer)};var ae=function(h,v,p){this.func=h,this.mask=v,this.range=p};ae.ReadOnly=!1,ae.ReadWrite=!0,ae.disabled=new ae(519,ae.ReadOnly,[0,1]);var Ae=function(h,v,p,g,S,w){this.test=h,this.ref=v,this.mask=p,this.fail=g,this.depthFail=S,this.pass=w};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var Ze=function(h,v,p){this.blendFunction=h,this.blendColor=v,this.mask=p};Ze.disabled=new Ze(Ze.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Ze.unblended=new Ze(Ze.Replace,y.Color.transparent,[!0,!0,!0,!0]),Ze.alphaBlended=new Ze([1,771],y.Color.transparent,[!0,!0,!0,!0]);var at=function(h,v,p){this.enable=h,this.mode=v,this.frontFace=p};at.disabled=new at(!1,1029,2305),at.backCCW=new at(!0,1029,2305);var j=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new fi(this),this.clearDepth=new Lr(this),this.clearStencil=new Vn(this),this.colorMask=new Hr(this),this.depthMask=new hn(this),this.stencilMask=new qi(this),this.stencilFunc=new xi(this),this.stencilOp=new ia(this),this.stencilTest=new ea(this),this.depthRange=new be(this),this.depthTest=new Fi(this),this.depthFunc=new aa(this),this.blend=new va(this),this.blendFunc=new oo(this),this.blendColor=new po(this),this.blendEquation=new Mo(this),this.cullFace=new Gt(this),this.cullFaceSide=new _r(this),this.frontFace=new Gr(this),this.program=new rn(this),this.activeTexture=new yn(this),this.viewport=new Ti(this),this.bindFramebuffer=new fe(this),this.bindRenderbuffer=new k(this),this.bindTexture=new z(this),this.bindVertexBuffer=new le(this),this.bindElementBuffer=new Se(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new De(this),this.pixelStoreUnpack=new $t(this),this.pixelStoreUnpackPremultiplyAlpha=new Dt(this),this.pixelStoreUnpackFlipY=new Bt(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};j.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},j.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},j.prototype.createIndexBuffer=function(h,v){return new Or(this,h,v)},j.prototype.createVertexBuffer=function(h,v,p){return new gn(this,h,v,p)},j.prototype.createRenderbuffer=function(h,v,p){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,p),this.bindRenderbuffer.set(null),S},j.prototype.createFramebuffer=function(h,v,p){return new $(this,h,v,p)},j.prototype.clear=function(h){var v=h.color,p=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),g.clear(S)},j.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},j.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},j.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},j.prototype.setColorMode=function(h){y.deepEqual(h.blendFunction,Ze.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},j.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var J=function(h){function v(p,g,S){var w=this;h.call(this),this.id=p,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(R,P,X,te){var ye=new Tt[P.type](R,P,X,te);if(ye.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+ye.id);return y.bindAll(["load","abort","unload","serialize","prepare"],ye),ye}(p,g,S,this),this._tiles={},this._cache=new Kr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},v.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var g=this._tiles[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(p,g){return this._source.loadTile(p,g)},v.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},v.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(p){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(p),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return y.values(this._tiles).map(function(p){return p.tileID}).sort(Ne).map(function(p){return p.key})},v.prototype.getRenderableIds=function(p){var g=this,S=[];for(var w in this._tiles)this._isIdRenderable(w,p)&&S.push(this._tiles[w]);return p?S.sort(function(R,P){var X=R.tileID,te=P.tileID,ye=new y.Point(X.canonical.x,X.canonical.y)._rotate(g.transform.angle),Ee=new y.Point(te.canonical.x,te.canonical.y)._rotate(g.transform.angle);return X.overscaledZ-te.overscaledZ||Ee.y-ye.y||Ee.x-ye.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(Ne).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(p){var g=this.findLoadedParent(p,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(p,g){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(g||!this._tiles[p].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},v.prototype._reloadTile=function(p,g){var S=this._tiles[p];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,p,g)))},v.prototype._tileLoaded=function(p,g,S,w){if(w)return p.state="errored",void(w.status!==404?this._source.fire(new y.ErrorEvent(w,{tile:p})):this.update(this.transform));p.timeAdded=y.browser.now(),S==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(g,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},v.prototype._backfillDEM=function(p){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var w=g[S];if(p.neighboringTiles&&p.neighboringTiles[w]){var R=this.getTileByID(w);P(p,R),P(R,p)}}function P(X,te){X.needsHillshadePrepare=!0;var ye=te.tileID.canonical.x-X.tileID.canonical.x,Ee=te.tileID.canonical.y-X.tileID.canonical.y,Ce=Math.pow(2,X.tileID.canonical.z),Xe=te.tileID.key;ye===0&&Ee===0||Math.abs(Ee)>1||(Math.abs(ye)>1&&(Math.abs(ye+Ce)===1?ye+=Ce:Math.abs(ye-Ce)===1&&(ye-=Ce)),te.dem&&X.dem&&(X.dem.backfillBorder(te.dem,ye,Ee),X.neighboringTiles&&X.neighboringTiles[Xe]&&(X.neighboringTiles[Xe].backfilled=!0)))}},v.prototype.getTile=function(p){return this.getTileByID(p.key)},v.prototype.getTileByID=function(p){return this._tiles[p]},v.prototype._retainLoadedChildren=function(p,g,S,w){for(var R in this._tiles){var P=this._tiles[R];if(!(w[R]||!P.hasData()||P.tileID.overscaledZ<=g||P.tileID.overscaledZ>S)){for(var X=P.tileID;P&&P.tileID.overscaledZ>g+1;){var te=P.tileID.scaledTo(P.tileID.overscaledZ-1);(P=this._tiles[te.key])&&P.hasData()&&(X=te)}for(var ye=X;ye.overscaledZ>g;)if(p[(ye=ye.scaledTo(ye.overscaledZ-1)).key]){w[X.key]=X;break}}}},v.prototype.findLoadedParent=function(p,g){if(p.key in this._loadedParentTiles){var S=this._loadedParentTiles[p.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var w=p.overscaledZ-1;w>=g;w--){var R=p.scaledTo(w),P=this._getLoadedTile(R);if(P)return P}},v.prototype._getLoadedTile=function(p){var g=this._tiles[p.key];return g&&g.hasData()?g:this._cache.getByKey(p.wrapped().key)},v.prototype.updateCacheSize=function(p){var g=Math.ceil(p.width/this._source.tileSize)+1,S=Math.ceil(p.height/this._source.tileSize)+1,w=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(p){var g=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,g){var S={};for(var w in this._tiles){var R=this._tiles[w];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var P in this._tiles=S,this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(var X in this._tiles)this._setTileReloadTimer(X,this._tiles[X])}},v.prototype.update=function(p){var g=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ar){return new y.OverscaledTileID(Ar.canonical.z,Ar.wrap,Ar.canonical.z,Ar.canonical.x,Ar.canonical.y)}):(S=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Ar){return g._source.hasTile(Ar)}))):S=[];var w=p.coveringZoomLevel(this._source),R=Math.max(w-v.maxOverzooming,this._source.minzoom),P=Math.max(w+v.maxUnderzooming,this._source.minzoom),X=this._updateRetainedTiles(S,w);if(st(this._source.type)){for(var te={},ye={},Ee=0,Ce=Object.keys(X);Ee<Ce.length;Ee+=1){var Xe=Ce[Ee],We=X[Xe],ft=this._tiles[Xe];if(ft&&!(ft.fadeEndTime&&ft.fadeEndTime<=y.browser.now())){var Ue=this.findLoadedParent(We,R);Ue&&(this._addTile(Ue.tileID),te[Ue.tileID.key]=Ue.tileID),ye[Xe]=We}}for(var ct in this._retainLoadedChildren(ye,w,P,X),te)X[ct]||(this._coveredTiles[ct]=!0,X[ct]=te[ct])}for(var Et in X)this._tiles[Et].clearFadeHold();for(var zt=0,or=y.keysDifference(this._tiles,X);zt<or.length;zt+=1){var Qt=or[zt],fr=this._tiles[Qt];fr.hasSymbolBuckets&&!fr.holdingForFade()?fr.setHoldDuration(this.map._fadeDuration):fr.hasSymbolBuckets&&!fr.symbolFadeFinished()||this._removeTile(Qt)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},v.prototype._updateRetainedTiles=function(p,g){for(var S={},w={},R=Math.max(g-v.maxOverzooming,this._source.minzoom),P=Math.max(g+v.maxUnderzooming,this._source.minzoom),X={},te=0,ye=p;te<ye.length;te+=1){var Ee=ye[te],Ce=this._addTile(Ee);S[Ee.key]=Ee,Ce.hasData()||g<this._source.maxzoom&&(X[Ee.key]=Ee)}this._retainLoadedChildren(X,g,P,S);for(var Xe=0,We=p;Xe<We.length;Xe+=1){var ft=We[Xe],Ue=this._tiles[ft.key];if(!Ue.hasData()){if(g+1>this._source.maxzoom){var ct=ft.children(this._source.maxzoom)[0],Et=this.getTile(ct);if(Et&&Et.hasData()){S[ct.key]=ct;continue}}else{var zt=ft.children(this._source.maxzoom);if(S[zt[0].key]&&S[zt[1].key]&&S[zt[2].key]&&S[zt[3].key])continue}for(var or=Ue.wasRequested(),Qt=ft.overscaledZ-1;Qt>=R;--Qt){var fr=ft.scaledTo(Qt);if(w[fr.key]||(w[fr.key]=!0,!(Ue=this.getTile(fr))&&or&&(Ue=this._addTile(fr)),Ue&&(S[fr.key]=fr,or=Ue.wasRequested(),Ue.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,w=this._tiles[p].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){S=this._loadedParentTiles[w.key];break}g.push(w.key);var R=w.scaledTo(w.overscaledZ-1);if(S=this._getLoadedTile(R))break;w=R}for(var P=0,X=g;P<X.length;P+=1)this._loadedParentTiles[X[P]]=S}},v.prototype._addTile=function(p){var g=this._tiles[p.key];if(g)return g;(g=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,g),g.tileID=p,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,g)));var S=!!g;return S||(g=new y.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,p.key,g.state))),g?(g.uses++,this._tiles[p.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(p,g){var S=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var w=g.getExpiryTimeout();w&&(this._timers[p]=setTimeout(function(){S._reloadTile(p,"expired"),delete S._timers[p]},w))},v.prototype._removeTile=function(p){var g=this._tiles[p];g&&(g.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},v.prototype.tilesIn=function(p,g,S){var w=this,R=[],P=this.transform;if(!P)return R;for(var X=S?P.getCameraQueryGeometry(p):p,te=p.map(function(Qt){return P.pointCoordinate(Qt)}),ye=X.map(function(Qt){return P.pointCoordinate(Qt)}),Ee=this.getIds(),Ce=1/0,Xe=1/0,We=-1/0,ft=-1/0,Ue=0,ct=ye;Ue<ct.length;Ue+=1){var Et=ct[Ue];Ce=Math.min(Ce,Et.x),Xe=Math.min(Xe,Et.y),We=Math.max(We,Et.x),ft=Math.max(ft,Et.y)}for(var zt=function(Qt){var fr=w._tiles[Ee[Qt]];if(!fr.holdingForFade()){var Ar=fr.tileID,Yr=Math.pow(2,P.zoom-fr.tileID.overscaledZ),zr=g*fr.queryPadding*y.EXTENT/fr.tileSize/Yr,_n=[Ar.getTilePoint(new y.MercatorCoordinate(Ce,Xe)),Ar.getTilePoint(new y.MercatorCoordinate(We,ft))];if(_n[0].x-zr<y.EXTENT&&_n[0].y-zr<y.EXTENT&&_n[1].x+zr>=0&&_n[1].y+zr>=0){var jn=te.map(function(Hn){return Ar.getTilePoint(Hn)}),zn=ye.map(function(Hn){return Ar.getTilePoint(Hn)});R.push({tile:fr,tileID:Ar,queryGeometry:jn,cameraQueryGeometry:zn,scale:Yr})}}},or=0;or<Ee.length;or++)zt(or);return R},v.prototype.getVisibleCoordinates=function(p){for(var g=this,S=this.getRenderableIds(p).map(function(X){return g._tiles[X].tileID}),w=0,R=S;w<R.length;w+=1){var P=R[w];P.posMatrix=this.transform.calculatePosMatrix(P.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(st(this._source.type))for(var p in this._tiles){var g=this._tiles[p];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},v.prototype.setFeatureState=function(p,g,S){this._state.updateState(p=p||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(p,g,S){this._state.removeFeatureState(p=p||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(p,g){return this._state.getState(p=p||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(p,g,S){var w=this._tiles[p];w&&w.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(p,g){for(var S in this._tiles)this._tiles[S].hasDependency(p,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(w){return!w.hasDependency(p,g)})},v}(y.Evented);function Ne(h,v){var p=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-p||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function st(h){return h==="raster"||h==="image"||h==="video"}function Te(){return new y.window.Worker(Ph.workerUrl)}J.maxOverzooming=10,J.maxUnderzooming=3;var Kt="mapboxgl_preloaded_worker_pool",xr=function(){this.active={}};xr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<xr.workerCount;)this.workers.push(new Te);return this.active[h]=!0,this.workers.slice()},xr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},xr.prototype.isPreloaded=function(){return!!this.active[Kt]},xr.prototype.numActive=function(){return Object.keys(this.active).length};var sn,un=Math.floor(y.browser.hardwareConcurrency/2);function nr(){return sn||(sn=new xr),sn}function Qr(h,v){var p={};for(var g in h)g!=="ref"&&(p[g]=h[g]);return y.refProperties.forEach(function(S){S in v&&(p[S]=v[S])}),p}function Wr(h){h=h.slice();for(var v=Object.create(null),p=0;p<h.length;p++)v[h[p].id]=h[p];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=Qr(h[g],v[h[g].ref]));return h}xr.workerCount=Math.max(Math.min(un,6),1);var $r={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ii(h,v,p){p.push({command:$r.addSource,args:[h,v[h]]})}function pn(h,v,p){v.push({command:$r.removeSource,args:[h]}),p[h]=!0}function mi(h,v,p,g){pn(h,p,g),ii(h,v,p)}function Gi(h,v,p){var g;for(g in h[p])if(h[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;for(g in v[p])if(v[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;return!0}function di(h,v,p,g,S,w){var R;for(R in v=v||{},h=h||{})h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:w,args:[g,R,v[R],S]}));for(R in v)v.hasOwnProperty(R)&&!h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:w,args:[g,R,v[R],S]}))}function Ui(h){return h.id}function wi(h,v){return h[v.id]=v,h}var ss=function(h,v){this.reset(h,v)};ss.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ss.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=y.clamp(h,0,1);for(var v=1,p=this._distances[v],g=h*this.paddedLength+this.padding;p<g&&v<this._distances.length;)p=this._distances[++v];var S=v-1,w=this._distances[S],R=p-w,P=R>0?(g-w)/R:0;return this.points[S].mult(1-P).add(this.points[v].mult(P))};var oa=function(h,v,p){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(v/p);for(var w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function ka(h,v,p,g,S){var w=y.create();return v?(y.scale(w,w,[1/S,1/S,1]),p||y.rotateZ(w,w,g.angle)):y.multiply(w,g.labelPlaneMatrix,h),w}function Ci(h,v,p,g,S){if(v){var w=y.clone(h);return y.scale(w,w,[S,S,1]),p||y.rotateZ(w,w,-g.angle),w}return g.glCoordMatrix}function yi(h,v){var p=[h.x,h.y,0,1];fa(p,p,v);var g=p[3];return{point:new y.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Ri(h,v){return .5+h/v*.5}function Da(h,v){var p=h[0]/h[3],g=h[1]/h[3];return p>=-v[0]&&p<=v[0]&&g>=-v[1]&&g<=v[1]}function gu(h,v,p,g,S,w,R,P){var X=g?h.textSizeData:h.iconSizeData,te=y.evaluateSizeForZoom(X,p.transform.zoom),ye=[256/p.width*2+1,256/p.height*2+1],Ee=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Ee.clear();for(var Ce=h.lineVertexArray,Xe=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,We=p.transform.width/p.transform.height,ft=!1,Ue=0;Ue<Xe.length;Ue++){var ct=Xe.get(Ue);if(ct.hidden||ct.writingMode===y.WritingMode.vertical&&!ft)La(ct.numGlyphs,Ee);else{ft=!1;var Et=[ct.anchorX,ct.anchorY,0,1];if(y.transformMat4(Et,Et,v),Da(Et,ye)){var zt=Ri(p.transform.cameraToCenterDistance,Et[3]),or=y.evaluateSizeForFeature(X,te,ct),Qt=R?or/zt:or*zt,fr=new y.Point(ct.anchorX,ct.anchorY),Ar=yi(fr,S).point,Yr={},zr=Zl(ct,Qt,!1,P,v,S,w,h.glyphOffsetArray,Ce,Ee,Ar,fr,Yr,We);ft=zr.useVertical,(zr.notEnoughRoom||ft||zr.needsFlipping&&Zl(ct,Qt,!0,P,v,S,w,h.glyphOffsetArray,Ce,Ee,Ar,fr,Yr,We).notEnoughRoom)&&La(ct.numGlyphs,Ee)}else La(ct.numGlyphs,Ee)}}g?h.text.dynamicLayoutVertexBuffer.updateData(Ee):h.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function _a(h,v,p,g,S,w,R,P,X,te,ye){var Ee=P.glyphStartIndex+P.numGlyphs,Ce=P.lineStartIndex,Xe=P.lineStartIndex+P.lineLength,We=v.getoffsetX(P.glyphStartIndex),ft=v.getoffsetX(Ee-1),Ue=Pa(h*We,p,g,S,w,R,P.segment,Ce,Xe,X,te,ye);if(!Ue)return null;var ct=Pa(h*ft,p,g,S,w,R,P.segment,Ce,Xe,X,te,ye);return ct?{first:Ue,last:ct}:null}function Ia(h,v,p,g){return h===y.WritingMode.horizontal&&Math.abs(p.y-v.y)>Math.abs(p.x-v.x)*g?{useVertical:!0}:(h===y.WritingMode.vertical?v.y<p.y:v.x>p.x)?{needsFlipping:!0}:null}function Zl(h,v,p,g,S,w,R,P,X,te,ye,Ee,Ce,Xe){var We,ft=v/24,Ue=h.lineOffsetX*ft,ct=h.lineOffsetY*ft;if(h.numGlyphs>1){var Et=h.glyphStartIndex+h.numGlyphs,zt=h.lineStartIndex,or=h.lineStartIndex+h.lineLength,Qt=_a(ft,P,Ue,ct,p,ye,Ee,h,X,w,Ce);if(!Qt)return{notEnoughRoom:!0};var fr=yi(Qt.first.point,R).point,Ar=yi(Qt.last.point,R).point;if(g&&!p){var Yr=Ia(h.writingMode,fr,Ar,Xe);if(Yr)return Yr}We=[Qt.first];for(var zr=h.glyphStartIndex+1;zr<Et-1;zr++)We.push(Pa(ft*P.getoffsetX(zr),Ue,ct,p,ye,Ee,h.segment,zt,or,X,w,Ce));We.push(Qt.last)}else{if(g&&!p){var _n=yi(Ee,S).point,jn=h.lineStartIndex+h.segment+1,zn=new y.Point(X.getx(jn),X.gety(jn)),Hn=yi(zn,S),Wi=Hn.signedDistanceFromCamera>0?Hn.point:vs(Ee,zn,_n,1,S),An=Ia(h.writingMode,_n,Wi,Xe);if(An)return An}var ui=Pa(ft*P.getoffsetX(h.glyphStartIndex),Ue,ct,p,ye,Ee,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,X,w,Ce);if(!ui)return{notEnoughRoom:!0};We=[ui]}for(var gi=0,oi=We;gi<oi.length;gi+=1){var ri=oi[gi];y.addDynamicAttributes(te,ri.point,ri.angle)}return{}}function vs(h,v,p,g,S){var w=yi(h.add(h.sub(v)._unit()),S).point,R=p.sub(w);return p.add(R._mult(g/R.mag()))}function Pa(h,v,p,g,S,w,R,P,X,te,ye,Ee){var Ce=g?h-v:h+v,Xe=Ce>0?1:-1,We=0;g&&(Xe*=-1,We=Math.PI),Xe<0&&(We+=Math.PI);for(var ft=Xe>0?P+R:P+R+1,Ue=S,ct=S,Et=0,zt=0,or=Math.abs(Ce),Qt=[];Et+zt<=or;){if((ft+=Xe)<P||ft>=X)return null;if(ct=Ue,Qt.push(Ue),(Ue=Ee[ft])===void 0){var fr=new y.Point(te.getx(ft),te.gety(ft)),Ar=yi(fr,ye);if(Ar.signedDistanceFromCamera>0)Ue=Ee[ft]=Ar.point;else{var Yr=ft-Xe;Ue=vs(Et===0?w:new y.Point(te.getx(Yr),te.gety(Yr)),fr,ct,or-Et+1,ye)}}Et+=zt,zt=ct.dist(Ue)}var zr=(or-Et)/zt,_n=Ue.sub(ct),jn=_n.mult(zr)._add(ct);jn._add(_n._unit()._perp()._mult(p*Xe));var zn=We+Math.atan2(Ue.y-ct.y,Ue.x-ct.x);return Qt.push(jn),{point:jn,angle:zn,path:Qt}}oa.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},oa.prototype.insert=function(h,v,p,g,S){this._forEachCell(v,p,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(S)},oa.prototype.insertCircle=function(h,v,p,g){this._forEachCell(v-g,p-g,v+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(p),this.circles.push(g)},oa.prototype._insertBoxCell=function(h,v,p,g,S,w){this.boxCells[S].push(w)},oa.prototype._insertCircleCell=function(h,v,p,g,S,w){this.circleCells[S].push(w)},oa.prototype._query=function(h,v,p,g,S,w){if(p<0||h>this.width||g<0||v>this.height)return!S&&[];var R=[];if(h<=0&&v<=0&&this.width<=p&&this.height<=g){if(S)return!0;for(var P=0;P<this.boxKeys.length;P++)R.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(var X=0;X<this.circleKeys.length;X++){var te=this.circles[3*X],ye=this.circles[3*X+1],Ee=this.circles[3*X+2];R.push({key:this.circleKeys[X],x1:te-Ee,y1:ye-Ee,x2:te+Ee,y2:ye+Ee})}return w?R.filter(w):R}return this._forEachCell(h,v,p,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},w),S?R.length>0:R},oa.prototype._queryCircle=function(h,v,p,g,S){var w=h-p,R=h+p,P=v-p,X=v+p;if(R<0||w>this.width||X<0||P>this.height)return!g&&[];var te=[];return this._forEachCell(w,P,R,X,this._queryCellCircle,te,{hitTest:g,circle:{x:h,y:v,radius:p},seenUids:{box:{},circle:{}}},S),g?te.length>0:te},oa.prototype.query=function(h,v,p,g,S){return this._query(h,v,p,g,!1,S)},oa.prototype.hitTest=function(h,v,p,g,S){return this._query(h,v,p,g,!0,S)},oa.prototype.hitTestCircle=function(h,v,p,g){return this._queryCircle(h,v,p,!0,g)},oa.prototype._queryCell=function(h,v,p,g,S,w,R,P){var X=R.seenUids,te=this.boxCells[S];if(te!==null)for(var ye=this.bboxes,Ee=0,Ce=te;Ee<Ce.length;Ee+=1){var Xe=Ce[Ee];if(!X.box[Xe]){X.box[Xe]=!0;var We=4*Xe;if(h<=ye[We+2]&&v<=ye[We+3]&&p>=ye[We+0]&&g>=ye[We+1]&&(!P||P(this.boxKeys[Xe]))){if(R.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Xe],x1:ye[We],y1:ye[We+1],x2:ye[We+2],y2:ye[We+3]})}}}var ft=this.circleCells[S];if(ft!==null)for(var Ue=this.circles,ct=0,Et=ft;ct<Et.length;ct+=1){var zt=Et[ct];if(!X.circle[zt]){X.circle[zt]=!0;var or=3*zt;if(this._circleAndRectCollide(Ue[or],Ue[or+1],Ue[or+2],h,v,p,g)&&(!P||P(this.circleKeys[zt]))){if(R.hitTest)return w.push(!0),!0;var Qt=Ue[or],fr=Ue[or+1],Ar=Ue[or+2];w.push({key:this.circleKeys[zt],x1:Qt-Ar,y1:fr-Ar,x2:Qt+Ar,y2:fr+Ar})}}}},oa.prototype._queryCellCircle=function(h,v,p,g,S,w,R,P){var X=R.circle,te=R.seenUids,ye=this.boxCells[S];if(ye!==null)for(var Ee=this.bboxes,Ce=0,Xe=ye;Ce<Xe.length;Ce+=1){var We=Xe[Ce];if(!te.box[We]){te.box[We]=!0;var ft=4*We;if(this._circleAndRectCollide(X.x,X.y,X.radius,Ee[ft+0],Ee[ft+1],Ee[ft+2],Ee[ft+3])&&(!P||P(this.boxKeys[We])))return w.push(!0),!0}}var Ue=this.circleCells[S];if(Ue!==null)for(var ct=this.circles,Et=0,zt=Ue;Et<zt.length;Et+=1){var or=zt[Et];if(!te.circle[or]){te.circle[or]=!0;var Qt=3*or;if(this._circlesCollide(ct[Qt],ct[Qt+1],ct[Qt+2],X.x,X.y,X.radius)&&(!P||P(this.circleKeys[or])))return w.push(!0),!0}}},oa.prototype._forEachCell=function(h,v,p,g,S,w,R,P){for(var X=this._convertToXCellCoord(h),te=this._convertToYCellCoord(v),ye=this._convertToXCellCoord(p),Ee=this._convertToYCellCoord(g),Ce=X;Ce<=ye;Ce++)for(var Xe=te;Xe<=Ee;Xe++)if(S.call(this,h,v,p,g,this.xCellCount*Xe+Ce,w,R,P))return},oa.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},oa.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},oa.prototype._circlesCollide=function(h,v,p,g,S,w){var R=g-h,P=S-v,X=p+w;return X*X>R*R+P*P},oa.prototype._circleAndRectCollide=function(h,v,p,g,S,w,R){var P=(w-g)/2,X=Math.abs(h-(g+P));if(X>P+p)return!1;var te=(R-S)/2,ye=Math.abs(v-(S+te));if(ye>te+p)return!1;if(X<=P||ye<=te)return!0;var Ee=X-P,Ce=ye-te;return Ee*Ee+Ce*Ce<=p*p};var _i=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function La(h,v){for(var p=0;p<h;p++){var g=v.length;v.resize(g+4),v.float32.set(_i,3*g)}}function fa(h,v,p){var g=v[0],S=v[1];return h[0]=p[0]*g+p[4]*S+p[12],h[1]=p[1]*g+p[5]*S+p[13],h[3]=p[3]*g+p[7]*S+p[15],h}var Ho=function(h,v,p){v===void 0&&(v=new oa(h.width+200,h.height+200,25)),p===void 0&&(p=new oa(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function ga(h,v,p){return v*(y.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}Ho.prototype.placeCollisionBox=function(h,v,p,g,S){var w=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),R=p*w.perspectiveRatio,P=h.x1*R+w.point.x,X=h.y1*R+w.point.y,te=h.x2*R+w.point.x,ye=h.y2*R+w.point.y;return!this.isInsideGrid(P,X,te,ye)||!v&&this.grid.hitTest(P,X,te,ye,S)?{box:[],offscreen:!1}:{box:[P,X,te,ye],offscreen:this.isOffscreen(P,X,te,ye)}},Ho.prototype.placeCollisionCircles=function(h,v,p,g,S,w,R,P,X,te,ye,Ee,Ce){var Xe=[],We=new y.Point(v.anchorX,v.anchorY),ft=yi(We,w),Ue=Ri(this.transform.cameraToCenterDistance,ft.signedDistanceFromCamera),ct=(te?S/Ue:S*Ue)/y.ONE_EM,Et=yi(We,R).point,zt=_a(ct,g,v.lineOffsetX*ct,v.lineOffsetY*ct,!1,Et,We,v,p,R,{}),or=!1,Qt=!1,fr=!0;if(zt){for(var Ar=.5*Ee*Ue+Ce,Yr=new y.Point(-100,-100),zr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),_n=new ss,jn=zt.first,zn=zt.last,Hn=[],Wi=jn.path.length-1;Wi>=1;Wi--)Hn.push(jn.path[Wi]);for(var An=1;An<zn.path.length;An++)Hn.push(zn.path[An]);var ui=2.5*Ar;if(P){var gi=Hn.map(function(Zs){return yi(Zs,P)});Hn=gi.some(function(Zs){return Zs.signedDistanceFromCamera<=0})?[]:gi.map(function(Zs){return Zs.point})}var oi=[];if(Hn.length>0){for(var ri=Hn[0].clone(),vi=Hn[0].clone(),ni=1;ni<Hn.length;ni++)ri.x=Math.min(ri.x,Hn[ni].x),ri.y=Math.min(ri.y,Hn[ni].y),vi.x=Math.max(vi.x,Hn[ni].x),vi.y=Math.max(vi.y,Hn[ni].y);oi=ri.x>=Yr.x&&vi.x<=zr.x&&ri.y>=Yr.y&&vi.y<=zr.y?[Hn]:vi.x<Yr.x||ri.x>zr.x||vi.y<Yr.y||ri.y>zr.y?[]:y.clipLine([Hn],Yr.x,Yr.y,zr.x,zr.y)}for(var Kn=0,ko=oi;Kn<ko.length;Kn+=1){var to;_n.reset(ko[Kn],.25*Ar),to=_n.length<=.5*Ar?1:Math.ceil(_n.paddedLength/ui)+1;for(var Do=0;Do<to;Do++){var bo=Do/Math.max(to-1,1),$a=_n.lerp(bo),ro=$a.x+100,xs=$a.y+100;Xe.push(ro,xs,Ar,0);var Es=ro-Ar,cl=xs-Ar,Ss=ro+Ar,fu=xs+Ar;if(fr=fr&&this.isOffscreen(Es,cl,Ss,fu),Qt=Qt||this.isInsideGrid(Es,cl,Ss,fu),!h&&this.grid.hitTestCircle(ro,xs,Ar,ye)&&(or=!0,!X))return{circles:[],offscreen:!1,collisionDetected:or}}}}return{circles:!X&&or||!Qt?[]:Xe,offscreen:fr,collisionDetected:or}},Ho.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],p=1/0,g=1/0,S=-1/0,w=-1/0,R=0,P=h;R<P.length;R+=1){var X=P[R],te=new y.Point(X.x+100,X.y+100);p=Math.min(p,te.x),g=Math.min(g,te.y),S=Math.max(S,te.x),w=Math.max(w,te.y),v.push(te)}for(var ye={},Ee={},Ce=0,Xe=this.grid.query(p,g,S,w).concat(this.ignoredGrid.query(p,g,S,w));Ce<Xe.length;Ce+=1){var We=Xe[Ce],ft=We.key;if(ye[ft.bucketInstanceId]===void 0&&(ye[ft.bucketInstanceId]={}),!ye[ft.bucketInstanceId][ft.featureIndex]){var Ue=[new y.Point(We.x1,We.y1),new y.Point(We.x2,We.y1),new y.Point(We.x2,We.y2),new y.Point(We.x1,We.y2)];y.polygonIntersectsPolygon(v,Ue)&&(ye[ft.bucketInstanceId][ft.featureIndex]=!0,Ee[ft.bucketInstanceId]===void 0&&(Ee[ft.bucketInstanceId]=[]),Ee[ft.bucketInstanceId].push(ft.featureIndex))}}return Ee},Ho.prototype.insertCollisionBox=function(h,v,p,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},Ho.prototype.insertCollisionCircles=function(h,v,p,g,S){for(var w=v?this.ignoredGrid:this.grid,R={bucketInstanceId:p,featureIndex:g,collisionGroupID:S},P=0;P<h.length;P+=4)w.insertCircle(R,h[P],h[P+1],h[P+2])},Ho.prototype.projectAndGetPerspectiveRatio=function(h,v,p){var g=[v,p,0,1];return fa(g,g,h),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ho.prototype.isOffscreen=function(h,v,p,g){return p<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},Ho.prototype.isInsideGrid=function(h,v,p,g){return p>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},Ho.prototype.getViewportMatrix=function(){var h=y.identity([]);return y.translate(h,h,[-100,-100,0]),h};var us=function(h,v,p,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&p?1:0,this.placed=p};us.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Qo=function(h,v,p,g,S){this.text=new us(h?h.text:null,v,p,S),this.icon=new us(h?h.icon:null,v,g,S)};Qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Lu=function(h,v,p){this.text=h,this.icon=v,this.skipFade=p},ms=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},gc=function(h,v,p,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=S},wa=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function sa(h,v,p,g,S){var w=y.getAnchorAlignment(h),R=-(w.horizontalAlign-.5)*v,P=-(w.verticalAlign-.5)*p,X=y.evaluateVariableOffset(h,g);return new y.Point(R+X[0]*S,P+X[1]*S)}function er(h,v,p,g,S,w){var R=h.x1,P=h.x2,X=h.y1,te=h.y2,ye=h.anchorPointX,Ee=h.anchorPointY,Ce=new y.Point(v,p);return g&&Ce._rotate(S?w:-w),{x1:R+Ce.x,y1:X+Ce.y,x2:P+Ce.x,y2:te+Ce.y,anchorPointX:ye,anchorPointY:Ee}}wa.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(p){return p.collisionGroupID===v}}}return this.collisionGroups[h]};var Cn=function(h,v,p,g){this.transform=h.clone(),this.collisionIndex=new Ho(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new wa(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function _e(h,v,p,g,S){h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0)}Cn.prototype.getBucketParts=function(h,v,p,g){var S=p.getBucket(v),w=p.latestFeatureIndex;if(S&&w&&v.id===S.layerIds[0]){var R=p.collisionBoxArray,P=S.layers[0].layout,X=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),te=p.tileSize/y.EXTENT,ye=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Ee=P.get("text-pitch-alignment")==="map",Ce=P.get("text-rotation-alignment")==="map",Xe=ga(p,1,this.transform.zoom),We=ka(ye,Ee,Ce,this.transform,Xe),ft=null;if(Ee){var Ue=Ci(ye,Ee,Ce,this.transform,Xe);ft=y.multiply([],this.transform.labelPlaneMatrix,Ue)}this.retainedQueryData[S.bucketInstanceId]=new gc(S.bucketInstanceId,w,S.sourceLayerIndex,S.index,p.tileID);var ct={bucket:S,layout:P,posMatrix:ye,textLabelPlaneMatrix:We,labelToScreenMatrix:ft,scale:X,textPixelRatio:te,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var Et=0,zt=S.sortKeyRanges;Et<zt.length;Et+=1){var or=zt[Et];h.push({sortKey:or.sortKey,symbolInstanceStart:or.symbolInstanceStart,symbolInstanceEnd:or.symbolInstanceEnd,parameters:ct})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ct})}},Cn.prototype.attemptAnchorPlacement=function(h,v,p,g,S,w,R,P,X,te,ye,Ee,Ce,Xe,We){var ft,Ue=[Ee.textOffset0,Ee.textOffset1],ct=sa(h,p,g,Ue,S),Et=this.collisionIndex.placeCollisionBox(er(v,ct.x,ct.y,w,R,this.transform.angle),ye,P,X,te.predicate);if(!We||this.collisionIndex.placeCollisionBox(er(We,ct.x,ct.y,w,R,this.transform.angle),ye,P,X,te.predicate).box.length!==0)return Et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID].text&&(ft=this.prevPlacement.variableOffsets[Ee.crossTileID].anchor),this.variableOffsets[Ee.crossTileID]={textOffset:Ue,width:p,height:g,anchor:h,textBoxScale:S,prevAnchor:ft},this.markUsedJustification(Ce,h,Ee,Xe),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Xe,Ee),this.placedOrientations[Ee.crossTileID]=Xe),{shift:ct,placedGlyphBoxes:Et}):void 0},Cn.prototype.placeLayerBucketPart=function(h,v,p){var g=this,S=h.parameters,w=S.bucket,R=S.layout,P=S.posMatrix,X=S.textLabelPlaneMatrix,te=S.labelToScreenMatrix,ye=S.textPixelRatio,Ee=S.holdingForFade,Ce=S.collisionBoxArray,Xe=S.partiallyEvaluatedTextSize,We=S.collisionGroup,ft=R.get("text-optional"),Ue=R.get("icon-optional"),ct=R.get("text-allow-overlap"),Et=R.get("icon-allow-overlap"),zt=R.get("text-rotation-alignment")==="map",or=R.get("text-pitch-alignment")==="map",Qt=R.get("icon-text-fit")!=="none",fr=R.get("symbol-z-order")==="viewport-y",Ar=ct&&(Et||!w.hasIconData()||Ue),Yr=Et&&(ct||!w.hasTextData()||ft);!w.collisionArrays&&Ce&&w.deserializeCollisionBoxes(Ce);var zr=function(An,ui){if(!v[An.crossTileID])if(Ee)g.placements[An.crossTileID]=new Lu(!1,!1,!1);else{var gi,oi=!1,ri=!1,vi=!0,ni=null,Kn={box:null,offscreen:null},ko={box:null,offscreen:null},to=null,Do=null,bo=0,$a=0,ro=0;ui.textFeatureIndex?bo=ui.textFeatureIndex:An.useRuntimeCollisionCircles&&(bo=An.featureIndex),ui.verticalTextFeatureIndex&&($a=ui.verticalTextFeatureIndex);var xs=ui.textBox;if(xs){var Es=function(Zi){var ts=y.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Zi&&g.prevPlacement){var lo=g.prevPlacement.placedOrientations[An.crossTileID];lo&&(g.placedOrientations[An.crossTileID]=lo,g.markUsedOrientation(w,ts=lo,An))}return ts},cl=function(Zi,ts){if(w.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&ui.verticalTextBox)for(var lo=0,du=w.writingModes;lo<du.length&&(du[lo]===y.WritingMode.vertical?(Kn=ts(),ko=Kn):Kn=Zi(),!(Kn&&Kn.box&&Kn.box.length));lo+=1);else Kn=Zi()};if(R.get("text-variable-anchor")){var Ss=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[An.crossTileID]){var fu=g.prevPlacement.variableOffsets[An.crossTileID];Ss.indexOf(fu.anchor)>0&&(Ss=Ss.filter(function(Zi){return Zi!==fu.anchor})).unshift(fu.anchor)}var Zs=function(Zi,ts,lo){for(var du=Zi.x2-Zi.x1,Mc=Zi.y2-Zi.y1,Gu=An.textBoxScale,Oh=Qt&&!Et?ts:null,Bo={box:[],offscreen:!1},Br=ct?2*Ss.length:Ss.length,Vs=0;Vs<Br;++Vs){var kh=g.attemptAnchorPlacement(Ss[Vs%Ss.length],Zi,du,Mc,Gu,zt,or,ye,P,We,Vs>=Ss.length,An,w,lo,Oh);if(kh&&(Bo=kh.placedGlyphBoxes)&&Bo.box&&Bo.box.length){oi=!0,ni=kh.shift;break}}return Bo};cl(function(){return Zs(xs,ui.iconBox,y.WritingMode.horizontal)},function(){var Zi=ui.verticalTextBox;return w.allowVerticalPlacement&&!(Kn&&Kn.box&&Kn.box.length)&&An.numVerticalGlyphVertices>0&&Zi?Zs(Zi,ui.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Kn&&(oi=Kn.box,vi=Kn.offscreen);var Rc=Es(Kn&&Kn.box);if(!oi&&g.prevPlacement){var Wu=g.prevPlacement.variableOffsets[An.crossTileID];Wu&&(g.variableOffsets[An.crossTileID]=Wu,g.markUsedJustification(w,Wu.anchor,An,Rc))}}else{var Cu=function(Zi,ts){var lo=g.collisionIndex.placeCollisionBox(Zi,ct,ye,P,We.predicate);return lo&&lo.box&&lo.box.length&&(g.markUsedOrientation(w,ts,An),g.placedOrientations[An.crossTileID]=ts),lo};cl(function(){return Cu(xs,y.WritingMode.horizontal)},function(){var Zi=ui.verticalTextBox;return w.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&Zi?Cu(Zi,y.WritingMode.vertical):{box:null,offscreen:null}}),Es(Kn&&Kn.box&&Kn.box.length)}}if(oi=(gi=Kn)&&gi.box&&gi.box.length>0,vi=gi&&gi.offscreen,An.useRuntimeCollisionCircles){var Jl=w.text.placedSymbolArray.get(An.centerJustifiedTextSymbolIndex),fl=y.evaluateSizeForFeature(w.textSizeData,Xe,Jl),hu=R.get("text-padding");to=g.collisionIndex.placeCollisionCircles(ct,Jl,w.lineVertexArray,w.glyphOffsetArray,fl,P,X,te,p,or,We.predicate,An.collisionCircleDiameter,hu),oi=ct||to.circles.length>0&&!to.collisionDetected,vi=vi&&to.offscreen}if(ui.iconFeatureIndex&&(ro=ui.iconFeatureIndex),ui.iconBox){var hl=function(Zi){var ts=Qt&&ni?er(Zi,ni.x,ni.y,zt,or,g.transform.angle):Zi;return g.collisionIndex.placeCollisionBox(ts,Et,ye,P,We.predicate)};ri=ko&&ko.box&&ko.box.length&&ui.verticalIconBox?(Do=hl(ui.verticalIconBox)).box.length>0:(Do=hl(ui.iconBox)).box.length>0,vi=vi&&Do.offscreen}var Lo=ft||An.numHorizontalGlyphVertices===0&&An.numVerticalGlyphVertices===0,uo=Ue||An.numIconVertices===0;if(Lo||uo?uo?Lo||(ri=ri&&oi):oi=ri&&oi:ri=oi=ri&&oi,oi&&gi&&gi.box&&g.collisionIndex.insertCollisionBox(gi.box,R.get("text-ignore-placement"),w.bucketInstanceId,ko&&ko.box&&$a?$a:bo,We.ID),ri&&Do&&g.collisionIndex.insertCollisionBox(Do.box,R.get("icon-ignore-placement"),w.bucketInstanceId,ro,We.ID),to&&(oi&&g.collisionIndex.insertCollisionCircles(to.circles,R.get("text-ignore-placement"),w.bucketInstanceId,bo,We.ID),p)){var Is=w.bucketInstanceId,pu=g.collisionCircleArrays[Is];pu===void 0&&(pu=g.collisionCircleArrays[Is]=new ms);for(var Ru=0;Ru<to.circles.length;Ru+=4)pu.circles.push(to.circles[Ru+0]),pu.circles.push(to.circles[Ru+1]),pu.circles.push(to.circles[Ru+2]),pu.circles.push(to.collisionDetected?1:0)}g.placements[An.crossTileID]=new Lu(oi||Ar,ri||Yr,vi||w.justReloaded),v[An.crossTileID]=!0}};if(fr)for(var _n=w.getSortedSymbolIndexes(this.transform.angle),jn=_n.length-1;jn>=0;--jn){var zn=_n[jn];zr(w.symbolInstances.get(zn),w.collisionArrays[zn])}else for(var Hn=h.symbolInstanceStart;Hn<h.symbolInstanceEnd;Hn++)zr(w.symbolInstances.get(Hn),w.collisionArrays[Hn]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){var Wi=this.collisionCircleArrays[w.bucketInstanceId];y.invert(Wi.invProjMatrix,P),Wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Cn.prototype.markUsedJustification=function(h,v,p,g){var S;S=g===y.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(v)];for(var w=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];w<R.length;w+=1){var P=R[w];P>=0&&(h.text.placedSymbolArray.get(P).crossTileID=S>=0&&P!==S?0:p.crossTileID)}},Cn.prototype.markUsedOrientation=function(h,v,p){for(var g=v===y.WritingMode.horizontal||v===y.WritingMode.horizontalOnly?v:0,S=v===y.WritingMode.vertical?v:0,w=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];w<R.length;w+=1)h.text.placedSymbolArray.get(R[w]).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)},Cn.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,p=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},w=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var P in this.placements){var X=this.placements[P],te=S[P];te?(this.opacities[P]=new Qo(te,g,X.text,X.icon),p=p||X.text!==te.text.placed||X.icon!==te.icon.placed):(this.opacities[P]=new Qo(null,g,X.text,X.icon,X.skipFade),p=p||X.text||X.icon)}for(var ye in S){var Ee=S[ye];if(!this.opacities[ye]){var Ce=new Qo(Ee,g,!1,!1);Ce.isHidden()||(this.opacities[ye]=Ce,p=p||Ee.text.placed||Ee.icon.placed)}}for(var Xe in w)this.variableOffsets[Xe]||!this.opacities[Xe]||this.opacities[Xe].isHidden()||(this.variableOffsets[Xe]=w[Xe]);for(var We in R)this.placedOrientations[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.placedOrientations[We]=R[We]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},Cn.prototype.updateLayerOpacities=function(h,v){for(var p={},g=0,S=v;g<S.length;g+=1){var w=S[g],R=w.getBucket(h);R&&w.latestFeatureIndex&&h.id===R.layerIds[0]&&this.updateBucketOpacities(R,p,w.collisionBoxArray)}},Cn.prototype.updateBucketOpacities=function(h,v,p){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,w=new Qo(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),P=S.get("icon-allow-overlap"),X=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",ye=S.get("text-pitch-alignment")==="map",Ee=S.get("icon-text-fit")!=="none",Ce=new Qo(null,0,R&&(P||!h.hasIconData()||S.get("icon-optional")),P&&(R||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(p);for(var Xe=function(ct,Et,zt){for(var or=0;or<Et/4;or++)ct.opacityVertexArray.emplaceBack(zt)},We=function(ct){var Et=h.symbolInstances.get(ct),zt=Et.numHorizontalGlyphVertices,or=Et.numVerticalGlyphVertices,Qt=Et.crossTileID,fr=g.opacities[Qt];v[Qt]?fr=w:fr||(g.opacities[Qt]=fr=Ce),v[Qt]=!0;var Ar=Et.numIconVertices>0,Yr=g.placedOrientations[Et.crossTileID],zr=Yr===y.WritingMode.vertical,_n=Yr===y.WritingMode.horizontal||Yr===y.WritingMode.horizontalOnly;if(zt>0||or>0){var jn=Io(fr.text);Xe(h.text,zt,zr?vo:jn),Xe(h.text,or,_n?vo:jn);var zn=fr.text.isHidden();[Et.rightJustifiedTextSymbolIndex,Et.centerJustifiedTextSymbolIndex,Et.leftJustifiedTextSymbolIndex].forEach(function(Kn){Kn>=0&&(h.text.placedSymbolArray.get(Kn).hidden=zn||zr?1:0)}),Et.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(Et.verticalPlacedTextSymbolIndex).hidden=zn||_n?1:0);var Hn=g.variableOffsets[Et.crossTileID];Hn&&g.markUsedJustification(h,Hn.anchor,Et,Yr);var Wi=g.placedOrientations[Et.crossTileID];Wi&&(g.markUsedJustification(h,"left",Et,Wi),g.markUsedOrientation(h,Wi,Et))}if(Ar){var An=Io(fr.icon),ui=!(Ee&&Et.verticalPlacedIconSymbolIndex&&zr);Et.placedIconSymbolIndex>=0&&(Xe(h.icon,Et.numIconVertices,ui?An:vo),h.icon.placedSymbolArray.get(Et.placedIconSymbolIndex).hidden=fr.icon.isHidden()),Et.verticalPlacedIconSymbolIndex>=0&&(Xe(h.icon,Et.numVerticalIconVertices,ui?vo:An),h.icon.placedSymbolArray.get(Et.verticalPlacedIconSymbolIndex).hidden=fr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var gi=h.collisionArrays[ct];if(gi){var oi=new y.Point(0,0);if(gi.textBox||gi.verticalTextBox){var ri=!0;if(X){var vi=g.variableOffsets[Qt];vi?(oi=sa(vi.anchor,vi.width,vi.height,vi.textOffset,vi.textBoxScale),te&&oi._rotate(ye?g.transform.angle:-g.transform.angle)):ri=!1}gi.textBox&&_e(h.textCollisionBox.collisionVertexArray,fr.text.placed,!ri||zr,oi.x,oi.y),gi.verticalTextBox&&_e(h.textCollisionBox.collisionVertexArray,fr.text.placed,!ri||_n,oi.x,oi.y)}var ni=!!(!_n&&gi.verticalIconBox);gi.iconBox&&_e(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,ni,Ee?oi.x:0,Ee?oi.y:0),gi.verticalIconBox&&_e(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,!ni,Ee?oi.x:0,Ee?oi.y:0)}}},ft=0;ft<h.symbolInstances.length;ft++)We(ft);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Ue=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Ue.invProjMatrix,h.placementViewportMatrix=Ue.viewportMatrix,h.collisionCircleArray=Ue.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Cn.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Cn.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Cn.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Cn.prototype.stillRecent=function(h,v){var p=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*p>h},Cn.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),bt=Math.pow(2,24),cr=Math.pow(2,17),tn=Math.pow(2,16),Bn=Math.pow(2,9),Xi=Math.pow(2,8),yo=Math.pow(2,1);function Io(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,p=Math.floor(127*h.opacity);return p*ke+v*bt+p*cr+v*tn+p*Bn+v*Xi+p*yo+v}var vo=0,Ds=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ds.prototype.continuePlacement=function(h,v,p,g,S){for(var w=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(w,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(R,P){return R.sortKey-P.sortKey}));this._currentPartIndex<w.length;)if(v.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1};var Ms=function(h,v,p,g,S,w,R){this.placement=new Cn(h,S,w,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1};Ms.prototype.isDone=function(){return this._done},Ms.prototype.continuePlacement=function(h,v,p){for(var g=this,S=y.browser.now(),w=function(){var X=y.browser.now()-S;return!g._forceFullPlacement&&X>2};this._currentPlacementIndex>=0;){var R=v[h[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=P)&&(!R.maxzoom||R.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Ds(R)),this._inProgressLayer.continuePlacement(p[R.source],this.placement,this._showCollisionBoxes,R,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ms.prototype.commit=function(h){return this.placement.commit(h),this.placement};var tp=512/y.EXTENT/2,Tf=function(h,v,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var g=0;g<v.length;g++){var S=v.get(g),w=S.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};Tf.prototype.getScaledCoordinates=function(h,v){var p=tp/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*y.EXTENT+h.anchorX)*p),y:Math.floor((v.canonical.y*y.EXTENT+h.anchorY)*p)}},Tf.prototype.findMatches=function(h,v,p){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var w=h.get(S);if(!w.crossTileID){var R=this.indexedSymbolInstances[w.key];if(R)for(var P=this.getScaledCoordinates(w,v),X=0,te=R;X<te.length;X+=1){var ye=te[X];if(Math.abs(ye.coord.x-P.x)<=g&&Math.abs(ye.coord.y-P.y)<=g&&!p[ye.crossTileID]){p[ye.crossTileID]=!0,w.crossTileID=ye.crossTileID;break}}}}};var Jo=function(){this.maxCrossTileID=0};Jo.prototype.generate=function(){return++this.maxCrossTileID};var xl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};xl.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var p in this.indexes){var g=this.indexes[p],S={};for(var w in g){var R=g[w];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),S[R.tileID.key]=R}this.indexes[p]=S}this.lng=h},xl.prototype.addBucket=function(h,v,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var w in this.indexes){var R=this.indexes[w];if(Number(w)>h.overscaledZ)for(var P in R){var X=R[P];X.tileID.isChildOf(h)&&X.findMatches(v.symbolInstances,h,S)}else{var te=R[h.scaledTo(Number(w)).key];te&&te.findMatches(v.symbolInstances,h,S)}}for(var ye=0;ye<v.symbolInstances.length;ye++){var Ee=v.symbolInstances.get(ye);Ee.crossTileID||(Ee.crossTileID=p.generate(),S[Ee.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Tf(h,v.symbolInstances,v.bucketInstanceId),!0},xl.prototype.removeBucketCrossTileIDs=function(h,v){for(var p in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[p];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},xl.prototype.removeStaleBuckets=function(h){var v=!1;for(var p in this.indexes){var g=this.indexes[p];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[S]),delete g[S],v=!0)}return v};var El=function(){this.layerIndexes={},this.crossTileIDs=new Jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};El.prototype.addLayer=function(h,v,p){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new xl);var S=!1,w={};g.handleWrapJump(p);for(var R=0,P=v;R<P.length;R+=1){var X=P[R],te=X.getBucket(h);te&&h.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(X.tileID,te,this.crossTileIDs)&&(S=!0),w[te.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(S=!0),S},El.prototype.pruneUnusedLayers=function(h){var v={};for(var p in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[p]||delete this.layerIndexes[p]};var Bu=function(h,v){return y.emitValidationErrors(h,v&&v.filter(function(p){return p.identifier!=="source.canvas"}))},Fu=y.pick($r,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qu=y.pick($r,["setCenter","setZoom","setBearing","setPitch"]),Yc=function(){var h={},v=y.styleSpec.$version;for(var p in y.styleSpec.$root){var g,S=y.styleSpec.$root[p];S.required&&(g=p==="version"?v:S.type==="array"?[]:{})!=null&&(h[p]=g)}return h}(),Ls=function(h){function v(p,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=p,this.dispatcher=new Zt(nr(),this),this.imageManager=new Nt,this.imageManager.setEventedParent(this),this.glyphManager=new lr(p._requestManager,g.localIdeographFontFamily),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new El,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var w=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(P,X){if(y.triggerPluginCompletionEvent(P),X&&X.every(function(ye){return ye}))for(var te in w.sourceCaches)w.sourceCaches[te].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var P=S.sourceCaches[R.sourceId];if(P){var X=P.getSource();if(X&&X.vectorLayerIds)for(var te in S._layers){var ye=S._layers[te];ye.source===X.id&&S._validateLayer(ye)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var w=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,g.accessToken);var R=this.map._requestManager.transformRequest(p,y.ResourceType.Style);this._request=y.getJSON(R,function(P,X){S._request=null,P?S.fire(new y.ErrorEvent(P)):X&&S._load(X,w)})},v.prototype.loadJSON=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(p,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Yc,!1)},v.prototype._load=function(p,g){if(!g||!Bu(this,y.validateStyle(p))){for(var S in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var w=Wr(this.stylesheet.layers);this._order=w.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var R=0,P=w;R<P.length;R+=1){var X=P[R];(X=y.createStyleLayer(X)).setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new At(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},v.prototype._loadSprite=function(p){var g=this;this._spriteRequest=function(S,w,R){var P,X,te,ye=y.browser.devicePixelRatio>1?"@2x":"",Ee=y.getJSON(w.transformRequest(w.normalizeSpriteURL(S,ye,".json"),y.ResourceType.SpriteJSON),function(We,ft){Ee=null,te||(te=We,P=ft,Xe())}),Ce=y.getImage(w.transformRequest(w.normalizeSpriteURL(S,ye,".png"),y.ResourceType.SpriteImage),function(We,ft){Ce=null,te||(te=We,X=ft,Xe())});function Xe(){if(te)R(te);else if(P&&X){var We=y.browser.getImageData(X),ft={};for(var Ue in P){var ct=P[Ue],Et=ct.width,zt=ct.height,or=ct.x,Qt=ct.y,fr=ct.sdf,Ar=ct.pixelRatio,Yr=ct.stretchX,zr=ct.stretchY,_n=ct.content,jn=new y.RGBAImage({width:Et,height:zt});y.RGBAImage.copy(We,jn,{x:or,y:Qt},{x:0,y:0},{width:Et,height:zt}),ft[Ue]={data:jn,pixelRatio:Ar,sdf:fr,stretchX:Yr,stretchY:zr,content:_n}}R(null,ft)}}return{cancel:function(){Ee&&(Ee.cancel(),Ee=null),Ce&&(Ce.cancel(),Ce=null)}}}(p,this.map._requestManager,function(S,w){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(w)for(var R in w)g.imageManager.addImage(R,w[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(p){var g=this.sourceCaches[p.source];if(g){var S=p.sourceLayer;if(S){var w=g.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+w.id+'" as specified by style layer "'+p.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(p){for(var g=[],S=0,w=p;S<w.length;S+=1){var R=this._layers[w[S]];R.type!=="custom"&&g.push(R.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(p){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var R in(S.length||w.length)&&this._updateWorkerLayers(S,w),this._updatedSources){var P=this._updatedSources[R];P==="reload"?this._reloadSource(R):P==="clear"&&this._clearSource(R)}for(var X in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[X].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var te={};for(var ye in this.sourceCaches){var Ee=this.sourceCaches[ye];te[ye]=Ee.used,Ee.used=!1}for(var Ce=0,Xe=this._order;Ce<Xe.length;Ce+=1){var We=this._layers[Xe[Ce]];We.recalculate(p,this._availableImages),!We.isHidden(p.zoom)&&We.source&&(this.sourceCaches[We.source].used=!0)}for(var ft in te){var Ue=this.sourceCaches[ft];te[ft]!==Ue.used&&Ue.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ft}))}this.light.recalculate(p),this.z=p.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},v.prototype._updateWorkerLayers=function(p,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(p){var g=this;if(this._checkLoaded(),Bu(this,y.validateStyle(p)))return!1;(p=y.clone$1(p)).layers=Wr(p.layers);var S=function(R,P){if(!R)return[{command:$r.setStyle,args:[P]}];var X=[];try{if(!y.deepEqual(R.version,P.version))return[{command:$r.setStyle,args:[P]}];y.deepEqual(R.center,P.center)||X.push({command:$r.setCenter,args:[P.center]}),y.deepEqual(R.zoom,P.zoom)||X.push({command:$r.setZoom,args:[P.zoom]}),y.deepEqual(R.bearing,P.bearing)||X.push({command:$r.setBearing,args:[P.bearing]}),y.deepEqual(R.pitch,P.pitch)||X.push({command:$r.setPitch,args:[P.pitch]}),y.deepEqual(R.sprite,P.sprite)||X.push({command:$r.setSprite,args:[P.sprite]}),y.deepEqual(R.glyphs,P.glyphs)||X.push({command:$r.setGlyphs,args:[P.glyphs]}),y.deepEqual(R.transition,P.transition)||X.push({command:$r.setTransition,args:[P.transition]}),y.deepEqual(R.light,P.light)||X.push({command:$r.setLight,args:[P.light]});var te={},ye=[];(function(Ce,Xe,We,ft){var Ue;for(Ue in Xe=Xe||{},Ce=Ce||{})Ce.hasOwnProperty(Ue)&&(Xe.hasOwnProperty(Ue)||pn(Ue,We,ft));for(Ue in Xe)Xe.hasOwnProperty(Ue)&&(Ce.hasOwnProperty(Ue)?y.deepEqual(Ce[Ue],Xe[Ue])||(Ce[Ue].type==="geojson"&&Xe[Ue].type==="geojson"&&Gi(Ce,Xe,Ue)?We.push({command:$r.setGeoJSONSourceData,args:[Ue,Xe[Ue].data]}):mi(Ue,Xe,We,ft)):ii(Ue,Xe,We))})(R.sources,P.sources,ye,te);var Ee=[];R.layers&&R.layers.forEach(function(Ce){te[Ce.source]?X.push({command:$r.removeLayer,args:[Ce.id]}):Ee.push(Ce)}),X=X.concat(ye),function(Ce,Xe,We){Xe=Xe||[];var ft,Ue,ct,Et,zt,or,Qt,fr=(Ce=Ce||[]).map(Ui),Ar=Xe.map(Ui),Yr=Ce.reduce(wi,{}),zr=Xe.reduce(wi,{}),_n=fr.slice(),jn=Object.create(null);for(ft=0,Ue=0;ft<fr.length;ft++)zr.hasOwnProperty(ct=fr[ft])?Ue++:(We.push({command:$r.removeLayer,args:[ct]}),_n.splice(_n.indexOf(ct,Ue),1));for(ft=0,Ue=0;ft<Ar.length;ft++)_n[_n.length-1-ft]!==(ct=Ar[Ar.length-1-ft])&&(Yr.hasOwnProperty(ct)?(We.push({command:$r.removeLayer,args:[ct]}),_n.splice(_n.lastIndexOf(ct,_n.length-Ue),1)):Ue++,We.push({command:$r.addLayer,args:[zr[ct],or=_n[_n.length-ft]]}),_n.splice(_n.length-ft,0,ct),jn[ct]=!0);for(ft=0;ft<Ar.length;ft++)if(Et=Yr[ct=Ar[ft]],zt=zr[ct],!jn[ct]&&!y.deepEqual(Et,zt))if(y.deepEqual(Et.source,zt.source)&&y.deepEqual(Et["source-layer"],zt["source-layer"])&&y.deepEqual(Et.type,zt.type)){for(Qt in di(Et.layout,zt.layout,We,ct,null,$r.setLayoutProperty),di(Et.paint,zt.paint,We,ct,null,$r.setPaintProperty),y.deepEqual(Et.filter,zt.filter)||We.push({command:$r.setFilter,args:[ct,zt.filter]}),y.deepEqual(Et.minzoom,zt.minzoom)&&y.deepEqual(Et.maxzoom,zt.maxzoom)||We.push({command:$r.setLayerZoomRange,args:[ct,zt.minzoom,zt.maxzoom]}),Et)Et.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?di(Et[Qt],zt[Qt],We,ct,Qt.slice(6),$r.setPaintProperty):y.deepEqual(Et[Qt],zt[Qt])||We.push({command:$r.setLayerProperty,args:[ct,Qt,zt[Qt]]}));for(Qt in zt)zt.hasOwnProperty(Qt)&&!Et.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?di(Et[Qt],zt[Qt],We,ct,Qt.slice(6),$r.setPaintProperty):y.deepEqual(Et[Qt],zt[Qt])||We.push({command:$r.setLayerProperty,args:[ct,Qt,zt[Qt]]}))}else We.push({command:$r.removeLayer,args:[ct]}),or=_n[_n.lastIndexOf(ct)+1],We.push({command:$r.addLayer,args:[zt,or]})}(Ee,P.layers,X)}catch(Ce){console.warn("Unable to compute style diff:",Ce),X=[{command:$r.setStyle,args:[P]}]}return X}(this.serialize(),p).filter(function(R){return!(R.command in Qu)});if(S.length===0)return!1;var w=S.filter(function(R){return!(R.command in Fu)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=p,!0},v.prototype.addImage=function(p,g){if(this.getImage(p))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,g),this._afterImageUpdated(p)},v.prototype.updateImage=function(p,g){this.imageManager.updateImage(p,g)},v.prototype.getImage=function(p){return this.imageManager.getImage(p)},v.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},v.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(p,g,S){var w=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+p,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[p]=new J(p,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:R.serialize(),sourceId:p}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===p)return this.fire(new y.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(p,g){this._checkLoaded(),this.sourceCaches[p].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},v.prototype.addLayer=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=p.id;if(this.getLayer(w))this.fire(new y.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var R;if(p.type==="custom"){if(Bu(this,y.validateCustomStyleLayer(p)))return;R=y.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(w,p.source),p=y.clone$1(p),p=y.extend(p,{source:w})),this._validate(y.validateStyle.layer,"layers."+w,p,{arrayIndex:-1},S))return;R=y.createStyleLayer(p),this._validateLayer(R),R.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[R.id]=R.serialize()}var P=g?this._order.indexOf(g):this._order.length;if(g&&P===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(P,0,w),this._layerOrderChanged=!0,this._layers[w]=R,this._removedLayers[w]&&R.source&&R.type!=="custom"){var X=this._removedLayers[w];delete this._removedLayers[w],X.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(p,g){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==g){var S=this._order.indexOf(p);this._order.splice(S,1);var w=g?this._order.indexOf(g):this._order.length;g&&w===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(w,0,p),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(p){this._checkLoaded();var g=this._layers[p];if(g){g.setEventedParent(null);var S=this._order.indexOf(p);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=g,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(p){return this._layers[p]},v.prototype.hasLayer=function(p){return p in this._layers},v.prototype.setLayerZoomRange=function(p,g,S){this._checkLoaded();var w=this.getLayer(p);w?w.minzoom===g&&w.maxzoom===S||(g!=null&&(w.minzoom=g),S!=null&&(w.maxzoom=S),this._updateLayer(w)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=this.getLayer(p);if(w){if(!y.deepEqual(w.filter,g))return g==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(y.validateStyle.filter,"layers."+w.id+".filter",g,null,S)||(w.filter=y.clone$1(g),this._updateLayer(w)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(p){return y.clone$1(this.getLayer(p).filter)},v.prototype.setLayoutProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,w),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(p,g){var S=this.getLayer(p);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,w)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(p,g){return this.getLayer(p).getPaintProperty(g)},v.prototype.setFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=p.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var P=R.getSource().type;P==="geojson"&&w?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||w?(p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(w,p.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=this.sourceCaches[S];if(w!==void 0){var R=w.getSource().type,P=R==="vector"?p.sourceLayer:void 0;R!=="vector"||P?g&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(P,p.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(p){this._checkLoaded();var g=p.source,S=p.sourceLayer,w=this.sourceCaches[g];if(w!==void 0){if(w.getSource().type!=="vector"||S)return p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(S,p.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},v.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(p){for(var g=this,S=function(Yr){return g._layers[Yr].type==="fill-extrusion"},w={},R=[],P=this._order.length-1;P>=0;P--){var X=this._order[P];if(S(X)){w[X]=P;for(var te=0,ye=p;te<ye.length;te+=1){var Ee=ye[te][X];if(Ee)for(var Ce=0,Xe=Ee;Ce<Xe.length;Ce+=1)R.push(Xe[Ce])}}}R.sort(function(Yr,zr){return zr.intersectionZ-Yr.intersectionZ});for(var We=[],ft=this._order.length-1;ft>=0;ft--){var Ue=this._order[ft];if(S(Ue))for(var ct=R.length-1;ct>=0;ct--){var Et=R[ct].feature;if(w[Et.layer.id]<ft)break;We.push(Et),R.pop()}else for(var zt=0,or=p;zt<or.length;zt+=1){var Qt=or[zt][Ue];if(Qt)for(var fr=0,Ar=Qt;fr<Ar.length;fr+=1)We.push(Ar[fr].feature)}}return We},v.prototype.queryRenderedFeatures=function(p,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var w={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,P=g.layers;R<P.length;R+=1){var X=P[R],te=this._layers[X];if(!te)return this.fire(new y.ErrorEvent(new Error("The layer '"+X+"' does not exist in the map's style and cannot be queried for features."))),[];w[te.source]=!0}}var ye=[];for(var Ee in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!w[Ee]||ye.push(Ot(this.sourceCaches[Ee],this._layers,this._serializedLayers,p,g,S));return this.placement&&ye.push(function(Ce,Xe,We,ft,Ue,ct,Et){for(var zt={},or=ct.queryRenderedSymbols(ft),Qt=[],fr=0,Ar=Object.keys(or).map(Number);fr<Ar.length;fr+=1)Qt.push(Et[Ar[fr]]);Qt.sort(Vr);for(var Yr=function(){var Hn=_n[zr],Wi=Hn.featureIndex.lookupSymbolFeatures(or[Hn.bucketInstanceId],Xe,Hn.bucketIndex,Hn.sourceLayerIndex,Ue.filter,Ue.layers,Ue.availableImages,Ce);for(var An in Wi){var ui=zt[An]=zt[An]||[],gi=Wi[An];gi.sort(function(vi,ni){var Kn=Hn.featureSortOrder;if(Kn){var ko=Kn.indexOf(vi.featureIndex);return Kn.indexOf(ni.featureIndex)-ko}return ni.featureIndex-vi.featureIndex});for(var oi=0,ri=gi;oi<ri.length;oi+=1)ui.push(ri[oi])}},zr=0,_n=Qt;zr<_n.length;zr+=1)Yr();var jn=function(Hn){zt[Hn].forEach(function(Wi){var An=Wi.feature,ui=We[Ce[Hn].source].getFeatureState(An.layer["source-layer"],An.id);An.source=An.layer.source,An.layer["source-layer"]&&(An.sourceLayer=An.layer["source-layer"]),An.state=ui})};for(var zn in zt)jn(zn);return zt}(this._layers,this._serializedLayers,this.sourceCaches,p,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ye)},v.prototype.querySourceFeatures=function(p,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[p];return S?function(w,R){for(var P=w.getRenderableIds().map(function(Xe){return w.getTileByID(Xe)}),X=[],te={},ye=0;ye<P.length;ye++){var Ee=P[ye],Ce=Ee.tileID.canonical.key;te[Ce]||(te[Ce]=!0,Ee.querySourceFeatures(X,R))}return X}(S,g):[]},v.prototype.addSourceType=function(p,g,S){return v.getSourceType(p)?S(new Error('A source type called "'+p+'" already exists.')):(v.setSourceType(p,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(p,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),w=!1;for(var R in p)if(!y.deepEqual(p[R],S[R])){w=!0;break}if(w){var P={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,g),this.light.updateTransitions(P)}},v.prototype._validate=function(p,g,S,w,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Bu(this,p.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},w)))},v.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},v.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},v.prototype._updateSources=function(p){for(var g in this.sourceCaches)this.sourceCaches[g].update(p)},v.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},v.prototype._updatePlacement=function(p,g,S,w,R){R===void 0&&(R=!1);for(var P=!1,X=!1,te={},ye=0,Ee=this._order;ye<Ee.length;ye+=1){var Ce=this._layers[Ee[ye]];if(Ce.type==="symbol"){if(!te[Ce.source]){var Xe=this.sourceCaches[Ce.source];te[Ce.source]=Xe.getRenderableIds(!0).map(function(Et){return Xe.getTileByID(Et)}).sort(function(Et,zt){return zt.tileID.overscaledZ-Et.tileID.overscaledZ||(Et.tileID.isLessThan(zt.tileID)?-1:1)})}var We=this.crossTileSymbolIndex.addLayer(Ce,te[Ce.source],p.center.lng);P=P||We}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),p.zoom))&&(this.pauseablePlacement=new Ms(p,this._order,R,g,S,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),X=!0),P&&this.pauseablePlacement.placement.setStale()),X||P)for(var ft=0,Ue=this._order;ft<Ue.length;ft+=1){var ct=this._layers[Ue[ft]];ct.type==="symbol"&&this.placement.updateLayerOpacities(ct,te[ct.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},v.prototype.getImages=function(p,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var w=this.sourceCaches[g.source];w&&w.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(p,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(p,g,S){return y.makeRequest(g,S)},v}(y.Evented);Ls.getSourceType=function(h){return Tt[h]},Ls.setSourceType=function(h,v){Tt[h]=v},Ls.registerForPluginStateChange=y.registerForPluginStateChange;var Ja=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Sl=Oi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ju=Oi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wf=Oi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),rp=Oi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Cf=Oi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gh=Oi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),yh=Oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),_h=Oi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),np=Oi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ip=Oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Wp=Oi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),qc=Oi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Nu=Oi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ap=Oi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),es=Oi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Vl=Oi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Al=Oi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ys=Oi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Tl=Oi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),hi=Oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),el=Oi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Bs=Oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Uu=Oi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),tl=Oi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),op=Oi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ta=Oi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Oi(h,v){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=w?w.concat(S):S,P={};return{fragmentSource:h=h.replace(p,function(X,te,ye,Ee,Ce){return P[Ce]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
varying `+ye+" "+Ee+" "+Ce+`;
#else
uniform `+ye+" "+Ee+" u_"+Ce+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ce+`
    `+ye+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`}),vertexSource:v=v.replace(p,function(X,te,ye,Ee,Ce){var Xe=Ee==="float"?"vec2":"vec4",We=Ce.match(/color/)?"color":Xe;return P[Ce]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
uniform lowp float u_`+Ce+`_t;
attribute `+ye+" "+Xe+" a_"+Ce+`;
varying `+ye+" "+Ee+" "+Ce+`;
#else
uniform `+ye+" "+Ee+" u_"+Ce+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+Ce+" = a_"+Ce+`;
#else
    `+ye+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+Ce+" = unpack_mix_"+We+"(a_"+Ce+", u_"+Ce+`_t);
#else
    `+ye+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
uniform lowp float u_`+Ce+`_t;
attribute `+ye+" "+Xe+" a_"+Ce+`;
#else
uniform `+ye+" "+Ee+" u_"+Ce+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+ye+" "+Ee+" "+Ce+" = a_"+Ce+`;
#else
    `+ye+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+ye+" "+Ee+" "+Ce+" = unpack_mix_"+We+"(a_"+Ce+", u_"+Ce+`_t);
#else
    `+ye+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var uu=Object.freeze({__proto__:null,prelude:Sl,background:Ju,backgroundPattern:wf,circle:rp,clippingMask:Cf,heatmap:gh,heatmapTexture:yh,collisionBox:_h,collisionCircle:np,debug:ip,fill:Wp,fillOutline:qc,fillOutlinePattern:Nu,fillPattern:ap,fillExtrusion:es,fillExtrusionPattern:Vl,hillshadePrepare:Al,hillshade:Ys,line:Tl,lineGradient:hi,linePattern:el,lineSDF:Bs,raster:Uu,symbolIcon:tl,symbolSDF:op,symbolTextAndIcon:ta}),yu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Rf(h){for(var v=[],p=0;p<h.length;p++)if(h[p]!==null){var g=h[p].split(" ");v.push(g.pop())}return v}yu.prototype.bind=function(h,v,p,g,S,w,R,P){this.context=h;for(var X=this.boundPaintVertexBuffers.length!==g.length,te=0;!X&&te<g.length;te++)this.boundPaintVertexBuffers[te]!==g[te]&&(X=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===p&&!X&&this.boundIndexBuffer===S&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===P?(h.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),P&&P.bind()):this.freshBind(v,p,g,S,w,R,P)},yu.prototype.freshBind=function(h,v,p,g,S,w,R){var P,X=h.numAttributes,te=this.context,ye=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=R;else{P=te.currentNumAttributes||0;for(var Ee=X;Ee<P;Ee++)ye.disableVertexAttribArray(Ee)}v.enableAttributes(ye,h);for(var Ce=0,Xe=p;Ce<Xe.length;Ce+=1)Xe[Ce].enableAttributes(ye,h);w&&w.enableAttributes(ye,h),R&&R.enableAttributes(ye,h),v.bind(),v.setVertexAttribPointers(ye,h,S);for(var We=0,ft=p;We<ft.length;We+=1){var Ue=ft[We];Ue.bind(),Ue.setVertexAttribPointers(ye,h,S)}w&&(w.bind(),w.setVertexAttribPointers(ye,h,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(ye,h,S)),te.currentNumAttributes=X},yu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Wa=function(h,v,p,g,S,w){var R=h.gl;this.program=R.createProgram();for(var P=Rf(p.staticAttributes),X=g?g.getBinderAttributes():[],te=P.concat(X),ye=p.staticUniforms?Rf(p.staticUniforms):[],Ee=g?g.getBinderUniforms():[],Ce=[],Xe=0,We=ye.concat(Ee);Xe<We.length;Xe+=1){var ft=We[Xe];Ce.indexOf(ft)<0&&Ce.push(ft)}var Ue=g?g.defines():[];w&&Ue.push("#define OVERDRAW_INSPECTOR;");var ct=Ue.concat(Sl.fragmentSource,p.fragmentSource).join(`
`),Et=Ue.concat(Sl.vertexSource,p.vertexSource).join(`
`),zt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(zt,ct),R.compileShader(zt),R.attachShader(this.program,zt);var or=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(or,Et),R.compileShader(or),R.attachShader(this.program,or),this.attributes={};var Qt={};this.numAttributes=te.length;for(var fr=0;fr<this.numAttributes;fr++)te[fr]&&(R.bindAttribLocation(this.program,fr,te[fr]),this.attributes[te[fr]]=fr);R.linkProgram(this.program),R.deleteShader(or),R.deleteShader(zt);for(var Ar=0;Ar<Ce.length;Ar++){var Yr=Ce[Ar];if(Yr&&!Qt[Yr]){var zr=R.getUniformLocation(this.program,Yr);zr&&(Qt[Yr]=zr)}}this.fixedUniforms=S(h,Qt),this.binderUniforms=g?g.getUniforms(h,Qt):[]}}};function bh(h,v,p){var g=1/ga(p,1,v.transform.tileZoom),S=Math.pow(2,p.tileID.overscaledZ),w=p.tileSize*Math.pow(2,v.transform.tileZoom)/S,R=w*(p.tileID.canonical.x+p.tileID.wrap*S),P=w*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[R>>16,P>>16],u_pixel_coord_lower:[65535&R,65535&P]}}Wa.prototype.draw=function(h,v,p,g,S,w,R,P,X,te,ye,Ee,Ce,Xe,We,ft){var Ue,ct=h.gl;if(!this.failedToCreate){for(var Et in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Et].set(R[Et]);Xe&&Xe.setUniforms(h,this.binderUniforms,Ee,{zoom:Ce});for(var zt=(Ue={},Ue[ct.LINES]=2,Ue[ct.TRIANGLES]=3,Ue[ct.LINE_STRIP]=1,Ue)[v],or=0,Qt=ye.get();or<Qt.length;or+=1){var fr=Qt[or],Ar=fr.vaos||(fr.vaos={});(Ar[P]||(Ar[P]=new yu)).bind(h,this,X,Xe?Xe.getPaintVertexBuffers():[],te,fr.vertexOffset,We,ft),ct.drawElements(v,fr.primitiveLength*zt,ct.UNSIGNED_SHORT,fr.primitiveOffset*zt*2)}}};var Mf=function(h,v,p,g){var S=v.style.light,w=S.properties.get("position"),R=[w.x,w.y,w.z],P=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(P,-v.transform.angle),y.transformMat3(R,R,P);var X=S.properties.get("color");return{u_matrix:h,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+p,u_opacity:g}},Fs=function(h,v,p,g,S,w,R){return y.extend(Mf(h,v,p,g),bh(w,v,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},rl=function(h){return{u_matrix:h}},_u=function(h,v,p,g){return y.extend(rl(h),bh(p,v,g))},jl=function(h,v){return{u_matrix:h,u_world:v}},xh=function(h,v,p,g,S){return y.extend(_u(h,v,p,g),{u_world:S})},yc=function(h,v,p,g){var S,w,R=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var P=ga(p,1,R.zoom);S=!0,w=[P,P]}else S=!1,w=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,p,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:w}},ma=function(h,v,p){var g=ga(p,1,v.zoom),S=Math.pow(2,v.zoom-p.tileID.overscaledZ),w=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:w}},_c=function(h,v,p){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:p.cameraToCenterDistance,u_viewport_size:[p.width,p.height]}},nl=function(h,v,p){return p===void 0&&(p=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:p}},wl=function(h){return{u_matrix:h}},Eh=function(h,v,p,g){return{u_matrix:h,u_extrude_scale:ga(v,1,p),u_intensity:g}},Kc=function(h,v,p){var g=h.transform;return{u_matrix:Qc(h,v,p),u_ratio:1/ga(v,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ba=function(h,v,p,g){return y.extend(Kc(h,v,p),{u_image:0,u_image_height:g})},Cl=function(h,v,p,g){var S=h.transform,w=il(v,S);return{u_matrix:Qc(h,v,p),u_texsize:v.imageAtlasTexture.size,u_ratio:1/ga(v,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},sp=function(h,v,p,g,S){var w=h.lineAtlas,R=il(v,h.transform),P=p.layout.get("line-cap")==="round",X=w.getDash(g.from,P),te=w.getDash(g.to,P),ye=X.width*S.fromScale,Ee=te.width*S.toScale;return y.extend(Kc(h,v,p),{u_patternscale_a:[R/ye,-X.height/2],u_patternscale_b:[R/Ee,-te.height/2],u_sdfgamma:w.width/(256*Math.min(ye,Ee)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:X.y,u_tex_y_b:te.y,u_mix:S.t})};function il(h,v){return 1/ga(h,1,v.tileZoom)}function Qc(h,v,p){return h.translatePosMatrix(v.tileID.posMatrix,v,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var Jc=function(h,v,p,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:p,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(w=S.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:If(S.paint.get("raster-hue-rotate"))};var w,R};function If(h){h*=Math.PI/180;var v=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*v-p+1)/3,(Math.sqrt(3)*v-p+1)/3]}var al,Hl=function(h,v,p,g,S,w,R,P,X,te){var ye=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:ye.width/ye.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:R,u_coord_matrix:P,u_is_text:+X,u_pitch_with_map:+g,u_texsize:te,u_texture:0}},zu=function(h,v,p,g,S,w,R,P,X,te,ye){var Ee=S.transform;return y.extend(Hl(h,v,p,g,S,w,R,P,X,te),{u_gamma_scale:g?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+ye})},ef=function(h,v,p,g,S,w,R,P,X,te){return y.extend(zu(h,v,p,g,S,w,R,P,!0,X,!0),{u_texsize_icon:te,u_texture_icon:1})},bc=function(h,v,p){return{u_matrix:h,u_opacity:v,u_color:p}},Wl=function(h,v,p,g,S,w){return y.extend(function(R,P,X,te){var ye=X.imageManager.getPattern(R.from.toString()),Ee=X.imageManager.getPattern(R.to.toString()),Ce=X.imageManager.getPixelSize(),Xe=Ce.width,We=Ce.height,ft=Math.pow(2,te.tileID.overscaledZ),Ue=te.tileSize*Math.pow(2,X.transform.tileZoom)/ft,ct=Ue*(te.tileID.canonical.x+te.tileID.wrap*ft),Et=Ue*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:Ee.tl,u_pattern_br_b:Ee.br,u_texsize:[Xe,We],u_mix:P.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:Ee.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/ga(te,1,X.transform.tileZoom),u_pixel_coord_upper:[ct>>16,Et>>16],u_pixel_coord_lower:[65535&ct,65535&Et]}}(g,w,p,S),{u_matrix:h,u_opacity:v})},Sh={fillExtrusion:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new y.Uniform1f(h,v.u_height_factor),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new y.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new y.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new y.UniformColor(h,v.u_color),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_overlay:new y.Uniform1i(h,v.u_overlay),u_overlay_scale:new y.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new y.Uniform1f(h,v.u_extrude_scale),u_intensity:new y.Uniform1f(h,v.u_intensity),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_color_ramp:new y.Uniform1i(h,v.u_color_ramp),u_opacity:new y.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_latrange:new y.Uniform2f(h,v.u_latrange),u_light:new y.Uniform2f(h,v.u_light),u_shadow:new y.UniformColor(h,v.u_shadow),u_highlight:new y.UniformColor(h,v.u_highlight),u_accent:new y.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_dimension:new y.Uniform2f(h,v.u_dimension),u_zoom:new y.Uniform1f(h,v.u_zoom),u_unpack:new y.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_image:new y.Uniform1i(h,v.u_image),u_image_height:new y.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_texsize:new y.Uniform2f(h,v.u_texsize),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_image:new y.Uniform1i(h,v.u_image),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new y.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new y.Uniform1f(h,v.u_sdfgamma),u_image:new y.Uniform1i(h,v.u_image),u_tex_y_a:new y.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new y.Uniform1f(h,v.u_tex_y_b),u_mix:new y.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new y.Uniform2f(h,v.u_tl_parent),u_scale_parent:new y.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new y.Uniform1f(h,v.u_buffer_scale),u_fade_t:new y.Uniform1f(h,v.u_fade_t),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image0:new y.Uniform1i(h,v.u_image0),u_image1:new y.Uniform1i(h,v.u_image1),u_brightness_low:new y.Uniform1f(h,v.u_brightness_low),u_brightness_high:new y.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new y.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new y.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new y.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texsize_icon:new y.Uniform2f(h,v.u_texsize_icon),u_texture:new y.Uniform1i(h,v.u_texture),u_texture_icon:new y.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_color:new y.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image:new y.Uniform1i(h,v.u_image),u_pattern_tl_a:new y.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(h,v.u_pattern_br_b),u_texsize:new y.Uniform2f(h,v.u_texsize),u_mix:new y.Uniform1f(h,v.u_mix),u_pattern_size_a:new y.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new y.Uniform1f(h,v.u_scale_a),u_scale_b:new y.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(h,v.u_tile_units_to_pixels)}}};function xc(h,v,p,g,S,w,R){for(var P=h.context,X=P.gl,te=h.useProgram("collisionBox"),ye=[],Ee=0,Ce=0,Xe=0;Xe<g.length;Xe++){var We=g[Xe],ft=v.getTile(We),Ue=ft.getBucket(p);if(Ue){var ct=We.posMatrix;S[0]===0&&S[1]===0||(ct=h.translatePosMatrix(We.posMatrix,ft,S,w));var Et=R?Ue.textCollisionBox:Ue.iconCollisionBox,zt=Ue.collisionCircleArray;if(zt.length>0){var or=y.create(),Qt=ct;y.mul(or,Ue.placementInvProjMatrix,h.transform.glCoordMatrix),y.mul(or,or,Ue.placementViewportMatrix),ye.push({circleArray:zt,circleOffset:Ce,transform:Qt,invTransform:or}),Ce=Ee+=zt.length/4}Et&&te.draw(P,X.LINES,ae.disabled,Ae.disabled,h.colorModeForRenderPass(),at.disabled,ma(ct,h.transform,ft),p.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,h.transform.zoom,null,null,Et.collisionVertexBuffer)}}if(R&&ye.length){var fr=h.useProgram("collisionCircle"),Ar=new y.StructArrayLayout2f1f2i16;Ar.resize(4*Ee),Ar._trim();for(var Yr=0,zr=0,_n=ye;zr<_n.length;zr+=1)for(var jn=_n[zr],zn=0;zn<jn.circleArray.length/4;zn++){var Hn=4*zn,Wi=jn.circleArray[Hn+0],An=jn.circleArray[Hn+1],ui=jn.circleArray[Hn+2],gi=jn.circleArray[Hn+3];Ar.emplace(Yr++,Wi,An,ui,gi,0),Ar.emplace(Yr++,Wi,An,ui,gi,1),Ar.emplace(Yr++,Wi,An,ui,gi,2),Ar.emplace(Yr++,Wi,An,ui,gi,3)}(!al||al.length<2*Ee)&&(al=function(to){var Do=2*to,bo=new y.StructArrayLayout3ui6;bo.resize(Do),bo._trim();for(var $a=0;$a<Do;$a++){var ro=6*$a;bo.uint16[ro+0]=4*$a+0,bo.uint16[ro+1]=4*$a+1,bo.uint16[ro+2]=4*$a+2,bo.uint16[ro+3]=4*$a+2,bo.uint16[ro+4]=4*$a+3,bo.uint16[ro+5]=4*$a+0}return bo}(Ee));for(var oi=P.createIndexBuffer(al,!0),ri=P.createVertexBuffer(Ar,y.collisionCircleLayout.members,!0),vi=0,ni=ye;vi<ni.length;vi+=1){var Kn=ni[vi],ko=_c(Kn.transform,Kn.invTransform,h.transform);fr.draw(P,X.TRIANGLES,ae.disabled,Ae.disabled,h.colorModeForRenderPass(),at.disabled,ko,p.id,ri,oi,y.SegmentVector.simpleSegment(0,2*Kn.circleOffset,Kn.circleArray.length,Kn.circleArray.length/2),null,h.transform.zoom,null,null,null)}ri.destroy(),oi.destroy()}}var Ns=y.identity(new Float32Array(16));function Ah(h,v,p,g,S,w){var R=y.getAnchorAlignment(h),P=-(R.horizontalAlign-.5)*v,X=-(R.verticalAlign-.5)*p,te=y.evaluateVariableOffset(h,g);return new y.Point((P/S+te[0])*w,(X/S+te[1])*w)}function tf(h,v,p,g,S,w,R,P,X,te,ye){var Ee=h.text.placedSymbolArray,Ce=h.text.dynamicLayoutVertexArray,Xe=h.icon.dynamicLayoutVertexArray,We={};Ce.clear();for(var ft=0;ft<Ee.length;ft++){var Ue=Ee.get(ft),ct=Ue.hidden||!Ue.crossTileID||h.allowVerticalPlacement&&!Ue.placedOrientation?null:g[Ue.crossTileID];if(ct){var Et=new y.Point(Ue.anchorX,Ue.anchorY),zt=yi(Et,p?P:R),or=Ri(w.cameraToCenterDistance,zt.signedDistanceFromCamera),Qt=S.evaluateSizeForFeature(h.textSizeData,te,Ue)*or/y.ONE_EM;p&&(Qt*=h.tilePixelRatio/X);for(var fr=Ah(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textBoxScale,Qt),Ar=p?yi(Et.add(fr),R).point:zt.point.add(v?fr.rotate(-w.angle):fr),Yr=h.allowVerticalPlacement&&Ue.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,zr=0;zr<Ue.numGlyphs;zr++)y.addDynamicAttributes(Ce,Ar,Yr);ye&&Ue.associatedIconIndex>=0&&(We[Ue.associatedIconIndex]={shiftedAnchor:Ar,angle:Yr})}else La(Ue.numGlyphs,Ce)}if(ye){Xe.clear();for(var _n=h.icon.placedSymbolArray,jn=0;jn<_n.length;jn++){var zn=_n.get(jn);if(zn.hidden)La(zn.numGlyphs,Xe);else{var Hn=We[jn];if(Hn)for(var Wi=0;Wi<zn.numGlyphs;Wi++)y.addDynamicAttributes(Xe,Hn.shiftedAnchor,Hn.angle);else La(zn.numGlyphs,Xe)}}h.icon.dynamicLayoutVertexBuffer.updateData(Xe)}h.text.dynamicLayoutVertexBuffer.updateData(Ce)}function Ec(h,v,p){return p.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Rl(h,v,p,g,S,w,R,P,X,te,ye,Ee){for(var Ce=h.context,Xe=Ce.gl,We=h.transform,ft=P==="map",Ue=X==="map",ct=ft&&p.layout.get("symbol-placement")!=="point",Et=ft&&!Ue&&!ct,zt=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,or=!1,Qt=h.depthModeForSublayer(0,ae.ReadOnly),fr=p.layout.get("text-variable-anchor"),Ar=[],Yr=0,zr=g;Yr<zr.length;Yr+=1){var _n=zr[Yr],jn=v.getTile(_n),zn=jn.getBucket(p);if(zn){var Hn=S?zn.text:zn.icon;if(Hn&&Hn.segments.get().length){var Wi=Hn.programConfigurations.get(p.id),An=S||zn.sdfIcons,ui=S?zn.textSizeData:zn.iconSizeData,gi=Ue||We.pitch!==0,oi=h.useProgram(Ec(An,S,zn),Wi),ri=y.evaluateSizeForZoom(ui,We.zoom),vi=void 0,ni=[0,0],Kn=void 0,ko=void 0,to=null,Do=void 0;if(S)Kn=jn.glyphAtlasTexture,ko=Xe.LINEAR,vi=jn.glyphAtlasTexture.size,zn.iconsInText&&(ni=jn.imageAtlasTexture.size,to=jn.imageAtlasTexture,Do=gi||h.options.rotating||h.options.zooming||ui.kind==="composite"||ui.kind==="camera"?Xe.LINEAR:Xe.NEAREST);else{var bo=p.layout.get("icon-size").constantOr(0)!==1||zn.iconsNeedLinear;Kn=jn.imageAtlasTexture,ko=An||h.options.rotating||h.options.zooming||bo||gi?Xe.LINEAR:Xe.NEAREST,vi=jn.imageAtlasTexture.size}var $a=ga(jn,1,h.transform.zoom),ro=ka(_n.posMatrix,Ue,ft,h.transform,$a),xs=Ci(_n.posMatrix,Ue,ft,h.transform,$a),Es=fr&&zn.hasTextData(),cl=p.layout.get("icon-text-fit")!=="none"&&Es&&zn.hasIconData();ct&&gu(zn,_n.posMatrix,h,S,ro,xs,Ue,te);var Ss=h.translatePosMatrix(_n.posMatrix,jn,w,R),fu=ct||S&&fr||cl?Ns:ro,Zs=h.translatePosMatrix(xs,jn,w,R,!0),Rc=An&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Wu={program:oi,buffers:Hn,uniformValues:An?zn.iconsInText?ef(ui.kind,ri,Et,Ue,h,Ss,fu,Zs,vi,ni):zu(ui.kind,ri,Et,Ue,h,Ss,fu,Zs,S,vi,!0):Hl(ui.kind,ri,Et,Ue,h,Ss,fu,Zs,S,vi),atlasTexture:Kn,atlasTextureIcon:to,atlasInterpolation:ko,atlasInterpolationIcon:Do,isSDF:An,hasHalo:Rc};if(zt&&zn.canOverlap){or=!0;for(var Cu=0,Jl=Hn.segments.get();Cu<Jl.length;Cu+=1){var fl=Jl[Cu];Ar.push({segments:new y.SegmentVector([fl]),sortKey:fl.sortKey,state:Wu})}}else Ar.push({segments:Hn.segments,sortKey:0,state:Wu})}}}or&&Ar.sort(function(pu,Ru){return pu.sortKey-Ru.sortKey});for(var hu=0,hl=Ar;hu<hl.length;hu+=1){var Lo=hl[hu],uo=Lo.state;if(Ce.activeTexture.set(Xe.TEXTURE0),uo.atlasTexture.bind(uo.atlasInterpolation,Xe.CLAMP_TO_EDGE),uo.atlasTextureIcon&&(Ce.activeTexture.set(Xe.TEXTURE1),uo.atlasTextureIcon&&uo.atlasTextureIcon.bind(uo.atlasInterpolationIcon,Xe.CLAMP_TO_EDGE)),uo.isSDF){var Is=uo.uniformValues;uo.hasHalo&&(Is.u_is_halo=1,Zu(uo.buffers,Lo.segments,p,h,uo.program,Qt,ye,Ee,Is)),Is.u_is_halo=0}Zu(uo.buffers,Lo.segments,p,h,uo.program,Qt,ye,Ee,uo.uniformValues)}}function Zu(h,v,p,g,S,w,R,P,X){var te=g.context;S.draw(te,te.gl.TRIANGLES,w,R,P,at.disabled,X,p.id,h.layoutVertexBuffer,h.indexBuffer,v,p.paint,g.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Gl(h,v,p,g,S,w,R){var P,X,te,ye,Ee,Ce=h.context.gl,Xe=p.paint.get("fill-pattern"),We=Xe&&Xe.constantOr(1),ft=p.getCrossfadeParameters();R?(X=We&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=Ce.LINES):(X=We?"fillPattern":"fill",P=Ce.TRIANGLES);for(var Ue=0,ct=g;Ue<ct.length;Ue+=1){var Et=ct[Ue],zt=v.getTile(Et);if(!We||zt.patternsLoaded()){var or=zt.getBucket(p);if(or){var Qt=or.programConfigurations.get(p.id),fr=h.useProgram(X,Qt);We&&(h.context.activeTexture.set(Ce.TEXTURE0),zt.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Qt.updatePaintBuffers(ft));var Ar=Xe.constantOr(null);if(Ar&&zt.imageAtlas){var Yr=zt.imageAtlas,zr=Yr.patternPositions[Ar.to.toString()],_n=Yr.patternPositions[Ar.from.toString()];zr&&_n&&Qt.setConstantPatternPositions(zr,_n)}var jn=h.translatePosMatrix(Et.posMatrix,zt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(R){ye=or.indexBuffer2,Ee=or.segments2;var zn=[Ce.drawingBufferWidth,Ce.drawingBufferHeight];te=X==="fillOutlinePattern"&&We?xh(jn,h,ft,zt,zn):jl(jn,zn)}else ye=or.indexBuffer,Ee=or.segments,te=We?_u(jn,h,ft,zt):rl(jn);fr.draw(h.context,P,S,h.stencilModeForClipping(Et),w,at.disabled,te,p.id,or.layoutVertexBuffer,ye,Ee,p.paint,h.transform.zoom,Qt)}}}}function Pf(h,v,p,g,S,w,R){for(var P=h.context,X=P.gl,te=p.paint.get("fill-extrusion-pattern"),ye=te.constantOr(1),Ee=p.getCrossfadeParameters(),Ce=p.paint.get("fill-extrusion-opacity"),Xe=0,We=g;Xe<We.length;Xe+=1){var ft=We[Xe],Ue=v.getTile(ft),ct=Ue.getBucket(p);if(ct){var Et=ct.programConfigurations.get(p.id),zt=h.useProgram(ye?"fillExtrusionPattern":"fillExtrusion",Et);ye&&(h.context.activeTexture.set(X.TEXTURE0),Ue.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Et.updatePaintBuffers(Ee));var or=te.constantOr(null);if(or&&Ue.imageAtlas){var Qt=Ue.imageAtlas,fr=Qt.patternPositions[or.to.toString()],Ar=Qt.patternPositions[or.from.toString()];fr&&Ar&&Et.setConstantPatternPositions(fr,Ar)}var Yr=h.translatePosMatrix(ft.posMatrix,Ue,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),zr=p.paint.get("fill-extrusion-vertical-gradient"),_n=ye?Fs(Yr,h,zr,Ce,ft,Ee,Ue):Mf(Yr,h,zr,Ce);zt.draw(P,P.gl.TRIANGLES,S,w,R,at.backCCW,_n,p.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,p.paint,h.transform.zoom,Et)}}}function ol(h,v,p,g,S,w){var R=h.context,P=R.gl,X=v.fbo;if(X){var te=h.useProgram("hillshade");R.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,X.colorAttachment.get());var ye=function(Ee,Ce,Xe){var We=Xe.paint.get("hillshade-shadow-color"),ft=Xe.paint.get("hillshade-highlight-color"),Ue=Xe.paint.get("hillshade-accent-color"),ct=Xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Xe.paint.get("hillshade-illumination-anchor")==="viewport"&&(ct-=Ee.transform.angle);var Et,zt,or,Qt=!Ee.options.moving;return{u_matrix:Ee.transform.calculatePosMatrix(Ce.tileID.toUnwrapped(),Qt),u_image:0,u_latrange:(Et=Ce.tileID,zt=Math.pow(2,Et.canonical.z),or=Et.canonical.y,[new y.MercatorCoordinate(0,or/zt).toLngLat().lat,new y.MercatorCoordinate(0,(or+1)/zt).toLngLat().lat]),u_light:[Xe.paint.get("hillshade-exaggeration"),ct],u_shadow:We,u_highlight:ft,u_accent:Ue}}(h,v,p);te.draw(R,P.TRIANGLES,g,S,w,at.disabled,ye,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function Th(h,v,p,g,S,w){var R=h.context,P=R.gl,X=v.dem;if(X&&X.data){var te=X.dim,ye=X.stride,Ee=X.getPixels();if(R.activeTexture.set(P.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(ye),v.demTexture){var Ce=v.demTexture;Ce.update(Ee,{premultiply:!1}),Ce.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else v.demTexture=new y.Texture(R,Ee,P.RGBA,{premultiply:!1}),v.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);R.activeTexture.set(P.TEXTURE0);var Xe=v.fbo;if(!Xe){var We=new y.Texture(R,{width:te,height:te,data:null},P.RGBA);We.bind(P.LINEAR,P.CLAMP_TO_EDGE),(Xe=v.fbo=R.createFramebuffer(te,te,!0)).colorAttachment.set(We.texture)}R.bindFramebuffer.set(Xe.framebuffer),R.viewport.set([0,0,te,te]),h.useProgram("hillshadePrepare").draw(R,P.TRIANGLES,g,S,w,at.disabled,function(ft,Ue){var ct=Ue.stride,Et=y.create();return y.ortho(Et,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Et,Et,[0,-y.EXTENT,0]),{u_matrix:Et,u_image:1,u_dimension:[ct,ct],u_zoom:ft.overscaledZ,u_unpack:Ue.getUnpackVector()}}(v.tileID,X),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function wh(h,v,p,g,S){var w=g.paint.get("raster-fade-duration");if(w>0){var R=y.browser.now(),P=(R-h.timeAdded)/w,X=v?(R-v.timeAdded)/w:-1,te=p.getSource(),ye=S.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),Ee=!v||Math.abs(v.tileID.overscaledZ-ye)>Math.abs(h.tileID.overscaledZ-ye),Ce=Ee&&h.refreshedUponExpiration?1:y.clamp(Ee?P:1-X,0,1);return h.refreshedUponExpiration&&P>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Ce}:{opacity:Ce,mix:0}}return{opacity:1,mix:0}}var Ch=new y.Color(1,0,0,1),Of=new y.Color(0,1,0,1),up=new y.Color(0,0,1,1),Ga=new y.Color(1,0,1,1),lp=new y.Color(0,1,1,1);function kf(h,v,p,g){Xl(h,0,v+p/2,h.transform.width,p,g)}function cp(h,v,p,g){Xl(h,v-p/2,0,p,h.transform.height,g)}function Xl(h,v,p,g,S,w){var R=h.context,P=R.gl;P.enable(P.SCISSOR_TEST),P.scissor(v*y.browser.devicePixelRatio,p*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:w}),P.disable(P.SCISSOR_TEST)}function fp(h,v,p){var g=h.context,S=g.gl,w=p.posMatrix,R=h.useProgram("debug"),P=ae.disabled,X=Ae.disabled,te=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,P,X,te,at.disabled,nl(w,y.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var ye=v.getTileByID(p.key).latestRawTileData,Ee=Math.floor((ye&&ye.byteLength||0)/1024),Ce=v.getTile(p).tileSize,Xe=512/Math.min(Ce,512)*(p.overscaledZ/h.transform.zoom)*.5,We=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(We+=" => "+p.overscaledZ),function(ft,Ue){ft.initDebugOverlayCanvas();var ct=ft.debugOverlayCanvas,Et=ft.context.gl,zt=ft.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,ct.width,ct.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(Ue,5,5),zt.strokeText(Ue,5,5),ft.debugOverlayTexture.update(ct),ft.debugOverlayTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE)}(h,We+" "+Ee+"kb"),R.draw(g,S.TRIANGLES,P,X,Ze.alphaBlended,at.disabled,nl(w,y.Color.transparent,Xe),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var Vu={symbol:function(h,v,p,g,S){if(h.renderPass==="translucent"){var w=Ae.disabled,R=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(P,X,te,ye,Ee,Ce,Xe){for(var We=X.transform,ft=Ee==="map",Ue=Ce==="map",ct=0,Et=P;ct<Et.length;ct+=1){var zt=Et[ct],or=ye.getTile(zt),Qt=or.getBucket(te);if(Qt&&Qt.text&&Qt.text.segments.get().length){var fr=y.evaluateSizeForZoom(Qt.textSizeData,We.zoom),Ar=ga(or,1,X.transform.zoom),Yr=ka(zt.posMatrix,Ue,ft,X.transform,Ar),zr=te.layout.get("icon-text-fit")!=="none"&&Qt.hasIconData();if(fr){var _n=Math.pow(2,We.zoom-or.tileID.overscaledZ);tf(Qt,ft,Ue,Xe,y.symbolSize,We,Yr,zt.posMatrix,_n,fr,zr)}}}}(g,h,p,v,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&Rl(h,v,p,g,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),w,R),p.paint.get("text-opacity").constantOr(1)!==0&&Rl(h,v,p,g,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),w,R),v.map.showCollisionBoxes&&(xc(h,v,p,g,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),xc(h,v,p,g,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("circle-opacity"),w=p.paint.get("circle-stroke-width"),R=p.paint.get("circle-stroke-opacity"),P=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||w.constantOr(1)!==0&&R.constantOr(1)!==0){for(var X=h.context,te=X.gl,ye=h.depthModeForSublayer(0,ae.ReadOnly),Ee=Ae.disabled,Ce=h.colorModeForRenderPass(),Xe=[],We=0;We<g.length;We++){var ft=g[We],Ue=v.getTile(ft),ct=Ue.getBucket(p);if(ct){var Et=ct.programConfigurations.get(p.id),zt={programConfiguration:Et,program:h.useProgram("circle",Et),layoutVertexBuffer:ct.layoutVertexBuffer,indexBuffer:ct.indexBuffer,uniformValues:yc(h,ft,Ue,p)};if(P)for(var or=0,Qt=ct.segments.get();or<Qt.length;or+=1){var fr=Qt[or];Xe.push({segments:new y.SegmentVector([fr]),sortKey:fr.sortKey,state:zt})}else Xe.push({segments:ct.segments,sortKey:0,state:zt})}}P&&Xe.sort(function(jn,zn){return jn.sortKey-zn.sortKey});for(var Ar=0,Yr=Xe;Ar<Yr.length;Ar+=1){var zr=Yr[Ar],_n=zr.state;_n.program.draw(X,te.TRIANGLES,ye,Ee,Ce,at.disabled,_n.uniformValues,p.id,_n.layoutVertexBuffer,_n.indexBuffer,zr.segments,p.paint,h.transform.zoom,_n.programConfiguration)}}}},heatmap:function(h,v,p,g){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,w=S.gl,R=Ae.disabled,P=new Ze([w.ONE,w.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Xe,We,ft){var Ue=Xe.gl;Xe.activeTexture.set(Ue.TEXTURE1),Xe.viewport.set([0,0,We.width/4,We.height/4]);var ct=ft.heatmapFbo;if(ct)Ue.bindTexture(Ue.TEXTURE_2D,ct.colorAttachment.get()),Xe.bindFramebuffer.set(ct.framebuffer);else{var Et=Ue.createTexture();Ue.bindTexture(Ue.TEXTURE_2D,Et),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_2D,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR),ct=ft.heatmapFbo=Xe.createFramebuffer(We.width/4,We.height/4,!1),function(zt,or,Qt,fr){var Ar=zt.gl;Ar.texImage2D(Ar.TEXTURE_2D,0,Ar.RGBA,or.width/4,or.height/4,0,Ar.RGBA,zt.extRenderToTextureHalfFloat?zt.extTextureHalfFloat.HALF_FLOAT_OES:Ar.UNSIGNED_BYTE,null),fr.colorAttachment.set(Qt)}(Xe,We,Et,ct)}})(S,h,p),S.clear({color:y.Color.transparent});for(var X=0;X<g.length;X++){var te=g[X];if(!v.hasRenderableParent(te)){var ye=v.getTile(te),Ee=ye.getBucket(p);if(Ee){var Ce=Ee.programConfigurations.get(p.id);h.useProgram("heatmap",Ce).draw(S,w.TRIANGLES,ae.disabled,R,P,at.disabled,Eh(te.posMatrix,ye,h.transform.zoom,p.paint.get("heatmap-intensity")),p.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,p.paint,h.transform.zoom,Ce)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(Xe,We){var ft=Xe.context,Ue=ft.gl,ct=We.heatmapFbo;if(ct){ft.activeTexture.set(Ue.TEXTURE0),Ue.bindTexture(Ue.TEXTURE_2D,ct.colorAttachment.get()),ft.activeTexture.set(Ue.TEXTURE1);var Et=We.colorRampTexture;Et||(Et=We.colorRampTexture=new y.Texture(ft,We.colorRamp,Ue.RGBA)),Et.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),Xe.useProgram("heatmapTexture").draw(ft,Ue.TRIANGLES,ae.disabled,Ae.disabled,Xe.colorModeForRenderPass(),at.disabled,function(zt,or,Qt,fr){var Ar=y.create();y.ortho(Ar,0,zt.width,zt.height,0,0,1);var Yr=zt.context.gl;return{u_matrix:Ar,u_world:[Yr.drawingBufferWidth,Yr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:or.paint.get("heatmap-opacity")}}(Xe,We),We.id,Xe.viewportBuffer,Xe.quadTriangleIndexBuffer,Xe.viewportSegments,We.paint,Xe.transform.zoom)}}(h,p))},line:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("line-opacity"),w=p.paint.get("line-width");if(S.constantOr(1)!==0&&w.constantOr(1)!==0)for(var R=h.depthModeForSublayer(0,ae.ReadOnly),P=h.colorModeForRenderPass(),X=p.paint.get("line-dasharray"),te=p.paint.get("line-pattern"),ye=te.constantOr(1),Ee=p.paint.get("line-gradient"),Ce=p.getCrossfadeParameters(),Xe=ye?"linePattern":X?"lineSDF":Ee?"lineGradient":"line",We=h.context,ft=We.gl,Ue=!0,ct=0,Et=g;ct<Et.length;ct+=1){var zt=Et[ct],or=v.getTile(zt);if(!ye||or.patternsLoaded()){var Qt=or.getBucket(p);if(Qt){var fr=Qt.programConfigurations.get(p.id),Ar=h.context.program.get(),Yr=h.useProgram(Xe,fr),zr=Ue||Yr.program!==Ar,_n=te.constantOr(null);if(_n&&or.imageAtlas){var jn=or.imageAtlas,zn=jn.patternPositions[_n.to.toString()],Hn=jn.patternPositions[_n.from.toString()];zn&&Hn&&fr.setConstantPatternPositions(zn,Hn)}var Wi=ye?Cl(h,or,p,Ce):X?sp(h,or,p,X,Ce):Ee?ba(h,or,p,Qt.lineClipsArray.length):Kc(h,or,p);if(ye)We.activeTexture.set(ft.TEXTURE0),or.imageAtlasTexture.bind(ft.LINEAR,ft.CLAMP_TO_EDGE),fr.updatePaintBuffers(Ce);else if(X&&(zr||h.lineAtlas.dirty))We.activeTexture.set(ft.TEXTURE0),h.lineAtlas.bind(We);else if(Ee){var An=Qt.gradients[p.id],ui=An.texture;if(p.gradientVersion!==An.version){var gi=256;if(p.stepInterpolant){var oi=v.getSource().maxzoom,ri=zt.canonical.z===oi?Math.ceil(1<<h.transform.maxZoom-zt.canonical.z):1;gi=y.clamp(y.nextPowerOfTwo(Qt.maxLineLength/y.EXTENT*1024*ri),256,We.maxTextureSize)}An.gradient=y.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:An.gradient||void 0,clips:Qt.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new y.Texture(We,An.gradient,ft.RGBA),An.version=p.gradientVersion,ui=An.texture}We.activeTexture.set(ft.TEXTURE0),ui.bind(p.stepInterpolant?ft.NEAREST:ft.LINEAR,ft.CLAMP_TO_EDGE)}Yr.draw(We,ft.TRIANGLES,R,h.stencilModeForClipping(zt),P,at.disabled,Wi,p.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,p.paint,h.transform.zoom,fr,Qt.layoutVertexBuffer2),Ue=!1}}}}},fill:function(h,v,p,g){var S=p.paint.get("fill-color"),w=p.paint.get("fill-opacity");if(w.constantOr(1)!==0){var R=h.colorModeForRenderPass(),P=p.paint.get("fill-pattern"),X=h.opaquePassEnabledForLayer()&&!P.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===X){var te=h.depthModeForSublayer(1,h.renderPass==="opaque"?ae.ReadWrite:ae.ReadOnly);Gl(h,v,p,g,te,R,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var ye=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,ae.ReadOnly);Gl(h,v,p,g,ye,R,!0)}}},"fill-extrusion":function(h,v,p,g){var S=p.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var w=new ae(h.context.gl.LEQUAL,ae.ReadWrite,h.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Pf(h,v,p,g,w,Ae.disabled,Ze.disabled),Pf(h,v,p,g,w,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var R=h.colorModeForRenderPass();Pf(h,v,p,g,w,Ae.disabled,R)}}},hillshade:function(h,v,p,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,w=h.depthModeForSublayer(0,ae.ReadOnly),R=h.colorModeForRenderPass(),P=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],X=P[0],te=0,ye=P[1];te<ye.length;te+=1){var Ee=ye[te],Ce=v.getTile(Ee);Ce.needsHillshadePrepare&&h.renderPass==="offscreen"?Th(h,Ce,p,w,Ae.disabled,R):h.renderPass==="translucent"&&ol(h,Ce,p,w,X[Ee.overscaledZ],R)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,p,g){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,w=S.gl,R=v.getSource(),P=h.useProgram("raster"),X=h.colorModeForRenderPass(),te=R instanceof Le?[{},g]:h.stencilConfigForOverlap(g),ye=te[0],Ee=te[1],Ce=Ee[Ee.length-1].overscaledZ,Xe=!h.options.moving,We=0,ft=Ee;We<ft.length;We+=1){var Ue=ft[We],ct=h.depthModeForSublayer(Ue.overscaledZ-Ce,p.paint.get("raster-opacity")===1?ae.ReadWrite:ae.ReadOnly,w.LESS),Et=v.getTile(Ue),zt=h.transform.calculatePosMatrix(Ue.toUnwrapped(),Xe);Et.registerFadeDuration(p.paint.get("raster-fade-duration"));var or=v.findLoadedParent(Ue,0),Qt=wh(Et,or,v,p,h.transform),fr=void 0,Ar=void 0,Yr=p.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;S.activeTexture.set(w.TEXTURE0),Et.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(w.TEXTURE1),or?(or.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),fr=Math.pow(2,or.tileID.overscaledZ-Et.tileID.overscaledZ),Ar=[Et.tileID.canonical.x*fr%1,Et.tileID.canonical.y*fr%1]):Et.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var zr=Jc(zt,Ar||[0,0],fr||1,Qt,p);R instanceof Le?P.draw(S,w.TRIANGLES,ct,Ae.disabled,X,at.disabled,zr,p.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):P.draw(S,w.TRIANGLES,ct,ye[Ue.overscaledZ],X,at.disabled,zr,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,p){var g=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S!==0){var w=h.context,R=w.gl,P=h.transform,X=P.tileSize,te=p.paint.get("background-pattern");if(!h.isPatternMissing(te)){var ye=!te&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===ye){var Ee=Ae.disabled,Ce=h.depthModeForSublayer(0,ye==="opaque"?ae.ReadWrite:ae.ReadOnly),Xe=h.colorModeForRenderPass(),We=h.useProgram(te?"backgroundPattern":"background"),ft=P.coveringTiles({tileSize:X});te&&(w.activeTexture.set(R.TEXTURE0),h.imageManager.bind(h.context));for(var Ue=p.getCrossfadeParameters(),ct=0,Et=ft;ct<Et.length;ct+=1){var zt=Et[ct],or=h.transform.calculatePosMatrix(zt.toUnwrapped()),Qt=te?Wl(or,S,h,te,{tileID:zt,tileSize:X},Ue):bc(or,S,g);We.draw(w,R.TRIANGLES,Ce,Ee,Xe,at.disabled,Qt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,p){for(var g=0;g<p.length;g++)fp(h,v,p[g])},custom:function(h,v,p){var g=h.context,S=p.implementation;if(h.renderPass==="offscreen"){var w=S.prerender;w&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),w.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Ae.disabled);var R=S.renderingMode==="3d"?new ae(h.context.gl.LEQUAL,ae.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ae.ReadOnly);g.setDepthMode(R),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},Ea=function(h,v){this.context=new j(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=J.maxUnderzooming+J.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new El,this.gpuTimers={}};Ea.prototype.resize=function(h,v){if(this.width=h*y.browser.devicePixelRatio,this.height=v*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,g=this.style._order;p<g.length;p+=1)this.style._layers[g[p]].resize()},Ea.prototype.setup=function(){var h=this.context,v=new y.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(y.EXTENT,0),v.emplaceBack(0,y.EXTENT),v.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,Ja.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var p=new y.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=h.createVertexBuffer(p,Ja.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,nt.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,Ja.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(w);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R),this.emptyTexture=new y.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var P=this.context.gl;this.stencilClearMode=new Ae({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)},Ea.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=y.create();y.ortho(p,0,this.width,this.height,0,0,1),y.scale(p,p,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,ae.disabled,this.stencilClearMode,Ze.disabled,at.disabled,wl(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ea.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var p=this.context,g=p.gl;this.nextStencilID+v.length>256&&this.clearStencil(),p.setColorMode(Ze.disabled),p.setDepthMode(ae.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,R=v;w<R.length;w+=1){var P=R[w],X=this._tileClippingMaskIDs[P.key]=this.nextStencilID++;S.draw(p,g.TRIANGLES,ae.disabled,new Ae({func:g.ALWAYS,mask:0},X,255,g.KEEP,g.KEEP,g.REPLACE),Ze.disabled,at.disabled,wl(P.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ea.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new Ae({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},Ea.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new Ae({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},Ea.prototype.stencilConfigForOverlap=function(h){var v,p=this.context.gl,g=h.sort(function(X,te){return te.overscaledZ-X.overscaledZ}),S=g[g.length-1].overscaledZ,w=g[0].overscaledZ-S+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var R={},P=0;P<w;P++)R[P+S]=new Ae({func:p.GEQUAL,mask:255},P+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=w,[R,g]}return[(v={},v[S]=Ae.disabled,v),g]},Ea.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Ze([h.CONSTANT_COLOR,h.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ze.unblended:Ze.alphaBlended},Ea.prototype.depthModeForSublayer=function(h,v,p){if(!this.opaquePassEnabledForLayer())return ae.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ae(p||this.context.gl.LEQUAL,v,[g,g])},Ea.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ea.prototype.render=function(h,v){var p=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var w in S){var R=S[w];R.used&&R.prepare(this.context)}var P,X,te={},ye={},Ee={};for(var Ce in S){var Xe=S[Ce];te[Ce]=Xe.getVisibleCoordinates(),ye[Ce]=te[Ce].slice().reverse(),Ee[Ce]=Xe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var We=0;We<g.length;We++)if(this.style._layers[g[We]].is3D()){this.opaquePassCutoff=We;break}this.renderPass="offscreen";for(var ft=0,Ue=g;ft<Ue.length;ft+=1){var ct=this.style._layers[Ue[ft]];if(ct.hasOffscreenPass()&&!ct.isHidden(this.transform.zoom)){var Et=ye[ct.source];(ct.type==="custom"||Et.length)&&this.renderLayer(this,S[ct.source],ct,Et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var zt=this.style._layers[g[this.currentLayer]],or=S[zt.source],Qt=te[zt.source];this._renderTileClippingMasks(zt,Qt),this.renderLayer(this,or,zt,Qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var fr=this.style._layers[g[this.currentLayer]],Ar=S[fr.source],Yr=(fr.type==="symbol"?Ee:ye)[fr.source];this._renderTileClippingMasks(fr,te[fr.source]),this.renderLayer(this,Ar,fr,Yr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(zr){zr.source&&!zr.isHidden(p.transform.zoom)&&(zr.source!==(X&&X.id)&&(X=p.style.sourceCaches[zr.source]),(!P||P.getSource().maxzoom<X.getSource().maxzoom)&&(P=X))}),P&&Vu.debug(this,P,P.getVisibleCoordinates())),this.options.showPadding&&function(zr){var _n=zr.transform.padding;kf(zr,zr.transform.height-(_n.top||0),3,Ch),kf(zr,_n.bottom||0,3,Of),cp(zr,_n.left||0,3,up),cp(zr,zr.transform.width-(_n.right||0),3,Ga);var jn=zr.transform.centerPoint;(function(zn,Hn,Wi,An){Xl(zn,Hn-1,Wi-10,2,20,An),Xl(zn,Hn-10,Wi-1,20,2,An)})(zr,jn.x,zr.transform.height-jn.y,lp)}(this),this.context.setDefault()},Ea.prototype.renderLayer=function(h,v,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||g.length)&&(this.id=p.id,this.gpuTimingStart(p),Vu[p.type](h,v,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ea.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),p.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,p.query)}},Ea.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},Ea.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},Ea.prototype.queryGpuTimers=function(h){var v={};for(var p in h){var g=h[p],S=this.context.extTimerQuery,w=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[p]=w}return v},Ea.prototype.translatePosMatrix=function(h,v,p,g,S){if(!p[0]&&!p[1])return h;var w=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){var R=Math.sin(w),P=Math.cos(w);p=[p[0]*P-p[1]*R,p[0]*R+p[1]*P]}var X=[S?p[0]:ga(v,p[0],this.transform.zoom),S?p[1]:ga(v,p[1],this.transform.zoom),0],te=new Float32Array(16);return y.translate(te,h,X),te},Ea.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},Ea.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},Ea.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!v||!p},Ea.prototype.useProgram=function(h,v){this.cache=this.cache||{};var p=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new Wa(this.context,h,uu[h],v,Sh[h],this._showOverdrawInspector)),this.cache[p]},Ea.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ea.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},Ea.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ea.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var $l=function(h,v){this.points=h,this.planes=v};$l.fromInvProjectionMatrix=function(h,v,p){var g=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,h)}).map(function(R){return y.scale$1([],R,1/R[3]/v*g)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var P=y.sub([],S[R[0]],S[R[1]]),X=y.sub([],S[R[2]],S[R[1]]),te=y.normalize([],y.cross([],P,X)),ye=-y.dot(te,S[R[1]]);return te.concat(ye)});return new $l(S,w)};var ju=function(h,v){this.min=h,this.max=v,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};ju.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],p=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<v.length;S++)p[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new ju(p,g)},ju.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},ju.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},ju.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],w=0,R=0;R<v.length;R++)w+=y.dot$1(S,v[R])>=0;if(w===0)return 0;w!==v.length&&(p=!1)}if(p)return 2;for(var P=0;P<3;P++){for(var X=Number.MAX_VALUE,te=-Number.MAX_VALUE,ye=0;ye<h.points.length;ye++){var Ee=h.points[ye][P]-this.min[P];X=Math.min(X,Ee),te=Math.max(te,Ee)}if(te<0||X>this.max[P]-this.min[P])return 0}return 1};var sl=function(h,v,p,g){if(h===void 0&&(h=0),v===void 0&&(v=0),p===void 0&&(p=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=p,this.right=g};sl.prototype.interpolate=function(h,v,p){return v.top!=null&&h.top!=null&&(this.top=y.number(h.top,v.top,p)),v.bottom!=null&&h.bottom!=null&&(this.bottom=y.number(h.bottom,v.bottom,p)),v.left!=null&&h.left!=null&&(this.left=y.number(h.left,v.left,p)),v.right!=null&&h.right!=null&&(this.right=y.number(h.right,v.right,p)),this},sl.prototype.getCenter=function(h,v){var p=y.clamp((this.left+h-this.right)/2,0,h),g=y.clamp((this.top+v-this.bottom)/2,0,v);return new y.Point(p,g)},sl.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},sl.prototype.clone=function(){return new sl(this.top,this.bottom,this.left,this.right)},sl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var zi=function(h,v,p,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new sl,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};zi.prototype.clone=function(){var h=new zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},Sa.minZoom.get=function(){return this._minZoom},Sa.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},Sa.maxZoom.get=function(){return this._maxZoom},Sa.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},Sa.minPitch.get=function(){return this._minPitch},Sa.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},Sa.maxPitch.get=function(){return this._maxPitch},Sa.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},Sa.renderWorldCopies.get=function(){return this._renderWorldCopies},Sa.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},Sa.worldSize.get=function(){return this.tileSize*this.scale},Sa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sa.size.get=function(){return new y.Point(this.width,this.height)},Sa.bearing.get=function(){return-this.angle/Math.PI*180},Sa.bearing.set=function(h){var v=-y.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sa.pitch.get=function(){return this._pitch/Math.PI*180},Sa.pitch.set=function(h){var v=y.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},Sa.fov.get=function(){return this._fov/Math.PI*180},Sa.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},Sa.zoom.get=function(){return this._zoom},Sa.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},Sa.center.get=function(){return this._center},Sa.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},Sa.padding.get=function(){return this._edgeInsets.toJSON()},Sa.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},Sa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},zi.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},zi.prototype.interpolatePadding=function(h,v,p){this._unmodified=!1,this._edgeInsets.interpolate(h,v,p),this._constrain(),this._calcMatrices()},zi.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},zi.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new y.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),w=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(p.x,g.x,S.x,w.x)),P=Math.floor(Math.max(p.x,g.x,S.x,w.x)),X=R-1;X<=P+1;X++)X!==0&&v.push(new y.UnwrappedTileID(X,h));return v},zi.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),p=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),w=[S*g.x,S*g.y,0],R=$l.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),P=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(P=v);var X=function(zr){return{aabb:new ju([zr*S,0,0],[(zr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:zr,fullyVisible:!1}},te=[],ye=[],Ee=v,Ce=h.reparseOverscaled?p:v;if(this._renderWorldCopies)for(var Xe=1;Xe<=3;Xe++)te.push(X(-Xe)),te.push(X(Xe));for(te.push(X(0));te.length>0;){var We=te.pop(),ft=We.x,Ue=We.y,ct=We.fullyVisible;if(!ct){var Et=We.aabb.intersects(R);if(Et===0)continue;ct=Et===2}var zt=We.aabb.distanceX(w),or=We.aabb.distanceY(w),Qt=Math.max(Math.abs(zt),Math.abs(or));if(We.zoom===Ee||Qt>3+(1<<Ee-We.zoom)-2&&We.zoom>=P)ye.push({tileID:new y.OverscaledTileID(We.zoom===Ee?Ce:We.zoom,We.wrap,We.zoom,ft,Ue),distanceSq:y.sqrLen([w[0]-.5-ft,w[1]-.5-Ue])});else for(var fr=0;fr<4;fr++){var Ar=(ft<<1)+fr%2,Yr=(Ue<<1)+(fr>>1);te.push({aabb:We.aabb.quadrant(fr),zoom:We.zoom+1,x:Ar,y:Yr,wrap:We.wrap,fullyVisible:ct})}}return ye.sort(function(zr,_n){return zr.distanceSq-_n.distanceSq}).map(function(zr){return zr.tileID})},zi.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},Sa.unmodified.get=function(){return this._unmodified},zi.prototype.zoomScale=function(h){return Math.pow(2,h)},zi.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},zi.prototype.project=function(h){var v=y.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(h.lng)*this.worldSize,y.mercatorYfromLat(v)*this.worldSize)},zi.prototype.unproject=function(h){return new y.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},Sa.point.get=function(){return this.project(this.center)},zi.prototype.setLocationAtPoint=function(h,v){var p=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),w=new y.MercatorCoordinate(S.x-(p.x-g.x),S.y-(p.y-g.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},zi.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},zi.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},zi.prototype.locationCoordinate=function(h){return y.MercatorCoordinate.fromLngLat(h)},zi.prototype.coordinateLocation=function(h){return h.toLngLat()},zi.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],p=[h.x,h.y,1,1];y.transformMat4(v,v,this.pixelMatrixInverse),y.transformMat4(p,p,this.pixelMatrixInverse);var g=v[3],S=p[3],w=v[1]/g,R=p[1]/S,P=v[2]/g,X=p[2]/S,te=P===X?0:(0-P)/(X-P);return new y.MercatorCoordinate(y.number(v[0]/g,p[0]/S,te)/this.worldSize,y.number(w,R,te)/this.worldSize)},zi.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix),new y.Point(v[0]/v[3],v[1]/v[3])},zi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},zi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},zi.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},zi.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var p=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];var S=h.canonical,w=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*h.wrap,P=y.identity(new Float64Array(16));return y.translate(P,P,[R*w,S.y*w,0]),y.scale(P,P,[w/y.EXTENT,w/y.EXTENT,1]),y.multiply(P,v?this.alignedProjMatrix:this.projMatrix,P),g[p]=new Float32Array(P),g[p]},zi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},zi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,p,g,S=-90,w=90,R=-180,P=180,X=this.size,te=this._unmodified;if(this.latRange){var ye=this.latRange;S=y.mercatorYfromLat(ye[1])*this.worldSize,h=(w=y.mercatorYfromLat(ye[0])*this.worldSize)-S<X.y?X.y/(w-S):0}if(this.lngRange){var Ee=this.lngRange;R=y.mercatorXfromLng(Ee[0])*this.worldSize,v=(P=y.mercatorXfromLng(Ee[1])*this.worldSize)-R<X.x?X.x/(P-R):0}var Ce=this.point,Xe=Math.max(v||0,h||0);if(Xe)return this.center=this.unproject(new y.Point(v?(P+R)/2:Ce.x,h?(w+S)/2:Ce.y)),this.zoom+=this.scaleZoom(Xe),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var We=Ce.y,ft=X.y/2;We-ft<S&&(g=S+ft),We+ft>w&&(g=w-ft)}if(this.lngRange){var Ue=Ce.x,ct=X.x/2;Ue-ct<R&&(p=R+ct),Ue+ct>P&&(p=P-ct)}p===void 0&&g===void 0||(this.center=this.unproject(new y.Point(p!==void 0?p:Ce.x,g!==void 0?g:Ce.y))),this._unmodified=te,this._constraining=!1}},zi.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,p=this._fov*(.5+h.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-v-p,.01,Math.PI-.01)),S=this.point,w=S.x,R=S.y,P=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),X=this.height/50,te=new Float64Array(16);y.perspective(te,this._fov,this.width/this.height,X,P),te[8]=2*-h.x/this.width,te[9]=2*h.y/this.height,y.scale(te,te,[1,-1,1]),y.translate(te,te,[0,0,-this.cameraToCenterDistance]),y.rotateX(te,te,this._pitch),y.rotateZ(te,te,this.angle),y.translate(te,te,[-w,-R,0]),this.mercatorMatrix=y.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),y.scale(te,te,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=y.invert([],this.projMatrix);var ye=this.width%2/2,Ee=this.height%2/2,Ce=Math.cos(this.angle),Xe=Math.sin(this.angle),We=w-Math.round(w)+Ce*ye+Xe*Ee,ft=R-Math.round(R)+Ce*Ee+Xe*ye,Ue=new Float64Array(te);if(y.translate(Ue,Ue,[We>.5?We-1:We,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Ue,te=y.create(),y.scale(te,te,[this.width/2,-this.height/2,1]),y.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=y.create(),y.scale(te,te,[1,-1,1]),y.translate(te,te,[-1,-1,0]),y.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},zi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new y.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},zi.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,h))},zi.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var p=v.x,g=v.y,S=v.x,w=v.y,R=0,P=h;R<P.length;R+=1){var X=P[R];p=Math.min(p,X.x),g=Math.min(g,X.y),S=Math.max(S,X.x),w=Math.max(w,X.y)}return[new y.Point(p,g),new y.Point(S,g),new y.Point(S,w),new y.Point(p,w),new y.Point(p,g)]},Object.defineProperties(zi.prototype,Sa);var lu=function(h){var v,p,g,S;this._hashName=h&&encodeURIComponent(h),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),p=!1,g=null,S=function(){g=null,p&&(v(),g=setTimeout(S,300),p=!1)},function(){return p=!0,g||S(),g})};lu.prototype.addTo=function(h){return this._map=h,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},lu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},lu.prototype.getHashString=function(h){var v=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),w=Math.round(v.lng*S)/S,R=Math.round(v.lat*S)/S,P=this._map.getBearing(),X=this._map.getPitch(),te="";if(te+=h?"/"+w+"/"+R+"/"+p:p+"/"+R+"/"+w,(P||X)&&(te+="/"+Math.round(10*P)/10),X&&(te+="/"+Math.round(X)),this._hashName){var ye=this._hashName,Ee=!1,Ce=y.window.location.hash.slice(1).split("&").map(function(Xe){var We=Xe.split("=")[0];return We===ye?(Ee=!0,We+"="+te):Xe}).filter(function(Xe){return Xe});return Ee||Ce.push(ye+"="+te),"#"+Ce.join("&")}return"#"+te},lu.prototype._getCurrentHash=function(){var h,v=this,p=y.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):p.split("/")},lu.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},lu.prototype._updateHashUnthrottled=function(){var h=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,h)}catch(v){}};var rf={linearity:.3,easing:y.bezier(0,0,.3,1)},nf=y.extend({deceleration:2500,maxSpeed:1400},rf),qs=y.extend({deceleration:20,maxSpeed:1400},rf),hp=y.extend({deceleration:1e3,maxSpeed:360},rf),Df=y.extend({deceleration:1e3,maxSpeed:90},rf),Lf=function(h){this._map=h,this.clear()};function Yl(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function Po(h,v,p){var g=p.maxSpeed,S=p.linearity,w=p.deceleration,R=y.clamp(h*S/(v/1e3),-g,g),P=Math.abs(R)/(w*S);return{easing:p.easing,duration:1e3*P,amount:R*(P/2)}}Lf.prototype.clear=function(){this._inertiaBuffer=[]},Lf.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:h})},Lf.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=y.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},Lf.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},p=0,g=this._inertiaBuffer;p<g.length;p+=1){var S=g[p].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var P=Po(v.pan.mag(),w,y.extend({},nf,h||{}));R.offset=v.pan.mult(P.amount/v.pan.mag()),R.center=this._map.transform.center,Yl(R,P)}if(v.zoom){var X=Po(v.zoom,w,qs);R.zoom=this._map.transform.zoom+X.amount,Yl(R,X)}if(v.bearing){var te=Po(v.bearing,w,hp);R.bearing=this._map.transform.bearing+y.clamp(te.amount,-179,179),Yl(R,te)}if(v.pitch){var ye=Po(v.pitch,w,Df);R.pitch=this._map.transform.pitch+ye.amount,Yl(R,ye)}if(R.zoom||R.bearing){var Ee=v.pinchAround===void 0?v.around:v.pinchAround;R.around=Ee?this._map.unproject(Ee):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var Xa=function(h){function v(g,S,w,R){R===void 0&&(R={});var P=L.mousePos(S.getCanvasContainer(),w),X=S.unproject(P);h.call(this,g,y.extend({point:P,lngLat:X,originalEvent:w},R)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),af=function(h){function v(g,S,w){var R=g==="touchend"?w.changedTouches:w.touches,P=L.touchPos(S.getCanvasContainer(),R),X=P.map(function(Ee){return S.unproject(Ee)}),te=P.reduce(function(Ee,Ce,Xe,We){return Ee.add(Ce.div(We.length))},new y.Point(0,0)),ye=S.unproject(te);h.call(this,g,{points:P,point:te,lngLats:X,lngLat:ye,originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),Sc=function(h){function v(g,S,w){h.call(this,g,{originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),so=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};so.prototype.reset=function(){delete this._mousedownPos},so.prototype.wheel=function(h){return this._firePreventable(new Sc(h.type,this._map,h))},so.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new Xa(h.type,this._map,h))},so.prototype.mouseup=function(h){this._map.fire(new Xa(h.type,this._map,h))},so.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new Xa(h.type,this._map,h))},so.prototype.dblclick=function(h){return this._firePreventable(new Xa(h.type,this._map,h))},so.prototype.mouseover=function(h){this._map.fire(new Xa(h.type,this._map,h))},so.prototype.mouseout=function(h){this._map.fire(new Xa(h.type,this._map,h))},so.prototype.touchstart=function(h){return this._firePreventable(new af(h.type,this._map,h))},so.prototype.touchmove=function(h){this._map.fire(new af(h.type,this._map,h))},so.prototype.touchend=function(h){this._map.fire(new af(h.type,this._map,h))},so.prototype.touchcancel=function(h){this._map.fire(new af(h.type,this._map,h))},so.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},so.prototype.isEnabled=function(){return!0},so.prototype.isActive=function(){return!1},so.prototype.enable=function(){},so.prototype.disable=function(){};var Rn=function(h){this._map=h};Rn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Rn.prototype.mousemove=function(h){this._map.fire(new Xa(h.type,this._map,h))},Rn.prototype.mousedown=function(){this._delayContextMenu=!0},Rn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Rn.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new Xa(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},Rn.prototype.isEnabled=function(){return!0},Rn.prototype.isActive=function(){return!1},Rn.prototype.enable=function(){},Rn.prototype.disable=function(){};var gs=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function Bf(h,v){for(var p={},g=0;g<h.length;g++)p[h[g].identifier]=v[g];return p}gs.prototype.isEnabled=function(){return!!this._enabled},gs.prototype.isActive=function(){return!!this._active},gs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},gs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gs.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(L.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},gs.prototype.mousemoveWindow=function(h,v){if(this._active){var p=v;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=p,this._box||(this._box=L.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,p.x),w=Math.max(g.x,p.x),R=Math.min(g.y,p.y),P=Math.max(g.y,p.y);L.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=w-S+"px",this._box.style.height=P-R+"px"}}},gs.prototype.mouseupWindow=function(h,v){var p=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),L.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(w){return w.fitScreenCoordinates(g,S,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},gs.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},gs.prototype.blur=function(){this.reset()},gs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos},gs.prototype._fireEvent=function(h,v){return this._map.fire(new y.Event(h,{originalEvent:v}))};var Ac=function(h){this.reset(),this.numTouches=h.numTouches};Ac.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ac.prototype.touchstart=function(h,v,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),w=0,R=g;w<R.length;w+=1)S._add(R[w]);return S.div(g.length)}(v),this.touches=Bf(p,v)))},Ac.prototype.touchmove=function(h,v,p){if(!this.aborted&&this.centroid){var g=Bf(p,v);for(var S in this.touches){var w=g[S];(!w||w.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Ac.prototype.touchend=function(h,v,p){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var ls=function(h){this.singleTap=new Ac(h),this.numTaps=h.numTaps,this.reset()};ls.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ls.prototype.touchstart=function(h,v,p){this.singleTap.touchstart(h,v,p)},ls.prototype.touchmove=function(h,v,p){this.singleTap.touchmove(h,v,p)},ls.prototype.touchend=function(h,v,p){var g=this.singleTap.touchend(h,v,p);if(g){var S=h.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(S&&w||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var xa=function(){this._zoomIn=new ls({numTouches:1,numTaps:2}),this._zoomOut=new ls({numTouches:2,numTaps:1}),this.reset()};xa.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},xa.prototype.touchstart=function(h,v,p){this._zoomIn.touchstart(h,v,p),this._zoomOut.touchstart(h,v,p)},xa.prototype.touchmove=function(h,v,p){this._zoomIn.touchmove(h,v,p),this._zoomOut.touchmove(h,v,p)},xa.prototype.touchend=function(h,v,p){var g=this,S=this._zoomIn.touchend(h,v,p),w=this._zoomOut.touchend(h,v,p);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:h})}}):w?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(w)},{originalEvent:h})}}):void 0},xa.prototype.touchcancel=function(){this.reset()},xa.prototype.enable=function(){this._enabled=!0},xa.prototype.disable=function(){this._enabled=!1,this.reset()},xa.prototype.isEnabled=function(){return this._enabled},xa.prototype.isActive=function(){return this._active};var Ff={0:1,2:2},cn=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};cn.prototype.blur=function(){this.reset()},cn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},cn.prototype._correctButton=function(h,v){return!1},cn.prototype._move=function(h,v){return{}},cn.prototype.mousedown=function(h,v){if(!this._lastPoint){var p=L.mouseButton(h);this._correctButton(h,p)&&(this._lastPoint=v,this._eventButton=p)}},cn.prototype.mousemoveWindow=function(h,v){var p=this._lastPoint;if(p){if(h.preventDefault(),function(g,S){var w=Ff[S];return g.buttons===void 0||(g.buttons&w)!==w}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(p,v)}},cn.prototype.mouseupWindow=function(h){this._lastPoint&&L.mouseButton(h)===this._eventButton&&(this._moved&&L.suppressClick(),this.reset())},cn.prototype.enable=function(){this._enabled=!0},cn.prototype.disable=function(){this._enabled=!1,this.reset()},cn.prototype.isEnabled=function(){return this._enabled},cn.prototype.isActive=function(){return this._active};var ul=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(p,g){h.prototype.mousedown.call(this,p,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(p,g){return g===0&&!p.ctrlKey},v.prototype._move=function(p,g){return{around:g,panDelta:g.sub(p)}},v}(cn),of=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=.8*(g.x-p.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(cn),sf=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=-.5*(g.y-p.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(cn),bu=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};bu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},bu.prototype.touchstart=function(h,v,p){return this._calculateTransform(h,v,p)},bu.prototype.touchmove=function(h,v,p){if(this._active&&!(p.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,p)},bu.prototype.touchend=function(h,v,p){this._calculateTransform(h,v,p),this._active&&p.length<this._minTouches&&this.reset()},bu.prototype.touchcancel=function(){this.reset()},bu.prototype._calculateTransform=function(h,v,p){p.length>0&&(this._active=!0);var g=Bf(p,v),S=new y.Point(0,0),w=new y.Point(0,0),R=0;for(var P in g){var X=g[P],te=this._touches[P];te&&(S._add(X),w._add(X.sub(te)),R++,g[P]=X)}if(this._touches=g,!(R<this._minTouches)&&w.mag()){var ye=w.div(R);if(this._sum._add(ye),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:ye}}},bu.prototype.enable=function(){this._enabled=!0},bu.prototype.disable=function(){this._enabled=!1,this.reset()},bu.prototype.isEnabled=function(){return this._enabled},bu.prototype.isActive=function(){return this._active};var Us=function(){this.reset()};function Nf(h,v,p){for(var g=0;g<h.length;g++)if(h[g].identifier===p)return v[g]}function Uf(h,v){return Math.log(h/v)/Math.LN2}Us.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Us.prototype._start=function(h){},Us.prototype._move=function(h,v,p){return{}},Us.prototype.touchstart=function(h,v,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([v[0],v[1]]))},Us.prototype.touchmove=function(h,v,p){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],w=Nf(p,v,g[0]),R=Nf(p,v,S);if(w&&R){var P=this._aroundCenter?null:w.add(R).div(2);return this._move([w,R],P,h)}}},Us.prototype.touchend=function(h,v,p){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],w=Nf(p,v,g[0]),R=Nf(p,v,S);w&&R||(this._active&&L.suppressClick(),this.reset())}},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var ys=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(Uf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uf(this._distance,S),pinchAround:g}},v}(Us);function xu(h,v){return 180*h.angleWith(v)/Math.PI}var pp=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xu(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var g=25/(Math.PI*this._minDiameter)*360,S=xu(p,this._startVector);return Math.abs(S)<g},v}(Us);function Tc(h){return Math.abs(h.y)>Math.abs(h.x)}var wc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(p){this._lastPoints=p,Tc(p[0].sub(p[1]))&&(this._valid=!1)},v.prototype._move=function(p,g,S){var w=p[0].sub(this._lastPoints[0]),R=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,R,S.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(w.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(p,g,S){if(this._valid!==void 0)return this._valid;var w=p.mag()>=2,R=g.mag()>=2;if(w||R){if(!w||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var P=p.y>0==g.y>0;return Tc(p)&&Tc(g)&&P}},v}(Us),zf={panStep:100,bearingStep:15,pitchStep:10},Ks=function(){var h=zf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Ut(h){return h*(2-h)}Ks.prototype.blur=function(){this.reset()},Ks.prototype.reset=function(){this._active=!1},Ks.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var p=0,g=0,S=0,w=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),w=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),w=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(P){var X=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Ut,zoom:p?Math.round(X)+p*(h.shiftKey?2:1):X,bearing:P.getBearing()+g*v._bearingStep,pitch:P.getPitch()+S*v._pitchStep,offset:[-w*v._panStep,-R*v._panStep],center:P.getCenter()},{originalEvent:h})}}}},Ks.prototype.enable=function(){this._enabled=!0},Ks.prototype.disable=function(){this._enabled=!1,this.reset()},Ks.prototype.isEnabled=function(){return this._enabled},Ks.prototype.isActive=function(){return this._active},Ks.prototype.disableRotation=function(){this._rotationDisabled=!0},Ks.prototype.enableRotation=function(){this._rotationDisabled=!1};var Me=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Me.prototype.setZoomRate=function(h){this._defaultZoomRate=h},Me.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},Me.prototype.isEnabled=function(){return!!this._enabled},Me.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Me.prototype.isZooming=function(){return!!this._zooming},Me.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},Me.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Me.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=y.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},Me.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},Me.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=L.mousePos(this._el,h);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Me.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,P=this._startZoom,X=this._easing,te=!1;if(this._type==="wheel"&&P&&X){var ye=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Ee=X(ye);w=y.number(P,R,Ee),ye<1?this._frameId||(this._frameId=!0):te=!0}else w=R,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:w-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Me.prototype._smoothOutEasing=function(h){var v=y.ease;if(this._prevEase){var p=this._prevEase,g=(y.browser.now()-p.start)/p.duration,S=p.easing(g+.01)-p.easing(g),w=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-w*w);v=y.bezier(w,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:h,easing:v},v},Me.prototype.blur=function(){this.reset()},Me.prototype.reset=function(){this._active=!1};var F=function(h,v){this._clickZoom=h,this._tapZoom=v};F.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},F.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},F.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},F.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Qs=function(){this.reset()};Qs.prototype.reset=function(){this._active=!1},Qs.prototype.blur=function(){this.reset()},Qs.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(p){p.easeTo({duration:300,zoom:p.getZoom()+(h.shiftKey?-1:1),around:p.unproject(v)},{originalEvent:h})}}},Qs.prototype.enable=function(){this._enabled=!0},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active};var pe=function(){this._tap=new ls({numTouches:1,numTaps:1}),this.reset()};pe.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},pe.prototype.touchstart=function(h,v,p){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=v[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(h,v,p))},pe.prototype.touchmove=function(h,v,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,p)},pe.prototype.touchend=function(h,v,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(h,v,p)&&(this._tapTime=h.timeStamp)},pe.prototype.touchcancel=function(){this.reset()},pe.prototype.enable=function(){this._enabled=!0},pe.prototype.disable=function(){this._enabled=!1,this.reset()},pe.prototype.isEnabled=function(){return this._enabled},pe.prototype.isActive=function(){return this._active};var Ml=function(h,v,p){this._el=h,this._mousePan=v,this._touchPan=p};Ml.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ml.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ml.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ml.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var eo=function(h,v,p){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=p};eo.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},eo.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},eo.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},eo.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var zs=function(h,v,p,g){this._el=h,this._touchZoom=v,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};zs.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},zs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},zs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},zs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},zs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},zs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Oo=function(h){return h.zoom||h.drag||h.pitch||h.rotate},_s=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(y.Event);function Un(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var Pn=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lf(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),y.bindAll(["handleEvent","handleWindowEvent"],this);var p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var w=S[g],R=w[0];L.addEventListener(R,w[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Pn.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var p=v[h],g=p[0];L.removeEventListener(g,p[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},Pn.prototype._addDefaultHandlers=function(h){var v=this._map,p=v.getCanvasContainer();this._add("mapEvent",new so(v,h));var g=v.boxZoom=new gs(v,h);this._add("boxZoom",g);var S=new xa,w=new Qs;v.doubleClickZoom=new F(w,S),this._add("tapZoom",S),this._add("clickZoom",w);var R=new pe;this._add("tapDragZoom",R);var P=v.touchPitch=new wc;this._add("touchPitch",P);var X=new of(h),te=new sf(h);v.dragRotate=new eo(h,X,te),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var ye=new ul(h),Ee=new bu(h);v.dragPan=new Ml(p,ye,Ee),this._add("mousePan",ye),this._add("touchPan",Ee,["touchZoom","touchRotate"]);var Ce=new pp,Xe=new ys;v.touchZoomRotate=new zs(p,Xe,Ce,R),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",Xe,["touchPan","touchRotate"]);var We=v.scrollZoom=new Me(v,this);this._add("scrollZoom",We,["mousePan"]);var ft=v.keyboard=new Ks;this._add("keyboard",ft),this._add("blockableMapEvent",new Rn(v));for(var Ue=0,ct=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ue<ct.length;Ue+=1){var Et=ct[Ue];h.interactive&&h[Et]&&v[Et].enable(h[Et])}},Pn.prototype._add=function(h,v,p){this._handlers.push({handlerName:h,handler:v,allowed:p}),this._handlersById[h]=v},Pn.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,p=this._handlers;v<p.length;v+=1)p[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},Pn.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},Pn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Pn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Pn.prototype.isMoving=function(){return!!Oo(this._eventsInProgress)||this.isZooming()},Pn.prototype._blockedByActive=function(h,v,p){for(var g in h)if(g!==p&&(!v||v.indexOf(g)<0))return!0;return!1},Pn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},Pn.prototype._getMapTouches=function(h){for(var v=[],p=0,g=h;p<g.length;p+=1){var S=g[p];this._el.contains(S.target)&&v.push(S)}return v},Pn.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var p=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},w={},R=h.touches?this._getMapTouches(h.touches):void 0,P=R?L.touchPos(this._el,R):L.mousePos(this._el,h),X=0,te=this._handlers;X<te.length;X+=1){var ye=te[X],Ee=ye.handlerName,Ce=ye.handler,Xe=ye.allowed;if(Ce.isEnabled()){var We=void 0;this._blockedByActive(w,Xe,Ee)?Ce.reset():Ce[v||h.type]&&(We=Ce[v||h.type](h,P,R),this.mergeHandlerResult(g,S,We,Ee,p),We&&We.needsRenderFrame&&this._triggerRenderFrame()),(We||Ce.isActive())&&(w[Ee]=Ce)}}var ft={};for(var Ue in this._previousActiveHandlers)w[Ue]||(ft[Ue]=p);this._previousActiveHandlers=w,(Object.keys(ft).length||Un(g))&&(this._changes.push([g,S,ft]),this._triggerRenderFrame()),(Object.keys(w).length||Un(g))&&this._map._stop(!0),this._updatingCamera=!1;var ct=g.cameraAnimation;ct&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ct(this._map))},Pn.prototype.mergeHandlerResult=function(h,v,p,g,S){if(p){y.extend(h,p);var w={handlerName:g,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(v.zoom=w),p.panDelta!==void 0&&(v.drag=w),p.pitchDelta!==void 0&&(v.pitch=w),p.bearingDelta!==void 0&&(v.rotate=w)}},Pn.prototype._applyChanges=function(){for(var h={},v={},p={},g=0,S=this._changes;g<S.length;g+=1){var w=S[g],R=w[0],P=w[1],X=w[2];R.panDelta&&(h.panDelta=(h.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(h.around=R.around),R.pinchAround!==void 0&&(h.pinchAround=R.pinchAround),R.noInertia&&(h.noInertia=R.noInertia),y.extend(v,P),y.extend(p,X)}this._updateMapTransform(h,v,p),this._changes=[]},Pn.prototype._updateMapTransform=function(h,v,p){var g=this._map,S=g.transform;if(!Un(h))return this._fireEvents(v,p,!0);var w=h.panDelta,R=h.zoomDelta,P=h.bearingDelta,X=h.pitchDelta,te=h.around,ye=h.pinchAround;ye!==void 0&&(te=ye),g._stop(!0),te=te||g.transform.centerPoint;var Ee=S.pointLocation(w?te.sub(w):te);P&&(S.bearing+=P),X&&(S.pitch+=X),R&&(S.zoom+=R),S.setLocationAtPoint(Ee,te),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,p,!0)},Pn.prototype._fireEvents=function(h,v,p){var g=this,S=Oo(this._eventsInProgress),w=Oo(h),R={};for(var P in h)this._eventsInProgress[P]||(R[P+"start"]=h[P].originalEvent),this._eventsInProgress[P]=h[P];for(var X in!S&&w&&this._fireEvent("movestart",w.originalEvent),R)this._fireEvent(X,R[X]);for(var te in w&&this._fireEvent("move",w.originalEvent),h)this._fireEvent(te,h[te].originalEvent);var ye,Ee={};for(var Ce in this._eventsInProgress){var Xe=this._eventsInProgress[Ce],We=Xe.handlerName,ft=Xe.originalEvent;this._handlersById[We].isActive()||(delete this._eventsInProgress[Ce],Ee[Ce+"end"]=ye=v[We]||ft)}for(var Ue in Ee)this._fireEvent(Ue,Ee[Ue]);var ct=Oo(this._eventsInProgress);if(p&&(S||w)&&!ct){this._updatingCamera=!0;var Et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),zt=function(or){return or!==0&&-g._bearingSnap<or&&or<g._bearingSnap};Et?(zt(Et.bearing||this._map.getBearing())&&(Et.bearing=0),this._map.easeTo(Et,{originalEvent:ye})):(this._map.fire(new y.Event("moveend",{originalEvent:ye})),zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Pn.prototype._fireEvent=function(h,v){this._map.fire(new y.Event(h,v?{originalEvent:v}:{}))},Pn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new _s("renderFrame",{timeStamp:v})),h._applyChanges()})},Pn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var cs=function(h){function v(p,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(p,g){return this.jumpTo({center:p},g)},v.prototype.panBy=function(p,g,S){return p=y.Point.convert(p).mult(-1),this.panTo(this.transform.center,y.extend({offset:p},g),S)},v.prototype.panTo=function(p,g,S){return this.easeTo(y.extend({center:p},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(p,g){return this.jumpTo({zoom:p},g),this},v.prototype.zoomTo=function(p,g,S){return this.easeTo(y.extend({zoom:p},g),S)},v.prototype.zoomIn=function(p,g){return this.zoomTo(this.getZoom()+1,p,g),this},v.prototype.zoomOut=function(p,g){return this.zoomTo(this.getZoom()-1,p,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(p,g){return this.jumpTo({bearing:p},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(p,g){return this.jumpTo({padding:p},g),this},v.prototype.rotateTo=function(p,g,S){return this.easeTo(y.extend({bearing:p},g),S)},v.prototype.resetNorth=function(p,g){return this.rotateTo(0,y.extend({duration:1e3},p),g),this},v.prototype.resetNorthPitch=function(p,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},p),g),this},v.prototype.snapToNorth=function(p,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(p,g){return this.jumpTo({pitch:p},g),this},v.prototype.cameraForBounds=function(p,g){p=y.LngLatBounds.convert(p);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(p,g,S,w){var R={top:0,bottom:0,right:0,left:0};if(typeof(w=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var P=w.padding;w.padding={top:P,bottom:P,right:P,left:P}}w.padding=y.extend(R,w.padding);var X=this.transform,te=X.padding,ye=X.project(y.LngLat.convert(p)),Ee=X.project(y.LngLat.convert(g)),Ce=ye.rotate(-S*Math.PI/180),Xe=Ee.rotate(-S*Math.PI/180),We=new y.Point(Math.max(Ce.x,Xe.x),Math.max(Ce.y,Xe.y)),ft=new y.Point(Math.min(Ce.x,Xe.x),Math.min(Ce.y,Xe.y)),Ue=We.sub(ft),ct=(X.width-(te.left+te.right+w.padding.left+w.padding.right))/Ue.x,Et=(X.height-(te.top+te.bottom+w.padding.top+w.padding.bottom))/Ue.y;if(!(Et<0||ct<0)){var zt=Math.min(X.scaleZoom(X.scale*Math.min(ct,Et)),w.maxZoom),or=typeof w.offset.x=="number"?new y.Point(w.offset.x,w.offset.y):y.Point.convert(w.offset),Qt=new y.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(S*Math.PI/180),fr=or.add(Qt).mult(X.scale/X.zoomScale(zt));return{center:X.unproject(ye.add(Ee).div(2).sub(fr)),zoom:zt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(p,g,S){return this._fitInternal(this.cameraForBounds(p,g),g,S)},v.prototype.fitScreenCoordinates=function(p,g,S,w,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(p)),this.transform.pointLocation(y.Point.convert(g)),S,w),w,R)},v.prototype._fitInternal=function(p,g,S){return p?(delete(g=y.extend(p,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(p,g){this.stop();var S=this.transform,w=!1,R=!1,P=!1;return"zoom"in p&&S.zoom!==+p.zoom&&(w=!0,S.zoom=+p.zoom),p.center!==void 0&&(S.center=y.LngLat.convert(p.center)),"bearing"in p&&S.bearing!==+p.bearing&&(R=!0,S.bearing=+p.bearing),"pitch"in p&&S.pitch!==+p.pitch&&(P=!0,S.pitch=+p.pitch),p.padding==null||S.isPaddingEqual(p.padding)||(S.padding=p.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),w&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),R&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),P&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},v.prototype.easeTo=function(p,g){var S=this;this._stop(!1,p.easeId),((p=y.extend({offset:[0,0],duration:500,easing:y.ease},p)).animate===!1||!p.essential&&y.browser.prefersReducedMotion)&&(p.duration=0);var w=this.transform,R=this.getZoom(),P=this.getBearing(),X=this.getPitch(),te=this.getPadding(),ye="zoom"in p?+p.zoom:R,Ee="bearing"in p?this._normalizeBearing(p.bearing,P):P,Ce="pitch"in p?+p.pitch:X,Xe="padding"in p?p.padding:w.padding,We=y.Point.convert(p.offset),ft=w.centerPoint.add(We),Ue=w.pointLocation(ft),ct=y.LngLat.convert(p.center||Ue);this._normalizeCenter(ct);var Et,zt,or=w.project(Ue),Qt=w.project(ct).sub(or),fr=w.zoomScale(ye-R);p.around&&(Et=y.LngLat.convert(p.around),zt=w.locationPoint(Et));var Ar={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==R,this._rotating=this._rotating||P!==Ee,this._pitching=this._pitching||Ce!==X,this._padding=!w.isPaddingEqual(Xe),this._easeId=p.easeId,this._prepareEase(g,p.noMoveStart,Ar),this._ease(function(Yr){if(S._zooming&&(w.zoom=y.number(R,ye,Yr)),S._rotating&&(w.bearing=y.number(P,Ee,Yr)),S._pitching&&(w.pitch=y.number(X,Ce,Yr)),S._padding&&(w.interpolatePadding(te,Xe,Yr),ft=w.centerPoint.add(We)),Et)w.setLocationAtPoint(Et,zt);else{var zr=w.zoomScale(w.zoom-R),_n=ye>R?Math.min(2,fr):Math.max(.5,fr),jn=Math.pow(_n,1-Yr),zn=w.unproject(or.add(Qt.mult(Yr*jn)).mult(zr));w.setLocationAtPoint(w.renderWorldCopies?zn.wrap():zn,ft)}S._fireMoveEvents(g)},function(Yr){S._afterEase(g,Yr)},p),this},v.prototype._prepareEase=function(p,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",p)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",p)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",p)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",p))},v.prototype._fireMoveEvents=function(p){this.fire(new y.Event("move",p)),this._zooming&&this.fire(new y.Event("zoom",p)),this._rotating&&this.fire(new y.Event("rotate",p)),this._pitching&&this.fire(new y.Event("pitch",p))},v.prototype._afterEase=function(p,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,w=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",p)),w&&this.fire(new y.Event("rotateend",p)),R&&this.fire(new y.Event("pitchend",p)),this.fire(new y.Event("moveend",p))}},v.prototype.flyTo=function(p,g){var S=this;if(!p.essential&&y.browser.prefersReducedMotion){var w=y.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,g)}this.stop(),p=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},p);var R=this.transform,P=this.getZoom(),X=this.getBearing(),te=this.getPitch(),ye=this.getPadding(),Ee="zoom"in p?y.clamp(+p.zoom,R.minZoom,R.maxZoom):P,Ce="bearing"in p?this._normalizeBearing(p.bearing,X):X,Xe="pitch"in p?+p.pitch:te,We="padding"in p?p.padding:R.padding,ft=R.zoomScale(Ee-P),Ue=y.Point.convert(p.offset),ct=R.centerPoint.add(Ue),Et=R.pointLocation(ct),zt=y.LngLat.convert(p.center||Et);this._normalizeCenter(zt);var or=R.project(Et),Qt=R.project(zt).sub(or),fr=p.curve,Ar=Math.max(R.width,R.height),Yr=Ar/ft,zr=Qt.mag();if("minZoom"in p){var _n=y.clamp(Math.min(p.minZoom,P,Ee),R.minZoom,R.maxZoom),jn=Ar/R.zoomScale(_n-P);fr=Math.sqrt(jn/zr*2)}var zn=fr*fr;function Hn(ni){var Kn=(Yr*Yr-Ar*Ar+(ni?-1:1)*zn*zn*zr*zr)/(2*(ni?Yr:Ar)*zn*zr);return Math.log(Math.sqrt(Kn*Kn+1)-Kn)}function Wi(ni){return(Math.exp(ni)-Math.exp(-ni))/2}function An(ni){return(Math.exp(ni)+Math.exp(-ni))/2}var ui=Hn(0),gi=function(ni){return An(ui)/An(ui+fr*ni)},oi=function(ni){return Ar*((An(ui)*(Wi(Kn=ui+fr*ni)/An(Kn))-Wi(ui))/zn)/zr;var Kn},ri=(Hn(1)-ui)/fr;if(Math.abs(zr)<1e-6||!isFinite(ri)){if(Math.abs(Ar-Yr)<1e-6)return this.easeTo(p,g);var vi=Yr<Ar?-1:1;ri=Math.abs(Math.log(Yr/Ar))/fr,oi=function(){return 0},gi=function(ni){return Math.exp(vi*fr*ni)}}return p.duration="duration"in p?+p.duration:1e3*ri/("screenSpeed"in p?+p.screenSpeed/fr:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=X!==Ce,this._pitching=Xe!==te,this._padding=!R.isPaddingEqual(We),this._prepareEase(g,!1),this._ease(function(ni){var Kn=ni*ri,ko=1/gi(Kn);R.zoom=ni===1?Ee:P+R.scaleZoom(ko),S._rotating&&(R.bearing=y.number(X,Ce,ni)),S._pitching&&(R.pitch=y.number(te,Xe,ni)),S._padding&&(R.interpolatePadding(ye,We,ni),ct=R.centerPoint.add(Ue));var to=ni===1?zt:R.unproject(or.add(Qt.mult(oi(Kn))).mult(ko));R.setLocationAtPoint(R.renderWorldCopies?to.wrap():to,ct),S._fireMoveEvents(g)},function(){return S._afterEase(g)},p),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(p,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!p){var w=this.handlers;w&&w.stop(!1)}return this},v.prototype._ease=function(p,g,S){S.animate===!1||S.duration===0?(p(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=p,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var p=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(p,g){p=y.wrap(p,-180,180);var S=Math.abs(p-g);return Math.abs(p-360-g)<S&&(p-=360),Math.abs(p+360-g)<S&&(p+=360),p},v.prototype._normalizeCenter=function(p){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=p.lng-g.center.lng;p.lng+=S>180?-360:S<-180?360:0}},v}(y.Evented),fs=function(h){h===void 0&&(h={}),this.options=h,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};fs.prototype.getDefaultPosition=function(){return"bottom-right"},fs.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},fs.prototype.onRemove=function(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},fs.prototype._setElementTitle=function(h,v){var p=this._map._getUIString("AttributionControl."+v);h.title=p,h.setAttribute("aria-label",p)},fs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},fs.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(h){var p=v.reduce(function(g,S,w){return S.value&&(g+=S.key+"="+S.value+(w<v.length-1?"&":"")),g},"?");h.href=y.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},fs.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},fs.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(P){return typeof P!="string"?"":P})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var p=this._map.style.sourceCaches;for(var g in p){var S=p[g];if(S.used){var w=S.getSource();w.attribution&&h.indexOf(w.attribution)<0&&h.push(w.attribution)}}h.sort(function(P,X){return P.length-X.length});var R=(h=h.filter(function(P,X){for(var te=X+1;te<h.length;te++)if(h[te].indexOf(P)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,h.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},fs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Eu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};Eu.prototype.onAdd=function(h){this._map=h,this._container=L.create("div","mapboxgl-ctrl");var v=L.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Eu.prototype.onRemove=function(){L.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Eu.prototype.getDefaultPosition=function(){return"bottom-left"},Eu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Eu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},Eu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Na=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Na.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Na.prototype.remove=function(h){for(var v=this._currentlyRunning,p=0,g=v?this._queue.concat(v):this._queue;p<g.length;p+=1){var S=g[p];if(S.id===h)return void(S.cancelled=!0)}},Na.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,g=v;p<g.length;p+=1){var S=g[p];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Na.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Js={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Su=y.window.HTMLImageElement,Au=y.window.HTMLElement,da=y.window.ImageBitmap,_o={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Rh=function(h){function v(g){var S=this;if((g=y.extend({},_o,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new zi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,w,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Na,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Js,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Au))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Pn(this,g),this._hash=g.hash&&new lu(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new fs({customAttribution:g.customAttribution})),this.addControl(new Eu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(w,R.firstChild):R.appendChild(w),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),w=S[0],R=S[1];if(w===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(w,R),this.transform.resize(w,R),this.painter.resize(w,R);var P=!this._moving;return P&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),P&&this.fire(new y.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,w){var R,P=this;if(g==="mouseenter"||g==="mouseover"){var X=!1;return{layer:S,listener:w,delegates:{mousemove:function(ye){var Ee=P.getLayer(S)?P.queryRenderedFeatures(ye.point,{layers:[S]}):[];Ee.length?X||(X=!0,w.call(P,new Xa(g,P,ye.originalEvent,{features:Ee}))):X=!1},mouseout:function(){X=!1}}}}if(g==="mouseleave"||g==="mouseout"){var te=!1;return{layer:S,listener:w,delegates:{mousemove:function(ye){(P.getLayer(S)?P.queryRenderedFeatures(ye.point,{layers:[S]}):[]).length?te=!0:te&&(te=!1,w.call(P,new Xa(g,P,ye.originalEvent)))},mouseout:function(ye){te&&(te=!1,w.call(P,new Xa(g,P,ye.originalEvent)))}}}}return{layer:S,listener:w,delegates:(R={},R[g]=function(ye){var Ee=P.getLayer(S)?P.queryRenderedFeatures(ye.point,{layers:[S]}):[];Ee.length&&(ye.features=Ee,w.call(P,ye),delete ye.features)},R)}},v.prototype.on=function(g,S,w){if(w===void 0)return h.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,w);for(var P in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(P,R.delegates[P]);return this},v.prototype.once=function(g,S,w){if(w===void 0)return h.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,w);for(var P in R.delegates)this.once(P,R.delegates[P]);return this},v.prototype.off=function(g,S,w){var R=this;return w===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(P){for(var X=P[g],te=0;te<X.length;te++){var ye=X[te];if(ye.layer===S&&ye.listener===w){for(var Ee in ye.delegates)R.off(Ee,ye.delegates[Ee]);return X.splice(te,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var w;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")w=[y.Point.convert(g)];else{var R=y.Point.convert(g[0]),P=y.Point.convert(g[1]);w=[R,new y.Point(P.x,R.y),P,new y.Point(R.x,P.y),R]}return this.style.queryRenderedFeatures(w,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Ls(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var w=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),P=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(P,function(X,te){X?w.fire(new y.ErrorEvent(X)):te&&w._updateDiff(te,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(w){y.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var w=g[S]._tiles;for(var R in w){var P=w[R];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,w)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,w){w===void 0&&(w={});var R=w.pixelRatio;R===void 0&&(R=1);var P=w.sdf;P===void 0&&(P=!1);var X=w.stretchX,te=w.stretchY,ye=w.content;if(this._lazyInitEmptyStyle(),S instanceof Su||da&&S instanceof da){var Ee=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:Ee.width,height:Ee.height},Ee.data),pixelRatio:R,stretchX:X,stretchY:te,content:ye,sdf:P,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ce=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:X,stretchY:te,content:ye,sdf:P,version:0,userImage:Ce}),Ce.onAdd&&Ce.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var w=this.style.getImage(g);if(!w)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof Su||da&&S instanceof da?y.browser.getImageData(S):S,P=R.width,X=R.height,te=R.data;return P===void 0||X===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):P!==w.data.width||X!==w.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(te,!(S instanceof Su||da&&S instanceof da)),void this.style.updateImage(g,w))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,w){return this.style.setLayerZoomRange(g,S,w),this._update(!0)},v.prototype.setFilter=function(g,S,w){return w===void 0&&(w={}),this.style.setFilter(g,S,w),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,w,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,w,R),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,w,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,w,R),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=L.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=L.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=L.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var R=this._controlContainer=L.create("div","mapboxgl-control-container",g),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(X){P[X]=L.create("div","mapboxgl-ctrl-"+X,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var w=y.browser.devicePixelRatio||1;this._canvas.width=w*g,this._canvas.height=w*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=y.extend({},ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new Ea(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,w=this,R=0,P=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=P.createQueryEXT(),P.beginQueryEXT(P.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var X=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,ye=y.browser.now();this.style.zoomHistory.update(te,ye);var Ee=new y.EvaluationParameters(te,{now:ye,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ce=Ee.crossFadingFactor();Ce===1&&Ce===this._crossFadingFactor||(X=!0,this._crossFadingFactor=Ce),this.style.update(Ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||X)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Xe=y.browser.now()-R;P.endQueryEXT(P.TIME_ELAPSED_EXT,S),setTimeout(function(){var Ue=P.getQueryObjectEXT(S,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(S),w.fire(new y.Event("gpu-timing-frame",{cpuTime:Xe,gpuTime:Ue}))},50)}if(this.listens("gpu-timing-layer")){var We=this.painter.collectGpuTimers();setTimeout(function(){var Ue=w.painter.queryGpuTimers(We);w.fire(new y.Event("gpu-timing-layer",{layerTimes:Ue}))},50)}var ft=this._sourcesDirty||this._styleDirty||this._placementDirty;return ft||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||ft||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Il(this._canvasContainer),Il(this._controlContainer),Il(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},p.version.get=function(){return y.version},Object.defineProperties(v.prototype,p),v}(cs);function Il(h){h.parentNode&&h.parentNode.removeChild(h)}var Zf={showCompass:!0,showZoom:!0,visualizePitch:!1},ll=function(h){var v=this;this.options=y.extend({},Zf,h),this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return v._map.zoomIn({},{originalEvent:p})}),L.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return v._map.zoomOut({},{originalEvent:p})}),L.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:p}):v._map.resetNorth({},{originalEvent:p})}),this._compassIcon=L.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ll.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),p=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},ll.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},ll.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bs(this._map,this._compass,this.options.visualizePitch)),this._container},ll.prototype.onRemove=function(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ll.prototype._createButton=function(h,v){var p=L.create("button",h,this._container);return p.type="button",p.addEventListener("click",v),p},ll.prototype._setButtonTitle=function(h,v){var p=this._map._getUIString("NavigationControl."+v);h.title=p,h.setAttribute("aria-label",p)};var bs=function(h,v,p){p===void 0&&(p=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new of({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,p&&(this.mousePitch=new sf({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),L.addEventListener(v,"mousedown",this.mousedown),L.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(v,"touchmove",this.touchmove),L.addEventListener(v,"touchend",this.touchend),L.addEventListener(v,"touchcancel",this.reset)};function ql(h,v,p){if(h=new y.LngLat(h.lng,h.lat),v){var g=new y.LngLat(h.lng-360,h.lat),S=new y.LngLat(h.lng+360,h.lat),w=p.locationPoint(h).distSqr(v);p.locationPoint(g).distSqr(v)<w?h=g:p.locationPoint(S).distSqr(v)<w&&(h=S)}for(;Math.abs(h.lng-p.center.lng)>180;){var R=p.locationPoint(h);if(R.x>=0&&R.y>=0&&R.x<=p.width&&R.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}bs.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),L.disableDrag()},bs.prototype.move=function(h,v){var p=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}},bs.prototype.off=function(){var h=this.element;L.removeEventListener(h,"mousedown",this.mousedown),L.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(h,"touchmove",this.touchmove),L.removeEventListener(h,"touchend",this.touchend),L.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},bs.prototype.offTemp=function(){L.enableDrag(),L.removeEventListener(y.window,"mousemove",this.mousemove),L.removeEventListener(y.window,"mouseup",this.mouseup)},bs.prototype.mousedown=function(h){this.down(y.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),L.mousePos(this.element,h)),L.addEventListener(y.window,"mousemove",this.mousemove),L.addEventListener(y.window,"mouseup",this.mouseup)},bs.prototype.mousemove=function(h){this.move(h,L.mousePos(this.element,h))},bs.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},bs.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},bs.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},bs.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},bs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vf(h,v,p){var g=h.classList;for(var S in Tu)g.remove("mapboxgl-"+p+"-anchor-"+S);g.add("mapboxgl-"+p+"-anchor-"+v)}var Cc,uf=function(h){function v(p,g){if(h.call(this),(p instanceof y.window.HTMLElement||g)&&(p=y.extend({element:p},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=y.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");var S=L.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var w=L.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var R=L.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var P=L.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");for(var X=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];X<te.length;X+=1){var ye=te[X],Ee=L.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",ye.rx),Ee.setAttributeNS(null,"ry",ye.ry),P.appendChild(Ee)}var Ce=L.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"fill",this._color);var Xe=L.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ce.appendChild(Xe);var We=L.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"opacity","0.25"),We.setAttributeNS(null,"fill","#000000");var ft=L.createNS("http://www.w3.org/2000/svg","path");ft.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),We.appendChild(ft);var Ue=L.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ue.setAttributeNS(null,"fill","#FFFFFF");var ct=L.createNS("http://www.w3.org/2000/svg","g");ct.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Et=L.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#000000"),Et.setAttributeNS(null,"opacity","0.25"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962");var zt=L.createNS("http://www.w3.org/2000/svg","circle");zt.setAttributeNS(null,"fill","#FFFFFF"),zt.setAttributeNS(null,"cx","5.5"),zt.setAttributeNS(null,"cy","5.5"),zt.setAttributeNS(null,"r","5.4999962"),ct.appendChild(Et),ct.appendChild(zt),R.appendChild(P),R.appendChild(Ce),R.appendChild(We),R.appendChild(Ue),R.appendChild(ct),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(or){or.preventDefault()}),this._element.addEventListener("mousedown",function(or){or.preventDefault()}),Vf(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(p){var g=p.code,S=p.charCode||p.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(p){var g=p.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},v.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ql(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,Tu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(p){return this._offset=y.Point.convert(p),this._update(),this},v.prototype._onMove=function(p){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(y.Evented),jf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Kl=0,Ql=!1,Mh=function(h){function v(p){h.call(this),this.options=y.extend({},jf,p),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){var g;return this._map=p,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Cc!==void 0?g(Cc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Cc=S.state!=="denied")}):g(Cc=!!y.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Kl=0,Ql=!1},v.prototype._isOutOfMapMaxBounds=function(p){var g=this._map.getMaxBounds(),S=p.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",p)),this._finish()}},v.prototype._updateCamera=function(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude),S=p.coords.accuracy,w=this._map.getBearing(),R=y.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},v.prototype._updateMarker=function(p){if(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,g=this._map.unproject([0,p]),S=this._map.unproject([1,p]),w=g.distanceTo(S),R=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&Ql)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",p)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(p){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=L.create("button","mapboxgl-ctrl-geolocate",this._container),L.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new uf(this._dotElement),this._circleElement=L.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Kl--,Ql=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Kl>1?(p={maximumAge:6e5,timeout:0},Ql=!0):(p=this.options.positionOptions,Ql=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(y.Evented),hs={maxWidth:100,unit:"metric"},wu=function(h){this.options=y.extend({},hs,h),y.bindAll(["_onMove","setUnit"],this)};function lf(h,v,p){var g=p&&p.maxWidth||100,S=h._container.clientHeight/2,w=h.unproject([0,S]),R=h.unproject([g,S]),P=w.distanceTo(R);if(p&&p.unit==="imperial"){var X=3.2808*P;X>5280?Pl(v,g,X/5280,h._getUIString("ScaleControl.Miles")):Pl(v,g,X,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?Pl(v,g,P/1852,h._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Pl(v,g,P/1e3,h._getUIString("ScaleControl.Kilometers")):Pl(v,g,P,h._getUIString("ScaleControl.Meters"))}function Pl(h,v,p,g){var S,w,R,P=(S=p,(w=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/w)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(X){var te=Math.pow(10,Math.ceil(-Math.log(X)/Math.LN10));return Math.round(X*te)/te}(R)));h.style.width=v*(P/p)+"px",h.innerHTML=P+"&nbsp;"+g}wu.prototype.getDefaultPosition=function(){return"bottom-left"},wu.prototype._onMove=function(){lf(this._map,this._container,this.options)},wu.prototype.onAdd=function(h){return this._map=h,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},wu.prototype.onRemove=function(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},wu.prototype.setUnit=function(h){this.options.unit=h,lf(this._map,this._container,this.options)};var cu=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof y.window.HTMLElement?this._container=h.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};cu.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},cu.prototype.onRemove=function(){L.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},cu.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},cu.prototype._setupUI=function(){var h=this._fullscreenButton=L.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},cu.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},cu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},cu.prototype._isFullscreen=function(){return this._fullscreen},cu.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},cu.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ih={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Hf=function(h){function v(p){h.call(this),this.options=y.extend(Object.create(Ih),p),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(p){return this.setDOMContent(y.window.document.createTextNode(p))},v.prototype.setHTML=function(p){var g,S=y.window.document.createDocumentFragment(),w=y.window.document.createElement("body");for(w.innerHTML=p;g=w.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},v.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},v.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},v.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},v.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=L.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(p){this._update(p.point)},v.prototype._onMouseMove=function(p){this._update(p.point)},v.prototype._onDrag=function(p){this._update(p.point)},v.prototype._update=function(p){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=L.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=L.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ee){return g._container.classList.add(Ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ql(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var S=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),w=this.options.anchor,R=function Ee(Ce){if(Ce){if(typeof Ce=="number"){var Xe=Math.round(Math.sqrt(.5*Math.pow(Ce,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ce),"top-left":new y.Point(Xe,Xe),"top-right":new y.Point(-Xe,Xe),bottom:new y.Point(0,-Ce),"bottom-left":new y.Point(Xe,-Xe),"bottom-right":new y.Point(-Xe,-Xe),left:new y.Point(Ce,0),right:new y.Point(-Ce,0)}}if(Ce instanceof y.Point||Array.isArray(Ce)){var We=y.Point.convert(Ce);return{center:We,top:We,"top-left":We,"top-right":We,bottom:We,"bottom-left":We,"bottom-right":We,left:We,right:We}}return{center:y.Point.convert(Ce.center||[0,0]),top:y.Point.convert(Ce.top||[0,0]),"top-left":y.Point.convert(Ce["top-left"]||[0,0]),"top-right":y.Point.convert(Ce["top-right"]||[0,0]),bottom:y.Point.convert(Ce.bottom||[0,0]),"bottom-left":y.Point.convert(Ce["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ce["bottom-right"]||[0,0]),left:y.Point.convert(Ce.left||[0,0]),right:y.Point.convert(Ce.right||[0,0])}}return Ee(new y.Point(0,0))}(this.options.offset);if(!w){var P,X=this._container.offsetWidth,te=this._container.offsetHeight;P=S.y+R.bottom.y<te?["top"]:S.y>this._map.transform.height-te?["bottom"]:[],S.x<X/2?P.push("left"):S.x>this._map.transform.width-X/2&&P.push("right"),w=P.length===0?"bottom":P.join("-")}var ye=S.add(R[w]).round();L.setTransform(this._container,Tu[w]+" translate("+ye.x+"px,"+ye.y+"px)"),Vf(this._container,w,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(Hu);p&&p.focus()}},v.prototype._onClose=function(){this.remove()},v}(y.Evented),Ph={version:y.version,supported:ce,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Rh,NavigationControl:ll,GeolocateControl:Mh,AttributionControl:fs,ScaleControl:wu,FullscreenControl:cu,Popup:Hf,Marker:uf,Style:Ls,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){nr().acquire(Kt)},clearPrewarmedResources:function(){var h=sn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Kt),sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(h){y.config.ACCESS_TOKEN=h},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(h){y.config.API_URL=h},get workerCount(){return xr.workerCount},set workerCount(h){xr.workerCount=h},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){y.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){y.clearTileCache(h)},workerUrl:""};return Ph}),ne})},3614:function(Ht,re,B){"use strict";Ht.exports=de;var ne=B(80645);function de(ee){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ee)?ee:new Uint8Array(ee||0),this.pos=0,this.type=0,this.length=this.buf.length}de.Varint=0,de.Fixed64=1,de.Bytes=2,de.Fixed32=5;var y=65536*65536,ce=1/y,L=12,ue=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");de.prototype={destroy:function(){this.buf=null},readFields:function(ee,V,Q){for(Q=Q||this.length;this.pos<Q;){var Re=this.readVarint(),xe=Re>>3,nt=this.pos;this.type=Re&7,ee(xe,V,this),this.pos===nt&&this.skip(Re)}return V},readMessage:function(ee,V){return this.readFields(ee,V,this.readVarint()+this.pos)},readFixed32:function(){var ee=ut(this.buf,this.pos);return this.pos+=4,ee},readSFixed32:function(){var ee=At(this.buf,this.pos);return this.pos+=4,ee},readFixed64:function(){var ee=ut(this.buf,this.pos)+ut(this.buf,this.pos+4)*y;return this.pos+=8,ee},readSFixed64:function(){var ee=ut(this.buf,this.pos)+At(this.buf,this.pos+4)*y;return this.pos+=8,ee},readFloat:function(){var ee=ne.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ee},readDouble:function(){var ee=ne.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ee},readVarint:function(ee){var V=this.buf,Q,Re;return Re=V[this.pos++],Q=Re&127,Re<128||(Re=V[this.pos++],Q|=(Re&127)<<7,Re<128)||(Re=V[this.pos++],Q|=(Re&127)<<14,Re<128)||(Re=V[this.pos++],Q|=(Re&127)<<21,Re<128)?Q:(Re=V[this.pos],Q|=(Re&15)<<28,oe(Q,ee,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ee=this.readVarint();return ee%2===1?(ee+1)/-2:ee/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ee=this.readVarint()+this.pos,V=this.pos;return this.pos=ee,ee-V>=L&&ue?Zt(this.buf,V,ee):Fe(this.buf,V,ee)},readBytes:function(){var ee=this.readVarint()+this.pos,V=this.buf.subarray(this.pos,ee);return this.pos=ee,V},readPackedVarint:function(ee,V){if(this.type!==de.Bytes)return ee.push(this.readVarint(V));var Q=Be(this);for(ee=ee||[];this.pos<Q;)ee.push(this.readVarint(V));return ee},readPackedSVarint:function(ee){if(this.type!==de.Bytes)return ee.push(this.readSVarint());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readSVarint());return ee},readPackedBoolean:function(ee){if(this.type!==de.Bytes)return ee.push(this.readBoolean());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readBoolean());return ee},readPackedFloat:function(ee){if(this.type!==de.Bytes)return ee.push(this.readFloat());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readFloat());return ee},readPackedDouble:function(ee){if(this.type!==de.Bytes)return ee.push(this.readDouble());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readDouble());return ee},readPackedFixed32:function(ee){if(this.type!==de.Bytes)return ee.push(this.readFixed32());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readFixed32());return ee},readPackedSFixed32:function(ee){if(this.type!==de.Bytes)return ee.push(this.readSFixed32());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readSFixed32());return ee},readPackedFixed64:function(ee){if(this.type!==de.Bytes)return ee.push(this.readFixed64());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readFixed64());return ee},readPackedSFixed64:function(ee){if(this.type!==de.Bytes)return ee.push(this.readSFixed64());var V=Be(this);for(ee=ee||[];this.pos<V;)ee.push(this.readSFixed64());return ee},skip:function(ee){var V=ee&7;if(V===de.Varint)for(;this.buf[this.pos++]>127;);else if(V===de.Bytes)this.pos=this.readVarint()+this.pos;else if(V===de.Fixed32)this.pos+=4;else if(V===de.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+V)},writeTag:function(ee,V){this.writeVarint(ee<<3|V)},realloc:function(ee){for(var V=this.length||16;V<this.pos+ee;)V*=2;if(V!==this.length){var Q=new Uint8Array(V);Q.set(this.buf),this.buf=Q,this.length=V}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ee){this.realloc(4),we(this.buf,ee,this.pos),this.pos+=4},writeSFixed32:function(ee){this.realloc(4),we(this.buf,ee,this.pos),this.pos+=4},writeFixed64:function(ee){this.realloc(8),we(this.buf,ee&-1,this.pos),we(this.buf,Math.floor(ee*ce),this.pos+4),this.pos+=8},writeSFixed64:function(ee){this.realloc(8),we(this.buf,ee&-1,this.pos),we(this.buf,Math.floor(ee*ce),this.pos+4),this.pos+=8},writeVarint:function(ee){if(ee=+ee||0,ee>268435455||ee<0){ze(ee,this);return}this.realloc(4),this.buf[this.pos++]=ee&127|(ee>127?128:0),!(ee<=127)&&(this.buf[this.pos++]=(ee>>>=7)&127|(ee>127?128:0),!(ee<=127)&&(this.buf[this.pos++]=(ee>>>=7)&127|(ee>127?128:0),!(ee<=127)&&(this.buf[this.pos++]=ee>>>7&127)))},writeSVarint:function(ee){this.writeVarint(ee<0?-ee*2-1:ee*2)},writeBoolean:function(ee){this.writeVarint(!!ee)},writeString:function(ee){ee=String(ee),this.realloc(ee.length*4),this.pos++;var V=this.pos;this.pos=vr(this.buf,ee,this.pos);var Q=this.pos-V;Q>=128&&Rt(V,Q,this),this.pos=V-1,this.writeVarint(Q),this.pos+=Q},writeFloat:function(ee){this.realloc(4),ne.write(this.buf,ee,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ee){this.realloc(8),ne.write(this.buf,ee,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ee){var V=ee.length;this.writeVarint(V),this.realloc(V);for(var Q=0;Q<V;Q++)this.buf[this.pos++]=ee[Q]},writeRawMessage:function(ee,V){this.pos++;var Q=this.pos;ee(V,this);var Re=this.pos-Q;Re>=128&&Rt(Q,Re,this),this.pos=Q-1,this.writeVarint(Re),this.pos+=Re},writeMessage:function(ee,V,Q){this.writeTag(ee,de.Bytes),this.writeRawMessage(V,Q)},writePackedVarint:function(ee,V){V.length&&this.writeMessage(ee,St,V)},writePackedSVarint:function(ee,V){V.length&&this.writeMessage(ee,Nt,V)},writePackedBoolean:function(ee,V){V.length&&this.writeMessage(ee,pt,V)},writePackedFloat:function(ee,V){V.length&&this.writeMessage(ee,Pt,V)},writePackedDouble:function(ee,V){V.length&&this.writeMessage(ee,Ct,V)},writePackedFixed32:function(ee,V){V.length&&this.writeMessage(ee,mt,V)},writePackedSFixed32:function(ee,V){V.length&&this.writeMessage(ee,pr,V)},writePackedFixed64:function(ee,V){V.length&&this.writeMessage(ee,gr,V)},writePackedSFixed64:function(ee,V){V.length&&this.writeMessage(ee,lr,V)},writeBytesField:function(ee,V){this.writeTag(ee,de.Bytes),this.writeBytes(V)},writeFixed32Field:function(ee,V){this.writeTag(ee,de.Fixed32),this.writeFixed32(V)},writeSFixed32Field:function(ee,V){this.writeTag(ee,de.Fixed32),this.writeSFixed32(V)},writeFixed64Field:function(ee,V){this.writeTag(ee,de.Fixed64),this.writeFixed64(V)},writeSFixed64Field:function(ee,V){this.writeTag(ee,de.Fixed64),this.writeSFixed64(V)},writeVarintField:function(ee,V){this.writeTag(ee,de.Varint),this.writeVarint(V)},writeSVarintField:function(ee,V){this.writeTag(ee,de.Varint),this.writeSVarint(V)},writeStringField:function(ee,V){this.writeTag(ee,de.Bytes),this.writeString(V)},writeFloatField:function(ee,V){this.writeTag(ee,de.Fixed32),this.writeFloat(V)},writeDoubleField:function(ee,V){this.writeTag(ee,de.Fixed64),this.writeDouble(V)},writeBooleanField:function(ee,V){this.writeVarintField(ee,!!V)}};function oe(ee,V,Q){var Re=Q.buf,xe,nt;if(nt=Re[Q.pos++],xe=(nt&112)>>4,nt<128||(nt=Re[Q.pos++],xe|=(nt&127)<<3,nt<128)||(nt=Re[Q.pos++],xe|=(nt&127)<<10,nt<128)||(nt=Re[Q.pos++],xe|=(nt&127)<<17,nt<128)||(nt=Re[Q.pos++],xe|=(nt&127)<<24,nt<128)||(nt=Re[Q.pos++],xe|=(nt&1)<<31,nt<128))return se(ee,xe,V);throw new Error("Expected varint not more than 10 bytes")}function Be(ee){return ee.type===de.Bytes?ee.readVarint()+ee.pos:ee.pos+1}function se(ee,V,Q){return Q?V*4294967296+(ee>>>0):(V>>>0)*4294967296+(ee>>>0)}function ze(ee,V){var Q,Re;if(ee>=0?(Q=ee%4294967296|0,Re=ee/4294967296|0):(Q=~(-ee%4294967296),Re=~(-ee/4294967296),Q^4294967295?Q=Q+1|0:(Q=0,Re=Re+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");V.realloc(10),Ge(Q,Re,V),Ke(Re,V)}function Ge(ee,V,Q){Q.buf[Q.pos++]=ee&127|128,ee>>>=7,Q.buf[Q.pos++]=ee&127|128,ee>>>=7,Q.buf[Q.pos++]=ee&127|128,ee>>>=7,Q.buf[Q.pos++]=ee&127|128,ee>>>=7,Q.buf[Q.pos]=ee&127}function Ke(ee,V){var Q=(ee&7)<<4;V.buf[V.pos++]|=Q|((ee>>>=3)?128:0),ee&&(V.buf[V.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(V.buf[V.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(V.buf[V.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(V.buf[V.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(V.buf[V.pos++]=ee&127)))))}function Rt(ee,V,Q){var Re=V<=16383?1:V<=2097151?2:V<=268435455?3:Math.floor(Math.log(V)/(Math.LN2*7));Q.realloc(Re);for(var xe=Q.pos-1;xe>=ee;xe--)Q.buf[xe+Re]=Q.buf[xe]}function St(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeVarint(ee[Q])}function Nt(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeSVarint(ee[Q])}function Pt(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeFloat(ee[Q])}function Ct(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeDouble(ee[Q])}function pt(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeBoolean(ee[Q])}function mt(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeFixed32(ee[Q])}function pr(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeSFixed32(ee[Q])}function gr(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeFixed64(ee[Q])}function lr(ee,V){for(var Q=0;Q<ee.length;Q++)V.writeSFixed64(ee[Q])}function ut(ee,V){return(ee[V]|ee[V+1]<<8|ee[V+2]<<16)+ee[V+3]*16777216}function we(ee,V,Q){ee[Q]=V,ee[Q+1]=V>>>8,ee[Q+2]=V>>>16,ee[Q+3]=V>>>24}function At(ee,V){return(ee[V]|ee[V+1]<<8|ee[V+2]<<16)+(ee[V+3]<<24)}function Fe(ee,V,Q){for(var Re="",xe=V;xe<Q;){var nt=ee[xe],Le=null,Ye=nt>239?4:nt>223?3:nt>191?2:1;if(xe+Ye>Q)break;var rt,Tt,dr;Ye===1?nt<128&&(Le=nt):Ye===2?(rt=ee[xe+1],(rt&192)===128&&(Le=(nt&31)<<6|rt&63,Le<=127&&(Le=null))):Ye===3?(rt=ee[xe+1],Tt=ee[xe+2],(rt&192)===128&&(Tt&192)===128&&(Le=(nt&15)<<12|(rt&63)<<6|Tt&63,(Le<=2047||Le>=55296&&Le<=57343)&&(Le=null))):Ye===4&&(rt=ee[xe+1],Tt=ee[xe+2],dr=ee[xe+3],(rt&192)===128&&(Tt&192)===128&&(dr&192)===128&&(Le=(nt&15)<<18|(rt&63)<<12|(Tt&63)<<6|dr&63,(Le<=65535||Le>=1114112)&&(Le=null))),Le===null?(Le=65533,Ye=1):Le>65535&&(Le-=65536,Re+=String.fromCharCode(Le>>>10&1023|55296),Le=56320|Le&1023),Re+=String.fromCharCode(Le),xe+=Ye}return Re}function Zt(ee,V,Q){return ue.decode(ee.subarray(V,Q))}function vr(ee,V,Q){for(var Re=0,xe,nt;Re<V.length;Re++){if(xe=V.charCodeAt(Re),xe>55295&&xe<57344)if(nt)if(xe<56320){ee[Q++]=239,ee[Q++]=191,ee[Q++]=189,nt=xe;continue}else xe=nt-55296<<10|xe-56320|65536,nt=null;else{xe>56319||Re+1===V.length?(ee[Q++]=239,ee[Q++]=191,ee[Q++]=189):nt=xe;continue}else nt&&(ee[Q++]=239,ee[Q++]=191,ee[Q++]=189,nt=null);xe<128?ee[Q++]=xe:(xe<2048?ee[Q++]=xe>>6|192:(xe<65536?ee[Q++]=xe>>12|224:(ee[Q++]=xe>>18|240,ee[Q++]=xe>>12&63|128),ee[Q++]=xe>>6&63|128),ee[Q++]=xe&63|128)}return Q}},32676:function(Ht,re,B){var ne=B(34155);(function(de,y){Ht.exports=y()})(this,function(){"use strict";function de(fe,k){var z={label:0,sent:function(){if(De[0]&1)throw De[1];return De[1]},trys:[],ops:[]},le,Se,De,$t;return $t={next:Dt(0),throw:Dt(1),return:Dt(2)},typeof Symbol=="function"&&($t[Symbol.iterator]=function(){return this}),$t;function Dt(yt){return function(U){return Bt([yt,U])}}function Bt(yt){if(le)throw new TypeError("Generator is already executing.");for(;z;)try{if(le=1,Se&&(De=yt[0]&2?Se.return:yt[0]?Se.throw||((De=Se.return)&&De.call(Se),0):Se.next)&&!(De=De.call(Se,yt[1])).done)return De;switch(Se=0,De&&(yt=[yt[0]&2,De.value]),yt[0]){case 0:case 1:De=yt;break;case 4:return z.label++,{value:yt[1],done:!1};case 5:z.label++,Se=yt[1],yt=[0];continue;case 7:yt=z.ops.pop(),z.trys.pop();continue;default:if(De=z.trys,!(De=De.length>0&&De[De.length-1])&&(yt[0]===6||yt[0]===2)){z=0;continue}if(yt[0]===3&&(!De||yt[1]>De[0]&&yt[1]<De[3])){z.label=yt[1];break}if(yt[0]===6&&z.label<De[1]){z.label=De[1],De=yt;break}if(De&&z.label<De[2]){z.label=De[2],z.ops.push(yt);break}De[2]&&z.ops.pop(),z.trys.pop();continue}yt=k.call(fe,z)}catch(U){yt=[6,U],Se=0}finally{le=De=0}if(yt[0]&5)throw yt[1];return{value:yt[0]?yt[1]:void 0,done:!0}}}var y=function(){function fe(k,z){this.next=null,this.key=k,this.data=z,this.left=null,this.right=null}return fe}();function ce(fe,k){return fe>k?1:fe<k?-1:0}function L(fe,k,z){for(var le=new y(null,null),Se=le,De=le;;){var $t=z(fe,k.key);if($t<0){if(k.left===null)break;if(z(fe,k.left.key)<0){var Dt=k.left;if(k.left=Dt.right,Dt.right=k,k=Dt,k.left===null)break}De.left=k,De=k,k=k.left}else if($t>0){if(k.right===null)break;if(z(fe,k.right.key)>0){var Dt=k.right;if(k.right=Dt.left,Dt.left=k,k=Dt,k.right===null)break}Se.right=k,Se=k,k=k.right}else break}return Se.right=k.left,De.left=k.right,k.left=le.right,k.right=le.left,k}function ue(fe,k,z,le){var Se=new y(fe,k);if(z===null)return Se.left=Se.right=null,Se;z=L(fe,z,le);var De=le(fe,z.key);return De<0?(Se.left=z.left,Se.right=z,z.left=null):De>=0&&(Se.right=z.right,Se.left=z,z.right=null),Se}function oe(fe,k,z){var le=null,Se=null;if(k){k=L(fe,k,z);var De=z(k.key,fe);De===0?(le=k.left,Se=k.right):De<0?(Se=k.right,k.right=null,le=k):(le=k.left,k.left=null,Se=k)}return{left:le,right:Se}}function Be(fe,k,z){return k===null?fe:(fe===null||(k=L(fe.key,k,z),k.left=fe),k)}function se(fe,k,z,le,Se){if(fe){le(""+k+(z?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Se(fe)+`
`);var De=k+(z?"    ":"\u2502   ");fe.left&&se(fe.left,De,!1,le,Se),fe.right&&se(fe.right,De,!0,le,Se)}}var ze=function(){function fe(k){k===void 0&&(k=ce),this._root=null,this._size=0,this._comparator=k}return fe.prototype.insert=function(k,z){return this._size++,this._root=ue(k,z,this._root,this._comparator)},fe.prototype.add=function(k,z){var le=new y(k,z);this._root===null&&(le.left=le.right=null,this._size++,this._root=le);var Se=this._comparator,De=L(k,this._root,Se),$t=Se(k,De.key);return $t===0?this._root=De:($t<0?(le.left=De.left,le.right=De,De.left=null):$t>0&&(le.right=De.right,le.left=De,De.right=null),this._size++,this._root=le),this._root},fe.prototype.remove=function(k){this._root=this._remove(k,this._root,this._comparator)},fe.prototype._remove=function(k,z,le){var Se;if(z===null)return null;z=L(k,z,le);var De=le(k,z.key);return De===0?(z.left===null?Se=z.right:(Se=L(k,z.left,le),Se.right=z.right),this._size--,Se):z},fe.prototype.pop=function(){var k=this._root;if(k){for(;k.left;)k=k.left;return this._root=L(k.key,this._root,this._comparator),this._root=this._remove(k.key,this._root,this._comparator),{key:k.key,data:k.data}}return null},fe.prototype.findStatic=function(k){for(var z=this._root,le=this._comparator;z;){var Se=le(k,z.key);if(Se===0)return z;Se<0?z=z.left:z=z.right}return null},fe.prototype.find=function(k){return this._root&&(this._root=L(k,this._root,this._comparator),this._comparator(k,this._root.key)!==0)?null:this._root},fe.prototype.contains=function(k){for(var z=this._root,le=this._comparator;z;){var Se=le(k,z.key);if(Se===0)return!0;Se<0?z=z.left:z=z.right}return!1},fe.prototype.forEach=function(k,z){for(var le=this._root,Se=[],De=!1;!De;)le!==null?(Se.push(le),le=le.left):Se.length!==0?(le=Se.pop(),k.call(z,le),le=le.right):De=!0;return this},fe.prototype.range=function(k,z,le,Se){for(var De=[],$t=this._comparator,Dt=this._root,Bt;De.length!==0||Dt;)if(Dt)De.push(Dt),Dt=Dt.left;else{if(Dt=De.pop(),Bt=$t(Dt.key,z),Bt>0)break;if($t(Dt.key,k)>=0&&le.call(Se,Dt))return this;Dt=Dt.right}return this},fe.prototype.keys=function(){var k=[];return this.forEach(function(z){var le=z.key;return k.push(le)}),k},fe.prototype.values=function(){var k=[];return this.forEach(function(z){var le=z.data;return k.push(le)}),k},fe.prototype.min=function(){return this._root?this.minNode(this._root).key:null},fe.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},fe.prototype.minNode=function(k){if(k===void 0&&(k=this._root),k)for(;k.left;)k=k.left;return k},fe.prototype.maxNode=function(k){if(k===void 0&&(k=this._root),k)for(;k.right;)k=k.right;return k},fe.prototype.at=function(k){for(var z=this._root,le=!1,Se=0,De=[];!le;)if(z)De.push(z),z=z.left;else if(De.length>0){if(z=De.pop(),Se===k)return z;Se++,z=z.right}else le=!0;return null},fe.prototype.next=function(k){var z=this._root,le=null;if(k.right){for(le=k.right;le.left;)le=le.left;return le}for(var Se=this._comparator;z;){var De=Se(k.key,z.key);if(De===0)break;De<0?(le=z,z=z.left):z=z.right}return le},fe.prototype.prev=function(k){var z=this._root,le=null;if(k.left!==null){for(le=k.left;le.right;)le=le.right;return le}for(var Se=this._comparator;z;){var De=Se(k.key,z.key);if(De===0)break;De<0?z=z.left:(le=z,z=z.right)}return le},fe.prototype.clear=function(){return this._root=null,this._size=0,this},fe.prototype.toList=function(){return Rt(this._root)},fe.prototype.load=function(k,z,le){z===void 0&&(z=[]),le===void 0&&(le=!1);var Se=k.length,De=this._comparator;if(le&&Pt(k,z,0,Se-1,De),this._root===null)this._root=Ge(k,z,0,Se),this._size=Se;else{var $t=Nt(this.toList(),Ke(k,z),De);Se=this._size+Se,this._root=St({head:$t},0,Se)}return this},fe.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(fe.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),fe.prototype.toString=function(k){k===void 0&&(k=function(le){return String(le.key)});var z=[];return se(this._root,"",!0,function(le){return z.push(le)},k),z.join("")},fe.prototype.update=function(k,z,le){var Se=this._comparator,De=oe(k,this._root,Se),$t=De.left,Dt=De.right;Se(k,z)<0?Dt=ue(z,le,Dt,Se):$t=ue(z,le,$t,Se),this._root=Be($t,Dt,Se)},fe.prototype.split=function(k){return oe(k,this._root,this._comparator)},fe.prototype[Symbol.iterator]=function(){var k,z,le;return de(this,function(Se){switch(Se.label){case 0:k=this._root,z=[],le=!1,Se.label=1;case 1:return le?[3,6]:k===null?[3,2]:(z.push(k),k=k.left,[3,5]);case 2:return z.length===0?[3,4]:(k=z.pop(),[4,k]);case 3:return Se.sent(),k=k.right,[3,5];case 4:le=!0,Se.label=5;case 5:return[3,1];case 6:return[2]}})},fe}();function Ge(fe,k,z,le){var Se=le-z;if(Se>0){var De=z+Math.floor(Se/2),$t=fe[De],Dt=k[De],Bt=new y($t,Dt);return Bt.left=Ge(fe,k,z,De),Bt.right=Ge(fe,k,De+1,le),Bt}return null}function Ke(fe,k){for(var z=new y(null,null),le=z,Se=0;Se<fe.length;Se++)le=le.next=new y(fe[Se],k[Se]);return le.next=null,z.next}function Rt(fe){for(var k=fe,z=[],le=!1,Se=new y(null,null),De=Se;!le;)k?(z.push(k),k=k.left):z.length>0?(k=De=De.next=z.pop(),k=k.right):le=!0;return De.next=null,Se.next}function St(fe,k,z){var le=z-k;if(le>0){var Se=k+Math.floor(le/2),De=St(fe,k,Se),$t=fe.head;return $t.left=De,fe.head=fe.head.next,$t.right=St(fe,Se+1,z),$t}return null}function Nt(fe,k,z){for(var le=new y(null,null),Se=le,De=fe,$t=k;De!==null&&$t!==null;)z(De.key,$t.key)<0?(Se.next=De,De=De.next):(Se.next=$t,$t=$t.next),Se=Se.next;return De!==null?Se.next=De:$t!==null&&(Se.next=$t),le.next}function Pt(fe,k,z,le,Se){if(!(z>=le)){for(var De=fe[z+le>>1],$t=z-1,Dt=le+1;;){do $t++;while(Se(fe[$t],De)<0);do Dt--;while(Se(fe[Dt],De)>0);if($t>=Dt)break;var Bt=fe[$t];fe[$t]=fe[Dt],fe[Dt]=Bt,Bt=k[$t],k[$t]=k[Dt],k[Dt]=Bt}Pt(fe,k,z,Dt,Se),Pt(fe,k,Dt+1,le,Se)}}const Ct=(fe,k)=>fe.ll.x<=k.x&&k.x<=fe.ur.x&&fe.ll.y<=k.y&&k.y<=fe.ur.y,pt=(fe,k)=>{if(k.ur.x<fe.ll.x||fe.ur.x<k.ll.x||k.ur.y<fe.ll.y||fe.ur.y<k.ll.y)return null;const z=fe.ll.x<k.ll.x?k.ll.x:fe.ll.x,le=fe.ur.x<k.ur.x?fe.ur.x:k.ur.x,Se=fe.ll.y<k.ll.y?k.ll.y:fe.ll.y,De=fe.ur.y<k.ur.y?fe.ur.y:k.ur.y;return{ll:{x:z,y:Se},ur:{x:le,y:De}}};let mt=Number.EPSILON;mt===void 0&&(mt=Math.pow(2,-52));const pr=mt*mt,gr=(fe,k)=>{if(-mt<fe&&fe<mt&&-mt<k&&k<mt)return 0;const z=fe-k;return z*z<pr*fe*k?0:fe<k?-1:1};class lr{constructor(){this.reset()}reset(){this.xRounder=new ut,this.yRounder=new ut}round(k,z){return{x:this.xRounder.round(k),y:this.yRounder.round(z)}}}class ut{constructor(){this.tree=new ze,this.round(0)}round(k){const z=this.tree.add(k),le=this.tree.prev(z);if(le!==null&&gr(z.key,le.key)===0)return this.tree.remove(k),le.key;const Se=this.tree.next(z);return Se!==null&&gr(z.key,Se.key)===0?(this.tree.remove(k),Se.key):k}}const we=new lr,At=11102230246251565e-32,Fe=134217729,Zt=(3+8*At)*At;function vr(fe,k,z,le,Se){let De,$t,Dt,Bt,yt=k[0],U=le[0],N=0,$=0;U>yt==U>-yt?(De=yt,yt=k[++N]):(De=U,U=le[++$]);let ae=0;if(N<fe&&$<z)for(U>yt==U>-yt?($t=yt+De,Dt=De-($t-yt),yt=k[++N]):($t=U+De,Dt=De-($t-U),U=le[++$]),De=$t,Dt!==0&&(Se[ae++]=Dt);N<fe&&$<z;)U>yt==U>-yt?($t=De+yt,Bt=$t-De,Dt=De-($t-Bt)+(yt-Bt),yt=k[++N]):($t=De+U,Bt=$t-De,Dt=De-($t-Bt)+(U-Bt),U=le[++$]),De=$t,Dt!==0&&(Se[ae++]=Dt);for(;N<fe;)$t=De+yt,Bt=$t-De,Dt=De-($t-Bt)+(yt-Bt),yt=k[++N],De=$t,Dt!==0&&(Se[ae++]=Dt);for(;$<z;)$t=De+U,Bt=$t-De,Dt=De-($t-Bt)+(U-Bt),U=le[++$],De=$t,Dt!==0&&(Se[ae++]=Dt);return(De!==0||ae===0)&&(Se[ae++]=De),ae}function ee(fe,k){let z=k[0];for(let le=1;le<fe;le++)z+=k[le];return z}function V(fe){return new Float64Array(fe)}const Q=(3+16*At)*At,Re=(2+12*At)*At,xe=(9+64*At)*At*At,nt=V(4),Le=V(8),Ye=V(12),rt=V(16),Tt=V(4);function dr(fe,k,z,le,Se,De,$t){let Dt,Bt,yt,U,N,$,ae,Ae,Ze,at,j,J,Ne,st,Te,Kt,xr,sn;const un=fe-Se,nr=z-Se,Qr=k-De,Wr=le-De;st=un*Wr,$=Fe*un,ae=$-($-un),Ae=un-ae,$=Fe*Wr,Ze=$-($-Wr),at=Wr-Ze,Te=Ae*at-(st-ae*Ze-Ae*Ze-ae*at),Kt=Qr*nr,$=Fe*Qr,ae=$-($-Qr),Ae=Qr-ae,$=Fe*nr,Ze=$-($-nr),at=nr-Ze,xr=Ae*at-(Kt-ae*Ze-Ae*Ze-ae*at),j=Te-xr,N=Te-j,nt[0]=Te-(j+N)+(N-xr),J=st+j,N=J-st,Ne=st-(J-N)+(j-N),j=Ne-Kt,N=Ne-j,nt[1]=Ne-(j+N)+(N-Kt),sn=J+j,N=sn-J,nt[2]=J-(sn-N)+(j-N),nt[3]=sn;let $r=ee(4,nt),ii=Re*$t;if($r>=ii||-$r>=ii||(N=fe-un,Dt=fe-(un+N)+(N-Se),N=z-nr,yt=z-(nr+N)+(N-Se),N=k-Qr,Bt=k-(Qr+N)+(N-De),N=le-Wr,U=le-(Wr+N)+(N-De),Dt===0&&Bt===0&&yt===0&&U===0)||(ii=xe*$t+Zt*Math.abs($r),$r+=un*U+Wr*Dt-(Qr*yt+nr*Bt),$r>=ii||-$r>=ii))return $r;st=Dt*Wr,$=Fe*Dt,ae=$-($-Dt),Ae=Dt-ae,$=Fe*Wr,Ze=$-($-Wr),at=Wr-Ze,Te=Ae*at-(st-ae*Ze-Ae*Ze-ae*at),Kt=Bt*nr,$=Fe*Bt,ae=$-($-Bt),Ae=Bt-ae,$=Fe*nr,Ze=$-($-nr),at=nr-Ze,xr=Ae*at-(Kt-ae*Ze-Ae*Ze-ae*at),j=Te-xr,N=Te-j,Tt[0]=Te-(j+N)+(N-xr),J=st+j,N=J-st,Ne=st-(J-N)+(j-N),j=Ne-Kt,N=Ne-j,Tt[1]=Ne-(j+N)+(N-Kt),sn=J+j,N=sn-J,Tt[2]=J-(sn-N)+(j-N),Tt[3]=sn;const pn=vr(4,nt,4,Tt,Le);st=un*U,$=Fe*un,ae=$-($-un),Ae=un-ae,$=Fe*U,Ze=$-($-U),at=U-Ze,Te=Ae*at-(st-ae*Ze-Ae*Ze-ae*at),Kt=Qr*yt,$=Fe*Qr,ae=$-($-Qr),Ae=Qr-ae,$=Fe*yt,Ze=$-($-yt),at=yt-Ze,xr=Ae*at-(Kt-ae*Ze-Ae*Ze-ae*at),j=Te-xr,N=Te-j,Tt[0]=Te-(j+N)+(N-xr),J=st+j,N=J-st,Ne=st-(J-N)+(j-N),j=Ne-Kt,N=Ne-j,Tt[1]=Ne-(j+N)+(N-Kt),sn=J+j,N=sn-J,Tt[2]=J-(sn-N)+(j-N),Tt[3]=sn;const mi=vr(pn,Le,4,Tt,Ye);st=Dt*U,$=Fe*Dt,ae=$-($-Dt),Ae=Dt-ae,$=Fe*U,Ze=$-($-U),at=U-Ze,Te=Ae*at-(st-ae*Ze-Ae*Ze-ae*at),Kt=Bt*yt,$=Fe*Bt,ae=$-($-Bt),Ae=Bt-ae,$=Fe*yt,Ze=$-($-yt),at=yt-Ze,xr=Ae*at-(Kt-ae*Ze-Ae*Ze-ae*at),j=Te-xr,N=Te-j,Tt[0]=Te-(j+N)+(N-xr),J=st+j,N=J-st,Ne=st-(J-N)+(j-N),j=Ne-Kt,N=Ne-j,Tt[1]=Ne-(j+N)+(N-Kt),sn=J+j,N=sn-J,Tt[2]=J-(sn-N)+(j-N),Tt[3]=sn;const Gi=vr(mi,Ye,4,Tt,rt);return rt[Gi-1]}function Ot(fe,k,z,le,Se,De){const $t=(k-De)*(z-Se),Dt=(fe-Se)*(le-De),Bt=$t-Dt,yt=Math.abs($t+Dt);return Math.abs(Bt)>=Q*yt?Bt:-dr(fe,k,z,le,Se,De,yt)}const Vr=(fe,k)=>fe.x*k.y-fe.y*k.x,Kr=(fe,k)=>fe.x*k.x+fe.y*k.y,Or=(fe,k,z)=>{const le=Ot(fe.x,fe.y,k.x,k.y,z.x,z.y);return le>0?-1:le<0?1:0},In=fe=>Math.sqrt(Kr(fe,fe)),gn=(fe,k,z)=>{const le={x:k.x-fe.x,y:k.y-fe.y},Se={x:z.x-fe.x,y:z.y-fe.y};return Vr(Se,le)/In(Se)/In(le)},nn=(fe,k,z)=>{const le={x:k.x-fe.x,y:k.y-fe.y},Se={x:z.x-fe.x,y:z.y-fe.y};return Kr(Se,le)/In(Se)/In(le)},fi=(fe,k,z)=>k.y===0?null:{x:fe.x+k.x/k.y*(z-fe.y),y:z},Lr=(fe,k,z)=>k.x===0?null:{x:z,y:fe.y+k.y/k.x*(z-fe.x)},Vn=(fe,k,z,le)=>{if(k.x===0)return Lr(z,le,fe.x);if(le.x===0)return Lr(fe,k,z.x);if(k.y===0)return fi(z,le,fe.y);if(le.y===0)return fi(fe,k,z.y);const Se=Vr(k,le);if(Se==0)return null;const De={x:z.x-fe.x,y:z.y-fe.y},$t=Vr(De,k)/Se,Dt=Vr(De,le)/Se,Bt=fe.x+Dt*k.x,yt=z.x+$t*le.x,U=fe.y+Dt*k.y,N=z.y+$t*le.y,$=(Bt+yt)/2,ae=(U+N)/2;return{x:$,y:ae}};class Hr{static compare(k,z){const le=Hr.comparePoints(k.point,z.point);return le!==0?le:(k.point!==z.point&&k.link(z),k.isLeft!==z.isLeft?k.isLeft?1:-1:qi.compare(k.segment,z.segment))}static comparePoints(k,z){return k.x<z.x?-1:k.x>z.x?1:k.y<z.y?-1:k.y>z.y?1:0}constructor(k,z){k.events===void 0?k.events=[this]:k.events.push(this),this.point=k,this.isLeft=z}link(k){if(k.point===this.point)throw new Error("Tried to link already linked events");const z=k.point.events;for(let le=0,Se=z.length;le<Se;le++){const De=z[le];this.point.events.push(De),De.point=this.point}this.checkForConsuming()}checkForConsuming(){const k=this.point.events.length;for(let z=0;z<k;z++){const le=this.point.events[z];if(le.segment.consumedBy===void 0)for(let Se=z+1;Se<k;Se++){const De=this.point.events[Se];De.consumedBy===void 0&&le.otherSE.point.events===De.otherSE.point.events&&le.segment.consume(De.segment)}}}getAvailableLinkedEvents(){const k=[];for(let z=0,le=this.point.events.length;z<le;z++){const Se=this.point.events[z];Se!==this&&!Se.segment.ringOut&&Se.segment.isInResult()&&k.push(Se)}return k}getLeftmostComparator(k){const z=new Map,le=Se=>{const De=Se.otherSE;z.set(Se,{sine:gn(this.point,k.point,De.point),cosine:nn(this.point,k.point,De.point)})};return(Se,De)=>{z.has(Se)||le(Se),z.has(De)||le(De);const{sine:$t,cosine:Dt}=z.get(Se),{sine:Bt,cosine:yt}=z.get(De);return $t>=0&&Bt>=0?Dt<yt?1:Dt>yt?-1:0:$t<0&&Bt<0?Dt<yt?-1:Dt>yt?1:0:Bt<$t?-1:Bt>$t?1:0}}}let hn=0;class qi{static compare(k,z){const le=k.leftSE.point.x,Se=z.leftSE.point.x,De=k.rightSE.point.x,$t=z.rightSE.point.x;if($t<le)return 1;if(De<Se)return-1;const Dt=k.leftSE.point.y,Bt=z.leftSE.point.y,yt=k.rightSE.point.y,U=z.rightSE.point.y;if(le<Se){if(Bt<Dt&&Bt<yt)return 1;if(Bt>Dt&&Bt>yt)return-1;const N=k.comparePoint(z.leftSE.point);if(N<0)return 1;if(N>0)return-1;const $=z.comparePoint(k.rightSE.point);return $!==0?$:-1}if(le>Se){if(Dt<Bt&&Dt<U)return-1;if(Dt>Bt&&Dt>U)return 1;const N=z.comparePoint(k.leftSE.point);if(N!==0)return N;const $=k.comparePoint(z.rightSE.point);return $<0?1:$>0?-1:1}if(Dt<Bt)return-1;if(Dt>Bt)return 1;if(De<$t){const N=z.comparePoint(k.rightSE.point);if(N!==0)return N}if(De>$t){const N=k.comparePoint(z.rightSE.point);if(N<0)return 1;if(N>0)return-1}if(De!==$t){const N=yt-Dt,$=De-le,ae=U-Bt,Ae=$t-Se;if(N>$&&ae<Ae)return 1;if(N<$&&ae>Ae)return-1}return De>$t?1:De<$t||yt<U?-1:yt>U?1:k.id<z.id?-1:k.id>z.id?1:0}constructor(k,z,le,Se){this.id=++hn,this.leftSE=k,k.segment=this,k.otherSE=z,this.rightSE=z,z.segment=this,z.otherSE=k,this.rings=le,this.windings=Se}static fromRing(k,z,le){let Se,De,$t;const Dt=Hr.comparePoints(k,z);if(Dt<0)Se=k,De=z,$t=1;else if(Dt>0)Se=z,De=k,$t=-1;else throw new Error(`Tried to create degenerate segment at [${k.x}, ${k.y}]`);const Bt=new Hr(Se,!0),yt=new Hr(De,!1);return new qi(Bt,yt,[le],[$t])}replaceRightSE(k){this.rightSE=k,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const k=this.leftSE.point.y,z=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:k<z?k:z},ur:{x:this.rightSE.point.x,y:k>z?k:z}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(k){return k.x===this.leftSE.point.x&&k.y===this.leftSE.point.y||k.x===this.rightSE.point.x&&k.y===this.rightSE.point.y}comparePoint(k){if(this.isAnEndpoint(k))return 0;const z=this.leftSE.point,le=this.rightSE.point,Se=this.vector();if(z.x===le.x)return k.x===z.x?0:k.x<z.x?1:-1;const De=(k.y-z.y)/Se.y,$t=z.x+De*Se.x;if(k.x===$t)return 0;const Dt=(k.x-z.x)/Se.x,Bt=z.y+Dt*Se.y;return k.y===Bt?0:k.y<Bt?-1:1}getIntersection(k){const z=this.bbox(),le=k.bbox(),Se=pt(z,le);if(Se===null)return null;const De=this.leftSE.point,$t=this.rightSE.point,Dt=k.leftSE.point,Bt=k.rightSE.point,yt=Ct(z,Dt)&&this.comparePoint(Dt)===0,U=Ct(le,De)&&k.comparePoint(De)===0,N=Ct(z,Bt)&&this.comparePoint(Bt)===0,$=Ct(le,$t)&&k.comparePoint($t)===0;if(U&&yt)return $&&!N?$t:!$&&N?Bt:null;if(U)return N&&De.x===Bt.x&&De.y===Bt.y?null:De;if(yt)return $&&$t.x===Dt.x&&$t.y===Dt.y?null:Dt;if($&&N)return null;if($)return $t;if(N)return Bt;const ae=Vn(De,this.vector(),Dt,k.vector());return ae===null||!Ct(Se,ae)?null:we.round(ae.x,ae.y)}split(k){const z=[],le=k.events!==void 0,Se=new Hr(k,!0),De=new Hr(k,!1),$t=this.rightSE;this.replaceRightSE(De),z.push(De),z.push(Se);const Dt=new qi(Se,$t,this.rings.slice(),this.windings.slice());return Hr.comparePoints(Dt.leftSE.point,Dt.rightSE.point)>0&&Dt.swapEvents(),Hr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),le&&(Se.checkForConsuming(),De.checkForConsuming()),z}swapEvents(){const k=this.rightSE;this.rightSE=this.leftSE,this.leftSE=k,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let z=0,le=this.windings.length;z<le;z++)this.windings[z]*=-1}consume(k){let z=this,le=k;for(;z.consumedBy;)z=z.consumedBy;for(;le.consumedBy;)le=le.consumedBy;const Se=qi.compare(z,le);if(Se!==0){if(Se>0){const De=z;z=le,le=De}if(z.prev===le){const De=z;z=le,le=De}for(let De=0,$t=le.rings.length;De<$t;De++){const Dt=le.rings[De],Bt=le.windings[De],yt=z.rings.indexOf(Dt);yt===-1?(z.rings.push(Dt),z.windings.push(Bt)):z.windings[yt]+=Bt}le.rings=null,le.windings=null,le.consumedBy=z,le.leftSE.consumedBy=z.leftSE,le.rightSE.consumedBy=z.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const k=this.prev.consumedBy||this.prev;this._beforeState=k.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const k=this.beforeState();this._afterState={rings:k.rings.slice(0),windings:k.windings.slice(0),multiPolys:[]};const z=this._afterState.rings,le=this._afterState.windings,Se=this._afterState.multiPolys;for(let Dt=0,Bt=this.rings.length;Dt<Bt;Dt++){const yt=this.rings[Dt],U=this.windings[Dt],N=z.indexOf(yt);N===-1?(z.push(yt),le.push(U)):le[N]+=U}const De=[],$t=[];for(let Dt=0,Bt=z.length;Dt<Bt;Dt++){if(le[Dt]===0)continue;const yt=z[Dt],U=yt.poly;if($t.indexOf(U)===-1)if(yt.isExterior)De.push(U);else{$t.indexOf(U)===-1&&$t.push(U);const N=De.indexOf(yt.poly);N!==-1&&De.splice(N,1)}}for(let Dt=0,Bt=De.length;Dt<Bt;Dt++){const yt=De[Dt].multiPoly;Se.indexOf(yt)===-1&&Se.push(yt)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const k=this.beforeState().multiPolys,z=this.afterState().multiPolys;switch(Gt.type){case"union":{const le=k.length===0,Se=z.length===0;this._isInResult=le!==Se;break}case"intersection":{let le,Se;k.length<z.length?(le=k.length,Se=z.length):(le=z.length,Se=k.length),this._isInResult=Se===Gt.numMultiPolys&&le<Se;break}case"xor":{const le=Math.abs(k.length-z.length);this._isInResult=le%2===1;break}case"difference":{const le=Se=>Se.length===1&&Se[0].isSubject;this._isInResult=le(k)!==le(z);break}default:throw new Error(`Unrecognized operation type found ${Gt.type}`)}return this._isInResult}}class xi{constructor(k,z,le){if(!Array.isArray(k)||k.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=z,this.isExterior=le,this.segments=[],typeof k[0][0]!="number"||typeof k[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Se=we.round(k[0][0],k[0][1]);this.bbox={ll:{x:Se.x,y:Se.y},ur:{x:Se.x,y:Se.y}};let De=Se;for(let $t=1,Dt=k.length;$t<Dt;$t++){if(typeof k[$t][0]!="number"||typeof k[$t][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let Bt=we.round(k[$t][0],k[$t][1]);Bt.x===De.x&&Bt.y===De.y||(this.segments.push(qi.fromRing(De,Bt,this)),Bt.x<this.bbox.ll.x&&(this.bbox.ll.x=Bt.x),Bt.y<this.bbox.ll.y&&(this.bbox.ll.y=Bt.y),Bt.x>this.bbox.ur.x&&(this.bbox.ur.x=Bt.x),Bt.y>this.bbox.ur.y&&(this.bbox.ur.y=Bt.y),De=Bt)}(Se.x!==De.x||Se.y!==De.y)&&this.segments.push(qi.fromRing(De,Se,this))}getSweepEvents(){const k=[];for(let z=0,le=this.segments.length;z<le;z++){const Se=this.segments[z];k.push(Se.leftSE),k.push(Se.rightSE)}return k}}class ia{constructor(k,z){if(!Array.isArray(k))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new xi(k[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let le=1,Se=k.length;le<Se;le++){const De=new xi(k[le],this,!1);De.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=De.bbox.ll.x),De.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=De.bbox.ll.y),De.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=De.bbox.ur.x),De.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=De.bbox.ur.y),this.interiorRings.push(De)}this.multiPoly=z}getSweepEvents(){const k=this.exteriorRing.getSweepEvents();for(let z=0,le=this.interiorRings.length;z<le;z++){const Se=this.interiorRings[z].getSweepEvents();for(let De=0,$t=Se.length;De<$t;De++)k.push(Se[De])}return k}}class ea{constructor(k,z){if(!Array.isArray(k))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof k[0][0][0]=="number"&&(k=[k])}catch(le){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let le=0,Se=k.length;le<Se;le++){const De=new ia(k[le],this);De.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=De.bbox.ll.x),De.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=De.bbox.ll.y),De.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=De.bbox.ur.x),De.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=De.bbox.ur.y),this.polys.push(De)}this.isSubject=z}getSweepEvents(){const k=[];for(let z=0,le=this.polys.length;z<le;z++){const Se=this.polys[z].getSweepEvents();for(let De=0,$t=Se.length;De<$t;De++)k.push(Se[De])}return k}}class be{static factory(k){const z=[];for(let le=0,Se=k.length;le<Se;le++){const De=k[le];if(!De.isInResult()||De.ringOut)continue;let $t=null,Dt=De.leftSE,Bt=De.rightSE;const yt=[Dt],U=Dt.point,N=[];for(;$t=Dt,Dt=Bt,yt.push(Dt),Dt.point!==U;)for(;;){const $=Dt.getAvailableLinkedEvents();if($.length===0){const Ze=yt[0].point,at=yt[yt.length-1].point;throw new Error(`Unable to complete output ring starting at [${Ze.x}, ${Ze.y}]. Last matching segment found ends at [${at.x}, ${at.y}].`)}if($.length===1){Bt=$[0].otherSE;break}let ae=null;for(let Ze=0,at=N.length;Ze<at;Ze++)if(N[Ze].point===Dt.point){ae=Ze;break}if(ae!==null){const Ze=N.splice(ae)[0],at=yt.splice(Ze.index);at.unshift(at[0].otherSE),z.push(new be(at.reverse()));continue}N.push({index:yt.length,point:Dt.point});const Ae=Dt.getLeftmostComparator($t);Bt=$.sort(Ae)[0].otherSE;break}z.push(new be(yt))}return z}constructor(k){this.events=k;for(let z=0,le=k.length;z<le;z++)k[z].segment.ringOut=this;this.poly=null}getGeom(){let k=this.events[0].point;const z=[k];for(let yt=1,U=this.events.length-1;yt<U;yt++){const N=this.events[yt].point,$=this.events[yt+1].point;Or(N,k,$)!==0&&(z.push(N),k=N)}if(z.length===1)return null;const le=z[0],Se=z[1];Or(le,k,Se)===0&&z.shift(),z.push(z[0]);const De=this.isExteriorRing()?1:-1,$t=this.isExteriorRing()?0:z.length-1,Dt=this.isExteriorRing()?z.length:-1,Bt=[];for(let yt=$t;yt!=Dt;yt+=De)Bt.push([z[yt].x,z[yt].y]);return Bt}isExteriorRing(){if(this._isExteriorRing===void 0){const k=this.enclosingRing();this._isExteriorRing=k?!k.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let k=this.events[0];for(let Se=1,De=this.events.length;Se<De;Se++){const $t=this.events[Se];Hr.compare(k,$t)>0&&(k=$t)}let z=k.segment.prevInResult(),le=z?z.prevInResult():null;for(;;){if(!z)return null;if(!le)return z.ringOut;if(le.ringOut!==z.ringOut)return le.ringOut.enclosingRing()!==z.ringOut?z.ringOut:z.ringOut.enclosingRing();z=le.prevInResult(),le=z?z.prevInResult():null}}}class Fi{constructor(k){this.exteriorRing=k,k.poly=this,this.interiorRings=[]}addInterior(k){this.interiorRings.push(k),k.poly=this}getGeom(){const k=[this.exteriorRing.getGeom()];if(k[0]===null)return null;for(let z=0,le=this.interiorRings.length;z<le;z++){const Se=this.interiorRings[z].getGeom();Se!==null&&k.push(Se)}return k}}class aa{constructor(k){this.rings=k,this.polys=this._composePolys(k)}getGeom(){const k=[];for(let z=0,le=this.polys.length;z<le;z++){const Se=this.polys[z].getGeom();Se!==null&&k.push(Se)}return k}_composePolys(k){const z=[];for(let le=0,Se=k.length;le<Se;le++){const De=k[le];if(!De.poly)if(De.isExteriorRing())z.push(new Fi(De));else{const $t=De.enclosingRing();$t.poly||z.push(new Fi($t)),$t.poly.addInterior(De)}}return z}}class va{constructor(k){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qi.compare;this.queue=k,this.tree=new ze(z),this.segments=[]}process(k){const z=k.segment,le=[];if(k.consumedBy)return k.isLeft?this.queue.remove(k.otherSE):this.tree.remove(z),le;const Se=k.isLeft?this.tree.add(z):this.tree.find(z);if(!Se)throw new Error(`Unable to find segment #${z.id} [${z.leftSE.point.x}, ${z.leftSE.point.y}] -> [${z.rightSE.point.x}, ${z.rightSE.point.y}] in SweepLine tree.`);let De=Se,$t=Se,Dt,Bt;for(;Dt===void 0;)De=this.tree.prev(De),De===null?Dt=null:De.key.consumedBy===void 0&&(Dt=De.key);for(;Bt===void 0;)$t=this.tree.next($t),$t===null?Bt=null:$t.key.consumedBy===void 0&&(Bt=$t.key);if(k.isLeft){let yt=null;if(Dt){const N=Dt.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(yt=N),!Dt.isAnEndpoint(N))){const $=this._splitSafely(Dt,N);for(let ae=0,Ae=$.length;ae<Ae;ae++)le.push($[ae])}}let U=null;if(Bt){const N=Bt.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(U=N),!Bt.isAnEndpoint(N))){const $=this._splitSafely(Bt,N);for(let ae=0,Ae=$.length;ae<Ae;ae++)le.push($[ae])}}if(yt!==null||U!==null){let N=null;yt===null?N=U:U===null?N=yt:N=Hr.comparePoints(yt,U)<=0?yt:U,this.queue.remove(z.rightSE),le.push(z.rightSE);const $=z.split(N);for(let ae=0,Ae=$.length;ae<Ae;ae++)le.push($[ae])}le.length>0?(this.tree.remove(z),le.push(k)):(this.segments.push(z),z.prev=Dt)}else{if(Dt&&Bt){const yt=Dt.getIntersection(Bt);if(yt!==null){if(!Dt.isAnEndpoint(yt)){const U=this._splitSafely(Dt,yt);for(let N=0,$=U.length;N<$;N++)le.push(U[N])}if(!Bt.isAnEndpoint(yt)){const U=this._splitSafely(Bt,yt);for(let N=0,$=U.length;N<$;N++)le.push(U[N])}}}this.tree.remove(z)}return le}_splitSafely(k,z){this.tree.remove(k);const le=k.rightSE;this.queue.remove(le);const Se=k.split(z);return Se.push(le),k.consumedBy===void 0&&this.tree.add(k),Se}}const oo=typeof ne!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,po=typeof ne!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Mo{run(k,z,le){Gt.type=k,we.reset();const Se=[new ea(z,!0)];for(let N=0,$=le.length;N<$;N++)Se.push(new ea(le[N],!1));if(Gt.numMultiPolys=Se.length,Gt.type==="difference"){const N=Se[0];let $=1;for(;$<Se.length;)pt(Se[$].bbox,N.bbox)!==null?$++:Se.splice($,1)}if(Gt.type==="intersection")for(let N=0,$=Se.length;N<$;N++){const ae=Se[N];for(let Ae=N+1,Ze=Se.length;Ae<Ze;Ae++)if(pt(ae.bbox,Se[Ae].bbox)===null)return[]}const De=new ze(Hr.compare);for(let N=0,$=Se.length;N<$;N++){const ae=Se[N].getSweepEvents();for(let Ae=0,Ze=ae.length;Ae<Ze;Ae++)if(De.insert(ae[Ae]),De.size>oo)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const $t=new va(De);let Dt=De.size,Bt=De.pop();for(;Bt;){const N=Bt.key;if(De.size===Dt){const ae=N.segment;throw new Error(`Unable to pop() ${N.isLeft?"left":"right"} SweepEvent [${N.point.x}, ${N.point.y}] from segment #${ae.id} [${ae.leftSE.point.x}, ${ae.leftSE.point.y}] -> [${ae.rightSE.point.x}, ${ae.rightSE.point.y}] from queue.`)}if(De.size>oo)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if($t.segments.length>po)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const $=$t.process(N);for(let ae=0,Ae=$.length;ae<Ae;ae++){const Ze=$[ae];Ze.consumedBy===void 0&&De.insert(Ze)}Dt=De.size,Bt=De.pop()}we.reset();const yt=be.factory($t.segments);return new aa(yt).getGeom()}}const Gt=new Mo;var Ti={union:function(fe){for(var k=arguments.length,z=new Array(k>1?k-1:0),le=1;le<k;le++)z[le-1]=arguments[le];return Gt.run("union",fe,z)},intersection:function(fe){for(var k=arguments.length,z=new Array(k>1?k-1:0),le=1;le<k;le++)z[le-1]=arguments[le];return Gt.run("intersection",fe,z)},xor:function(fe){for(var k=arguments.length,z=new Array(k>1?k-1:0),le=1;le<k;le++)z[le-1]=arguments[le];return Gt.run("xor",fe,z)},difference:function(fe){for(var k=arguments.length,z=new Array(k>1?k-1:0),le=1;le<k;le++)z[le-1]=arguments[le];return Gt.run("difference",fe,z)}};return Ti})},81550:function(Ht){(function(re,B){Ht.exports=B()})(this,function(){"use strict";var re=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},B=function(W,Ie){for(var et=Object.keys(Ie),Jt=0;Jt<et.length;++Jt)W[et[Jt]]=Ie[et[Jt]];return W},ne=`
`;function de(W){return typeof atob!="undefined"?atob(W):"base64:"+W}function y(W){var Ie=new Error("(regl) "+W);throw console.error(Ie),Ie}function ce(W,Ie){W||y(Ie)}function L(W){return W?": "+W:""}function ue(W,Ie,et){W in Ie||y("unknown parameter ("+W+")"+L(et)+". possible values: "+Object.keys(Ie).join())}function oe(W,Ie){re(W)||y("invalid parameter type"+L(Ie)+". must be a typed array")}function Be(W,Ie){switch(Ie){case"number":return typeof W=="number";case"object":return typeof W=="object";case"string":return typeof W=="string";case"boolean":return typeof W=="boolean";case"function":return typeof W=="function";case"undefined":return typeof W=="undefined";case"symbol":return typeof W=="symbol"}}function se(W,Ie,et){Be(W,Ie)||y("invalid parameter type"+L(et)+". expected "+Ie+", got "+typeof W)}function ze(W,Ie){W>=0&&(W|0)===W||y("invalid parameter type, ("+W+")"+L(Ie)+". must be a nonnegative integer")}function Ge(W,Ie,et){Ie.indexOf(W)<0&&y("invalid value"+L(et)+". must be one of: "+Ie)}var Ke=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Rt(W){Object.keys(W).forEach(function(Ie){Ke.indexOf(Ie)<0&&y('invalid regl constructor argument "'+Ie+'". must be one of '+Ke)})}function St(W,Ie){for(W=W+"";W.length<Ie;)W=" "+W;return W}function Nt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Pt(W,Ie){this.number=W,this.line=Ie,this.errors=[]}function Ct(W,Ie,et){this.file=W,this.line=Ie,this.message=et}function pt(){var W=new Error,Ie=(W.stack||W).toString(),et=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ie);if(et)return et[1];var Jt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ie);return Jt?Jt[1]:"unknown"}function mt(){var W=new Error,Ie=(W.stack||W).toString(),et=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ie);if(et)return et[1];var Jt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ie);return Jt?Jt[1]:"unknown"}function pr(W,Ie){var et=W.split(`
`),Jt=1,yr=0,tr={unknown:new Nt,0:new Nt};tr.unknown.name=tr[0].name=Ie||pt(),tr.unknown.lines.push(new Pt(0,""));for(var Xt=0;Xt<et.length;++Xt){var Ur=et[Xt],Dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if(Dr)switch(Dr[1]){case"line":var Jr=/(\d+)(\s+\d+)?/.exec(Dr[2]);Jr&&(Jt=Jr[1]|0,Jr[2]&&(yr=Jr[2]|0,yr in tr||(tr[yr]=new Nt)));break;case"define":var jr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Dr[2]);jr&&(tr[yr].name=jr[1]?de(jr[2]):jr[2]);break}tr[yr].lines.push(new Pt(Jt++,Ur))}return Object.keys(tr).forEach(function(qr){var an=tr[qr];an.lines.forEach(function(Mr){an.index[Mr.number]=Mr})}),tr}function gr(W){var Ie=[];return W.split(`
`).forEach(function(et){if(!(et.length<5)){var Jt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(et);Jt?Ie.push(new Ct(Jt[1]|0,Jt[2]|0,Jt[3].trim())):et.length>0&&Ie.push(new Ct("unknown",0,et))}}),Ie}function lr(W,Ie){Ie.forEach(function(et){var Jt=W[et.file];if(Jt){var yr=Jt.index[et.line];if(yr){yr.errors.push(et),Jt.hasErrors=!0;return}}W.unknown.hasErrors=!0,W.unknown.lines[0].errors.push(et)})}function ut(W,Ie,et,Jt,yr){if(!W.getShaderParameter(Ie,W.COMPILE_STATUS)){var tr=W.getShaderInfoLog(Ie),Xt=Jt===W.FRAGMENT_SHADER?"fragment":"vertex";V(et,"string",Xt+" shader source must be a string",yr);var Ur=pr(et,yr),Dr=gr(tr);lr(Ur,Dr),Object.keys(Ur).forEach(function(Jr){var jr=Ur[Jr];if(!jr.hasErrors)return;var qr=[""],an=[""];function Mr(en,Ft){qr.push(en),an.push(Ft||"")}Mr("file number "+Jr+": "+jr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),jr.lines.forEach(function(en){if(en.errors.length>0){Mr(St(en.number,4)+"|  ","background-color:yellow; font-weight:bold"),Mr(en.line+ne,"color:red; background-color:yellow; font-weight:bold");var Ft=0;en.errors.forEach(function(ur){var Zr=ur.message,dn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Zr);if(dn){var Cr=dn[1];switch(Zr=dn[2],Cr){case"assign":Cr="=";break}Ft=Math.max(en.line.indexOf(Cr,Ft),0)}else Ft=0;Mr(St("| ",6)),Mr(St("^^^",Ft+3)+ne,"font-weight:bold"),Mr(St("| ",6)),Mr(Zr+ne,"font-weight:bold")}),Mr(St("| ",6)+ne)}else Mr(St(en.number,4)+"|  "),Mr(en.line+ne,"color:red")}),typeof document!="undefined"&&!window.chrome?(an[0]=qr.join("%c"),console.log.apply(console,an)):console.log(qr.join(""))}),ce.raise("Error compiling "+Xt+" shader, "+Ur[0].name)}}function we(W,Ie,et,Jt,yr){if(!W.getProgramParameter(Ie,W.LINK_STATUS)){var tr=W.getProgramInfoLog(Ie),Xt=pr(et,yr),Ur=pr(Jt,yr),Dr='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+Xt[0].name+'"';typeof document!="undefined"?console.log("%c"+Dr+ne+"%c"+tr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Dr+ne+tr),ce.raise(Dr)}}function At(W){W._commandRef=pt()}function Fe(W,Ie,et,Jt){At(W);function yr(Dr){return Dr?Jt.id(Dr):0}W._fragId=yr(W.static.frag),W._vertId=yr(W.static.vert);function tr(Dr,Jr){Object.keys(Jr).forEach(function(jr){Dr[Jt.id(jr)]=!0})}var Xt=W._uniformSet={};tr(Xt,Ie.static),tr(Xt,Ie.dynamic);var Ur=W._attributeSet={};tr(Ur,et.static),tr(Ur,et.dynamic),W._hasCount="count"in W.static||"count"in W.dynamic||"elements"in W.static||"elements"in W.dynamic}function Zt(W,Ie){var et=mt();y(W+" in command "+(Ie||pt())+(et==="unknown"?"":" called from "+et))}function vr(W,Ie,et){W||Zt(Ie,et||pt())}function ee(W,Ie,et,Jt){W in Ie||Zt("unknown parameter ("+W+")"+L(et)+". possible values: "+Object.keys(Ie).join(),Jt||pt())}function V(W,Ie,et,Jt){Be(W,Ie)||Zt("invalid parameter type"+L(et)+". expected "+Ie+", got "+typeof W,Jt||pt())}function Q(W){W()}function Re(W,Ie,et){W.texture?Ge(W.texture._texture.internalformat,Ie,"unsupported texture format for attachment"):Ge(W.renderbuffer._renderbuffer.format,et,"unsupported renderbuffer format for attachment")}var xe=33071,nt=9728,Le=9984,Ye=9985,rt=9986,Tt=9987,dr=5120,Ot=5121,Vr=5122,Kr=5123,Or=5124,In=5125,gn=5126,nn=32819,fi=32820,Lr=33635,Vn=34042,Hr=36193,hn={};hn[dr]=hn[Ot]=1,hn[Vr]=hn[Kr]=hn[Hr]=hn[Lr]=hn[nn]=hn[fi]=2,hn[Or]=hn[In]=hn[gn]=hn[Vn]=4;function qi(W,Ie){return W===fi||W===nn||W===Lr?2:W===Vn?4:hn[W]*Ie}function xi(W){return!(W&W-1)&&!!W}function ia(W,Ie,et){var Jt,yr=Ie.width,tr=Ie.height,Xt=Ie.channels;ce(yr>0&&yr<=et.maxTextureSize&&tr>0&&tr<=et.maxTextureSize,"invalid texture shape"),(W.wrapS!==xe||W.wrapT!==xe)&&ce(xi(yr)&&xi(tr),"incompatible wrap mode for texture, both width and height must be power of 2"),Ie.mipmask===1?yr!==1&&tr!==1&&ce(W.minFilter!==Le&&W.minFilter!==rt&&W.minFilter!==Ye&&W.minFilter!==Tt,"min filter requires mipmap"):(ce(xi(yr)&&xi(tr),"texture must be a square power of 2 to support mipmapping"),ce(Ie.mipmask===(yr<<1)-1,"missing or incomplete mipmap data")),Ie.type===gn&&(et.extensions.indexOf("oes_texture_float_linear")<0&&ce(W.minFilter===nt&&W.magFilter===nt,"filter not supported, must enable oes_texture_float_linear"),ce(!W.genMipmaps,"mipmap generation not supported with float textures"));var Ur=Ie.images;for(Jt=0;Jt<16;++Jt)if(Ur[Jt]){var Dr=yr>>Jt,Jr=tr>>Jt;ce(Ie.mipmask&1<<Jt,"missing mipmap data");var jr=Ur[Jt];if(ce(jr.width===Dr&&jr.height===Jr,"invalid shape for mip images"),ce(jr.format===Ie.format&&jr.internalformat===Ie.internalformat&&jr.type===Ie.type,"incompatible type for mip image"),!jr.compressed)if(jr.data){var qr=Math.ceil(qi(jr.type,Xt)*Dr/jr.unpackAlignment)*jr.unpackAlignment;ce(jr.data.byteLength===qr*Jr,"invalid data for image, buffer size is inconsistent with image format")}else jr.element||jr.copy}else W.genMipmaps||ce((Ie.mipmask&1<<Jt)===0,"extra mipmap data");Ie.compressed&&ce(!W.genMipmaps,"mipmap generation for compressed images not supported")}function ea(W,Ie,et,Jt){var yr=W.width,tr=W.height,Xt=W.channels;ce(yr>0&&yr<=Jt.maxTextureSize&&tr>0&&tr<=Jt.maxTextureSize,"invalid texture shape"),ce(yr===tr,"cube map must be square"),ce(Ie.wrapS===xe&&Ie.wrapT===xe,"wrap mode not supported by cube map");for(var Ur=0;Ur<et.length;++Ur){var Dr=et[Ur];ce(Dr.width===yr&&Dr.height===tr,"inconsistent cube map face shape"),Ie.genMipmaps&&(ce(!Dr.compressed,"can not generate mipmap for compressed textures"),ce(Dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Jr=Dr.images,jr=0;jr<16;++jr){var qr=Jr[jr];if(qr){var an=yr>>jr,Mr=tr>>jr;ce(Dr.mipmask&1<<jr,"missing mipmap data"),ce(qr.width===an&&qr.height===Mr,"invalid shape for mip images"),ce(qr.format===W.format&&qr.internalformat===W.internalformat&&qr.type===W.type,"incompatible type for mip image"),qr.compressed||(qr.data?ce(qr.data.byteLength===an*Mr*Math.max(qi(qr.type,Xt),qr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):qr.element||qr.copy)}}}}var be=B(ce,{optional:Q,raise:y,commandRaise:Zt,command:vr,parameter:ue,commandParameter:ee,constructor:Rt,type:se,commandType:V,isTypedArray:oe,nni:ze,oneOf:Ge,shaderError:ut,linkError:we,callSite:mt,saveCommandRef:At,saveDrawInfo:Fe,framebufferFormat:Re,guessCommand:pt,texture2D:ia,textureCube:ea}),Fi=0,aa=0;function va(W,Ie){this.id=Fi++,this.type=W,this.data=Ie}function oo(W){return W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function po(W){if(W.length===0)return[];var Ie=W.charAt(0),et=W.charAt(W.length-1);if(W.length>1&&Ie===et&&(Ie==='"'||Ie==="'"))return['"'+oo(W.substr(1,W.length-2))+'"'];var Jt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W);if(Jt)return po(W.substr(0,Jt.index)).concat(po(Jt[1])).concat(po(W.substr(Jt.index+Jt[0].length)));var yr=W.split(".");if(yr.length===1)return['"'+oo(W)+'"'];for(var tr=[],Xt=0;Xt<yr.length;++Xt)tr=tr.concat(po(yr[Xt]));return tr}function Mo(W){return"["+po(W).join("][")+"]"}function Gt(W,Ie){return new va(W,Mo(Ie+""))}function _r(W){return typeof W=="function"&&!W._reglType||W instanceof va}function Gr(W,Ie){return typeof W=="function"?new va(aa,W):W}var rn={DynamicVariable:va,define:Gt,isDynamic:_r,unbox:Gr,accessor:Mo},yn={next:typeof requestAnimationFrame=="function"?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:typeof cancelAnimationFrame=="function"?function(W){return cancelAnimationFrame(W)}:clearTimeout},Ti=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fe(){var W={"":0},Ie=[""];return{id:function(et){var Jt=W[et];return Jt||(Jt=W[et]=Ie.length,Ie.push(et),Jt)},str:function(et){return Ie[et]}}}function k(W,Ie,et){var Jt=document.createElement("canvas");B(Jt.style,{border:0,margin:0,padding:0,top:0,left:0}),W.appendChild(Jt),W===document.body&&(Jt.style.position="absolute",B(W.style,{margin:0,padding:0}));function yr(){var Ur=window.innerWidth,Dr=window.innerHeight;if(W!==document.body){var Jr=W.getBoundingClientRect();Ur=Jr.right-Jr.left,Dr=Jr.bottom-Jr.top}Jt.width=et*Ur,Jt.height=et*Dr,B(Jt.style,{width:Ur+"px",height:Dr+"px"})}var tr;W!==document.body&&typeof ResizeObserver=="function"?(tr=new ResizeObserver(function(){setTimeout(yr)}),tr.observe(W)):window.addEventListener("resize",yr,!1);function Xt(){tr?tr.disconnect():window.removeEventListener("resize",yr),W.removeChild(Jt)}return yr(),{canvas:Jt,onDestroy:Xt}}function z(W,Ie){function et(Jt){try{return W.getContext(Jt,Ie)}catch(yr){return null}}return et("webgl")||et("experimental-webgl")||et("webgl-experimental")}function le(W){return typeof W.nodeName=="string"&&typeof W.appendChild=="function"&&typeof W.getBoundingClientRect=="function"}function Se(W){return typeof W.drawArrays=="function"||typeof W.drawElements=="function"}function De(W){return typeof W=="string"?W.split():(be(Array.isArray(W),"invalid extension array"),W)}function $t(W){return typeof W=="string"?(be(typeof document!="undefined","not supported outside of DOM"),document.querySelector(W)):W}function Dt(W){var Ie=W||{},et,Jt,yr,tr,Xt={},Ur=[],Dr=[],Jr=typeof window=="undefined"?1:window.devicePixelRatio,jr=!1,qr=function(en){en&&be.raise(en)},an=function(){};if(typeof Ie=="string"?(be(typeof document!="undefined","selector queries only supported in DOM enviroments"),et=document.querySelector(Ie),be(et,"invalid query string for element")):typeof Ie=="object"?le(Ie)?et=Ie:Se(Ie)?(tr=Ie,yr=tr.canvas):(be.constructor(Ie),"gl"in Ie?tr=Ie.gl:"canvas"in Ie?yr=$t(Ie.canvas):"container"in Ie&&(Jt=$t(Ie.container)),"attributes"in Ie&&(Xt=Ie.attributes,be.type(Xt,"object","invalid context attributes")),"extensions"in Ie&&(Ur=De(Ie.extensions)),"optionalExtensions"in Ie&&(Dr=De(Ie.optionalExtensions)),"onDone"in Ie&&(be.type(Ie.onDone,"function","invalid or missing onDone callback"),qr=Ie.onDone),"profile"in Ie&&(jr=!!Ie.profile),"pixelRatio"in Ie&&(Jr=+Ie.pixelRatio,be(Jr>0,"invalid pixel ratio"))):be.raise("invalid arguments to regl"),et&&(et.nodeName.toLowerCase()==="canvas"?yr=et:Jt=et),!tr){if(!yr){be(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Mr=k(Jt||document.body,qr,Jr);if(!Mr)return null;yr=Mr.canvas,an=Mr.onDestroy}Xt.premultipliedAlpha===void 0&&(Xt.premultipliedAlpha=!0),tr=z(yr,Xt)}return tr?{gl:tr,canvas:yr,container:Jt,extensions:Ur,optionalExtensions:Dr,pixelRatio:Jr,profile:jr,onDone:qr,onDestroy:an}:(an(),qr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Bt(W,Ie){var et={};function Jt(Xt){be.type(Xt,"string","extension name must be string");var Ur=Xt.toLowerCase(),Dr;try{Dr=et[Ur]=W.getExtension(Ur)}catch(Jr){}return!!Dr}for(var yr=0;yr<Ie.extensions.length;++yr){var tr=Ie.extensions[yr];if(!Jt(tr))return Ie.onDestroy(),Ie.onDone('"'+tr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ie.optionalExtensions.forEach(Jt),{extensions:et,restore:function(){Object.keys(et).forEach(function(Xt){if(et[Xt]&&!Jt(Xt))throw new Error("(regl): error restoring extension "+Xt)})}}}function yt(W,Ie){for(var et=Array(W),Jt=0;Jt<W;++Jt)et[Jt]=Ie(Jt);return et}var U=5120,N=5121,$=5122,ae=5123,Ae=5124,Ze=5125,at=5126;function j(W){for(var Ie=16;Ie<=1<<28;Ie*=16)if(W<=Ie)return Ie;return 0}function J(W){var Ie,et;return Ie=(W>65535)<<4,W>>>=Ie,et=(W>255)<<3,W>>>=et,Ie|=et,et=(W>15)<<2,W>>>=et,Ie|=et,et=(W>3)<<1,W>>>=et,Ie|=et,Ie|W>>1}function Ne(){var W=yt(8,function(){return[]});function Ie(tr){var Xt=j(tr),Ur=W[J(Xt)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(Xt)}function et(tr){W[J(tr.byteLength)>>2].push(tr)}function Jt(tr,Xt){var Ur=null;switch(tr){case U:Ur=new Int8Array(Ie(Xt),0,Xt);break;case N:Ur=new Uint8Array(Ie(Xt),0,Xt);break;case $:Ur=new Int16Array(Ie(2*Xt),0,Xt);break;case ae:Ur=new Uint16Array(Ie(2*Xt),0,Xt);break;case Ae:Ur=new Int32Array(Ie(4*Xt),0,Xt);break;case Ze:Ur=new Uint32Array(Ie(4*Xt),0,Xt);break;case at:Ur=new Float32Array(Ie(4*Xt),0,Xt);break;default:return null}return Ur.length!==Xt?Ur.subarray(0,Xt):Ur}function yr(tr){et(tr.buffer)}return{alloc:Ie,free:et,allocType:Jt,freeType:yr}}var st=Ne();st.zero=Ne();var Te=3408,Kt=3410,xr=3411,sn=3412,un=3413,nr=3414,Qr=3415,Wr=33901,$r=33902,ii=3379,pn=3386,mi=34921,Gi=36347,di=36348,Ui=35661,wi=35660,ss=34930,oa=36349,ka=34076,Ci=34024,yi=7936,Ri=7937,Da=7938,gu=35724,_a=34047,Ia=36063,Zl=34852,vs=3553,Pa=34067,_i=34069,La=33984,fa=6408,Ho=5126,ga=5121,us=36160,Qo=36053,Lu=36064,ms=16384,gc=function(W,Ie){var et=1;Ie.ext_texture_filter_anisotropic&&(et=W.getParameter(_a));var Jt=1,yr=1;Ie.webgl_draw_buffers&&(Jt=W.getParameter(Zl),yr=W.getParameter(Ia));var tr=!!Ie.oes_texture_float;if(tr){var Xt=W.createTexture();W.bindTexture(vs,Xt),W.texImage2D(vs,0,fa,1,1,0,fa,Ho,null);var Ur=W.createFramebuffer();if(W.bindFramebuffer(us,Ur),W.framebufferTexture2D(us,Lu,vs,Xt,0),W.bindTexture(vs,null),W.checkFramebufferStatus(us)!==Qo)tr=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(ms);var Dr=st.allocType(Ho,4);W.readPixels(0,0,1,1,fa,Ho,Dr),W.getError()?tr=!1:(W.deleteFramebuffer(Ur),W.deleteTexture(Xt),tr=Dr[0]===1),st.freeType(Dr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),jr=!0;if(!Jr){var qr=W.createTexture(),an=st.allocType(ga,36);W.activeTexture(La),W.bindTexture(Pa,qr),W.texImage2D(_i,0,fa,3,3,0,fa,ga,an),st.freeType(an),W.bindTexture(Pa,null),W.deleteTexture(qr),jr=!W.getError()}return{colorBits:[W.getParameter(Kt),W.getParameter(xr),W.getParameter(sn),W.getParameter(un)],depthBits:W.getParameter(nr),stencilBits:W.getParameter(Qr),subpixelBits:W.getParameter(Te),extensions:Object.keys(Ie).filter(function(Mr){return!!Ie[Mr]}),maxAnisotropic:et,maxDrawbuffers:Jt,maxColorAttachments:yr,pointSizeDims:W.getParameter(Wr),lineWidthDims:W.getParameter($r),maxViewportDims:W.getParameter(pn),maxCombinedTextureUnits:W.getParameter(Ui),maxCubeMapSize:W.getParameter(ka),maxRenderbufferSize:W.getParameter(Ci),maxTextureUnits:W.getParameter(ss),maxTextureSize:W.getParameter(ii),maxAttributes:W.getParameter(mi),maxVertexUniforms:W.getParameter(Gi),maxVertexTextureUnits:W.getParameter(wi),maxVaryingVectors:W.getParameter(di),maxFragmentUniforms:W.getParameter(oa),glsl:W.getParameter(gu),renderer:W.getParameter(Ri),vendor:W.getParameter(yi),version:W.getParameter(Da),readFloat:tr,npotTextureCube:jr}};function wa(W){return!!W&&typeof W=="object"&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&typeof W.offset=="number"&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||re(W.data))}var sa=function(W){return Object.keys(W).map(function(Ie){return W[Ie]})},er={shape:tn,flatten:cr};function Cn(W,Ie,et){for(var Jt=0;Jt<Ie;++Jt)et[Jt]=W[Jt]}function _e(W,Ie,et,Jt){for(var yr=0,tr=0;tr<Ie;++tr)for(var Xt=W[tr],Ur=0;Ur<et;++Ur)Jt[yr++]=Xt[Ur]}function ke(W,Ie,et,Jt,yr,tr){for(var Xt=tr,Ur=0;Ur<Ie;++Ur)for(var Dr=W[Ur],Jr=0;Jr<et;++Jr)for(var jr=Dr[Jr],qr=0;qr<Jt;++qr)yr[Xt++]=jr[qr]}function bt(W,Ie,et,Jt,yr){for(var tr=1,Xt=et+1;Xt<Ie.length;++Xt)tr*=Ie[Xt];var Ur=Ie[et];if(Ie.length-et===4){var Dr=Ie[et+1],Jr=Ie[et+2],jr=Ie[et+3];for(Xt=0;Xt<Ur;++Xt)ke(W[Xt],Dr,Jr,jr,Jt,yr),yr+=tr}else for(Xt=0;Xt<Ur;++Xt)bt(W[Xt],Ie,et+1,Jt,yr),yr+=tr}function cr(W,Ie,et,Jt){var yr=1;if(Ie.length)for(var tr=0;tr<Ie.length;++tr)yr*=Ie[tr];else yr=0;var Xt=Jt||st.allocType(et,yr);switch(Ie.length){case 0:break;case 1:Cn(W,Ie[0],Xt);break;case 2:_e(W,Ie[0],Ie[1],Xt);break;case 3:ke(W,Ie[0],Ie[1],Ie[2],Xt,0);break;default:bt(W,Ie,0,Xt,0)}return Xt}function tn(W){for(var Ie=[],et=W;et.length;et=et[0])Ie.push(et.length);return Ie}var Bn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xi=5120,yo=5122,Io=5124,vo=5121,Ds=5123,Ms=5125,tp=5126,Tf=5126,Jo={int8:Xi,int16:yo,int32:Io,uint8:vo,uint16:Ds,uint32:Ms,float:tp,float32:Tf},xl=35048,El=35040,Bu={dynamic:xl,stream:El,static:35044},Fu=er.flatten,Qu=er.shape,Yc=35044,Ls=35040,Ja=5121,Sl=5126,Ju=[];Ju[5120]=1,Ju[5122]=2,Ju[5124]=4,Ju[5121]=1,Ju[5123]=2,Ju[5125]=4,Ju[5126]=4;function wf(W){return Bn[Object.prototype.toString.call(W)]|0}function rp(W,Ie){for(var et=0;et<Ie.length;++et)W[et]=Ie[et]}function Cf(W,Ie,et,Jt,yr,tr,Xt){for(var Ur=0,Dr=0;Dr<et;++Dr)for(var Jr=0;Jr<Jt;++Jr)W[Ur++]=Ie[yr*Dr+tr*Jr+Xt]}function gh(W,Ie,et,Jt){var yr=0,tr={};function Xt(Ft){this.id=yr++,this.buffer=W.createBuffer(),this.type=Ft,this.usage=Yc,this.byteLength=0,this.dimension=1,this.dtype=Ja,this.persistentData=null,et.profile&&(this.stats={size:0})}Xt.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},Xt.prototype.destroy=function(){an(this)};var Ur=[];function Dr(Ft,ur){var Zr=Ur.pop();return Zr||(Zr=new Xt(Ft)),Zr.bind(),qr(Zr,ur,Ls,0,1,!1),Zr}function Jr(Ft){Ur.push(Ft)}function jr(Ft,ur,Zr){Ft.byteLength=ur.byteLength,W.bufferData(Ft.type,ur,Zr)}function qr(Ft,ur,Zr,dn,Cr,bn){var kr;if(Ft.usage=Zr,Array.isArray(ur)){if(Ft.dtype=dn||Sl,ur.length>0){var vn;if(Array.isArray(ur[0])){kr=Qu(ur);for(var wr=1,fn=1;fn<kr.length;++fn)wr*=kr[fn];Ft.dimension=wr,vn=Fu(ur,kr,Ft.dtype),jr(Ft,vn,Zr),bn?Ft.persistentData=vn:st.freeType(vn)}else if(typeof ur[0]=="number"){Ft.dimension=Cr;var Xn=st.allocType(Ft.dtype,ur.length);rp(Xn,ur),jr(Ft,Xn,Zr),bn?Ft.persistentData=Xn:st.freeType(Xn)}else re(ur[0])?(Ft.dimension=ur[0].length,Ft.dtype=dn||wf(ur[0])||Sl,vn=Fu(ur,[ur.length,ur[0].length],Ft.dtype),jr(Ft,vn,Zr),bn?Ft.persistentData=vn:st.freeType(vn)):be.raise("invalid buffer data")}}else if(re(ur))Ft.dtype=dn||wf(ur),Ft.dimension=Cr,jr(Ft,ur,Zr),bn&&(Ft.persistentData=new Uint8Array(new Uint8Array(ur.buffer)));else if(wa(ur)){kr=ur.shape;var li=ur.stride,ln=ur.offset,Fr=0,Er=0,rr=0,Mi=0;kr.length===1?(Fr=kr[0],Er=1,rr=li[0],Mi=0):kr.length===2?(Fr=kr[0],Er=kr[1],rr=li[0],Mi=li[1]):be.raise("invalid shape"),Ft.dtype=dn||wf(ur.data)||Sl,Ft.dimension=Er;var it=st.allocType(Ft.dtype,Fr*Er);Cf(it,ur.data,Fr,Er,rr,Mi,ln),jr(Ft,it,Zr),bn?Ft.persistentData=it:st.freeType(it)}else ur instanceof ArrayBuffer?(Ft.dtype=Ja,Ft.dimension=Cr,jr(Ft,ur,Zr),bn&&(Ft.persistentData=new Uint8Array(new Uint8Array(ur)))):be.raise("invalid buffer data")}function an(Ft){Ie.bufferCount--,Jt(Ft);var ur=Ft.buffer;be(ur,"buffer must not be deleted already"),W.deleteBuffer(ur),Ft.buffer=null,delete tr[Ft.id]}function Mr(Ft,ur,Zr,dn){Ie.bufferCount++;var Cr=new Xt(ur);tr[Cr.id]=Cr;function bn(wr){var fn=Yc,Xn=null,li=0,ln=0,Fr=1;return Array.isArray(wr)||re(wr)||wa(wr)||wr instanceof ArrayBuffer?Xn=wr:typeof wr=="number"?li=wr|0:wr&&(be.type(wr,"object","buffer arguments must be an object, a number or an array"),"data"in wr&&(be(Xn===null||Array.isArray(Xn)||re(Xn)||wa(Xn),"invalid data for buffer"),Xn=wr.data),"usage"in wr&&(be.parameter(wr.usage,Bu,"invalid buffer usage"),fn=Bu[wr.usage]),"type"in wr&&(be.parameter(wr.type,Jo,"invalid buffer type"),ln=Jo[wr.type]),"dimension"in wr&&(be.type(wr.dimension,"number","invalid dimension"),Fr=wr.dimension|0),"length"in wr&&(be.nni(li,"buffer length must be a nonnegative integer"),li=wr.length|0)),Cr.bind(),Xn?qr(Cr,Xn,fn,ln,Fr,dn):(li&&W.bufferData(Cr.type,li,fn),Cr.dtype=ln||Ja,Cr.usage=fn,Cr.dimension=Fr,Cr.byteLength=li),et.profile&&(Cr.stats.size=Cr.byteLength*Ju[Cr.dtype]),bn}function kr(wr,fn){be(fn+wr.byteLength<=Cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+wr.byteLength+" starting from offset "+fn+" to a buffer of size "+Cr.byteLength),W.bufferSubData(Cr.type,fn,wr)}function vn(wr,fn){var Xn=(fn||0)|0,li;if(Cr.bind(),re(wr)||wr instanceof ArrayBuffer)kr(wr,Xn);else if(Array.isArray(wr)){if(wr.length>0)if(typeof wr[0]=="number"){var ln=st.allocType(Cr.dtype,wr.length);rp(ln,wr),kr(ln,Xn),st.freeType(ln)}else if(Array.isArray(wr[0])||re(wr[0])){li=Qu(wr);var Fr=Fu(wr,li,Cr.dtype);kr(Fr,Xn),st.freeType(Fr)}else be.raise("invalid buffer data")}else if(wa(wr)){li=wr.shape;var Er=wr.stride,rr=0,Mi=0,it=0,Si=0;li.length===1?(rr=li[0],Mi=1,it=Er[0],Si=0):li.length===2?(rr=li[0],Mi=li[1],it=Er[0],Si=Er[1]):be.raise("invalid shape");var pi=Array.isArray(wr.data)?Cr.dtype:wf(wr.data),ei=st.allocType(pi,rr*Mi);Cf(ei,wr.data,rr,Mi,it,Si,wr.offset),kr(ei,Xn),st.freeType(ei)}else be.raise("invalid data for buffer subdata");return bn}return Zr||bn(Ft),bn._reglType="buffer",bn._buffer=Cr,bn.subdata=vn,et.profile&&(bn.stats=Cr.stats),bn.destroy=function(){an(Cr)},bn}function en(){sa(tr).forEach(function(Ft){Ft.buffer=W.createBuffer(),W.bindBuffer(Ft.type,Ft.buffer),W.bufferData(Ft.type,Ft.persistentData||Ft.byteLength,Ft.usage)})}return et.profile&&(Ie.getTotalBufferSize=function(){var Ft=0;return Object.keys(tr).forEach(function(ur){Ft+=tr[ur].stats.size}),Ft}),{create:Mr,createStream:Dr,destroyStream:Jr,clear:function(){sa(tr).forEach(an),Ur.forEach(an)},getBuffer:function(Ft){return Ft&&Ft._buffer instanceof Xt?Ft._buffer:null},restore:en,_initBuffer:qr}}var yh=0,_h=0,np=1,ip=1,Wp=4,qc=4,Nu={points:yh,point:_h,lines:np,line:ip,triangles:Wp,triangle:qc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ap=0,es=1,Vl=4,Al=5120,Ys=5121,Tl=5122,hi=5123,el=5124,Bs=5125,Uu=34963,tl=35040,op=35044;function ta(W,Ie,et,Jt){var yr={},tr=0,Xt={uint8:Ys,uint16:hi};Ie.oes_element_index_uint&&(Xt.uint32=Bs);function Ur(en){this.id=tr++,yr[this.id]=this,this.buffer=en,this.primType=Vl,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var Dr=[];function Jr(en){var Ft=Dr.pop();return Ft||(Ft=new Ur(et.create(null,Uu,!0,!1)._buffer)),qr(Ft,en,tl,-1,-1,0,0),Ft}function jr(en){Dr.push(en)}function qr(en,Ft,ur,Zr,dn,Cr,bn){en.buffer.bind();var kr;if(Ft){var vn=bn;!bn&&(!re(Ft)||wa(Ft)&&!re(Ft.data))&&(vn=Ie.oes_element_index_uint?Bs:hi),et._initBuffer(en.buffer,Ft,ur,vn,3)}else W.bufferData(Uu,Cr,ur),en.buffer.dtype=kr||Ys,en.buffer.usage=ur,en.buffer.dimension=3,en.buffer.byteLength=Cr;if(kr=bn,!bn){switch(en.buffer.dtype){case Ys:case Al:kr=Ys;break;case hi:case Tl:kr=hi;break;case Bs:case el:kr=Bs;break;default:be.raise("unsupported type for element array")}en.buffer.dtype=kr}en.type=kr,be(kr!==Bs||!!Ie.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var wr=dn;wr<0&&(wr=en.buffer.byteLength,kr===hi?wr>>=1:kr===Bs&&(wr>>=2)),en.vertCount=wr;var fn=Zr;if(Zr<0){fn=Vl;var Xn=en.buffer.dimension;Xn===1&&(fn=ap),Xn===2&&(fn=es),Xn===3&&(fn=Vl)}en.primType=fn}function an(en){Jt.elementsCount--,be(en.buffer!==null,"must not double destroy elements"),delete yr[en.id],en.buffer.destroy(),en.buffer=null}function Mr(en,Ft){var ur=et.create(null,Uu,!0),Zr=new Ur(ur._buffer);Jt.elementsCount++;function dn(Cr){if(!Cr)ur(),Zr.primType=Vl,Zr.vertCount=0,Zr.type=Ys;else if(typeof Cr=="number")ur(Cr),Zr.primType=Vl,Zr.vertCount=Cr|0,Zr.type=Ys;else{var bn=null,kr=op,vn=-1,wr=-1,fn=0,Xn=0;Array.isArray(Cr)||re(Cr)||wa(Cr)?bn=Cr:(be.type(Cr,"object","invalid arguments for elements"),"data"in Cr&&(bn=Cr.data,be(Array.isArray(bn)||re(bn)||wa(bn),"invalid data for element buffer")),"usage"in Cr&&(be.parameter(Cr.usage,Bu,"invalid element buffer usage"),kr=Bu[Cr.usage]),"primitive"in Cr&&(be.parameter(Cr.primitive,Nu,"invalid element buffer primitive"),vn=Nu[Cr.primitive]),"count"in Cr&&(be(typeof Cr.count=="number"&&Cr.count>=0,"invalid vertex count for elements"),wr=Cr.count|0),"type"in Cr&&(be.parameter(Cr.type,Xt,"invalid buffer type"),Xn=Xt[Cr.type]),"length"in Cr?fn=Cr.length|0:(fn=wr,Xn===hi||Xn===Tl?fn*=2:(Xn===Bs||Xn===el)&&(fn*=4))),qr(Zr,bn,kr,vn,wr,fn,Xn)}return dn}return dn(en),dn._reglType="elements",dn._elements=Zr,dn.subdata=function(Cr,bn){return ur.subdata(Cr,bn),dn},dn.destroy=function(){an(Zr)},dn}return{create:Mr,createStream:Jr,destroyStream:jr,getElements:function(en){return typeof en=="function"&&en._elements instanceof Ur?en._elements:null},clear:function(){sa(yr).forEach(an)}}}var Oi=new Float32Array(1),uu=new Uint32Array(Oi.buffer),yu=5123;function Rf(W){for(var Ie=st.allocType(yu,W.length),et=0;et<W.length;++et)if(isNaN(W[et]))Ie[et]=65535;else if(W[et]===1/0)Ie[et]=31744;else if(W[et]===-1/0)Ie[et]=64512;else{Oi[0]=W[et];var Jt=uu[0],yr=Jt>>>31<<15,tr=(Jt<<1>>>24)-127,Xt=Jt>>13&1024-1;if(tr<-24)Ie[et]=yr;else if(tr<-14){var Ur=-14-tr;Ie[et]=yr+(Xt+1024>>Ur)}else tr>15?Ie[et]=yr+31744:Ie[et]=yr+(tr+15<<10)+Xt}return Ie}function Wa(W){return Array.isArray(W)||re(W)}var bh=function(W){return!(W&W-1)&&!!W},Mf=34467,Fs=3553,rl=34067,_u=34069,jl=6408,xh=6406,yc=6407,ma=6409,_c=6410,nl=32854,wl=32855,Eh=36194,Kc=32819,ba=32820,Cl=33635,sp=34042,il=6402,Qc=34041,Jc=35904,If=35906,al=36193,Hl=33776,zu=33777,ef=33778,bc=33779,Wl=35986,Sh=35987,xc=34798,Ns=35840,Ah=35841,tf=35842,Ec=35843,Rl=36196,Zu=5121,Gl=5123,Pf=5125,ol=5126,Th=10242,wh=10243,Ch=10497,Of=33071,up=33648,Ga=10240,lp=10241,kf=9728,cp=9729,Xl=9984,fp=9985,Vu=9986,Ea=9987,$l=33170,ju=4352,sl=4353,zi=4354,Sa=34046,lu=3317,rf=37440,nf=37441,qs=37443,hp=37444,Df=33984,Lf=[Xl,Vu,fp,Ea],Yl=[0,ma,_c,yc,jl],Po={};Po[ma]=Po[xh]=Po[il]=1,Po[Qc]=Po[_c]=2,Po[yc]=Po[Jc]=3,Po[jl]=Po[If]=4;function Xa(W){return"[object "+W+"]"}var af=Xa("HTMLCanvasElement"),Sc=Xa("OffscreenCanvas"),so=Xa("CanvasRenderingContext2D"),Rn=Xa("ImageBitmap"),gs=Xa("HTMLImageElement"),Bf=Xa("HTMLVideoElement"),Ac=Object.keys(Bn).concat([af,Sc,so,Rn,gs,Bf]),ls=[];ls[Zu]=1,ls[ol]=4,ls[al]=2,ls[Gl]=2,ls[Pf]=4;var xa=[];xa[nl]=2,xa[wl]=2,xa[Eh]=2,xa[Qc]=4,xa[Hl]=.5,xa[zu]=.5,xa[ef]=1,xa[bc]=1,xa[Wl]=.5,xa[Sh]=1,xa[xc]=1,xa[Ns]=.5,xa[Ah]=.25,xa[tf]=.5,xa[Ec]=.25,xa[Rl]=.5;function Ff(W){return Array.isArray(W)&&(W.length===0||typeof W[0]=="number")}function cn(W){if(!Array.isArray(W))return!1;var Ie=W.length;return!(Ie===0||!Wa(W[0]))}function ul(W){return Object.prototype.toString.call(W)}function of(W){return ul(W)===af}function sf(W){return ul(W)===Sc}function bu(W){return ul(W)===so}function Us(W){return ul(W)===Rn}function Nf(W){return ul(W)===gs}function Uf(W){return ul(W)===Bf}function ys(W){if(!W)return!1;var Ie=ul(W);return Ac.indexOf(Ie)>=0?!0:Ff(W)||cn(W)||wa(W)}function xu(W){return Bn[Object.prototype.toString.call(W)]|0}function pp(W,Ie){var et=Ie.length;switch(W.type){case Zu:case Gl:case Pf:case ol:var Jt=st.allocType(W.type,et);Jt.set(Ie),W.data=Jt;break;case al:W.data=Rf(Ie);break;default:be.raise("unsupported texture type, must specify a typed array")}}function Tc(W,Ie){return st.allocType(W.type===al?ol:W.type,Ie)}function wc(W,Ie){W.type===al?(W.data=Rf(Ie),st.freeType(Ie)):W.data=Ie}function zf(W,Ie,et,Jt,yr,tr){for(var Xt=W.width,Ur=W.height,Dr=W.channels,Jr=Xt*Ur*Dr,jr=Tc(W,Jr),qr=0,an=0;an<Ur;++an)for(var Mr=0;Mr<Xt;++Mr)for(var en=0;en<Dr;++en)jr[qr++]=Ie[et*Mr+Jt*an+yr*en+tr];wc(W,jr)}function Ks(W,Ie,et,Jt,yr,tr){var Xt;if(typeof xa[W]!="undefined"?Xt=xa[W]:Xt=Po[W]*ls[Ie],tr&&(Xt*=6),yr){for(var Ur=0,Dr=et;Dr>=1;)Ur+=Xt*Dr*Dr,Dr/=2;return Ur}else return Xt*et*Jt}function Ut(W,Ie,et,Jt,yr,tr,Xt){var Ur={"don't care":ju,"dont care":ju,nice:zi,fast:sl},Dr={repeat:Ch,clamp:Of,mirror:up},Jr={nearest:kf,linear:cp},jr=B({mipmap:Ea,"nearest mipmap nearest":Xl,"linear mipmap nearest":fp,"nearest mipmap linear":Vu,"linear mipmap linear":Ea},Jr),qr={none:0,browser:hp},an={uint8:Zu,rgba4:Kc,rgb565:Cl,"rgb5 a1":ba},Mr={alpha:xh,luminance:ma,"luminance alpha":_c,rgb:yc,rgba:jl,rgba4:nl,"rgb5 a1":wl,rgb565:Eh},en={};Ie.ext_srgb&&(Mr.srgb=Jc,Mr.srgba=If),Ie.oes_texture_float&&(an.float32=an.float=ol),Ie.oes_texture_half_float&&(an.float16=an["half float"]=al),Ie.webgl_depth_texture&&(B(Mr,{depth:il,"depth stencil":Qc}),B(an,{uint16:Gl,uint32:Pf,"depth stencil":sp})),Ie.webgl_compressed_texture_s3tc&&B(en,{"rgb s3tc dxt1":Hl,"rgba s3tc dxt1":zu,"rgba s3tc dxt3":ef,"rgba s3tc dxt5":bc}),Ie.webgl_compressed_texture_atc&&B(en,{"rgb atc":Wl,"rgba atc explicit alpha":Sh,"rgba atc interpolated alpha":xc}),Ie.webgl_compressed_texture_pvrtc&&B(en,{"rgb pvrtc 4bppv1":Ns,"rgb pvrtc 2bppv1":Ah,"rgba pvrtc 4bppv1":tf,"rgba pvrtc 2bppv1":Ec}),Ie.webgl_compressed_texture_etc1&&(en["rgb etc1"]=Rl);var Ft=Array.prototype.slice.call(W.getParameter(Mf));Object.keys(en).forEach(function($e){var ir=en[$e];Ft.indexOf(ir)>=0&&(Mr[$e]=ir)});var ur=Object.keys(Mr);et.textureFormats=ur;var Zr=[];Object.keys(Mr).forEach(function($e){var ir=Mr[$e];Zr[ir]=$e});var dn=[];Object.keys(an).forEach(function($e){var ir=an[$e];dn[ir]=$e});var Cr=[];Object.keys(Jr).forEach(function($e){var ir=Jr[$e];Cr[ir]=$e});var bn=[];Object.keys(jr).forEach(function($e){var ir=jr[$e];bn[ir]=$e});var kr=[];Object.keys(Dr).forEach(function($e){var ir=Dr[$e];kr[ir]=$e});var vn=ur.reduce(function($e,ir){var Yt=Mr[ir];return Yt===ma||Yt===xh||Yt===ma||Yt===_c||Yt===il||Yt===Qc||Ie.ext_srgb&&(Yt===Jc||Yt===If)?$e[Yt]=Yt:Yt===wl||ir.indexOf("rgba")>=0?$e[Yt]=jl:$e[Yt]=yc,$e},{});function wr(){this.internalformat=jl,this.format=jl,this.type=Zu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=hp,this.width=0,this.height=0,this.channels=0}function fn($e,ir){$e.internalformat=ir.internalformat,$e.format=ir.format,$e.type=ir.type,$e.compressed=ir.compressed,$e.premultiplyAlpha=ir.premultiplyAlpha,$e.flipY=ir.flipY,$e.unpackAlignment=ir.unpackAlignment,$e.colorSpace=ir.colorSpace,$e.width=ir.width,$e.height=ir.height,$e.channels=ir.channels}function Xn($e,ir){if(!(typeof ir!="object"||!ir)){if("premultiplyAlpha"in ir&&(be.type(ir.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),$e.premultiplyAlpha=ir.premultiplyAlpha),"flipY"in ir&&(be.type(ir.flipY,"boolean","invalid texture flip"),$e.flipY=ir.flipY),"alignment"in ir&&(be.oneOf(ir.alignment,[1,2,4,8],"invalid texture unpack alignment"),$e.unpackAlignment=ir.alignment),"colorSpace"in ir&&(be.parameter(ir.colorSpace,qr,"invalid colorSpace"),$e.colorSpace=qr[ir.colorSpace]),"type"in ir){var Yt=ir.type;be(Ie.oes_texture_float||!(Yt==="float"||Yt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),be(Ie.oes_texture_half_float||!(Yt==="half float"||Yt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),be(Ie.webgl_depth_texture||!(Yt==="uint16"||Yt==="uint32"||Yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),be.parameter(Yt,an,"invalid texture type"),$e.type=an[Yt]}var xn=$e.width,Ai=$e.height,Aa=$e.channels,ve=!1;"shape"in ir?(be(Array.isArray(ir.shape)&&ir.shape.length>=2,"shape must be an array"),xn=ir.shape[0],Ai=ir.shape[1],ir.shape.length===3&&(Aa=ir.shape[2],be(Aa>0&&Aa<=4,"invalid number of channels"),ve=!0),be(xn>=0&&xn<=et.maxTextureSize,"invalid width"),be(Ai>=0&&Ai<=et.maxTextureSize,"invalid height")):("radius"in ir&&(xn=Ai=ir.radius,be(xn>=0&&xn<=et.maxTextureSize,"invalid radius")),"width"in ir&&(xn=ir.width,be(xn>=0&&xn<=et.maxTextureSize,"invalid width")),"height"in ir&&(Ai=ir.height,be(Ai>=0&&Ai<=et.maxTextureSize,"invalid height")),"channels"in ir&&(Aa=ir.channels,be(Aa>0&&Aa<=4,"invalid number of channels"),ve=!0)),$e.width=xn|0,$e.height=Ai|0,$e.channels=Aa|0;var Oe=!1;if("format"in ir){var tt=ir.format;be(Ie.webgl_depth_texture||!(tt==="depth"||tt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),be.parameter(tt,Mr,"invalid texture format");var qt=$e.internalformat=Mr[tt];$e.format=vn[qt],tt in an&&("type"in ir||($e.type=an[tt])),tt in en&&($e.compressed=!0),Oe=!0}!ve&&Oe?$e.channels=Po[$e.format]:ve&&!Oe?$e.channels!==Yl[$e.format]&&($e.format=$e.internalformat=Yl[$e.channels]):Oe&&ve&&be($e.channels===Po[$e.format],"number of channels inconsistent with specified format")}}function li($e){W.pixelStorei(rf,$e.flipY),W.pixelStorei(nf,$e.premultiplyAlpha),W.pixelStorei(qs,$e.colorSpace),W.pixelStorei(lu,$e.unpackAlignment)}function ln(){wr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Fr($e,ir){var Yt=null;if(ys(ir)?Yt=ir:ir&&(be.type(ir,"object","invalid pixel data type"),Xn($e,ir),"x"in ir&&($e.xOffset=ir.x|0),"y"in ir&&($e.yOffset=ir.y|0),ys(ir.data)&&(Yt=ir.data)),be(!$e.compressed||Yt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ir.copy){be(!Yt,"can not specify copy and data field for the same texture");var xn=yr.viewportWidth,Ai=yr.viewportHeight;$e.width=$e.width||xn-$e.xOffset,$e.height=$e.height||Ai-$e.yOffset,$e.needsCopy=!0,be($e.xOffset>=0&&$e.xOffset<xn&&$e.yOffset>=0&&$e.yOffset<Ai&&$e.width>0&&$e.width<=xn&&$e.height>0&&$e.height<=Ai,"copy texture read out of bounds")}else if(!Yt)$e.width=$e.width||1,$e.height=$e.height||1,$e.channels=$e.channels||4;else if(re(Yt))$e.channels=$e.channels||4,$e.data=Yt,!("type"in ir)&&$e.type===Zu&&($e.type=xu(Yt));else if(Ff(Yt))$e.channels=$e.channels||4,pp($e,Yt),$e.alignment=1,$e.needsFree=!0;else if(wa(Yt)){var Aa=Yt.data;!Array.isArray(Aa)&&$e.type===Zu&&($e.type=xu(Aa));var ve=Yt.shape,Oe=Yt.stride,tt,qt,Wt,ht,xt,wt;ve.length===3?(Wt=ve[2],wt=Oe[2]):(be(ve.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Wt=1,wt=1),tt=ve[0],qt=ve[1],ht=Oe[0],xt=Oe[1],$e.alignment=1,$e.width=tt,$e.height=qt,$e.channels=Wt,$e.format=$e.internalformat=Yl[Wt],$e.needsFree=!0,zf($e,Aa,ht,xt,wt,Yt.offset)}else if(of(Yt)||sf(Yt)||bu(Yt))of(Yt)||sf(Yt)?$e.element=Yt:$e.element=Yt.canvas,$e.width=$e.element.width,$e.height=$e.element.height,$e.channels=4;else if(Us(Yt))$e.element=Yt,$e.width=Yt.width,$e.height=Yt.height,$e.channels=4;else if(Nf(Yt))$e.element=Yt,$e.width=Yt.naturalWidth,$e.height=Yt.naturalHeight,$e.channels=4;else if(Uf(Yt))$e.element=Yt,$e.width=Yt.videoWidth,$e.height=Yt.videoHeight,$e.channels=4;else if(cn(Yt)){var qe=$e.width||Yt[0].length,vt=$e.height||Yt.length,Pe=$e.channels;Wa(Yt[0][0])?Pe=Pe||Yt[0][0].length:Pe=Pe||1;for(var _t=er.shape(Yt),Lt=1,hr=0;hr<_t.length;++hr)Lt*=_t[hr];var Pr=Tc($e,Lt);er.flatten(Yt,_t,"",Pr),wc($e,Pr),$e.alignment=1,$e.width=qe,$e.height=vt,$e.channels=Pe,$e.format=$e.internalformat=Yl[Pe],$e.needsFree=!0}$e.type===ol?be(et.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):$e.type===al&&be(et.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Er($e,ir,Yt){var xn=$e.element,Ai=$e.data,Aa=$e.internalformat,ve=$e.format,Oe=$e.type,tt=$e.width,qt=$e.height;li($e),xn?W.texImage2D(ir,Yt,ve,ve,Oe,xn):$e.compressed?W.compressedTexImage2D(ir,Yt,Aa,tt,qt,0,Ai):$e.needsCopy?(Jt(),W.copyTexImage2D(ir,Yt,ve,$e.xOffset,$e.yOffset,tt,qt,0)):W.texImage2D(ir,Yt,ve,tt,qt,0,ve,Oe,Ai||null)}function rr($e,ir,Yt,xn,Ai){var Aa=$e.element,ve=$e.data,Oe=$e.internalformat,tt=$e.format,qt=$e.type,Wt=$e.width,ht=$e.height;li($e),Aa?W.texSubImage2D(ir,Ai,Yt,xn,tt,qt,Aa):$e.compressed?W.compressedTexSubImage2D(ir,Ai,Yt,xn,Oe,Wt,ht,ve):$e.needsCopy?(Jt(),W.copyTexSubImage2D(ir,Ai,Yt,xn,$e.xOffset,$e.yOffset,Wt,ht)):W.texSubImage2D(ir,Ai,Yt,xn,Wt,ht,tt,qt,ve)}var Mi=[];function it(){return Mi.pop()||new ln}function Si($e){$e.needsFree&&st.freeType($e.data),ln.call($e),Mi.push($e)}function pi(){wr.call(this),this.genMipmaps=!1,this.mipmapHint=ju,this.mipmask=0,this.images=Array(16)}function ei($e,ir,Yt){var xn=$e.images[0]=it();$e.mipmask=1,xn.width=$e.width=ir,xn.height=$e.height=Yt,xn.channels=$e.channels=4}function ra($e,ir){var Yt=null;if(ys(ir))Yt=$e.images[0]=it(),fn(Yt,$e),Fr(Yt,ir),$e.mipmask=1;else if(Xn($e,ir),Array.isArray(ir.mipmap))for(var xn=ir.mipmap,Ai=0;Ai<xn.length;++Ai)Yt=$e.images[Ai]=it(),fn(Yt,$e),Yt.width>>=Ai,Yt.height>>=Ai,Fr(Yt,xn[Ai]),$e.mipmask|=1<<Ai;else Yt=$e.images[0]=it(),fn(Yt,$e),Fr(Yt,ir),$e.mipmask=1;fn($e,$e.images[0]),$e.compressed&&($e.internalformat===Hl||$e.internalformat===zu||$e.internalformat===ef||$e.internalformat===bc)&&be($e.width%4===0&&$e.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function mo($e,ir){for(var Yt=$e.images,xn=0;xn<Yt.length;++xn){if(!Yt[xn])return;Er(Yt[xn],ir,xn)}}var go=[];function Di(){var $e=go.pop()||new pi;wr.call($e),$e.mipmask=0;for(var ir=0;ir<16;++ir)$e.images[ir]=null;return $e}function xo($e){for(var ir=$e.images,Yt=0;Yt<ir.length;++Yt)ir[Yt]&&Si(ir[Yt]),ir[Yt]=null;go.push($e)}function Ca(){this.minFilter=kf,this.magFilter=kf,this.wrapS=Of,this.wrapT=Of,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ju}function Eo($e,ir){if("min"in ir){var Yt=ir.min;be.parameter(Yt,jr),$e.minFilter=jr[Yt],Lf.indexOf($e.minFilter)>=0&&!("faces"in ir)&&($e.genMipmaps=!0)}if("mag"in ir){var xn=ir.mag;be.parameter(xn,Jr),$e.magFilter=Jr[xn]}var Ai=$e.wrapS,Aa=$e.wrapT;if("wrap"in ir){var ve=ir.wrap;typeof ve=="string"?(be.parameter(ve,Dr),Ai=Aa=Dr[ve]):Array.isArray(ve)&&(be.parameter(ve[0],Dr),be.parameter(ve[1],Dr),Ai=Dr[ve[0]],Aa=Dr[ve[1]])}else{if("wrapS"in ir){var Oe=ir.wrapS;be.parameter(Oe,Dr),Ai=Dr[Oe]}if("wrapT"in ir){var tt=ir.wrapT;be.parameter(tt,Dr),Aa=Dr[tt]}}if($e.wrapS=Ai,$e.wrapT=Aa,"anisotropic"in ir){var qt=ir.anisotropic;be(typeof qt=="number"&&qt>=1&&qt<=et.maxAnisotropic,"aniso samples must be between 1 and "),$e.anisotropic=ir.anisotropic}if("mipmap"in ir){var Wt=!1;switch(typeof ir.mipmap){case"string":be.parameter(ir.mipmap,Ur,"invalid mipmap hint"),$e.mipmapHint=Ur[ir.mipmap],$e.genMipmaps=!0,Wt=!0;break;case"boolean":Wt=$e.genMipmaps=ir.mipmap;break;case"object":be(Array.isArray(ir.mipmap),"invalid mipmap type"),$e.genMipmaps=!1,Wt=!0;break;default:be.raise("invalid mipmap type")}Wt&&!("min"in ir)&&($e.minFilter=Xl)}}function So($e,ir){W.texParameteri(ir,lp,$e.minFilter),W.texParameteri(ir,Ga,$e.magFilter),W.texParameteri(ir,Th,$e.wrapS),W.texParameteri(ir,wh,$e.wrapT),Ie.ext_texture_filter_anisotropic&&W.texParameteri(ir,Sa,$e.anisotropic),$e.genMipmaps&&(W.hint($l,$e.mipmapHint),W.generateMipmap(ir))}var Ya=0,zo={},Ts=et.maxTextureUnits,Ao=Array(Ts).map(function(){return null});function Ei($e){wr.call(this),this.mipmask=0,this.internalformat=jl,this.id=Ya++,this.refCount=1,this.target=$e,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ca,Xt.profile&&(this.stats={size:0})}function ps($e){W.activeTexture(Df),W.bindTexture($e.target,$e.texture)}function ha(){var $e=Ao[0];$e?W.bindTexture($e.target,$e.texture):W.bindTexture(Fs,null)}function Qn($e){var ir=$e.texture;be(ir,"must not double destroy texture");var Yt=$e.unit,xn=$e.target;Yt>=0&&(W.activeTexture(Df+Yt),W.bindTexture(xn,null),Ao[Yt]=null),W.deleteTexture(ir),$e.texture=null,$e.params=null,$e.pixels=null,$e.refCount=0,delete zo[$e.id],tr.textureCount--}B(Ei.prototype,{bind:function(){var $e=this;$e.bindCount+=1;var ir=$e.unit;if(ir<0){for(var Yt=0;Yt<Ts;++Yt){var xn=Ao[Yt];if(xn){if(xn.bindCount>0)continue;xn.unit=-1}Ao[Yt]=$e,ir=Yt;break}ir>=Ts&&be.raise("insufficient number of texture units"),Xt.profile&&tr.maxTextureUnits<ir+1&&(tr.maxTextureUnits=ir+1),$e.unit=ir,W.activeTexture(Df+ir),W.bindTexture($e.target,$e.texture)}return ir},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Qn(this)}});function ki($e,ir){var Yt=new Ei(Fs);zo[Yt.id]=Yt,tr.textureCount++;function xn(ve,Oe){var tt=Yt.texInfo;Ca.call(tt);var qt=Di();return typeof ve=="number"?typeof Oe=="number"?ei(qt,ve|0,Oe|0):ei(qt,ve|0,ve|0):ve?(be.type(ve,"object","invalid arguments to regl.texture"),Eo(tt,ve),ra(qt,ve)):ei(qt,1,1),tt.genMipmaps&&(qt.mipmask=(qt.width<<1)-1),Yt.mipmask=qt.mipmask,fn(Yt,qt),be.texture2D(tt,qt,et),Yt.internalformat=qt.internalformat,xn.width=qt.width,xn.height=qt.height,ps(Yt),mo(qt,Fs),So(tt,Fs),ha(),xo(qt),Xt.profile&&(Yt.stats.size=Ks(Yt.internalformat,Yt.type,qt.width,qt.height,tt.genMipmaps,!1)),xn.format=Zr[Yt.internalformat],xn.type=dn[Yt.type],xn.mag=Cr[tt.magFilter],xn.min=bn[tt.minFilter],xn.wrapS=kr[tt.wrapS],xn.wrapT=kr[tt.wrapT],xn}function Ai(ve,Oe,tt,qt){be(!!ve,"must specify image data");var Wt=Oe|0,ht=tt|0,xt=qt|0,wt=it();return fn(wt,Yt),wt.width=0,wt.height=0,Fr(wt,ve),wt.width=wt.width||(Yt.width>>xt)-Wt,wt.height=wt.height||(Yt.height>>xt)-ht,be(Yt.type===wt.type&&Yt.format===wt.format&&Yt.internalformat===wt.internalformat,"incompatible format for texture.subimage"),be(Wt>=0&&ht>=0&&Wt+wt.width<=Yt.width&&ht+wt.height<=Yt.height,"texture.subimage write out of bounds"),be(Yt.mipmask&1<<xt,"missing mipmap data"),be(wt.data||wt.element||wt.needsCopy,"missing image data"),ps(Yt),rr(wt,Fs,Wt,ht,xt),ha(),Si(wt),xn}function Aa(ve,Oe){var tt=ve|0,qt=Oe|0||tt;if(tt===Yt.width&&qt===Yt.height)return xn;xn.width=Yt.width=tt,xn.height=Yt.height=qt,ps(Yt);for(var Wt=0;Yt.mipmask>>Wt;++Wt){var ht=tt>>Wt,xt=qt>>Wt;if(!ht||!xt)break;W.texImage2D(Fs,Wt,Yt.format,ht,xt,0,Yt.format,Yt.type,null)}return ha(),Xt.profile&&(Yt.stats.size=Ks(Yt.internalformat,Yt.type,tt,qt,!1,!1)),xn}return xn($e,ir),xn.subimage=Ai,xn.resize=Aa,xn._reglType="texture2d",xn._texture=Yt,Xt.profile&&(xn.stats=Yt.stats),xn.destroy=function(){Yt.decRef()},xn}function Ki($e,ir,Yt,xn,Ai,Aa){var ve=new Ei(rl);zo[ve.id]=ve,tr.cubeCount++;var Oe=new Array(6);function tt(ht,xt,wt,qe,vt,Pe){var _t,Lt=ve.texInfo;for(Ca.call(Lt),_t=0;_t<6;++_t)Oe[_t]=Di();if(typeof ht=="number"||!ht){var hr=ht|0||1;for(_t=0;_t<6;++_t)ei(Oe[_t],hr,hr)}else if(typeof ht=="object")if(xt)ra(Oe[0],ht),ra(Oe[1],xt),ra(Oe[2],wt),ra(Oe[3],qe),ra(Oe[4],vt),ra(Oe[5],Pe);else if(Eo(Lt,ht),Xn(ve,ht),"faces"in ht){var Pr=ht.faces;for(be(Array.isArray(Pr)&&Pr.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)be(typeof Pr[_t]=="object"&&!!Pr[_t],"invalid input for cube map face"),fn(Oe[_t],ve),ra(Oe[_t],Pr[_t])}else for(_t=0;_t<6;++_t)ra(Oe[_t],ht);else be.raise("invalid arguments to cube map");for(fn(ve,Oe[0]),et.npotTextureCube||be(bh(ve.width)&&bh(ve.height),"your browser does not support non power or two texture dimensions"),Lt.genMipmaps?ve.mipmask=(Oe[0].width<<1)-1:ve.mipmask=Oe[0].mipmask,be.textureCube(ve,Lt,Oe,et),ve.internalformat=Oe[0].internalformat,tt.width=Oe[0].width,tt.height=Oe[0].height,ps(ve),_t=0;_t<6;++_t)mo(Oe[_t],_u+_t);for(So(Lt,rl),ha(),Xt.profile&&(ve.stats.size=Ks(ve.internalformat,ve.type,tt.width,tt.height,Lt.genMipmaps,!0)),tt.format=Zr[ve.internalformat],tt.type=dn[ve.type],tt.mag=Cr[Lt.magFilter],tt.min=bn[Lt.minFilter],tt.wrapS=kr[Lt.wrapS],tt.wrapT=kr[Lt.wrapT],_t=0;_t<6;++_t)xo(Oe[_t]);return tt}function qt(ht,xt,wt,qe,vt){be(!!xt,"must specify image data"),be(typeof ht=="number"&&ht===(ht|0)&&ht>=0&&ht<6,"invalid face");var Pe=wt|0,_t=qe|0,Lt=vt|0,hr=it();return fn(hr,ve),hr.width=0,hr.height=0,Fr(hr,xt),hr.width=hr.width||(ve.width>>Lt)-Pe,hr.height=hr.height||(ve.height>>Lt)-_t,be(ve.type===hr.type&&ve.format===hr.format&&ve.internalformat===hr.internalformat,"incompatible format for texture.subimage"),be(Pe>=0&&_t>=0&&Pe+hr.width<=ve.width&&_t+hr.height<=ve.height,"texture.subimage write out of bounds"),be(ve.mipmask&1<<Lt,"missing mipmap data"),be(hr.data||hr.element||hr.needsCopy,"missing image data"),ps(ve),rr(hr,_u+ht,Pe,_t,Lt),ha(),Si(hr),tt}function Wt(ht){var xt=ht|0;if(xt!==ve.width){tt.width=ve.width=xt,tt.height=ve.height=xt,ps(ve);for(var wt=0;wt<6;++wt)for(var qe=0;ve.mipmask>>qe;++qe)W.texImage2D(_u+wt,qe,ve.format,xt>>qe,xt>>qe,0,ve.format,ve.type,null);return ha(),Xt.profile&&(ve.stats.size=Ks(ve.internalformat,ve.type,tt.width,tt.height,!1,!0)),tt}}return tt($e,ir,Yt,xn,Ai,Aa),tt.subimage=qt,tt.resize=Wt,tt._reglType="textureCube",tt._texture=ve,Xt.profile&&(tt.stats=ve.stats),tt.destroy=function(){ve.decRef()},tt}function To(){for(var $e=0;$e<Ts;++$e)W.activeTexture(Df+$e),W.bindTexture(Fs,null),Ao[$e]=null;sa(zo).forEach(Qn),tr.cubeCount=0,tr.textureCount=0}Xt.profile&&(tr.getTotalTextureSize=function(){var $e=0;return Object.keys(zo).forEach(function(ir){$e+=zo[ir].stats.size}),$e});function ml(){for(var $e=0;$e<Ts;++$e){var ir=Ao[$e];ir&&(ir.bindCount=0,ir.unit=-1,Ao[$e]=null)}sa(zo).forEach(function(Yt){Yt.texture=W.createTexture(),W.bindTexture(Yt.target,Yt.texture);for(var xn=0;xn<32;++xn)if(Yt.mipmask&1<<xn)if(Yt.target===Fs)W.texImage2D(Fs,xn,Yt.internalformat,Yt.width>>xn,Yt.height>>xn,0,Yt.internalformat,Yt.type,null);else for(var Ai=0;Ai<6;++Ai)W.texImage2D(_u+Ai,xn,Yt.internalformat,Yt.width>>xn,Yt.height>>xn,0,Yt.internalformat,Yt.type,null);So(Yt.texInfo,Yt.target)})}return{create2D:ki,createCube:Ki,clear:To,getTexture:function($e){return null},restore:ml}}var Me=36161,F=32854,Qs=32855,pe=36194,Ml=33189,eo=36168,zs=34041,Oo=35907,_s=34836,Un=34842,Pn=34843,cs=[];cs[F]=2,cs[Qs]=2,cs[pe]=2,cs[Ml]=2,cs[eo]=1,cs[zs]=4,cs[Oo]=4,cs[_s]=16,cs[Un]=8,cs[Pn]=6;function fs(W,Ie,et){return cs[W]*Ie*et}var Eu=function(W,Ie,et,Jt,yr){var tr={rgba4:F,rgb565:pe,"rgb5 a1":Qs,depth:Ml,stencil:eo,"depth stencil":zs};Ie.ext_srgb&&(tr.srgba=Oo),Ie.ext_color_buffer_half_float&&(tr.rgba16f=Un,tr.rgb16f=Pn),Ie.webgl_color_buffer_float&&(tr.rgba32f=_s);var Xt=[];Object.keys(tr).forEach(function(Mr){var en=tr[Mr];Xt[en]=Mr});var Ur=0,Dr={};function Jr(Mr){this.id=Ur++,this.refCount=1,this.renderbuffer=Mr,this.format=F,this.width=0,this.height=0,yr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&jr(this)};function jr(Mr){var en=Mr.renderbuffer;be(en,"must not double destroy renderbuffer"),W.bindRenderbuffer(Me,null),W.deleteRenderbuffer(en),Mr.renderbuffer=null,Mr.refCount=0,delete Dr[Mr.id],Jt.renderbufferCount--}function qr(Mr,en){var Ft=new Jr(W.createRenderbuffer());Dr[Ft.id]=Ft,Jt.renderbufferCount++;function ur(dn,Cr){var bn=0,kr=0,vn=F;if(typeof dn=="object"&&dn){var wr=dn;if("shape"in wr){var fn=wr.shape;be(Array.isArray(fn)&&fn.length>=2,"invalid renderbuffer shape"),bn=fn[0]|0,kr=fn[1]|0}else"radius"in wr&&(bn=kr=wr.radius|0),"width"in wr&&(bn=wr.width|0),"height"in wr&&(kr=wr.height|0);"format"in wr&&(be.parameter(wr.format,tr,"invalid renderbuffer format"),vn=tr[wr.format])}else typeof dn=="number"?(bn=dn|0,typeof Cr=="number"?kr=Cr|0:kr=bn):dn?be.raise("invalid arguments to renderbuffer constructor"):bn=kr=1;if(be(bn>0&&kr>0&&bn<=et.maxRenderbufferSize&&kr<=et.maxRenderbufferSize,"invalid renderbuffer size"),!(bn===Ft.width&&kr===Ft.height&&vn===Ft.format))return ur.width=Ft.width=bn,ur.height=Ft.height=kr,Ft.format=vn,W.bindRenderbuffer(Me,Ft.renderbuffer),W.renderbufferStorage(Me,vn,bn,kr),be(W.getError()===0,"invalid render buffer format"),yr.profile&&(Ft.stats.size=fs(Ft.format,Ft.width,Ft.height)),ur.format=Xt[Ft.format],ur}function Zr(dn,Cr){var bn=dn|0,kr=Cr|0||bn;return bn===Ft.width&&kr===Ft.height||(be(bn>0&&kr>0&&bn<=et.maxRenderbufferSize&&kr<=et.maxRenderbufferSize,"invalid renderbuffer size"),ur.width=Ft.width=bn,ur.height=Ft.height=kr,W.bindRenderbuffer(Me,Ft.renderbuffer),W.renderbufferStorage(Me,Ft.format,bn,kr),be(W.getError()===0,"invalid render buffer format"),yr.profile&&(Ft.stats.size=fs(Ft.format,Ft.width,Ft.height))),ur}return ur(Mr,en),ur.resize=Zr,ur._reglType="renderbuffer",ur._renderbuffer=Ft,yr.profile&&(ur.stats=Ft.stats),ur.destroy=function(){Ft.decRef()},ur}yr.profile&&(Jt.getTotalRenderbufferSize=function(){var Mr=0;return Object.keys(Dr).forEach(function(en){Mr+=Dr[en].stats.size}),Mr});function an(){sa(Dr).forEach(function(Mr){Mr.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(Me,Mr.renderbuffer),W.renderbufferStorage(Me,Mr.format,Mr.width,Mr.height)}),W.bindRenderbuffer(Me,null)}return{create:qr,clear:function(){sa(Dr).forEach(jr)},restore:an}},Na=36160,Js=36161,Su=3553,Au=34069,da=36064,_o=36096,Rh=36128,Il=33306,Zf=36053,ll=36054,bs=36055,ql=36057,Tu=36061,Vf=36193,Cc=5121,uf=5126,jf=6407,Kl=6408,Ql=6402,Mh=[jf,Kl],hs=[];hs[Kl]=4,hs[jf]=3;var wu=[];wu[Cc]=1,wu[uf]=4,wu[Vf]=2;var lf=32854,Pl=32855,cu=36194,Ih=33189,Hu=36168,Hf=34041,Ph=35907,h=34836,v=34842,p=34843,g=[lf,Pl,cu,Ph,v,p,h],S={};S[Zf]="complete",S[ll]="incomplete attachment",S[ql]="incomplete dimensions",S[bs]="incomplete, missing attachment",S[Tu]="unsupported";function w(W,Ie,et,Jt,yr,tr){var Xt={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],Dr=["rgba4","rgb565","rgb5 a1"];Ie.ext_srgb&&Dr.push("srgba"),Ie.ext_color_buffer_half_float&&Dr.push("rgba16f","rgb16f"),Ie.webgl_color_buffer_float&&Dr.push("rgba32f");var Jr=["uint8"];Ie.oes_texture_half_float&&Jr.push("half float","float16"),Ie.oes_texture_float&&Jr.push("float","float32");function jr(ln,Fr,Er){this.target=ln,this.texture=Fr,this.renderbuffer=Er;var rr=0,Mi=0;Fr?(rr=Fr.width,Mi=Fr.height):Er&&(rr=Er.width,Mi=Er.height),this.width=rr,this.height=Mi}function qr(ln){ln&&(ln.texture&&ln.texture._texture.decRef(),ln.renderbuffer&&ln.renderbuffer._renderbuffer.decRef())}function an(ln,Fr,Er){if(ln)if(ln.texture){var rr=ln.texture._texture,Mi=Math.max(1,rr.width),it=Math.max(1,rr.height);be(Mi===Fr&&it===Er,"inconsistent width/height for supplied texture"),rr.refCount+=1}else{var Si=ln.renderbuffer._renderbuffer;be(Si.width===Fr&&Si.height===Er,"inconsistent width/height for renderbuffer"),Si.refCount+=1}}function Mr(ln,Fr){Fr&&(Fr.texture?W.framebufferTexture2D(Na,ln,Fr.target,Fr.texture._texture.texture,0):W.framebufferRenderbuffer(Na,ln,Js,Fr.renderbuffer._renderbuffer.renderbuffer))}function en(ln){var Fr=Su,Er=null,rr=null,Mi=ln;typeof ln=="object"&&(Mi=ln.data,"target"in ln&&(Fr=ln.target|0)),be.type(Mi,"function","invalid attachment data");var it=Mi._reglType;return it==="texture2d"?(Er=Mi,be(Fr===Su)):it==="textureCube"?(Er=Mi,be(Fr>=Au&&Fr<Au+6,"invalid cube map target")):it==="renderbuffer"?(rr=Mi,Fr=Js):be.raise("invalid regl object for attachment"),new jr(Fr,Er,rr)}function Ft(ln,Fr,Er,rr,Mi){if(Er){var it=Jt.create2D({width:ln,height:Fr,format:rr,type:Mi});return it._texture.refCount=0,new jr(Su,it,null)}else{var Si=yr.create({width:ln,height:Fr,format:rr});return Si._renderbuffer.refCount=0,new jr(Js,null,Si)}}function ur(ln){return ln&&(ln.texture||ln.renderbuffer)}function Zr(ln,Fr,Er){ln&&(ln.texture?ln.texture.resize(Fr,Er):ln.renderbuffer&&ln.renderbuffer.resize(Fr,Er),ln.width=Fr,ln.height=Er)}var dn=0,Cr={};function bn(){this.id=dn++,Cr[this.id]=this,this.framebuffer=W.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function kr(ln){ln.colorAttachments.forEach(qr),qr(ln.depthAttachment),qr(ln.stencilAttachment),qr(ln.depthStencilAttachment)}function vn(ln){var Fr=ln.framebuffer;be(Fr,"must not double destroy framebuffer"),W.deleteFramebuffer(Fr),ln.framebuffer=null,tr.framebufferCount--,delete Cr[ln.id]}function wr(ln){var Fr;W.bindFramebuffer(Na,ln.framebuffer);var Er=ln.colorAttachments;for(Fr=0;Fr<Er.length;++Fr)Mr(da+Fr,Er[Fr]);for(Fr=Er.length;Fr<et.maxColorAttachments;++Fr)W.framebufferTexture2D(Na,da+Fr,Su,null,0);W.framebufferTexture2D(Na,Il,Su,null,0),W.framebufferTexture2D(Na,_o,Su,null,0),W.framebufferTexture2D(Na,Rh,Su,null,0),Mr(_o,ln.depthAttachment),Mr(Rh,ln.stencilAttachment),Mr(Il,ln.depthStencilAttachment);var rr=W.checkFramebufferStatus(Na);!W.isContextLost()&&rr!==Zf&&be.raise("framebuffer configuration not supported, status = "+S[rr]),W.bindFramebuffer(Na,Xt.next?Xt.next.framebuffer:null),Xt.cur=Xt.next,W.getError()}function fn(ln,Fr){var Er=new bn;tr.framebufferCount++;function rr(it,Si){var pi;be(Xt.next!==Er,"can not update framebuffer which is currently in use");var ei=0,ra=0,mo=!0,go=!0,Di=null,xo=!0,Ca="rgba",Eo="uint8",So=1,Ya=null,zo=null,Ts=null,Ao=!1;if(typeof it=="number")ei=it|0,ra=Si|0||ei;else if(!it)ei=ra=1;else{be.type(it,"object","invalid arguments for framebuffer");var Ei=it;if("shape"in Ei){var ps=Ei.shape;be(Array.isArray(ps)&&ps.length>=2,"invalid shape for framebuffer"),ei=ps[0],ra=ps[1]}else"radius"in Ei&&(ei=ra=Ei.radius),"width"in Ei&&(ei=Ei.width),"height"in Ei&&(ra=Ei.height);("color"in Ei||"colors"in Ei)&&(Di=Ei.color||Ei.colors,Array.isArray(Di)&&be(Di.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in Ei&&(So=Ei.colorCount|0,be(So>0,"invalid color buffer count")),"colorTexture"in Ei&&(xo=!!Ei.colorTexture,Ca="rgba4"),"colorType"in Ei&&(Eo=Ei.colorType,xo?(be(Ie.oes_texture_float||!(Eo==="float"||Eo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),be(Ie.oes_texture_half_float||!(Eo==="half float"||Eo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Eo==="half float"||Eo==="float16"?(be(Ie.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ca="rgba16f"):(Eo==="float"||Eo==="float32")&&(be(Ie.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ca="rgba32f"),be.oneOf(Eo,Jr,"invalid color type")),"colorFormat"in Ei&&(Ca=Ei.colorFormat,Ur.indexOf(Ca)>=0?xo=!0:Dr.indexOf(Ca)>=0?xo=!1:xo?be.oneOf(Ei.colorFormat,Ur,"invalid color format for texture"):be.oneOf(Ei.colorFormat,Dr,"invalid color format for renderbuffer"))),("depthTexture"in Ei||"depthStencilTexture"in Ei)&&(Ao=!!(Ei.depthTexture||Ei.depthStencilTexture),be(!Ao||Ie.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ei&&(typeof Ei.depth=="boolean"?mo=Ei.depth:(Ya=Ei.depth,go=!1)),"stencil"in Ei&&(typeof Ei.stencil=="boolean"?go=Ei.stencil:(zo=Ei.stencil,mo=!1)),"depthStencil"in Ei&&(typeof Ei.depthStencil=="boolean"?mo=go=Ei.depthStencil:(Ts=Ei.depthStencil,mo=!1,go=!1))}var ha=null,Qn=null,ki=null,Ki=null;if(Array.isArray(Di))ha=Di.map(en);else if(Di)ha=[en(Di)];else for(ha=new Array(So),pi=0;pi<So;++pi)ha[pi]=Ft(ei,ra,xo,Ca,Eo);be(Ie.webgl_draw_buffers||ha.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),be(ha.length<=et.maxColorAttachments,"too many color attachments, not supported"),ei=ei||ha[0].width,ra=ra||ha[0].height,Ya?Qn=en(Ya):mo&&!go&&(Qn=Ft(ei,ra,Ao,"depth","uint32")),zo?ki=en(zo):go&&!mo&&(ki=Ft(ei,ra,!1,"stencil","uint8")),Ts?Ki=en(Ts):!Ya&&!zo&&go&&mo&&(Ki=Ft(ei,ra,Ao,"depth stencil","depth stencil")),be(!!Ya+!!zo+!!Ts<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var To=null;for(pi=0;pi<ha.length;++pi)if(an(ha[pi],ei,ra),be(!ha[pi]||ha[pi].texture&&Mh.indexOf(ha[pi].texture._texture.format)>=0||ha[pi].renderbuffer&&g.indexOf(ha[pi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+pi+" is invalid"),ha[pi]&&ha[pi].texture){var ml=hs[ha[pi].texture._texture.format]*wu[ha[pi].texture._texture.type];To===null?To=ml:be(To===ml,"all color attachments much have the same number of bits per pixel.")}return an(Qn,ei,ra),be(!Qn||Qn.texture&&Qn.texture._texture.format===Ql||Qn.renderbuffer&&Qn.renderbuffer._renderbuffer.format===Ih,"invalid depth attachment for framebuffer object"),an(ki,ei,ra),be(!ki||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===Hu,"invalid stencil attachment for framebuffer object"),an(Ki,ei,ra),be(!Ki||Ki.texture&&Ki.texture._texture.format===Hf||Ki.renderbuffer&&Ki.renderbuffer._renderbuffer.format===Hf,"invalid depth-stencil attachment for framebuffer object"),kr(Er),Er.width=ei,Er.height=ra,Er.colorAttachments=ha,Er.depthAttachment=Qn,Er.stencilAttachment=ki,Er.depthStencilAttachment=Ki,rr.color=ha.map(ur),rr.depth=ur(Qn),rr.stencil=ur(ki),rr.depthStencil=ur(Ki),rr.width=Er.width,rr.height=Er.height,wr(Er),rr}function Mi(it,Si){be(Xt.next!==Er,"can not resize a framebuffer which is currently in use");var pi=Math.max(it|0,1),ei=Math.max(Si|0||pi,1);if(pi===Er.width&&ei===Er.height)return rr;for(var ra=Er.colorAttachments,mo=0;mo<ra.length;++mo)Zr(ra[mo],pi,ei);return Zr(Er.depthAttachment,pi,ei),Zr(Er.stencilAttachment,pi,ei),Zr(Er.depthStencilAttachment,pi,ei),Er.width=rr.width=pi,Er.height=rr.height=ei,wr(Er),rr}return rr(ln,Fr),B(rr,{resize:Mi,_reglType:"framebuffer",_framebuffer:Er,destroy:function(){vn(Er),kr(Er)},use:function(it){Xt.setFBO({framebuffer:rr},it)}})}function Xn(ln){var Fr=Array(6);function Er(Mi){var it;be(Fr.indexOf(Xt.next)<0,"can not update framebuffer which is currently in use");var Si={color:null},pi=0,ei=null,ra="rgba",mo="uint8",go=1;if(typeof Mi=="number")pi=Mi|0;else if(!Mi)pi=1;else{be.type(Mi,"object","invalid arguments for framebuffer");var Di=Mi;if("shape"in Di){var xo=Di.shape;be(Array.isArray(xo)&&xo.length>=2,"invalid shape for framebuffer"),be(xo[0]===xo[1],"cube framebuffer must be square"),pi=xo[0]}else"radius"in Di&&(pi=Di.radius|0),"width"in Di?(pi=Di.width|0,"height"in Di&&be(Di.height===pi,"must be square")):"height"in Di&&(pi=Di.height|0);("color"in Di||"colors"in Di)&&(ei=Di.color||Di.colors,Array.isArray(ei)&&be(ei.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),ei||("colorCount"in Di&&(go=Di.colorCount|0,be(go>0,"invalid color buffer count")),"colorType"in Di&&(be.oneOf(Di.colorType,Jr,"invalid color type"),mo=Di.colorType),"colorFormat"in Di&&(ra=Di.colorFormat,be.oneOf(Di.colorFormat,Ur,"invalid color format for texture"))),"depth"in Di&&(Si.depth=Di.depth),"stencil"in Di&&(Si.stencil=Di.stencil),"depthStencil"in Di&&(Si.depthStencil=Di.depthStencil)}var Ca;if(ei)if(Array.isArray(ei))for(Ca=[],it=0;it<ei.length;++it)Ca[it]=ei[it];else Ca=[ei];else{Ca=Array(go);var Eo={radius:pi,format:ra,type:mo};for(it=0;it<go;++it)Ca[it]=Jt.createCube(Eo)}for(Si.color=Array(Ca.length),it=0;it<Ca.length;++it){var So=Ca[it];be(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),pi=pi||So.width,be(So.width===pi&&So.height===pi,"invalid cube map shape"),Si.color[it]={target:Au,data:Ca[it]}}for(it=0;it<6;++it){for(var Ya=0;Ya<Ca.length;++Ya)Si.color[Ya].target=Au+it;it>0&&(Si.depth=Fr[0].depth,Si.stencil=Fr[0].stencil,Si.depthStencil=Fr[0].depthStencil),Fr[it]?Fr[it](Si):Fr[it]=fn(Si)}return B(Er,{width:pi,height:pi,color:Ca})}function rr(Mi){var it,Si=Mi|0;if(be(Si>0&&Si<=et.maxCubeMapSize,"invalid radius for cube fbo"),Si===Er.width)return Er;var pi=Er.color;for(it=0;it<pi.length;++it)pi[it].resize(Si);for(it=0;it<6;++it)Fr[it].resize(Si);return Er.width=Er.height=Si,Er}return Er(ln),B(Er,{faces:Fr,resize:rr,_reglType:"framebufferCube",destroy:function(){Fr.forEach(function(Mi){Mi.destroy()})}})}function li(){Xt.cur=null,Xt.next=null,Xt.dirty=!0,sa(Cr).forEach(function(ln){ln.framebuffer=W.createFramebuffer(),wr(ln)})}return B(Xt,{getFramebuffer:function(ln){if(typeof ln=="function"&&ln._reglType==="framebuffer"){var Fr=ln._framebuffer;if(Fr instanceof bn)return Fr}return null},create:fn,createCube:Xn,clear:function(){sa(Cr).forEach(vn)},restore:li})}var R=5126,P=34962;function X(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function te(W,Ie,et,Jt,yr){for(var tr=et.maxAttributes,Xt=new Array(tr),Ur=0;Ur<tr;++Ur)Xt[Ur]=new X;var Dr=0,Jr={},jr={Record:X,scope:{},state:Xt,currentVAO:null,targetVAO:null,restore:an()?Cr:function(){},createVAO:bn,getVAO:en,destroyBuffer:qr,setVAO:an()?Ft:ur,clear:an()?Zr:function(){}};function qr(kr){for(var vn=0;vn<Xt.length;++vn){var wr=Xt[vn];wr.buffer===kr&&(W.disableVertexAttribArray(vn),wr.buffer=null)}}function an(){return Ie.oes_vertex_array_object}function Mr(){return Ie.angle_instanced_arrays}function en(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function Ft(kr){if(kr!==jr.currentVAO){var vn=an();kr?vn.bindVertexArrayOES(kr.vao):vn.bindVertexArrayOES(null),jr.currentVAO=kr}}function ur(kr){if(kr!==jr.currentVAO){if(kr)kr.bindAttrs();else for(var vn=Mr(),wr=0;wr<Xt.length;++wr){var fn=Xt[wr];fn.buffer?(W.enableVertexAttribArray(wr),W.vertexAttribPointer(wr,fn.size,fn.type,fn.normalized,fn.stride,fn.offfset),vn&&vn.vertexAttribDivisorANGLE(wr,fn.divisor)):(W.disableVertexAttribArray(wr),W.vertexAttrib4f(wr,fn.x,fn.y,fn.z,fn.w))}jr.currentVAO=kr}}function Zr(){sa(Jr).forEach(function(kr){kr.destroy()})}function dn(){this.id=++Dr,this.attributes=[];var kr=an();kr?this.vao=kr.createVertexArrayOES():this.vao=null,Jr[this.id]=this,this.buffers=[]}dn.prototype.bindAttrs=function(){for(var kr=Mr(),vn=this.attributes,wr=0;wr<vn.length;++wr){var fn=vn[wr];fn.buffer?(W.enableVertexAttribArray(wr),W.bindBuffer(P,fn.buffer.buffer),W.vertexAttribPointer(wr,fn.size,fn.type,fn.normalized,fn.stride,fn.offset),kr&&kr.vertexAttribDivisorANGLE(wr,fn.divisor)):(W.disableVertexAttribArray(wr),W.vertexAttrib4f(wr,fn.x,fn.y,fn.z,fn.w))}for(var Xn=vn.length;Xn<tr;++Xn)W.disableVertexAttribArray(Xn)},dn.prototype.refresh=function(){var kr=an();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=this)},dn.prototype.destroy=function(){if(this.vao){var kr=an();this===jr.currentVAO&&(jr.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}Jr[this.id]&&(delete Jr[this.id],Jt.vaoCount-=1)};function Cr(){var kr=an();kr&&sa(Jr).forEach(function(vn){vn.refresh()})}function bn(kr){var vn=new dn;Jt.vaoCount+=1;function wr(fn){be(Array.isArray(fn),"arguments to vertex array constructor must be an array"),be(fn.length<tr,"too many attributes"),be(fn.length>0,"must specify at least one attribute");for(var Xn=0;Xn<vn.buffers.length;++Xn)vn.buffers[Xn].destroy();vn.buffers.length=0;var li=vn.attributes;li.length=fn.length;for(var ln=0;ln<fn.length;++ln){var Fr=fn[ln],Er=li[ln]=new X;if(Array.isArray(Fr)||re(Fr)||wa(Fr)){var rr=yr.create(Fr,P,!1,!0);Er.buffer=yr.getBuffer(rr),Er.size=Er.buffer.dimension|0,Er.normalized=!1,Er.type=Er.buffer.dtype,Er.offset=0,Er.stride=0,Er.divisor=0,Er.state=1,vn.buffers.push(rr)}else yr.getBuffer(Fr)?(Er.buffer=yr.getBuffer(Fr),Er.size=Er.buffer.dimension|0,Er.normalized=!1,Er.type=Er.buffer.dtype,Er.offset=0,Er.stride=0,Er.divisor=0,Er.state=1):yr.getBuffer(Fr.buffer)?(Er.buffer=yr.getBuffer(Fr.buffer),Er.size=(+Fr.size||Er.buffer.dimension)|0,Er.normalized=!!Fr.normalized||!1,"type"in Fr?(be.parameter(Fr.type,Jo,"invalid buffer type"),Er.type=Jo[Fr.type]):Er.type=Er.buffer.dtype,Er.offset=(Fr.offset||0)|0,Er.stride=(Fr.stride||0)|0,Er.divisor=(Fr.divisor||0)|0,Er.state=1,be(Er.size>=1&&Er.size<=4,"size must be between 1 and 4"),be(Er.offset>=0,"invalid offset"),be(Er.stride>=0&&Er.stride<=255,"stride must be between 0 and 255"),be(Er.divisor>=0,"divisor must be positive"),be(!Er.divisor||!!Ie.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Fr?(be(ln>0,"first attribute must not be a constant"),Er.x=+Fr.x||0,Er.y=+Fr.y||0,Er.z=+Fr.z||0,Er.w=+Fr.w||0,Er.state=2):be(!1,"invalid attribute spec for location "+ln)}return vn.refresh(),wr}return wr.destroy=function(){vn.destroy()},wr._vao=vn,wr._reglType="vao",wr(kr)}return jr}var ye=35632,Ee=35633,Ce=35718,Xe=35721;function We(W,Ie,et,Jt){var yr={},tr={};function Xt(Ft,ur,Zr,dn){this.name=Ft,this.id=ur,this.location=Zr,this.info=dn}function Ur(Ft,ur){for(var Zr=0;Zr<Ft.length;++Zr)if(Ft[Zr].id===ur.id){Ft[Zr].location=ur.location;return}Ft.push(ur)}function Dr(Ft,ur,Zr){var dn=Ft===ye?yr:tr,Cr=dn[ur];if(!Cr){var bn=Ie.str(ur);Cr=W.createShader(Ft),W.shaderSource(Cr,bn),W.compileShader(Cr),be.shaderError(W,Cr,bn,Ft,Zr),dn[ur]=Cr}return Cr}var Jr={},jr=[],qr=0;function an(Ft,ur){this.id=qr++,this.fragId=Ft,this.vertId=ur,this.program=null,this.uniforms=[],this.attributes=[],Jt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Mr(Ft,ur,Zr){var dn,Cr,bn=Dr(ye,Ft.fragId),kr=Dr(Ee,Ft.vertId),vn=Ft.program=W.createProgram();if(W.attachShader(vn,bn),W.attachShader(vn,kr),Zr)for(dn=0;dn<Zr.length;++dn){var wr=Zr[dn];W.bindAttribLocation(vn,wr[0],wr[1])}W.linkProgram(vn),be.linkError(W,vn,Ie.str(Ft.fragId),Ie.str(Ft.vertId),ur);var fn=W.getProgramParameter(vn,Ce);Jt.profile&&(Ft.stats.uniformsCount=fn);var Xn=Ft.uniforms;for(dn=0;dn<fn;++dn)if(Cr=W.getActiveUniform(vn,dn),Cr)if(Cr.size>1)for(var li=0;li<Cr.size;++li){var ln=Cr.name.replace("[0]","["+li+"]");Ur(Xn,new Xt(ln,Ie.id(ln),W.getUniformLocation(vn,ln),Cr))}else Ur(Xn,new Xt(Cr.name,Ie.id(Cr.name),W.getUniformLocation(vn,Cr.name),Cr));var Fr=W.getProgramParameter(vn,Xe);Jt.profile&&(Ft.stats.attributesCount=Fr);var Er=Ft.attributes;for(dn=0;dn<Fr;++dn)Cr=W.getActiveAttrib(vn,dn),Cr&&Ur(Er,new Xt(Cr.name,Ie.id(Cr.name),W.getAttribLocation(vn,Cr.name),Cr))}Jt.profile&&(et.getMaxUniformsCount=function(){var Ft=0;return jr.forEach(function(ur){ur.stats.uniformsCount>Ft&&(Ft=ur.stats.uniformsCount)}),Ft},et.getMaxAttributesCount=function(){var Ft=0;return jr.forEach(function(ur){ur.stats.attributesCount>Ft&&(Ft=ur.stats.attributesCount)}),Ft});function en(){yr={},tr={};for(var Ft=0;Ft<jr.length;++Ft)Mr(jr[Ft],null,jr[Ft].attributes.map(function(ur){return[ur.location,ur.name]}))}return{clear:function(){var Ft=W.deleteShader.bind(W);sa(yr).forEach(Ft),yr={},sa(tr).forEach(Ft),tr={},jr.forEach(function(ur){W.deleteProgram(ur.program)}),jr.length=0,Jr={},et.shaderCount=0},program:function(Ft,ur,Zr,dn){be.command(Ft>=0,"missing vertex shader",Zr),be.command(ur>=0,"missing fragment shader",Zr);var Cr=Jr[ur];Cr||(Cr=Jr[ur]={});var bn=Cr[Ft];if(bn&&!dn)return bn;var kr=new an(ur,Ft);return et.shaderCount++,Mr(kr,Zr,dn),bn||(Cr[Ft]=kr),jr.push(kr),kr},restore:en,shader:Dr,frag:-1,vert:-1}}var ft=6408,Ue=5121,ct=3333,Et=5126;function zt(W,Ie,et,Jt,yr,tr,Xt){function Ur(jr){var qr;Ie.next===null?(be(yr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),qr=Ue):(be(Ie.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),qr=Ie.next.colorAttachments[0].texture._texture.type,tr.oes_texture_float?(be(qr===Ue||qr===Et,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),qr===Et&&be(Xt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):be(qr===Ue,"Reading from a framebuffer is only allowed for the type 'uint8'"));var an=0,Mr=0,en=Jt.framebufferWidth,Ft=Jt.framebufferHeight,ur=null;re(jr)?ur=jr:jr&&(be.type(jr,"object","invalid arguments to regl.read()"),an=jr.x|0,Mr=jr.y|0,be(an>=0&&an<Jt.framebufferWidth,"invalid x offset for regl.read"),be(Mr>=0&&Mr<Jt.framebufferHeight,"invalid y offset for regl.read"),en=(jr.width||Jt.framebufferWidth-an)|0,Ft=(jr.height||Jt.framebufferHeight-Mr)|0,ur=jr.data||null),ur&&(qr===Ue?be(ur instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):qr===Et&&be(ur instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),be(en>0&&en+an<=Jt.framebufferWidth,"invalid width for read pixels"),be(Ft>0&&Ft+Mr<=Jt.framebufferHeight,"invalid height for read pixels"),et();var Zr=en*Ft*4;return ur||(qr===Ue?ur=new Uint8Array(Zr):qr===Et&&(ur=ur||new Float32Array(Zr))),be.isTypedArray(ur,"data buffer for regl.read() must be a typedarray"),be(ur.byteLength>=Zr,"data buffer for regl.read() too small"),W.pixelStorei(ct,4),W.readPixels(an,Mr,en,Ft,ft,qr,ur),ur}function Dr(jr){var qr;return Ie.setFBO({framebuffer:jr.framebuffer},function(){qr=Ur(jr)}),qr}function Jr(jr){return!jr||!("framebuffer"in jr)?Ur(jr):Dr(jr)}return Jr}function or(W){return Array.prototype.slice.call(W)}function Qt(W){return or(W).join("")}function fr(){var W=0,Ie=[],et=[];function Jt(qr){for(var an=0;an<et.length;++an)if(et[an]===qr)return Ie[an];var Mr="g"+W++;return Ie.push(Mr),et.push(qr),Mr}function yr(){var qr=[];function an(){qr.push.apply(qr,or(arguments))}var Mr=[];function en(){var Ft="v"+W++;return Mr.push(Ft),arguments.length>0&&(qr.push(Ft,"="),qr.push.apply(qr,or(arguments)),qr.push(";")),Ft}return B(an,{def:en,toString:function(){return Qt([Mr.length>0?"var "+Mr.join(",")+";":"",Qt(qr)])}})}function tr(){var qr=yr(),an=yr(),Mr=qr.toString,en=an.toString;function Ft(ur,Zr){an(ur,Zr,"=",qr.def(ur,Zr),";")}return B(function(){qr.apply(qr,or(arguments))},{def:qr.def,entry:qr,exit:an,save:Ft,set:function(ur,Zr,dn){Ft(ur,Zr),qr(ur,Zr,"=",dn,";")},toString:function(){return Mr()+en()}})}function Xt(){var qr=Qt(arguments),an=tr(),Mr=tr(),en=an.toString,Ft=Mr.toString;return B(an,{then:function(){return an.apply(an,or(arguments)),this},else:function(){return Mr.apply(Mr,or(arguments)),this},toString:function(){var ur=Ft();return ur&&(ur="else{"+ur+"}"),Qt(["if(",qr,"){",en(),"}",ur])}})}var Ur=yr(),Dr={};function Jr(qr,an){var Mr=[];function en(){var Cr="a"+Mr.length;return Mr.push(Cr),Cr}an=an||0;for(var Ft=0;Ft<an;++Ft)en();var ur=tr(),Zr=ur.toString,dn=Dr[qr]=B(ur,{arg:en,toString:function(){return Qt(["function(",Mr.join(),"){",Zr(),"}"])}});return dn}function jr(){var qr=['"use strict";',Ur,"return {"];Object.keys(Dr).forEach(function(en){qr.push('"',en,'":',Dr[en].toString(),",")}),qr.push("}");var an=Qt(qr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Mr=Function.apply(null,Ie.concat(an));return Mr.apply(null,et)}return{global:Ur,link:Jt,block:yr,proc:Jr,scope:tr,cond:Xt,compile:jr}}var Ar="xyzw".split(""),Yr=5121,zr=1,_n=2,jn=0,zn=1,Hn=2,Wi=3,An=4,ui="dither",gi="blend.enable",oi="blend.color",ri="blend.equation",vi="blend.func",ni="depth.enable",Kn="depth.func",ko="depth.range",to="depth.mask",Do="colorMask",bo="cull.enable",$a="cull.face",ro="frontFace",xs="lineWidth",Es="polygonOffset.enable",cl="polygonOffset.offset",Ss="sample.alpha",fu="sample.enable",Zs="sample.coverage",Rc="stencil.enable",Wu="stencil.mask",Cu="stencil.func",Jl="stencil.opFront",fl="stencil.opBack",hu="scissor.enable",hl="scissor.box",Lo="viewport",uo="profile",Is="framebuffer",pu="vert",Ru="frag",Zi="elements",ts="primitive",lo="count",du="offset",Mc="instances",Gu="vao",Oh="Width",Bo="Height",Br=Is+Oh,Vs=Is+Bo,kh=Lo+Oh,Fo=Lo+Bo,eu="drawingBuffer",No=eu+Oh,dp=eu+Bo,ec=[vi,ri,Cu,Jl,fl,Zs,Lo,hl,cl],pl=34962,Gp=34963,sg=35632,Vv=35633,Wf=3553,vp=34067,Dh=2884,zd=3042,Ic=3024,Lh=2960,jv=2929,Zd=3089,ug=32823,Xp=32926,Vd=32928,jd=5126,$p=35664,Ol=35665,mp=35666,Pc=5124,Yp=35667,no=35668,Gf=35669,Xf=35670,dl=35671,cf=35672,Oc=35673,$f=35674,Yf=35675,kc=35676,Dc=35678,tc=35680,qp=4,rc=1028,ff=1029,gp=2304,Kp=2305,Bh=32775,Qp=32776,tu=519,Lc=7680,yp=0,Hd=1,Fh=32774,Jp=513,nc=36160,ed=36064,vl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},_p=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ru={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Bc={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},td={frag:sg,vert:Vv},ic={cw:gp,ccw:Kp};function qf(W){return Array.isArray(W)||re(W)||wa(W)}function Kf(W){return W.sort(function(Ie,et){return Ie===Lo?-1:et===Lo?1:Ie<et?-1:1})}function Ps(W,Ie,et,Jt){this.thisDep=W,this.contextDep=Ie,this.propDep=et,this.append=Jt}function As(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function Uo(W){return new Ps(!1,!1,!1,W)}function nu(W,Ie){var et=W.type;if(et===jn){var Jt=W.data.length;return new Ps(!0,Jt>=1,Jt>=2,Ie)}else if(et===An){var yr=W.data;return new Ps(yr.thisDep,yr.contextDep,yr.propDep,Ie)}else return new Ps(et===Wi,et===Hn,et===zn,Ie)}var bp=new Ps(!1,!1,!1,function(){});function Qf(W,Ie,et,Jt,yr,tr,Xt,Ur,Dr,Jr,jr,qr,an,Mr,en){var Ft=Jr.Record,ur={add:32774,subtract:32778,"reverse subtract":32779};et.ext_blend_minmax&&(ur.min=Bh,ur.max=Qp);var Zr=et.angle_instanced_arrays,dn=et.webgl_draw_buffers,Cr={dirty:!0,profile:en.profile},bn={},kr=[],vn={},wr={};function fn(ve){return ve.replace(".","_")}function Xn(ve,Oe,tt){var qt=fn(ve);kr.push(ve),bn[qt]=Cr[qt]=!!tt,vn[qt]=Oe}function li(ve,Oe,tt){var qt=fn(ve);kr.push(ve),Array.isArray(tt)?(Cr[qt]=tt.slice(),bn[qt]=tt.slice()):Cr[qt]=bn[qt]=tt,wr[qt]=Oe}Xn(ui,Ic),Xn(gi,zd),li(oi,"blendColor",[0,0,0,0]),li(ri,"blendEquationSeparate",[Fh,Fh]),li(vi,"blendFuncSeparate",[Hd,yp,Hd,yp]),Xn(ni,jv,!0),li(Kn,"depthFunc",Jp),li(ko,"depthRange",[0,1]),li(to,"depthMask",!0),li(Do,Do,[!0,!0,!0,!0]),Xn(bo,Dh),li($a,"cullFace",ff),li(ro,ro,Kp),li(xs,xs,1),Xn(Es,ug),li(cl,"polygonOffset",[0,0]),Xn(Ss,Xp),Xn(fu,Vd),li(Zs,"sampleCoverage",[1,!1]),Xn(Rc,Lh),li(Wu,"stencilMask",-1),li(Cu,"stencilFunc",[tu,0,-1]),li(Jl,"stencilOpSeparate",[rc,Lc,Lc,Lc]),li(fl,"stencilOpSeparate",[ff,Lc,Lc,Lc]),Xn(hu,Zd),li(hl,"scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),li(Lo,Lo,[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var ln={gl:W,context:an,strings:Ie,next:bn,current:Cr,draw:qr,elements:tr,buffer:yr,shader:jr,attributes:Jr.state,vao:Jr,uniforms:Dr,framebuffer:Ur,extensions:et,timer:Mr,isBufferArgs:qf},Fr={primTypes:Nu,compareFuncs:ru,blendFuncs:vl,blendEquations:ur,stencilOps:Bc,glTypes:Jo,orientationType:ic};be.optional(function(){ln.isArrayLike=Wa}),dn&&(Fr.backBuffer=[ff],Fr.drawBuffer=yt(Jt.maxDrawbuffers,function(ve){return ve===0?[0]:yt(ve,function(Oe){return ed+Oe})}));var Er=0;function rr(){var ve=fr(),Oe=ve.link,tt=ve.global;ve.id=Er++,ve.batchId="0";var qt=Oe(ln),Wt=ve.shared={props:"a0"};Object.keys(ln).forEach(function(vt){Wt[vt]=tt.def(qt,".",vt)}),be.optional(function(){ve.CHECK=Oe(be),ve.commandStr=be.guessCommand(),ve.command=Oe(ve.commandStr),ve.assert=function(vt,Pe,_t){vt("if(!(",Pe,"))",this.CHECK,".commandRaise(",Oe(_t),",",this.command,");")},Fr.invalidBlendCombinations=_p});var ht=ve.next={},xt=ve.current={};Object.keys(wr).forEach(function(vt){Array.isArray(Cr[vt])&&(ht[vt]=tt.def(Wt.next,".",vt),xt[vt]=tt.def(Wt.current,".",vt))});var wt=ve.constants={};Object.keys(Fr).forEach(function(vt){wt[vt]=tt.def(JSON.stringify(Fr[vt]))}),ve.invoke=function(vt,Pe){switch(Pe.type){case jn:var _t=["this",Wt.context,Wt.props,ve.batchId];return vt.def(Oe(Pe.data),".call(",_t.slice(0,Math.max(Pe.data.length+1,4)),")");case zn:return vt.def(Wt.props,Pe.data);case Hn:return vt.def(Wt.context,Pe.data);case Wi:return vt.def("this",Pe.data);case An:return Pe.data.append(ve,vt),Pe.data.ref}},ve.attribCache={};var qe={};return ve.scopeAttrib=function(vt){var Pe=Ie.id(vt);if(Pe in qe)return qe[Pe];var _t=Jr.scope[Pe];_t||(_t=Jr.scope[Pe]=new Ft);var Lt=qe[Pe]=Oe(_t);return Lt},ve}function Mi(ve){var Oe=ve.static,tt=ve.dynamic,qt;if(uo in Oe){var Wt=!!Oe[uo];qt=Uo(function(xt,wt){return Wt}),qt.enable=Wt}else if(uo in tt){var ht=tt[uo];qt=nu(ht,function(xt,wt){return xt.invoke(wt,ht)})}return qt}function it(ve,Oe){var tt=ve.static,qt=ve.dynamic;if(Is in tt){var Wt=tt[Is];return Wt?(Wt=Ur.getFramebuffer(Wt),be.command(Wt,"invalid framebuffer object"),Uo(function(xt,wt){var qe=xt.link(Wt),vt=xt.shared;wt.set(vt.framebuffer,".next",qe);var Pe=vt.context;return wt.set(Pe,"."+Br,qe+".width"),wt.set(Pe,"."+Vs,qe+".height"),qe})):Uo(function(xt,wt){var qe=xt.shared;wt.set(qe.framebuffer,".next","null");var vt=qe.context;return wt.set(vt,"."+Br,vt+"."+No),wt.set(vt,"."+Vs,vt+"."+dp),"null"})}else if(Is in qt){var ht=qt[Is];return nu(ht,function(xt,wt){var qe=xt.invoke(wt,ht),vt=xt.shared,Pe=vt.framebuffer,_t=wt.def(Pe,".getFramebuffer(",qe,")");be.optional(function(){xt.assert(wt,"!"+qe+"||"+_t,"invalid framebuffer object")}),wt.set(Pe,".next",_t);var Lt=vt.context;return wt.set(Lt,"."+Br,_t+"?"+_t+".width:"+Lt+"."+No),wt.set(Lt,"."+Vs,_t+"?"+_t+".height:"+Lt+"."+dp),_t})}else return null}function Si(ve,Oe,tt){var qt=ve.static,Wt=ve.dynamic;function ht(qe){if(qe in qt){var vt=qt[qe];be.commandType(vt,"object","invalid "+qe,tt.commandStr);var Pe=!0,_t=vt.x|0,Lt=vt.y|0,hr,Pr;return"width"in vt?(hr=vt.width|0,be.command(hr>=0,"invalid "+qe,tt.commandStr)):Pe=!1,"height"in vt?(Pr=vt.height|0,be.command(Pr>=0,"invalid "+qe,tt.commandStr)):Pe=!1,new Ps(!Pe&&Oe&&Oe.thisDep,!Pe&&Oe&&Oe.contextDep,!Pe&&Oe&&Oe.propDep,function(Ln,Mn){var On=Ln.shared.context,Jn=hr;"width"in vt||(Jn=Mn.def(On,".",Br,"-",_t));var si=Pr;return"height"in vt||(si=Mn.def(On,".",Vs,"-",Lt)),[_t,Lt,Jn,si]})}else if(qe in Wt){var Tr=Wt[qe],Ir=nu(Tr,function(Ln,Mn){var On=Ln.invoke(Mn,Tr);be.optional(function(){Ln.assert(Mn,On+"&&typeof "+On+'==="object"',"invalid "+qe)});var Jn=Ln.shared.context,si=Mn.def(On,".x|0"),pa=Mn.def(On,".y|0"),Zo=Mn.def('"width" in ',On,"?",On,".width|0:","(",Jn,".",Br,"-",si,")"),Xu=Mn.def('"height" in ',On,"?",On,".height|0:","(",Jn,".",Vs,"-",pa,")");return be.optional(function(){Ln.assert(Mn,Zo+">=0&&"+Xu+">=0","invalid "+qe)}),[si,pa,Zo,Xu]});return Oe&&(Ir.thisDep=Ir.thisDep||Oe.thisDep,Ir.contextDep=Ir.contextDep||Oe.contextDep,Ir.propDep=Ir.propDep||Oe.propDep),Ir}else return Oe?new Ps(Oe.thisDep,Oe.contextDep,Oe.propDep,function(Ln,Mn){var On=Ln.shared.context;return[0,0,Mn.def(On,".",Br),Mn.def(On,".",Vs)]}):null}var xt=ht(Lo);if(xt){var wt=xt;xt=new Ps(xt.thisDep,xt.contextDep,xt.propDep,function(qe,vt){var Pe=wt.append(qe,vt),_t=qe.shared.context;return vt.set(_t,"."+kh,Pe[2]),vt.set(_t,"."+Fo,Pe[3]),Pe})}return{viewport:xt,scissor_box:ht(hl)}}function pi(ve,Oe){var tt=ve.static,qt=typeof tt[Ru]=="string"&&typeof tt[pu]=="string";if(qt){if(Object.keys(Oe.dynamic).length>0)return null;var Wt=Oe.static,ht=Object.keys(Wt);if(ht.length>0&&typeof Wt[ht[0]]=="number"){for(var xt=[],wt=0;wt<ht.length;++wt)be(typeof Wt[ht[wt]]=="number","must specify all vertex attribute locations when using vaos"),xt.push([Wt[ht[wt]]|0,ht[wt]]);return xt}}return null}function ei(ve,Oe,tt){var qt=ve.static,Wt=ve.dynamic;function ht(Pe){if(Pe in qt){var _t=Ie.id(qt[Pe]);be.optional(function(){jr.shader(td[Pe],_t,be.guessCommand())});var Lt=Uo(function(){return _t});return Lt.id=_t,Lt}else if(Pe in Wt){var hr=Wt[Pe];return nu(hr,function(Pr,Tr){var Ir=Pr.invoke(Tr,hr),Ln=Tr.def(Pr.shared.strings,".id(",Ir,")");return be.optional(function(){Tr(Pr.shared.shader,".shader(",td[Pe],",",Ln,",",Pr.command,");")}),Ln})}return null}var xt=ht(Ru),wt=ht(pu),qe=null,vt;return As(xt)&&As(wt)?(qe=jr.program(wt.id,xt.id,null,tt),vt=Uo(function(Pe,_t){return Pe.link(qe)})):vt=new Ps(xt&&xt.thisDep||wt&&wt.thisDep,xt&&xt.contextDep||wt&&wt.contextDep,xt&&xt.propDep||wt&&wt.propDep,function(Pe,_t){var Lt=Pe.shared.shader,hr;xt?hr=xt.append(Pe,_t):hr=_t.def(Lt,".",Ru);var Pr;wt?Pr=wt.append(Pe,_t):Pr=_t.def(Lt,".",pu);var Tr=Lt+".program("+Pr+","+hr;return be.optional(function(){Tr+=","+Pe.command}),_t.def(Tr+")")}),{frag:xt,vert:wt,progVar:vt,program:qe}}function ra(ve,Oe){var tt=ve.static,qt=ve.dynamic;function Wt(){if(Zi in tt){var Pe=tt[Zi];qf(Pe)?Pe=tr.getElements(tr.create(Pe,!0)):Pe&&(Pe=tr.getElements(Pe),be.command(Pe,"invalid elements",Oe.commandStr));var _t=Uo(function(hr,Pr){if(Pe){var Tr=hr.link(Pe);return hr.ELEMENTS=Tr,Tr}return hr.ELEMENTS=null,null});return _t.value=Pe,_t}else if(Zi in qt){var Lt=qt[Zi];return nu(Lt,function(hr,Pr){var Tr=hr.shared,Ir=Tr.isBufferArgs,Ln=Tr.elements,Mn=hr.invoke(Pr,Lt),On=Pr.def("null"),Jn=Pr.def(Ir,"(",Mn,")"),si=hr.cond(Jn).then(On,"=",Ln,".createStream(",Mn,");").else(On,"=",Ln,".getElements(",Mn,");");return be.optional(function(){hr.assert(si.else,"!"+Mn+"||"+On,"invalid elements")}),Pr.entry(si),Pr.exit(hr.cond(Jn).then(Ln,".destroyStream(",On,");")),hr.ELEMENTS=On,On})}return null}var ht=Wt();function xt(){if(ts in tt){var Pe=tt[ts];return be.commandParameter(Pe,Nu,"invalid primitve",Oe.commandStr),Uo(function(Lt,hr){return Nu[Pe]})}else if(ts in qt){var _t=qt[ts];return nu(_t,function(Lt,hr){var Pr=Lt.constants.primTypes,Tr=Lt.invoke(hr,_t);return be.optional(function(){Lt.assert(hr,Tr+" in "+Pr,"invalid primitive, must be one of "+Object.keys(Nu))}),hr.def(Pr,"[",Tr,"]")})}else if(ht)return As(ht)?ht.value?Uo(function(Lt,hr){return hr.def(Lt.ELEMENTS,".primType")}):Uo(function(){return qp}):new Ps(ht.thisDep,ht.contextDep,ht.propDep,function(Lt,hr){var Pr=Lt.ELEMENTS;return hr.def(Pr,"?",Pr,".primType:",qp)});return null}function wt(Pe,_t){if(Pe in tt){var Lt=tt[Pe]|0;return be.command(!_t||Lt>=0,"invalid "+Pe,Oe.commandStr),Uo(function(Pr,Tr){return _t&&(Pr.OFFSET=Lt),Lt})}else if(Pe in qt){var hr=qt[Pe];return nu(hr,function(Pr,Tr){var Ir=Pr.invoke(Tr,hr);return _t&&(Pr.OFFSET=Ir,be.optional(function(){Pr.assert(Tr,Ir+">=0","invalid "+Pe)})),Ir})}else if(_t&&ht)return Uo(function(Pr,Tr){return Pr.OFFSET="0",0});return null}var qe=wt(du,!0);function vt(){if(lo in tt){var Pe=tt[lo]|0;return be.command(typeof Pe=="number"&&Pe>=0,"invalid vertex count",Oe.commandStr),Uo(function(){return Pe})}else if(lo in qt){var _t=qt[lo];return nu(_t,function(Pr,Tr){var Ir=Pr.invoke(Tr,_t);return be.optional(function(){Pr.assert(Tr,"typeof "+Ir+'==="number"&&'+Ir+">=0&&"+Ir+"===("+Ir+"|0)","invalid vertex count")}),Ir})}else if(ht)if(As(ht)){if(ht)return qe?new Ps(qe.thisDep,qe.contextDep,qe.propDep,function(Pr,Tr){var Ir=Tr.def(Pr.ELEMENTS,".vertCount-",Pr.OFFSET);return be.optional(function(){Pr.assert(Tr,Ir+">=0","invalid vertex offset/element buffer too small")}),Ir}):Uo(function(Pr,Tr){return Tr.def(Pr.ELEMENTS,".vertCount")});var Lt=Uo(function(){return-1});return be.optional(function(){Lt.MISSING=!0}),Lt}else{var hr=new Ps(ht.thisDep||qe.thisDep,ht.contextDep||qe.contextDep,ht.propDep||qe.propDep,function(Pr,Tr){var Ir=Pr.ELEMENTS;return Pr.OFFSET?Tr.def(Ir,"?",Ir,".vertCount-",Pr.OFFSET,":-1"):Tr.def(Ir,"?",Ir,".vertCount:-1")});return be.optional(function(){hr.DYNAMIC=!0}),hr}return null}return{elements:ht,primitive:xt(),count:vt(),instances:wt(Mc,!1),offset:qe}}function mo(ve,Oe){var tt=ve.static,qt=ve.dynamic,Wt={};return kr.forEach(function(ht){var xt=fn(ht);function wt(qe,vt){if(ht in tt){var Pe=qe(tt[ht]);Wt[xt]=Uo(function(){return Pe})}else if(ht in qt){var _t=qt[ht];Wt[xt]=nu(_t,function(Lt,hr){return vt(Lt,hr,Lt.invoke(hr,_t))})}}switch(ht){case bo:case gi:case ui:case Rc:case ni:case hu:case Es:case Ss:case fu:case to:return wt(function(qe){return be.commandType(qe,"boolean",ht,Oe.commandStr),qe},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,"typeof "+Pe+'==="boolean"',"invalid flag "+ht,qe.commandStr)}),Pe});case Kn:return wt(function(qe){return be.commandParameter(qe,ru,"invalid "+ht,Oe.commandStr),ru[qe]},function(qe,vt,Pe){var _t=qe.constants.compareFuncs;return be.optional(function(){qe.assert(vt,Pe+" in "+_t,"invalid "+ht+", must be one of "+Object.keys(ru))}),vt.def(_t,"[",Pe,"]")});case ko:return wt(function(qe){return be.command(Wa(qe)&&qe.length===2&&typeof qe[0]=="number"&&typeof qe[1]=="number"&&qe[0]<=qe[1],"depth range is 2d array",Oe.commandStr),qe},function(qe,vt,Pe){be.optional(function(){qe.assert(vt,qe.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===2&&typeof "+Pe+'[0]==="number"&&typeof '+Pe+'[1]==="number"&&'+Pe+"[0]<="+Pe+"[1]","depth range must be a 2d array")});var _t=vt.def("+",Pe,"[0]"),Lt=vt.def("+",Pe,"[1]");return[_t,Lt]});case vi:return wt(function(qe){be.commandType(qe,"object","blend.func",Oe.commandStr);var vt="srcRGB"in qe?qe.srcRGB:qe.src,Pe="srcAlpha"in qe?qe.srcAlpha:qe.src,_t="dstRGB"in qe?qe.dstRGB:qe.dst,Lt="dstAlpha"in qe?qe.dstAlpha:qe.dst;return be.commandParameter(vt,vl,xt+".srcRGB",Oe.commandStr),be.commandParameter(Pe,vl,xt+".srcAlpha",Oe.commandStr),be.commandParameter(_t,vl,xt+".dstRGB",Oe.commandStr),be.commandParameter(Lt,vl,xt+".dstAlpha",Oe.commandStr),be.command(_p.indexOf(vt+", "+_t)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+vt+", "+_t+")",Oe.commandStr),[vl[vt],vl[_t],vl[Pe],vl[Lt]]},function(qe,vt,Pe){var _t=qe.constants.blendFuncs;be.optional(function(){qe.assert(vt,Pe+"&&typeof "+Pe+'==="object"',"invalid blend func, must be an object")});function Lt(On,Jn){var si=vt.def('"',On,Jn,'" in ',Pe,"?",Pe,".",On,Jn,":",Pe,".",On);return be.optional(function(){qe.assert(vt,si+" in "+_t,"invalid "+ht+"."+On+Jn+", must be one of "+Object.keys(vl))}),si}var hr=Lt("src","RGB"),Pr=Lt("dst","RGB");be.optional(function(){var On=qe.constants.invalidBlendCombinations;qe.assert(vt,On+".indexOf("+hr+'+", "+'+Pr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Tr=vt.def(_t,"[",hr,"]"),Ir=vt.def(_t,"[",Lt("src","Alpha"),"]"),Ln=vt.def(_t,"[",Pr,"]"),Mn=vt.def(_t,"[",Lt("dst","Alpha"),"]");return[Tr,Ln,Ir,Mn]});case ri:return wt(function(qe){if(typeof qe=="string")return be.commandParameter(qe,ur,"invalid "+ht,Oe.commandStr),[ur[qe],ur[qe]];if(typeof qe=="object")return be.commandParameter(qe.rgb,ur,ht+".rgb",Oe.commandStr),be.commandParameter(qe.alpha,ur,ht+".alpha",Oe.commandStr),[ur[qe.rgb],ur[qe.alpha]];be.commandRaise("invalid blend.equation",Oe.commandStr)},function(qe,vt,Pe){var _t=qe.constants.blendEquations,Lt=vt.def(),hr=vt.def(),Pr=qe.cond("typeof ",Pe,'==="string"');return be.optional(function(){function Tr(Ir,Ln,Mn){qe.assert(Ir,Mn+" in "+_t,"invalid "+Ln+", must be one of "+Object.keys(ur))}Tr(Pr.then,ht,Pe),qe.assert(Pr.else,Pe+"&&typeof "+Pe+'==="object"',"invalid "+ht),Tr(Pr.else,ht+".rgb",Pe+".rgb"),Tr(Pr.else,ht+".alpha",Pe+".alpha")}),Pr.then(Lt,"=",hr,"=",_t,"[",Pe,"];"),Pr.else(Lt,"=",_t,"[",Pe,".rgb];",hr,"=",_t,"[",Pe,".alpha];"),vt(Pr),[Lt,hr]});case oi:return wt(function(qe){return be.command(Wa(qe)&&qe.length===4,"blend.color must be a 4d array",Oe.commandStr),yt(4,function(vt){return+qe[vt]})},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,qe.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===4","blend.color must be a 4d array")}),yt(4,function(_t){return vt.def("+",Pe,"[",_t,"]")})});case Wu:return wt(function(qe){return be.commandType(qe,"number",xt,Oe.commandStr),qe|0},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,"typeof "+Pe+'==="number"',"invalid stencil.mask")}),vt.def(Pe,"|0")});case Cu:return wt(function(qe){be.commandType(qe,"object",xt,Oe.commandStr);var vt=qe.cmp||"keep",Pe=qe.ref||0,_t="mask"in qe?qe.mask:-1;return be.commandParameter(vt,ru,ht+".cmp",Oe.commandStr),be.commandType(Pe,"number",ht+".ref",Oe.commandStr),be.commandType(_t,"number",ht+".mask",Oe.commandStr),[ru[vt],Pe,_t]},function(qe,vt,Pe){var _t=qe.constants.compareFuncs;be.optional(function(){function Tr(){qe.assert(vt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Tr(Pe+"&&typeof ",Pe,'==="object"'),Tr('!("cmp" in ',Pe,")||(",Pe,".cmp in ",_t,")")});var Lt=vt.def('"cmp" in ',Pe,"?",_t,"[",Pe,".cmp]",":",Lc),hr=vt.def(Pe,".ref|0"),Pr=vt.def('"mask" in ',Pe,"?",Pe,".mask|0:-1");return[Lt,hr,Pr]});case Jl:case fl:return wt(function(qe){be.commandType(qe,"object",xt,Oe.commandStr);var vt=qe.fail||"keep",Pe=qe.zfail||"keep",_t=qe.zpass||"keep";return be.commandParameter(vt,Bc,ht+".fail",Oe.commandStr),be.commandParameter(Pe,Bc,ht+".zfail",Oe.commandStr),be.commandParameter(_t,Bc,ht+".zpass",Oe.commandStr),[ht===fl?ff:rc,Bc[vt],Bc[Pe],Bc[_t]]},function(qe,vt,Pe){var _t=qe.constants.stencilOps;be.optional(function(){qe.assert(vt,Pe+"&&typeof "+Pe+'==="object"',"invalid "+ht)});function Lt(hr){return be.optional(function(){qe.assert(vt,'!("'+hr+'" in '+Pe+")||("+Pe+"."+hr+" in "+_t+")","invalid "+ht+"."+hr+", must be one of "+Object.keys(Bc))}),vt.def('"',hr,'" in ',Pe,"?",_t,"[",Pe,".",hr,"]:",Lc)}return[ht===fl?ff:rc,Lt("fail"),Lt("zfail"),Lt("zpass")]});case cl:return wt(function(qe){be.commandType(qe,"object",xt,Oe.commandStr);var vt=qe.factor|0,Pe=qe.units|0;return be.commandType(vt,"number",xt+".factor",Oe.commandStr),be.commandType(Pe,"number",xt+".units",Oe.commandStr),[vt,Pe]},function(qe,vt,Pe){be.optional(function(){qe.assert(vt,Pe+"&&typeof "+Pe+'==="object"',"invalid "+ht)});var _t=vt.def(Pe,".factor|0"),Lt=vt.def(Pe,".units|0");return[_t,Lt]});case $a:return wt(function(qe){var vt=0;return qe==="front"?vt=rc:qe==="back"&&(vt=ff),be.command(!!vt,xt,Oe.commandStr),vt},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,Pe+'==="front"||'+Pe+'==="back"',"invalid cull.face")}),vt.def(Pe,'==="front"?',rc,":",ff)});case xs:return wt(function(qe){return be.command(typeof qe=="number"&&qe>=Jt.lineWidthDims[0]&&qe<=Jt.lineWidthDims[1],"invalid line width, must be a positive number between "+Jt.lineWidthDims[0]+" and "+Jt.lineWidthDims[1],Oe.commandStr),qe},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,"typeof "+Pe+'==="number"&&'+Pe+">="+Jt.lineWidthDims[0]+"&&"+Pe+"<="+Jt.lineWidthDims[1],"invalid line width")}),Pe});case ro:return wt(function(qe){return be.commandParameter(qe,ic,xt,Oe.commandStr),ic[qe]},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,Pe+'==="cw"||'+Pe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),vt.def(Pe+'==="cw"?'+gp+":"+Kp)});case Do:return wt(function(qe){return be.command(Wa(qe)&&qe.length===4,"color.mask must be length 4 array",Oe.commandStr),qe.map(function(vt){return!!vt})},function(qe,vt,Pe){return be.optional(function(){qe.assert(vt,qe.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===4","invalid color.mask")}),yt(4,function(_t){return"!!"+Pe+"["+_t+"]"})});case Zs:return wt(function(qe){be.command(typeof qe=="object"&&qe,xt,Oe.commandStr);var vt="value"in qe?qe.value:1,Pe=!!qe.invert;return be.command(typeof vt=="number"&&vt>=0&&vt<=1,"sample.coverage.value must be a number between 0 and 1",Oe.commandStr),[vt,Pe]},function(qe,vt,Pe){be.optional(function(){qe.assert(vt,Pe+"&&typeof "+Pe+'==="object"',"invalid sample.coverage")});var _t=vt.def('"value" in ',Pe,"?+",Pe,".value:1"),Lt=vt.def("!!",Pe,".invert");return[_t,Lt]})}}),Wt}function go(ve,Oe){var tt=ve.static,qt=ve.dynamic,Wt={};return Object.keys(tt).forEach(function(ht){var xt=tt[ht],wt;if(typeof xt=="number"||typeof xt=="boolean")wt=Uo(function(){return xt});else if(typeof xt=="function"){var qe=xt._reglType;qe==="texture2d"||qe==="textureCube"?wt=Uo(function(vt){return vt.link(xt)}):qe==="framebuffer"||qe==="framebufferCube"?(be.command(xt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ht+'"',Oe.commandStr),wt=Uo(function(vt){return vt.link(xt.color[0])})):be.commandRaise('invalid data for uniform "'+ht+'"',Oe.commandStr)}else Wa(xt)?wt=Uo(function(vt){var Pe=vt.global.def("[",yt(xt.length,function(_t){return be.command(typeof xt[_t]=="number"||typeof xt[_t]=="boolean","invalid uniform "+ht,vt.commandStr),xt[_t]}),"]");return Pe}):be.commandRaise('invalid or missing data for uniform "'+ht+'"',Oe.commandStr);wt.value=xt,Wt[ht]=wt}),Object.keys(qt).forEach(function(ht){var xt=qt[ht];Wt[ht]=nu(xt,function(wt,qe){return wt.invoke(qe,xt)})}),Wt}function Di(ve,Oe){var tt=ve.static,qt=ve.dynamic,Wt={};return Object.keys(tt).forEach(function(ht){var xt=tt[ht],wt=Ie.id(ht),qe=new Ft;if(qf(xt))qe.state=zr,qe.buffer=yr.getBuffer(yr.create(xt,pl,!1,!0)),qe.type=0;else{var vt=yr.getBuffer(xt);if(vt)qe.state=zr,qe.buffer=vt,qe.type=0;else if(be.command(typeof xt=="object"&&xt,"invalid data for attribute "+ht,Oe.commandStr),"constant"in xt){var Pe=xt.constant;qe.buffer="null",qe.state=_n,typeof Pe=="number"?qe.x=Pe:(be.command(Wa(Pe)&&Pe.length>0&&Pe.length<=4,"invalid constant for attribute "+ht,Oe.commandStr),Ar.forEach(function(Ln,Mn){Mn<Pe.length&&(qe[Ln]=Pe[Mn])}))}else{qf(xt.buffer)?vt=yr.getBuffer(yr.create(xt.buffer,pl,!1,!0)):vt=yr.getBuffer(xt.buffer),be.command(!!vt,'missing buffer for attribute "'+ht+'"',Oe.commandStr);var _t=xt.offset|0;be.command(_t>=0,'invalid offset for attribute "'+ht+'"',Oe.commandStr);var Lt=xt.stride|0;be.command(Lt>=0&&Lt<256,'invalid stride for attribute "'+ht+'", must be integer betweeen [0, 255]',Oe.commandStr);var hr=xt.size|0;be.command(!("size"in xt)||hr>0&&hr<=4,'invalid size for attribute "'+ht+'", must be 1,2,3,4',Oe.commandStr);var Pr=!!xt.normalized,Tr=0;"type"in xt&&(be.commandParameter(xt.type,Jo,"invalid type for attribute "+ht,Oe.commandStr),Tr=Jo[xt.type]);var Ir=xt.divisor|0;"divisor"in xt&&(be.command(Ir===0||Zr,'cannot specify divisor for attribute "'+ht+'", instancing not supported',Oe.commandStr),be.command(Ir>=0,'invalid divisor for attribute "'+ht+'"',Oe.commandStr)),be.optional(function(){var Ln=Oe.commandStr,Mn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(xt).forEach(function(On){be.command(Mn.indexOf(On)>=0,'unknown parameter "'+On+'" for attribute pointer "'+ht+'" (valid parameters are '+Mn+")",Ln)})}),qe.buffer=vt,qe.state=zr,qe.size=hr,qe.normalized=Pr,qe.type=Tr||vt.dtype,qe.offset=_t,qe.stride=Lt,qe.divisor=Ir}}Wt[ht]=Uo(function(Ln,Mn){var On=Ln.attribCache;if(wt in On)return On[wt];var Jn={isStream:!1};return Object.keys(qe).forEach(function(si){Jn[si]=qe[si]}),qe.buffer&&(Jn.buffer=Ln.link(qe.buffer),Jn.type=Jn.type||Jn.buffer+".dtype"),On[wt]=Jn,Jn})}),Object.keys(qt).forEach(function(ht){var xt=qt[ht];function wt(qe,vt){var Pe=qe.invoke(vt,xt),_t=qe.shared,Lt=qe.constants,hr=_t.isBufferArgs,Pr=_t.buffer;be.optional(function(){qe.assert(vt,Pe+"&&(typeof "+Pe+'==="object"||typeof '+Pe+'==="function")&&('+hr+"("+Pe+")||"+Pr+".getBuffer("+Pe+")||"+Pr+".getBuffer("+Pe+".buffer)||"+hr+"("+Pe+'.buffer)||("constant" in '+Pe+"&&(typeof "+Pe+'.constant==="number"||'+_t.isArrayLike+"("+Pe+".constant))))",'invalid dynamic attribute "'+ht+'"')});var Tr={isStream:vt.def(!1)},Ir=new Ft;Ir.state=zr,Object.keys(Ir).forEach(function(Jn){Tr[Jn]=vt.def(""+Ir[Jn])});var Ln=Tr.buffer,Mn=Tr.type;vt("if(",hr,"(",Pe,")){",Tr.isStream,"=true;",Ln,"=",Pr,".createStream(",pl,",",Pe,");",Mn,"=",Ln,".dtype;","}else{",Ln,"=",Pr,".getBuffer(",Pe,");","if(",Ln,"){",Mn,"=",Ln,".dtype;",'}else if("constant" in ',Pe,"){",Tr.state,"=",_n,";","if(typeof "+Pe+'.constant === "number"){',Tr[Ar[0]],"=",Pe,".constant;",Ar.slice(1).map(function(Jn){return Tr[Jn]}).join("="),"=0;","}else{",Ar.map(function(Jn,si){return Tr[Jn]+"="+Pe+".constant.length>"+si+"?"+Pe+".constant["+si+"]:0;"}).join(""),"}}else{","if(",hr,"(",Pe,".buffer)){",Ln,"=",Pr,".createStream(",pl,",",Pe,".buffer);","}else{",Ln,"=",Pr,".getBuffer(",Pe,".buffer);","}",Mn,'="type" in ',Pe,"?",Lt.glTypes,"[",Pe,".type]:",Ln,".dtype;",Tr.normalized,"=!!",Pe,".normalized;");function On(Jn){vt(Tr[Jn],"=",Pe,".",Jn,"|0;")}return On("size"),On("offset"),On("stride"),On("divisor"),vt("}}"),vt.exit("if(",Tr.isStream,"){",Pr,".destroyStream(",Ln,");","}"),Tr}Wt[ht]=nu(xt,wt)}),Wt}function xo(ve,Oe){var tt=ve.static,qt=ve.dynamic;if(Gu in tt){var Wt=tt[Gu];return Wt!==null&&Jr.getVAO(Wt)===null&&(Wt=Jr.createVAO(Wt)),Uo(function(xt){return xt.link(Jr.getVAO(Wt))})}else if(Gu in qt){var ht=qt[Gu];return nu(ht,function(xt,wt){var qe=xt.invoke(wt,ht);return wt.def(xt.shared.vao+".getVAO("+qe+")")})}return null}function Ca(ve){var Oe=ve.static,tt=ve.dynamic,qt={};return Object.keys(Oe).forEach(function(Wt){var ht=Oe[Wt];qt[Wt]=Uo(function(xt,wt){return typeof ht=="number"||typeof ht=="boolean"?""+ht:xt.link(ht)})}),Object.keys(tt).forEach(function(Wt){var ht=tt[Wt];qt[Wt]=nu(ht,function(xt,wt){return xt.invoke(wt,ht)})}),qt}function Eo(ve,Oe,tt,qt,Wt){var ht=ve.static,xt=ve.dynamic;be.optional(function(){var On=[Is,pu,Ru,Zi,ts,du,lo,Mc,uo,Gu].concat(kr);function Jn(si){Object.keys(si).forEach(function(pa){be.command(On.indexOf(pa)>=0,'unknown parameter "'+pa+'"',Wt.commandStr)})}Jn(ht),Jn(xt)});var wt=pi(ve,Oe),qe=it(ve,Wt),vt=Si(ve,qe,Wt),Pe=ra(ve,Wt),_t=mo(ve,Wt),Lt=ei(ve,Wt,wt);function hr(On){var Jn=vt[On];Jn&&(_t[On]=Jn)}hr(Lo),hr(fn(hl));var Pr=Object.keys(_t).length>0,Tr={framebuffer:qe,draw:Pe,shader:Lt,state:_t,dirty:Pr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Tr.profile=Mi(ve,Wt),Tr.uniforms=go(tt,Wt),Tr.drawVAO=Tr.scopeVAO=xo(ve,Wt),!Tr.drawVAO&&Lt.program&&!wt&&et.angle_instanced_arrays){var Ir=!0,Ln=Lt.program.attributes.map(function(On){var Jn=Oe.static[On];return Ir=Ir&&!!Jn,Jn});if(Ir&&Ln.length>0){var Mn=Jr.getVAO(Jr.createVAO(Ln));Tr.drawVAO=new Ps(null,null,null,function(On,Jn){return On.link(Mn)}),Tr.useVAO=!0}}return wt?Tr.useVAO=!0:Tr.attributes=Di(Oe,Wt),Tr.context=Ca(qt,Wt),Tr}function So(ve,Oe,tt){var qt=ve.shared,Wt=qt.context,ht=ve.scope();Object.keys(tt).forEach(function(xt){Oe.save(Wt,"."+xt);var wt=tt[xt];ht(Wt,".",xt,"=",wt.append(ve,Oe),";")}),Oe(ht)}function Ya(ve,Oe,tt,qt){var Wt=ve.shared,ht=Wt.gl,xt=Wt.framebuffer,wt;dn&&(wt=Oe.def(Wt.extensions,".webgl_draw_buffers"));var qe=ve.constants,vt=qe.drawBuffer,Pe=qe.backBuffer,_t;tt?_t=tt.append(ve,Oe):_t=Oe.def(xt,".next"),qt||Oe("if(",_t,"!==",xt,".cur){"),Oe("if(",_t,"){",ht,".bindFramebuffer(",nc,",",_t,".framebuffer);"),dn&&Oe(wt,".drawBuffersWEBGL(",vt,"[",_t,".colorAttachments.length]);"),Oe("}else{",ht,".bindFramebuffer(",nc,",null);"),dn&&Oe(wt,".drawBuffersWEBGL(",Pe,");"),Oe("}",xt,".cur=",_t,";"),qt||Oe("}")}function zo(ve,Oe,tt){var qt=ve.shared,Wt=qt.gl,ht=ve.current,xt=ve.next,wt=qt.current,qe=qt.next,vt=ve.cond(wt,".dirty");kr.forEach(function(Pe){var _t=fn(Pe);if(!(_t in tt.state)){var Lt,hr;if(_t in xt){Lt=xt[_t],hr=ht[_t];var Pr=yt(Cr[_t].length,function(Ir){return vt.def(Lt,"[",Ir,"]")});vt(ve.cond(Pr.map(function(Ir,Ln){return Ir+"!=="+hr+"["+Ln+"]"}).join("||")).then(Wt,".",wr[_t],"(",Pr,");",Pr.map(function(Ir,Ln){return hr+"["+Ln+"]="+Ir}).join(";"),";"))}else{Lt=vt.def(qe,".",_t);var Tr=ve.cond(Lt,"!==",wt,".",_t);vt(Tr),_t in vn?Tr(ve.cond(Lt).then(Wt,".enable(",vn[_t],");").else(Wt,".disable(",vn[_t],");"),wt,".",_t,"=",Lt,";"):Tr(Wt,".",wr[_t],"(",Lt,");",wt,".",_t,"=",Lt,";")}}}),Object.keys(tt.state).length===0&&vt(wt,".dirty=false;"),Oe(vt)}function Ts(ve,Oe,tt,qt){var Wt=ve.shared,ht=ve.current,xt=Wt.current,wt=Wt.gl;Kf(Object.keys(tt)).forEach(function(qe){var vt=tt[qe];if(!(qt&&!qt(vt))){var Pe=vt.append(ve,Oe);if(vn[qe]){var _t=vn[qe];As(vt)?Pe?Oe(wt,".enable(",_t,");"):Oe(wt,".disable(",_t,");"):Oe(ve.cond(Pe).then(wt,".enable(",_t,");").else(wt,".disable(",_t,");")),Oe(xt,".",qe,"=",Pe,";")}else if(Wa(Pe)){var Lt=ht[qe];Oe(wt,".",wr[qe],"(",Pe,");",Pe.map(function(hr,Pr){return Lt+"["+Pr+"]="+hr}).join(";"),";")}else Oe(wt,".",wr[qe],"(",Pe,");",xt,".",qe,"=",Pe,";")}})}function Ao(ve,Oe){Zr&&(ve.instancing=Oe.def(ve.shared.extensions,".angle_instanced_arrays"))}function Ei(ve,Oe,tt,qt,Wt){var ht=ve.shared,xt=ve.stats,wt=ht.current,qe=ht.timer,vt=tt.profile;function Pe(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var _t,Lt;function hr(On){_t=Oe.def(),On(_t,"=",Pe(),";"),typeof Wt=="string"?On(xt,".count+=",Wt,";"):On(xt,".count++;"),Mr&&(qt?(Lt=Oe.def(),On(Lt,"=",qe,".getNumPendingQueries();")):On(qe,".beginQuery(",xt,");"))}function Pr(On){On(xt,".cpuTime+=",Pe(),"-",_t,";"),Mr&&(qt?On(qe,".pushScopeStats(",Lt,",",qe,".getNumPendingQueries(),",xt,");"):On(qe,".endQuery();"))}function Tr(On){var Jn=Oe.def(wt,".profile");Oe(wt,".profile=",On,";"),Oe.exit(wt,".profile=",Jn,";")}var Ir;if(vt){if(As(vt)){vt.enable?(hr(Oe),Pr(Oe.exit),Tr("true")):Tr("false");return}Ir=vt.append(ve,Oe),Tr(Ir)}else Ir=Oe.def(wt,".profile");var Ln=ve.block();hr(Ln),Oe("if(",Ir,"){",Ln,"}");var Mn=ve.block();Pr(Mn),Oe.exit("if(",Ir,"){",Mn,"}")}function ps(ve,Oe,tt,qt,Wt){var ht=ve.shared;function xt(qe){switch(qe){case $p:case Yp:case dl:return 2;case Ol:case no:case cf:return 3;case mp:case Gf:case Oc:return 4;default:return 1}}function wt(qe,vt,Pe){var _t=ht.gl,Lt=Oe.def(qe,".location"),hr=Oe.def(ht.attributes,"[",Lt,"]"),Pr=Pe.state,Tr=Pe.buffer,Ir=[Pe.x,Pe.y,Pe.z,Pe.w],Ln=["buffer","normalized","offset","stride"];function Mn(){Oe("if(!",hr,".buffer){",_t,".enableVertexAttribArray(",Lt,");}");var Jn=Pe.type,si;if(Pe.size?si=Oe.def(Pe.size,"||",vt):si=vt,Oe("if(",hr,".type!==",Jn,"||",hr,".size!==",si,"||",Ln.map(function(Zo){return hr+"."+Zo+"!=="+Pe[Zo]}).join("||"),"){",_t,".bindBuffer(",pl,",",Tr,".buffer);",_t,".vertexAttribPointer(",[Lt,si,Jn,Pe.normalized,Pe.stride,Pe.offset],");",hr,".type=",Jn,";",hr,".size=",si,";",Ln.map(function(Zo){return hr+"."+Zo+"="+Pe[Zo]+";"}).join(""),"}"),Zr){var pa=Pe.divisor;Oe("if(",hr,".divisor!==",pa,"){",ve.instancing,".vertexAttribDivisorANGLE(",[Lt,pa],");",hr,".divisor=",pa,";}")}}function On(){Oe("if(",hr,".buffer){",_t,".disableVertexAttribArray(",Lt,");",hr,".buffer=null;","}if(",Ar.map(function(Jn,si){return hr+"."+Jn+"!=="+Ir[si]}).join("||"),"){",_t,".vertexAttrib4f(",Lt,",",Ir,");",Ar.map(function(Jn,si){return hr+"."+Jn+"="+Ir[si]+";"}).join(""),"}")}Pr===zr?Mn():Pr===_n?On():(Oe("if(",Pr,"===",zr,"){"),Mn(),Oe("}else{"),On(),Oe("}"))}qt.forEach(function(qe){var vt=qe.name,Pe=tt.attributes[vt],_t;if(Pe){if(!Wt(Pe))return;_t=Pe.append(ve,Oe)}else{if(!Wt(bp))return;var Lt=ve.scopeAttrib(vt);be.optional(function(){ve.assert(Oe,Lt+".state","missing attribute "+vt)}),_t={},Object.keys(new Ft).forEach(function(hr){_t[hr]=Oe.def(Lt,".",hr)})}wt(ve.link(qe),xt(qe.info.type),_t)})}function ha(ve,Oe,tt,qt,Wt){for(var ht=ve.shared,xt=ht.gl,wt,qe=0;qe<qt.length;++qe){var vt=qt[qe],Pe=vt.name,_t=vt.info.type,Lt=tt.uniforms[Pe],hr=ve.link(vt),Pr=hr+".location",Tr;if(Lt){if(!Wt(Lt))continue;if(As(Lt)){var Ir=Lt.value;if(be.command(Ir!==null&&typeof Ir!="undefined",'missing uniform "'+Pe+'"',ve.commandStr),_t===Dc||_t===tc){be.command(typeof Ir=="function"&&(_t===Dc&&(Ir._reglType==="texture2d"||Ir._reglType==="framebuffer")||_t===tc&&(Ir._reglType==="textureCube"||Ir._reglType==="framebufferCube")),"invalid texture for uniform "+Pe,ve.commandStr);var Ln=ve.link(Ir._texture||Ir.color[0]._texture);Oe(xt,".uniform1i(",Pr,",",Ln+".bind());"),Oe.exit(Ln,".unbind();")}else if(_t===$f||_t===Yf||_t===kc){be.optional(function(){be.command(Wa(Ir),"invalid matrix for uniform "+Pe,ve.commandStr),be.command(_t===$f&&Ir.length===4||_t===Yf&&Ir.length===9||_t===kc&&Ir.length===16,"invalid length for matrix uniform "+Pe,ve.commandStr)});var Mn=ve.global.def("new Float32Array(["+Array.prototype.slice.call(Ir)+"])"),On=2;_t===Yf?On=3:_t===kc&&(On=4),Oe(xt,".uniformMatrix",On,"fv(",Pr,",false,",Mn,");")}else{switch(_t){case jd:be.commandType(Ir,"number","uniform "+Pe,ve.commandStr),wt="1f";break;case $p:be.command(Wa(Ir)&&Ir.length===2,"uniform "+Pe,ve.commandStr),wt="2f";break;case Ol:be.command(Wa(Ir)&&Ir.length===3,"uniform "+Pe,ve.commandStr),wt="3f";break;case mp:be.command(Wa(Ir)&&Ir.length===4,"uniform "+Pe,ve.commandStr),wt="4f";break;case Xf:be.commandType(Ir,"boolean","uniform "+Pe,ve.commandStr),wt="1i";break;case Pc:be.commandType(Ir,"number","uniform "+Pe,ve.commandStr),wt="1i";break;case dl:be.command(Wa(Ir)&&Ir.length===2,"uniform "+Pe,ve.commandStr),wt="2i";break;case Yp:be.command(Wa(Ir)&&Ir.length===2,"uniform "+Pe,ve.commandStr),wt="2i";break;case cf:be.command(Wa(Ir)&&Ir.length===3,"uniform "+Pe,ve.commandStr),wt="3i";break;case no:be.command(Wa(Ir)&&Ir.length===3,"uniform "+Pe,ve.commandStr),wt="3i";break;case Oc:be.command(Wa(Ir)&&Ir.length===4,"uniform "+Pe,ve.commandStr),wt="4i";break;case Gf:be.command(Wa(Ir)&&Ir.length===4,"uniform "+Pe,ve.commandStr),wt="4i";break}Oe(xt,".uniform",wt,"(",Pr,",",Wa(Ir)?Array.prototype.slice.call(Ir):Ir,");")}continue}else Tr=Lt.append(ve,Oe)}else{if(!Wt(bp))continue;Tr=Oe.def(ht.uniforms,"[",Ie.id(Pe),"]")}_t===Dc?Oe("if(",Tr,"&&",Tr,'._reglType==="framebuffer"){',Tr,"=",Tr,".color[0];","}"):_t===tc&&Oe("if(",Tr,"&&",Tr,'._reglType==="framebufferCube"){',Tr,"=",Tr,".color[0];","}"),be.optional(function(){function Xu(kl,od){ve.assert(Oe,kl,'bad data or missing for uniform "'+Pe+'".  '+od)}function Ep(kl){Xu("typeof "+Tr+'==="'+kl+'"',"invalid type, expected "+kl)}function $u(kl,od){Xu(ht.isArrayLike+"("+Tr+")&&"+Tr+".length==="+kl,"invalid vector, should have length "+kl,ve.commandStr)}function ad(kl){Xu("typeof "+Tr+'==="function"&&'+Tr+'._reglType==="texture'+(kl===Wf?"2d":"Cube")+'"',"invalid texture type",ve.commandStr)}switch(_t){case Pc:Ep("number");break;case Yp:$u(2,"number");break;case no:$u(3,"number");break;case Gf:$u(4,"number");break;case jd:Ep("number");break;case $p:$u(2,"number");break;case Ol:$u(3,"number");break;case mp:$u(4,"number");break;case Xf:Ep("boolean");break;case dl:$u(2,"boolean");break;case cf:$u(3,"boolean");break;case Oc:$u(4,"boolean");break;case $f:$u(4,"number");break;case Yf:$u(9,"number");break;case kc:$u(16,"number");break;case Dc:ad(Wf);break;case tc:ad(vp);break}});var Jn=1;switch(_t){case Dc:case tc:var si=Oe.def(Tr,"._texture");Oe(xt,".uniform1i(",Pr,",",si,".bind());"),Oe.exit(si,".unbind();");continue;case Pc:case Xf:wt="1i";break;case Yp:case dl:wt="2i",Jn=2;break;case no:case cf:wt="3i",Jn=3;break;case Gf:case Oc:wt="4i",Jn=4;break;case jd:wt="1f";break;case $p:wt="2f",Jn=2;break;case Ol:wt="3f",Jn=3;break;case mp:wt="4f",Jn=4;break;case $f:wt="Matrix2fv";break;case Yf:wt="Matrix3fv";break;case kc:wt="Matrix4fv";break}if(Oe(xt,".uniform",wt,"(",Pr,","),wt.charAt(0)==="M"){var pa=Math.pow(_t-$f+2,2),Zo=ve.global.def("new Float32Array(",pa,")");Oe("false,(Array.isArray(",Tr,")||",Tr," instanceof Float32Array)?",Tr,":(",yt(pa,function(Xu){return Zo+"["+Xu+"]="+Tr+"["+Xu+"]"}),",",Zo,")")}else Jn>1?Oe(yt(Jn,function(Xu){return Tr+"["+Xu+"]"})):Oe(Tr);Oe(");")}}function Qn(ve,Oe,tt,qt){var Wt=ve.shared,ht=Wt.gl,xt=Wt.draw,wt=qt.draw;function qe(){var si=wt.elements,pa,Zo=Oe;return si?((si.contextDep&&qt.contextDynamic||si.propDep)&&(Zo=tt),pa=si.append(ve,Zo)):pa=Zo.def(xt,".",Zi),pa&&Zo("if("+pa+")"+ht+".bindBuffer("+Gp+","+pa+".buffer.buffer);"),pa}function vt(){var si=wt.count,pa,Zo=Oe;return si?((si.contextDep&&qt.contextDynamic||si.propDep)&&(Zo=tt),pa=si.append(ve,Zo),be.optional(function(){si.MISSING&&ve.assert(Oe,"false","missing vertex count"),si.DYNAMIC&&ve.assert(Zo,pa+">=0","missing vertex count")})):(pa=Zo.def(xt,".",lo),be.optional(function(){ve.assert(Zo,pa+">=0","missing vertex count")})),pa}var Pe=qe();function _t(si){var pa=wt[si];return pa?pa.contextDep&&qt.contextDynamic||pa.propDep?pa.append(ve,tt):pa.append(ve,Oe):Oe.def(xt,".",si)}var Lt=_t(ts),hr=_t(du),Pr=vt();if(typeof Pr=="number"){if(Pr===0)return}else tt("if(",Pr,"){"),tt.exit("}");var Tr,Ir;Zr&&(Tr=_t(Mc),Ir=ve.instancing);var Ln=Pe+".type",Mn=wt.elements&&As(wt.elements);function On(){function si(){tt(Ir,".drawElementsInstancedANGLE(",[Lt,Pr,Ln,hr+"<<(("+Ln+"-"+Yr+")>>1)",Tr],");")}function pa(){tt(Ir,".drawArraysInstancedANGLE(",[Lt,hr,Pr,Tr],");")}Pe?Mn?si():(tt("if(",Pe,"){"),si(),tt("}else{"),pa(),tt("}")):pa()}function Jn(){function si(){tt(ht+".drawElements("+[Lt,Pr,Ln,hr+"<<(("+Ln+"-"+Yr+")>>1)"]+");")}function pa(){tt(ht+".drawArrays("+[Lt,hr,Pr]+");")}Pe?Mn?si():(tt("if(",Pe,"){"),si(),tt("}else{"),pa(),tt("}")):pa()}Zr&&(typeof Tr!="number"||Tr>=0)?typeof Tr=="string"?(tt("if(",Tr,">0){"),On(),tt("}else if(",Tr,"<0){"),Jn(),tt("}")):On():Jn()}function ki(ve,Oe,tt,qt,Wt){var ht=rr(),xt=ht.proc("body",Wt);return be.optional(function(){ht.commandStr=Oe.commandStr,ht.command=ht.link(Oe.commandStr)}),Zr&&(ht.instancing=xt.def(ht.shared.extensions,".angle_instanced_arrays")),ve(ht,xt,tt,qt),ht.compile().body}function Ki(ve,Oe,tt,qt){Ao(ve,Oe),tt.useVAO?tt.drawVAO?Oe(ve.shared.vao,".setVAO(",tt.drawVAO.append(ve,Oe),");"):Oe(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(Oe(ve.shared.vao,".setVAO(null);"),ps(ve,Oe,tt,qt.attributes,function(){return!0})),ha(ve,Oe,tt,qt.uniforms,function(){return!0}),Qn(ve,Oe,Oe,tt)}function To(ve,Oe){var tt=ve.proc("draw",1);Ao(ve,tt),So(ve,tt,Oe.context),Ya(ve,tt,Oe.framebuffer),zo(ve,tt,Oe),Ts(ve,tt,Oe.state),Ei(ve,tt,Oe,!1,!0);var qt=Oe.shader.progVar.append(ve,tt);if(tt(ve.shared.gl,".useProgram(",qt,".program);"),Oe.shader.program)Ki(ve,tt,Oe,Oe.shader.program);else{tt(ve.shared.vao,".setVAO(null);");var Wt=ve.global.def("{}"),ht=tt.def(qt,".id"),xt=tt.def(Wt,"[",ht,"]");tt(ve.cond(xt).then(xt,".call(this,a0);").else(xt,"=",Wt,"[",ht,"]=",ve.link(function(wt){return ki(Ki,ve,Oe,wt,1)}),"(",qt,");",xt,".call(this,a0);"))}Object.keys(Oe.state).length>0&&tt(ve.shared.current,".dirty=true;")}function ml(ve,Oe,tt,qt){ve.batchId="a1",Ao(ve,Oe);function Wt(){return!0}ps(ve,Oe,tt,qt.attributes,Wt),ha(ve,Oe,tt,qt.uniforms,Wt),Qn(ve,Oe,Oe,tt)}function $e(ve,Oe,tt,qt){Ao(ve,Oe);var Wt=tt.contextDep,ht=Oe.def(),xt="a0",wt="a1",qe=Oe.def();ve.shared.props=qe,ve.batchId=ht;var vt=ve.scope(),Pe=ve.scope();Oe(vt.entry,"for(",ht,"=0;",ht,"<",wt,";++",ht,"){",qe,"=",xt,"[",ht,"];",Pe,"}",vt.exit);function _t(Ln){return Ln.contextDep&&Wt||Ln.propDep}function Lt(Ln){return!_t(Ln)}if(tt.needsContext&&So(ve,Pe,tt.context),tt.needsFramebuffer&&Ya(ve,Pe,tt.framebuffer),Ts(ve,Pe,tt.state,_t),tt.profile&&_t(tt.profile)&&Ei(ve,Pe,tt,!1,!0),qt)tt.useVAO?tt.drawVAO?_t(tt.drawVAO)?Pe(ve.shared.vao,".setVAO(",tt.drawVAO.append(ve,Pe),");"):vt(ve.shared.vao,".setVAO(",tt.drawVAO.append(ve,vt),");"):vt(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(vt(ve.shared.vao,".setVAO(null);"),ps(ve,vt,tt,qt.attributes,Lt),ps(ve,Pe,tt,qt.attributes,_t)),ha(ve,vt,tt,qt.uniforms,Lt),ha(ve,Pe,tt,qt.uniforms,_t),Qn(ve,vt,Pe,tt);else{var hr=ve.global.def("{}"),Pr=tt.shader.progVar.append(ve,Pe),Tr=Pe.def(Pr,".id"),Ir=Pe.def(hr,"[",Tr,"]");Pe(ve.shared.gl,".useProgram(",Pr,".program);","if(!",Ir,"){",Ir,"=",hr,"[",Tr,"]=",ve.link(function(Ln){return ki(ml,ve,tt,Ln,2)}),"(",Pr,");}",Ir,".call(this,a0[",ht,"],",ht,");")}}function ir(ve,Oe){var tt=ve.proc("batch",2);ve.batchId="0",Ao(ve,tt);var qt=!1,Wt=!0;Object.keys(Oe.context).forEach(function(hr){qt=qt||Oe.context[hr].propDep}),qt||(So(ve,tt,Oe.context),Wt=!1);var ht=Oe.framebuffer,xt=!1;ht?(ht.propDep?qt=xt=!0:ht.contextDep&&qt&&(xt=!0),xt||Ya(ve,tt,ht)):Ya(ve,tt,null),Oe.state.viewport&&Oe.state.viewport.propDep&&(qt=!0);function wt(hr){return hr.contextDep&&qt||hr.propDep}zo(ve,tt,Oe),Ts(ve,tt,Oe.state,function(hr){return!wt(hr)}),(!Oe.profile||!wt(Oe.profile))&&Ei(ve,tt,Oe,!1,"a1"),Oe.contextDep=qt,Oe.needsContext=Wt,Oe.needsFramebuffer=xt;var qe=Oe.shader.progVar;if(qe.contextDep&&qt||qe.propDep)$e(ve,tt,Oe,null);else{var vt=qe.append(ve,tt);if(tt(ve.shared.gl,".useProgram(",vt,".program);"),Oe.shader.program)$e(ve,tt,Oe,Oe.shader.program);else{tt(ve.shared.vao,".setVAO(null);");var Pe=ve.global.def("{}"),_t=tt.def(vt,".id"),Lt=tt.def(Pe,"[",_t,"]");tt(ve.cond(Lt).then(Lt,".call(this,a0,a1);").else(Lt,"=",Pe,"[",_t,"]=",ve.link(function(hr){return ki($e,ve,Oe,hr,2)}),"(",vt,");",Lt,".call(this,a0,a1);"))}}Object.keys(Oe.state).length>0&&tt(ve.shared.current,".dirty=true;")}function Yt(ve,Oe){var tt=ve.proc("scope",3);ve.batchId="a2";var qt=ve.shared,Wt=qt.current;So(ve,tt,Oe.context),Oe.framebuffer&&Oe.framebuffer.append(ve,tt),Kf(Object.keys(Oe.state)).forEach(function(xt){var wt=Oe.state[xt],qe=wt.append(ve,tt);Wa(qe)?qe.forEach(function(vt,Pe){tt.set(ve.next[xt],"["+Pe+"]",vt)}):tt.set(qt.next,"."+xt,qe)}),Ei(ve,tt,Oe,!0,!0),[Zi,du,lo,Mc,ts].forEach(function(xt){var wt=Oe.draw[xt];wt&&tt.set(qt.draw,"."+xt,""+wt.append(ve,tt))}),Object.keys(Oe.uniforms).forEach(function(xt){tt.set(qt.uniforms,"["+Ie.id(xt)+"]",Oe.uniforms[xt].append(ve,tt))}),Object.keys(Oe.attributes).forEach(function(xt){var wt=Oe.attributes[xt].append(ve,tt),qe=ve.scopeAttrib(xt);Object.keys(new Ft).forEach(function(vt){tt.set(qe,"."+vt,wt[vt])})}),Oe.scopeVAO&&tt.set(qt.vao,".targetVAO",Oe.scopeVAO.append(ve,tt));function ht(xt){var wt=Oe.shader[xt];wt&&tt.set(qt.shader,"."+xt,wt.append(ve,tt))}ht(pu),ht(Ru),Object.keys(Oe.state).length>0&&(tt(Wt,".dirty=true;"),tt.exit(Wt,".dirty=true;")),tt("a1(",ve.shared.context,",a0,",ve.batchId,");")}function xn(ve){if(!(typeof ve!="object"||Wa(ve))){for(var Oe=Object.keys(ve),tt=0;tt<Oe.length;++tt)if(rn.isDynamic(ve[Oe[tt]]))return!0;return!1}}function Ai(ve,Oe,tt){var qt=Oe.static[tt];if(!qt||!xn(qt))return;var Wt=ve.global,ht=Object.keys(qt),xt=!1,wt=!1,qe=!1,vt=ve.global.def("{}");ht.forEach(function(_t){var Lt=qt[_t];if(rn.isDynamic(Lt)){typeof Lt=="function"&&(Lt=qt[_t]=rn.unbox(Lt));var hr=nu(Lt,null);xt=xt||hr.thisDep,qe=qe||hr.propDep,wt=wt||hr.contextDep}else{switch(Wt(vt,".",_t,"="),typeof Lt){case"number":Wt(Lt);break;case"string":Wt('"',Lt,'"');break;case"object":Array.isArray(Lt)&&Wt("[",Lt.join(),"]");break;default:Wt(ve.link(Lt));break}Wt(";")}});function Pe(_t,Lt){ht.forEach(function(hr){var Pr=qt[hr];if(rn.isDynamic(Pr)){var Tr=_t.invoke(Lt,Pr);Lt(vt,".",hr,"=",Tr,";")}})}Oe.dynamic[tt]=new rn.DynamicVariable(An,{thisDep:xt,contextDep:wt,propDep:qe,ref:vt,append:Pe}),delete Oe.static[tt]}function Aa(ve,Oe,tt,qt,Wt){var ht=rr();ht.stats=ht.link(Wt),Object.keys(Oe.static).forEach(function(wt){Ai(ht,Oe,wt)}),ec.forEach(function(wt){Ai(ht,ve,wt)});var xt=Eo(ve,Oe,tt,qt,ht);return To(ht,xt),Yt(ht,xt),ir(ht,xt),ht.compile()}return{next:bn,current:Cr,procs:function(){var ve=rr(),Oe=ve.proc("poll"),tt=ve.proc("refresh"),qt=ve.block();Oe(qt),tt(qt);var Wt=ve.shared,ht=Wt.gl,xt=Wt.next,wt=Wt.current;qt(wt,".dirty=false;"),Ya(ve,Oe),Ya(ve,tt,null,!0);var qe;Zr&&(qe=ve.link(Zr)),et.oes_vertex_array_object&&tt(ve.link(et.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var vt=0;vt<Jt.maxAttributes;++vt){var Pe=tt.def(Wt.attributes,"[",vt,"]"),_t=ve.cond(Pe,".buffer");_t.then(ht,".enableVertexAttribArray(",vt,");",ht,".bindBuffer(",pl,",",Pe,".buffer.buffer);",ht,".vertexAttribPointer(",vt,",",Pe,".size,",Pe,".type,",Pe,".normalized,",Pe,".stride,",Pe,".offset);").else(ht,".disableVertexAttribArray(",vt,");",ht,".vertexAttrib4f(",vt,",",Pe,".x,",Pe,".y,",Pe,".z,",Pe,".w);",Pe,".buffer=null;"),tt(_t),Zr&&tt(qe,".vertexAttribDivisorANGLE(",vt,",",Pe,".divisor);")}return tt(ve.shared.vao,".currentVAO=null;",ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"),Object.keys(vn).forEach(function(Lt){var hr=vn[Lt],Pr=qt.def(xt,".",Lt),Tr=ve.block();Tr("if(",Pr,"){",ht,".enable(",hr,")}else{",ht,".disable(",hr,")}",wt,".",Lt,"=",Pr,";"),tt(Tr),Oe("if(",Pr,"!==",wt,".",Lt,"){",Tr,"}")}),Object.keys(wr).forEach(function(Lt){var hr=wr[Lt],Pr=Cr[Lt],Tr,Ir,Ln=ve.block();if(Ln(ht,".",hr,"("),Wa(Pr)){var Mn=Pr.length;Tr=ve.global.def(xt,".",Lt),Ir=ve.global.def(wt,".",Lt),Ln(yt(Mn,function(On){return Tr+"["+On+"]"}),");",yt(Mn,function(On){return Ir+"["+On+"]="+Tr+"["+On+"];"}).join("")),Oe("if(",yt(Mn,function(On){return Tr+"["+On+"]!=="+Ir+"["+On+"]"}).join("||"),"){",Ln,"}")}else Tr=qt.def(xt,".",Lt),Ir=qt.def(wt,".",Lt),Ln(Tr,");",wt,".",Lt,"=",Tr,";"),Oe("if(",Tr,"!==",Ir,"){",Ln,"}");tt(Ln)}),ve.compile()}(),compile:Aa}}function rd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hv=34918,Wv=34919,xp=35007,Gv=function(W,Ie){if(!Ie.ext_disjoint_timer_query)return null;var et=[];function Jt(){return et.pop()||Ie.ext_disjoint_timer_query.createQueryEXT()}function yr(Zr){et.push(Zr)}var tr=[];function Xt(Zr){var dn=Jt();Ie.ext_disjoint_timer_query.beginQueryEXT(xp,dn),tr.push(dn),Mr(tr.length-1,tr.length,Zr)}function Ur(){Ie.ext_disjoint_timer_query.endQueryEXT(xp)}function Dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function jr(){return Jr.pop()||new Dr}function qr(Zr){Jr.push(Zr)}var an=[];function Mr(Zr,dn,Cr){var bn=jr();bn.startQueryIndex=Zr,bn.endQueryIndex=dn,bn.sum=0,bn.stats=Cr,an.push(bn)}var en=[],Ft=[];function ur(){var Zr,dn,Cr=tr.length;if(Cr!==0){Ft.length=Math.max(Ft.length,Cr+1),en.length=Math.max(en.length,Cr+1),en[0]=0,Ft[0]=0;var bn=0;for(Zr=0,dn=0;dn<tr.length;++dn){var kr=tr[dn];Ie.ext_disjoint_timer_query.getQueryObjectEXT(kr,Wv)?(bn+=Ie.ext_disjoint_timer_query.getQueryObjectEXT(kr,Hv),yr(kr)):tr[Zr++]=kr,en[dn+1]=bn,Ft[dn+1]=Zr}for(tr.length=Zr,Zr=0,dn=0;dn<an.length;++dn){var vn=an[dn],wr=vn.startQueryIndex,fn=vn.endQueryIndex;vn.sum+=en[fn]-en[wr];var Xn=Ft[wr],li=Ft[fn];li===Xn?(vn.stats.gpuTime+=vn.sum/1e6,qr(vn)):(vn.startQueryIndex=Xn,vn.endQueryIndex=li,an[Zr++]=vn)}an.length=Zr}}return{beginQuery:Xt,endQuery:Ur,pushScopeStats:Mr,update:ur,getNumPendingQueries:function(){return tr.length},clear:function(){et.push.apply(et,tr);for(var Zr=0;Zr<et.length;Zr++)Ie.ext_disjoint_timer_query.deleteQueryEXT(et[Zr]);tr.length=0,et.length=0},restore:function(){tr.length=0,et.length=0}}},Wd=16384,rs=256,nd=1024,Gd=34962,hf="webglcontextlost",Xd="webglcontextrestored",id=1,Xv=2,$v=3;function $d(W,Ie){for(var et=0;et<W.length;++et)if(W[et]===Ie)return et;return-1}function Yd(W){var Ie=Dt(W);if(!Ie)return null;var et=Ie.gl,Jt=et.getContextAttributes(),yr=et.isContextLost(),tr=Bt(et,Ie);if(!tr)return null;var Xt=fe(),Ur=rd(),Dr=tr.extensions,Jr=Gv(et,Dr),jr=Ti(),qr=et.drawingBufferWidth,an=et.drawingBufferHeight,Mr={tick:0,time:0,viewportWidth:qr,viewportHeight:an,framebufferWidth:qr,framebufferHeight:an,drawingBufferWidth:qr,drawingBufferHeight:an,pixelRatio:Ie.pixelRatio},en={},Ft={elements:null,primitive:4,count:-1,offset:0,instances:-1},ur=gc(et,Dr),Zr=gh(et,Ur,Ie,Cr),dn=te(et,Dr,ur,Ur,Zr);function Cr(Qn){return dn.destroyBuffer(Qn)}var bn=ta(et,Dr,Zr,Ur),kr=We(et,Xt,Ur,Ie),vn=Ut(et,Dr,ur,function(){Xn.procs.poll()},Mr,Ur,Ie),wr=Eu(et,Dr,ur,Ur,Ie),fn=w(et,Dr,ur,vn,wr,Ur),Xn=Qf(et,Xt,Dr,ur,Zr,bn,vn,fn,en,dn,kr,Ft,Mr,Jr,Ie),li=zt(et,fn,Xn.procs.poll,Mr,Jt,Dr,ur),ln=Xn.next,Fr=et.canvas,Er=[],rr=[],Mi=[],it=[Ie.onDestroy],Si=null;function pi(){if(Er.length===0){Jr&&Jr.update(),Si=null;return}Si=yn.next(pi),Ts();for(var Qn=Er.length-1;Qn>=0;--Qn){var ki=Er[Qn];ki&&ki(Mr,null,0)}et.flush(),Jr&&Jr.update()}function ei(){!Si&&Er.length>0&&(Si=yn.next(pi))}function ra(){Si&&(yn.cancel(pi),Si=null)}function mo(Qn){Qn.preventDefault(),yr=!0,ra(),rr.forEach(function(ki){ki()})}function go(Qn){et.getError(),yr=!1,tr.restore(),kr.restore(),Zr.restore(),vn.restore(),wr.restore(),fn.restore(),dn.restore(),Jr&&Jr.restore(),Xn.procs.refresh(),ei(),Mi.forEach(function(ki){ki()})}Fr&&(Fr.addEventListener(hf,mo,!1),Fr.addEventListener(Xd,go,!1));function Di(){Er.length=0,ra(),Fr&&(Fr.removeEventListener(hf,mo),Fr.removeEventListener(Xd,go)),kr.clear(),fn.clear(),wr.clear(),vn.clear(),bn.clear(),Zr.clear(),dn.clear(),Jr&&Jr.clear(),it.forEach(function(Qn){Qn()})}function xo(Qn){be(!!Qn,"invalid args to regl({...})"),be.type(Qn,"object","invalid args to regl({...})");function ki(Wt){var ht=B({},Wt);delete ht.uniforms,delete ht.attributes,delete ht.context,delete ht.vao,"stencil"in ht&&ht.stencil.op&&(ht.stencil.opBack=ht.stencil.opFront=ht.stencil.op,delete ht.stencil.op);function xt(wt){if(wt in ht){var qe=ht[wt];delete ht[wt],Object.keys(qe).forEach(function(vt){ht[wt+"."+vt]=qe[vt]})}}return xt("blend"),xt("depth"),xt("cull"),xt("stencil"),xt("polygonOffset"),xt("scissor"),xt("sample"),"vao"in Wt&&(ht.vao=Wt.vao),ht}function Ki(Wt){var ht={},xt={};return Object.keys(Wt).forEach(function(wt){var qe=Wt[wt];rn.isDynamic(qe)?xt[wt]=rn.unbox(qe,wt):ht[wt]=qe}),{dynamic:xt,static:ht}}var To=Ki(Qn.context||{}),ml=Ki(Qn.uniforms||{}),$e=Ki(Qn.attributes||{}),ir=Ki(ki(Qn)),Yt={gpuTime:0,cpuTime:0,count:0},xn=Xn.compile(ir,$e,ml,To,Yt),Ai=xn.draw,Aa=xn.batch,ve=xn.scope,Oe=[];function tt(Wt){for(;Oe.length<Wt;)Oe.push(null);return Oe}function qt(Wt,ht){var xt;if(yr&&be.raise("context lost"),typeof Wt=="function")return ve.call(this,null,Wt,0);if(typeof ht=="function")if(typeof Wt=="number")for(xt=0;xt<Wt;++xt)ve.call(this,null,ht,xt);else if(Array.isArray(Wt))for(xt=0;xt<Wt.length;++xt)ve.call(this,Wt[xt],ht,xt);else return ve.call(this,Wt,ht,0);else if(typeof Wt=="number"){if(Wt>0)return Aa.call(this,tt(Wt|0),Wt|0)}else if(Array.isArray(Wt)){if(Wt.length)return Aa.call(this,Wt,Wt.length)}else return Ai.call(this,Wt)}return B(qt,{stats:Yt})}var Ca=fn.setFBO=xo({framebuffer:rn.define.call(null,id,"framebuffer")});function Eo(Qn,ki){var Ki=0;Xn.procs.poll();var To=ki.color;To&&(et.clearColor(+To[0]||0,+To[1]||0,+To[2]||0,+To[3]||0),Ki|=Wd),"depth"in ki&&(et.clearDepth(+ki.depth),Ki|=rs),"stencil"in ki&&(et.clearStencil(ki.stencil|0),Ki|=nd),be(!!Ki,"called regl.clear with no buffer specified"),et.clear(Ki)}function So(Qn){if(be(typeof Qn=="object"&&Qn,"regl.clear() takes an object as input"),"framebuffer"in Qn)if(Qn.framebuffer&&Qn.framebuffer_reglType==="framebufferCube")for(var ki=0;ki<6;++ki)Ca(B({framebuffer:Qn.framebuffer.faces[ki]},Qn),Eo);else Ca(Qn,Eo);else Eo(null,Qn)}function Ya(Qn){be.type(Qn,"function","regl.frame() callback must be a function"),Er.push(Qn);function ki(){var Ki=$d(Er,Qn);be(Ki>=0,"cannot cancel a frame twice");function To(){var ml=$d(Er,To);Er[ml]=Er[Er.length-1],Er.length-=1,Er.length<=0&&ra()}Er[Ki]=To}return ei(),{cancel:ki}}function zo(){var Qn=ln.viewport,ki=ln.scissor_box;Qn[0]=Qn[1]=ki[0]=ki[1]=0,Mr.viewportWidth=Mr.framebufferWidth=Mr.drawingBufferWidth=Qn[2]=ki[2]=et.drawingBufferWidth,Mr.viewportHeight=Mr.framebufferHeight=Mr.drawingBufferHeight=Qn[3]=ki[3]=et.drawingBufferHeight}function Ts(){Mr.tick+=1,Mr.time=Ei(),zo(),Xn.procs.poll()}function Ao(){zo(),Xn.procs.refresh(),Jr&&Jr.update()}function Ei(){return(Ti()-jr)/1e3}Ao();function ps(Qn,ki){be.type(ki,"function","listener callback must be a function");var Ki;switch(Qn){case"frame":return Ya(ki);case"lost":Ki=rr;break;case"restore":Ki=Mi;break;case"destroy":Ki=it;break;default:be.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ki.push(ki),{cancel:function(){for(var To=0;To<Ki.length;++To)if(Ki[To]===ki){Ki[To]=Ki[Ki.length-1],Ki.pop();return}}}}var ha=B(xo,{clear:So,prop:rn.define.bind(null,id),context:rn.define.bind(null,Xv),this:rn.define.bind(null,$v),draw:xo({}),buffer:function(Qn){return Zr.create(Qn,Gd,!1,!1)},elements:function(Qn){return bn.create(Qn,!1)},texture:vn.create2D,cube:vn.createCube,renderbuffer:wr.create,framebuffer:fn.create,framebufferCube:fn.createCube,vao:dn.createVAO,attributes:Jt,frame:Ya,on:ps,limits:ur,hasExtension:function(Qn){return ur.extensions.indexOf(Qn.toLowerCase())>=0},read:li,destroy:Di,_gl:et,_refresh:Ao,poll:function(){Ts(),Jr&&Jr.update()},now:Ei,stats:Ur});return Ie.onDone(null,ha),ha}return Yd})},69848:function(Ht){(function(re,B){Ht.exports=B()})(this,function(){"use strict";function re(ut,we,At,Fe,Zt,vr){if(!(Zt-Fe<=At)){var ee=Fe+Zt>>1;B(ut,we,ee,Fe,Zt,vr%2),re(ut,we,At,Fe,ee-1,vr+1),re(ut,we,At,ee+1,Zt,vr+1)}}function B(ut,we,At,Fe,Zt,vr){for(;Zt>Fe;){if(Zt-Fe>600){var ee=Zt-Fe+1,V=At-Fe+1,Q=Math.log(ee),Re=.5*Math.exp(2*Q/3),xe=.5*Math.sqrt(Q*Re*(ee-Re)/ee)*(V-ee/2<0?-1:1),nt=Math.max(Fe,Math.floor(At-V*Re/ee+xe)),Le=Math.min(Zt,Math.floor(At+(ee-V)*Re/ee+xe));B(ut,we,At,nt,Le,vr)}var Ye=we[2*At+vr],rt=Fe,Tt=Zt;for(ne(ut,we,Fe,At),we[2*Zt+vr]>Ye&&ne(ut,we,Fe,Zt);rt<Tt;){for(ne(ut,we,rt,Tt),rt++,Tt--;we[2*rt+vr]<Ye;)rt++;for(;we[2*Tt+vr]>Ye;)Tt--}we[2*Fe+vr]===Ye?ne(ut,we,Fe,Tt):(Tt++,ne(ut,we,Tt,Zt)),Tt<=At&&(Fe=Tt+1),At<=Tt&&(Zt=Tt-1)}}function ne(ut,we,At,Fe){de(ut,At,Fe),de(we,2*At,2*Fe),de(we,2*At+1,2*Fe+1)}function de(ut,we,At){var Fe=ut[we];ut[we]=ut[At],ut[At]=Fe}function y(ut,we,At,Fe,Zt,vr,ee){for(var V=[0,ut.length-1,0],Q=[],Re,xe;V.length;){var nt=V.pop(),Le=V.pop(),Ye=V.pop();if(Le-Ye<=ee){for(var rt=Ye;rt<=Le;rt++)Re=we[2*rt],xe=we[2*rt+1],Re>=At&&Re<=Zt&&xe>=Fe&&xe<=vr&&Q.push(ut[rt]);continue}var Tt=Math.floor((Ye+Le)/2);Re=we[2*Tt],xe=we[2*Tt+1],Re>=At&&Re<=Zt&&xe>=Fe&&xe<=vr&&Q.push(ut[Tt]);var dr=(nt+1)%2;(nt===0?At<=Re:Fe<=xe)&&(V.push(Ye),V.push(Tt-1),V.push(dr)),(nt===0?Zt>=Re:vr>=xe)&&(V.push(Tt+1),V.push(Le),V.push(dr))}return Q}function ce(ut,we,At,Fe,Zt,vr){for(var ee=[0,ut.length-1,0],V=[],Q=Zt*Zt;ee.length;){var Re=ee.pop(),xe=ee.pop(),nt=ee.pop();if(xe-nt<=vr){for(var Le=nt;Le<=xe;Le++)L(we[2*Le],we[2*Le+1],At,Fe)<=Q&&V.push(ut[Le]);continue}var Ye=Math.floor((nt+xe)/2),rt=we[2*Ye],Tt=we[2*Ye+1];L(rt,Tt,At,Fe)<=Q&&V.push(ut[Ye]);var dr=(Re+1)%2;(Re===0?At-Zt<=rt:Fe-Zt<=Tt)&&(ee.push(nt),ee.push(Ye-1),ee.push(dr)),(Re===0?At+Zt>=rt:Fe+Zt>=Tt)&&(ee.push(Ye+1),ee.push(xe),ee.push(dr))}return V}function L(ut,we,At,Fe){var Zt=ut-At,vr=we-Fe;return Zt*Zt+vr*vr}var ue=function(ut){return ut[0]},oe=function(ut){return ut[1]},Be=function(we,At,Fe,Zt,vr){At===void 0&&(At=ue),Fe===void 0&&(Fe=oe),Zt===void 0&&(Zt=64),vr===void 0&&(vr=Float64Array),this.nodeSize=Zt,this.points=we;for(var ee=we.length<65536?Uint16Array:Uint32Array,V=this.ids=new ee(we.length),Q=this.coords=new vr(we.length*2),Re=0;Re<we.length;Re++)V[Re]=Re,Q[2*Re]=At(we[Re]),Q[2*Re+1]=Fe(we[Re]);re(V,Q,Zt,0,V.length-1,0)};Be.prototype.range=function(we,At,Fe,Zt){return y(this.ids,this.coords,we,At,Fe,Zt,this.nodeSize)},Be.prototype.within=function(we,At,Fe){return ce(this.ids,this.coords,we,At,Fe,this.nodeSize)};var se={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ut){return ut}},ze=Math.fround||function(ut){return function(we){return ut[0]=+we,ut[0]}}(new Float32Array(1)),Ge=function(we){this.options=pr(Object.create(se),we),this.trees=new Array(this.options.maxZoom+1)};Ge.prototype.load=function(we){var At=this.options,Fe=At.log,Zt=At.minZoom,vr=At.maxZoom,ee=At.nodeSize;Fe&&console.time("total time");var V="prepare "+we.length+" points";Fe&&console.time(V),this.points=we;for(var Q=[],Re=0;Re<we.length;Re++)we[Re].geometry&&Q.push(Rt(we[Re],Re));this.trees[vr+1]=new Be(Q,gr,lr,ee,Float32Array),Fe&&console.timeEnd(V);for(var xe=vr;xe>=Zt;xe--){var nt=+Date.now();Q=this._cluster(Q,xe),this.trees[xe]=new Be(Q,gr,lr,ee,Float32Array),Fe&&console.log("z%d: %d clusters in %dms",xe,Q.length,+Date.now()-nt)}return Fe&&console.timeEnd("total time"),this},Ge.prototype.getClusters=function(we,At){var Fe=((we[0]+180)%360+360)%360-180,Zt=Math.max(-90,Math.min(90,we[1])),vr=we[2]===180?180:((we[2]+180)%360+360)%360-180,ee=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)Fe=-180,vr=180;else if(Fe>vr){var V=this.getClusters([Fe,Zt,180,ee],At),Q=this.getClusters([-180,Zt,vr,ee],At);return V.concat(Q)}for(var Re=this.trees[this._limitZoom(At)],xe=Re.range(Pt(Fe),Ct(ee),Pt(vr),Ct(Zt)),nt=[],Le=0,Ye=xe;Le<Ye.length;Le+=1){var rt=Ye[Le],Tt=Re.points[rt];nt.push(Tt.numPoints?St(Tt):this.points[Tt.index])}return nt},Ge.prototype.getChildren=function(we){var At=this._getOriginId(we),Fe=this._getOriginZoom(we),Zt="No cluster with the specified id.",vr=this.trees[Fe];if(!vr)throw new Error(Zt);var ee=vr.points[At];if(!ee)throw new Error(Zt);for(var V=this.options.radius/(this.options.extent*Math.pow(2,Fe-1)),Q=vr.within(ee.x,ee.y,V),Re=[],xe=0,nt=Q;xe<nt.length;xe+=1){var Le=nt[xe],Ye=vr.points[Le];Ye.parentId===we&&Re.push(Ye.numPoints?St(Ye):this.points[Ye.index])}if(Re.length===0)throw new Error(Zt);return Re},Ge.prototype.getLeaves=function(we,At,Fe){At=At||10,Fe=Fe||0;var Zt=[];return this._appendLeaves(Zt,we,At,Fe,0),Zt},Ge.prototype.getTile=function(we,At,Fe){var Zt=this.trees[this._limitZoom(we)],vr=Math.pow(2,we),ee=this.options,V=ee.extent,Q=ee.radius,Re=Q/V,xe=(Fe-Re)/vr,nt=(Fe+1+Re)/vr,Le={features:[]};return this._addTileFeatures(Zt.range((At-Re)/vr,xe,(At+1+Re)/vr,nt),Zt.points,At,Fe,vr,Le),At===0&&this._addTileFeatures(Zt.range(1-Re/vr,xe,1,nt),Zt.points,vr,Fe,vr,Le),At===vr-1&&this._addTileFeatures(Zt.range(0,xe,Re/vr,nt),Zt.points,-1,Fe,vr,Le),Le.features.length?Le:null},Ge.prototype.getClusterExpansionZoom=function(we){for(var At=this._getOriginZoom(we)-1;At<=this.options.maxZoom;){var Fe=this.getChildren(we);if(At++,Fe.length!==1)break;we=Fe[0].properties.cluster_id}return At},Ge.prototype._appendLeaves=function(we,At,Fe,Zt,vr){for(var ee=this.getChildren(At),V=0,Q=ee;V<Q.length;V+=1){var Re=Q[V],xe=Re.properties;if(xe&&xe.cluster?vr+xe.point_count<=Zt?vr+=xe.point_count:vr=this._appendLeaves(we,xe.cluster_id,Fe,Zt,vr):vr<Zt?vr++:we.push(Re),we.length===Fe)break}return vr},Ge.prototype._addTileFeatures=function(we,At,Fe,Zt,vr,ee){for(var V=0,Q=we;V<Q.length;V+=1){var Re=Q[V],xe=At[Re],nt=xe.numPoints,Le=void 0,Ye=void 0,rt=void 0;if(nt)Le=Nt(xe),Ye=xe.x,rt=xe.y;else{var Tt=this.points[xe.index];Le=Tt.properties,Ye=Pt(Tt.geometry.coordinates[0]),rt=Ct(Tt.geometry.coordinates[1])}var dr={type:1,geometry:[[Math.round(this.options.extent*(Ye*vr-Fe)),Math.round(this.options.extent*(rt*vr-Zt))]],tags:Le},Ot=void 0;nt?Ot=xe.id:this.options.generateId?Ot=xe.index:this.points[xe.index].id&&(Ot=this.points[xe.index].id),Ot!==void 0&&(dr.id=Ot),ee.features.push(dr)}},Ge.prototype._limitZoom=function(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))},Ge.prototype._cluster=function(we,At){for(var Fe=[],Zt=this.options,vr=Zt.radius,ee=Zt.extent,V=Zt.reduce,Q=Zt.minPoints,Re=vr/(ee*Math.pow(2,At)),xe=0;xe<we.length;xe++){var nt=we[xe];if(!(nt.zoom<=At)){nt.zoom=At;for(var Le=this.trees[At+1],Ye=Le.within(nt.x,nt.y,Re),rt=nt.numPoints||1,Tt=rt,dr=0,Ot=Ye;dr<Ot.length;dr+=1){var Vr=Ot[dr],Kr=Le.points[Vr];Kr.zoom>At&&(Tt+=Kr.numPoints||1)}if(Tt>rt&&Tt>=Q){for(var Or=nt.x*rt,In=nt.y*rt,gn=V&&rt>1?this._map(nt,!0):null,nn=(xe<<5)+(At+1)+this.points.length,fi=0,Lr=Ye;fi<Lr.length;fi+=1){var Vn=Lr[fi],Hr=Le.points[Vn];if(!(Hr.zoom<=At)){Hr.zoom=At;var hn=Hr.numPoints||1;Or+=Hr.x*hn,In+=Hr.y*hn,Hr.parentId=nn,V&&(gn||(gn=this._map(nt,!0)),V(gn,this._map(Hr)))}}nt.parentId=nn,Fe.push(Ke(Or/Tt,In/Tt,nn,Tt,gn))}else if(Fe.push(nt),Tt>1)for(var qi=0,xi=Ye;qi<xi.length;qi+=1){var ia=xi[qi],ea=Le.points[ia];ea.zoom<=At||(ea.zoom=At,Fe.push(ea))}}}return Fe},Ge.prototype._getOriginId=function(we){return we-this.points.length>>5},Ge.prototype._getOriginZoom=function(we){return(we-this.points.length)%32},Ge.prototype._map=function(we,At){if(we.numPoints)return At?pr({},we.properties):we.properties;var Fe=this.points[we.index].properties,Zt=this.options.map(Fe);return At&&Zt===Fe?pr({},Zt):Zt};function Ke(ut,we,At,Fe,Zt){return{x:ze(ut),y:ze(we),zoom:1/0,id:At,parentId:-1,numPoints:Fe,properties:Zt}}function Rt(ut,we){var At=ut.geometry.coordinates,Fe=At[0],Zt=At[1];return{x:ze(Pt(Fe)),y:ze(Ct(Zt)),zoom:1/0,index:we,parentId:-1}}function St(ut){return{type:"Feature",id:ut.id,properties:Nt(ut),geometry:{type:"Point",coordinates:[pt(ut.x),mt(ut.y)]}}}function Nt(ut){var we=ut.numPoints,At=we>=1e4?Math.round(we/1e3)+"k":we>=1e3?Math.round(we/100)/10+"k":we;return pr(pr({},ut.properties),{cluster:!0,cluster_id:ut.id,point_count:we,point_count_abbreviated:At})}function Pt(ut){return ut/360+.5}function Ct(ut){var we=Math.sin(ut*Math.PI/180),At=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return At<0?0:At>1?1:At}function pt(ut){return(ut-.5)*360}function mt(ut){var we=(180-ut*360)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function pr(ut,we){for(var At in we)ut[At]=we[At];return ut}function gr(ut){return ut.x}function lr(ut){return ut.y}return Ge})},17061:function(Ht,re,B){var ne=B(18698).default;function de(){"use strict";Ht.exports=de=function(){return ce},Ht.exports.__esModule=!0,Ht.exports.default=Ht.exports;var y,ce={},L=Object.prototype,ue=L.hasOwnProperty,oe=Object.defineProperty||function(Le,Ye,rt){Le[Ye]=rt.value},Be=typeof Symbol=="function"?Symbol:{},se=Be.iterator||"@@iterator",ze=Be.asyncIterator||"@@asyncIterator",Ge=Be.toStringTag||"@@toStringTag";function Ke(Le,Ye,rt){return Object.defineProperty(Le,Ye,{value:rt,enumerable:!0,configurable:!0,writable:!0}),Le[Ye]}try{Ke({},"")}catch(Le){Ke=function(rt,Tt,dr){return rt[Tt]=dr}}function Rt(Le,Ye,rt,Tt){var dr=Ye&&Ye.prototype instanceof pr?Ye:pr,Ot=Object.create(dr.prototype),Vr=new xe(Tt||[]);return oe(Ot,"_invoke",{value:ee(Le,rt,Vr)}),Ot}function St(Le,Ye,rt){try{return{type:"normal",arg:Le.call(Ye,rt)}}catch(Tt){return{type:"throw",arg:Tt}}}ce.wrap=Rt;var Nt="suspendedStart",Pt="suspendedYield",Ct="executing",pt="completed",mt={};function pr(){}function gr(){}function lr(){}var ut={};Ke(ut,se,function(){return this});var we=Object.getPrototypeOf,At=we&&we(we(nt([])));At&&At!==L&&ue.call(At,se)&&(ut=At);var Fe=lr.prototype=pr.prototype=Object.create(ut);function Zt(Le){["next","throw","return"].forEach(function(Ye){Ke(Le,Ye,function(rt){return this._invoke(Ye,rt)})})}function vr(Le,Ye){function rt(dr,Ot,Vr,Kr){var Or=St(Le[dr],Le,Ot);if(Or.type!=="throw"){var In=Or.arg,gn=In.value;return gn&&ne(gn)=="object"&&ue.call(gn,"__await")?Ye.resolve(gn.__await).then(function(nn){rt("next",nn,Vr,Kr)},function(nn){rt("throw",nn,Vr,Kr)}):Ye.resolve(gn).then(function(nn){In.value=nn,Vr(In)},function(nn){return rt("throw",nn,Vr,Kr)})}Kr(Or.arg)}var Tt;oe(this,"_invoke",{value:function(Ot,Vr){function Kr(){return new Ye(function(Or,In){rt(Ot,Vr,Or,In)})}return Tt=Tt?Tt.then(Kr,Kr):Kr()}})}function ee(Le,Ye,rt){var Tt=Nt;return function(dr,Ot){if(Tt===Ct)throw new Error("Generator is already running");if(Tt===pt){if(dr==="throw")throw Ot;return{value:y,done:!0}}for(rt.method=dr,rt.arg=Ot;;){var Vr=rt.delegate;if(Vr){var Kr=V(Vr,rt);if(Kr){if(Kr===mt)continue;return Kr}}if(rt.method==="next")rt.sent=rt._sent=rt.arg;else if(rt.method==="throw"){if(Tt===Nt)throw Tt=pt,rt.arg;rt.dispatchException(rt.arg)}else rt.method==="return"&&rt.abrupt("return",rt.arg);Tt=Ct;var Or=St(Le,Ye,rt);if(Or.type==="normal"){if(Tt=rt.done?pt:Pt,Or.arg===mt)continue;return{value:Or.arg,done:rt.done}}Or.type==="throw"&&(Tt=pt,rt.method="throw",rt.arg=Or.arg)}}}function V(Le,Ye){var rt=Ye.method,Tt=Le.iterator[rt];if(Tt===y)return Ye.delegate=null,rt==="throw"&&Le.iterator.return&&(Ye.method="return",Ye.arg=y,V(Le,Ye),Ye.method==="throw")||rt!=="return"&&(Ye.method="throw",Ye.arg=new TypeError("The iterator does not provide a '"+rt+"' method")),mt;var dr=St(Tt,Le.iterator,Ye.arg);if(dr.type==="throw")return Ye.method="throw",Ye.arg=dr.arg,Ye.delegate=null,mt;var Ot=dr.arg;return Ot?Ot.done?(Ye[Le.resultName]=Ot.value,Ye.next=Le.nextLoc,Ye.method!=="return"&&(Ye.method="next",Ye.arg=y),Ye.delegate=null,mt):Ot:(Ye.method="throw",Ye.arg=new TypeError("iterator result is not an object"),Ye.delegate=null,mt)}function Q(Le){var Ye={tryLoc:Le[0]};1 in Le&&(Ye.catchLoc=Le[1]),2 in Le&&(Ye.finallyLoc=Le[2],Ye.afterLoc=Le[3]),this.tryEntries.push(Ye)}function Re(Le){var Ye=Le.completion||{};Ye.type="normal",delete Ye.arg,Le.completion=Ye}function xe(Le){this.tryEntries=[{tryLoc:"root"}],Le.forEach(Q,this),this.reset(!0)}function nt(Le){if(Le||Le===""){var Ye=Le[se];if(Ye)return Ye.call(Le);if(typeof Le.next=="function")return Le;if(!isNaN(Le.length)){var rt=-1,Tt=function dr(){for(;++rt<Le.length;)if(ue.call(Le,rt))return dr.value=Le[rt],dr.done=!1,dr;return dr.value=y,dr.done=!0,dr};return Tt.next=Tt}}throw new TypeError(ne(Le)+" is not iterable")}return gr.prototype=lr,oe(Fe,"constructor",{value:lr,configurable:!0}),oe(lr,"constructor",{value:gr,configurable:!0}),gr.displayName=Ke(lr,Ge,"GeneratorFunction"),ce.isGeneratorFunction=function(Le){var Ye=typeof Le=="function"&&Le.constructor;return!!Ye&&(Ye===gr||(Ye.displayName||Ye.name)==="GeneratorFunction")},ce.mark=function(Le){return Object.setPrototypeOf?Object.setPrototypeOf(Le,lr):(Le.__proto__=lr,Ke(Le,Ge,"GeneratorFunction")),Le.prototype=Object.create(Fe),Le},ce.awrap=function(Le){return{__await:Le}},Zt(vr.prototype),Ke(vr.prototype,ze,function(){return this}),ce.AsyncIterator=vr,ce.async=function(Le,Ye,rt,Tt,dr){dr===void 0&&(dr=Promise);var Ot=new vr(Rt(Le,Ye,rt,Tt),dr);return ce.isGeneratorFunction(Ye)?Ot:Ot.next().then(function(Vr){return Vr.done?Vr.value:Ot.next()})},Zt(Fe),Ke(Fe,Ge,"Generator"),Ke(Fe,se,function(){return this}),Ke(Fe,"toString",function(){return"[object Generator]"}),ce.keys=function(Le){var Ye=Object(Le),rt=[];for(var Tt in Ye)rt.push(Tt);return rt.reverse(),function dr(){for(;rt.length;){var Ot=rt.pop();if(Ot in Ye)return dr.value=Ot,dr.done=!1,dr}return dr.done=!0,dr}},ce.values=nt,xe.prototype={constructor:xe,reset:function(Ye){if(this.prev=0,this.next=0,this.sent=this._sent=y,this.done=!1,this.delegate=null,this.method="next",this.arg=y,this.tryEntries.forEach(Re),!Ye)for(var rt in this)rt.charAt(0)==="t"&&ue.call(this,rt)&&!isNaN(+rt.slice(1))&&(this[rt]=y)},stop:function(){this.done=!0;var Ye=this.tryEntries[0].completion;if(Ye.type==="throw")throw Ye.arg;return this.rval},dispatchException:function(Ye){if(this.done)throw Ye;var rt=this;function Tt(In,gn){return Vr.type="throw",Vr.arg=Ye,rt.next=In,gn&&(rt.method="next",rt.arg=y),!!gn}for(var dr=this.tryEntries.length-1;dr>=0;--dr){var Ot=this.tryEntries[dr],Vr=Ot.completion;if(Ot.tryLoc==="root")return Tt("end");if(Ot.tryLoc<=this.prev){var Kr=ue.call(Ot,"catchLoc"),Or=ue.call(Ot,"finallyLoc");if(Kr&&Or){if(this.prev<Ot.catchLoc)return Tt(Ot.catchLoc,!0);if(this.prev<Ot.finallyLoc)return Tt(Ot.finallyLoc)}else if(Kr){if(this.prev<Ot.catchLoc)return Tt(Ot.catchLoc,!0)}else{if(!Or)throw new Error("try statement without catch or finally");if(this.prev<Ot.finallyLoc)return Tt(Ot.finallyLoc)}}}},abrupt:function(Ye,rt){for(var Tt=this.tryEntries.length-1;Tt>=0;--Tt){var dr=this.tryEntries[Tt];if(dr.tryLoc<=this.prev&&ue.call(dr,"finallyLoc")&&this.prev<dr.finallyLoc){var Ot=dr;break}}Ot&&(Ye==="break"||Ye==="continue")&&Ot.tryLoc<=rt&&rt<=Ot.finallyLoc&&(Ot=null);var Vr=Ot?Ot.completion:{};return Vr.type=Ye,Vr.arg=rt,Ot?(this.method="next",this.next=Ot.finallyLoc,mt):this.complete(Vr)},complete:function(Ye,rt){if(Ye.type==="throw")throw Ye.arg;return Ye.type==="break"||Ye.type==="continue"?this.next=Ye.arg:Ye.type==="return"?(this.rval=this.arg=Ye.arg,this.method="return",this.next="end"):Ye.type==="normal"&&rt&&(this.next=rt),mt},finish:function(Ye){for(var rt=this.tryEntries.length-1;rt>=0;--rt){var Tt=this.tryEntries[rt];if(Tt.finallyLoc===Ye)return this.complete(Tt.completion,Tt.afterLoc),Re(Tt),mt}},catch:function(Ye){for(var rt=this.tryEntries.length-1;rt>=0;--rt){var Tt=this.tryEntries[rt];if(Tt.tryLoc===Ye){var dr=Tt.completion;if(dr.type==="throw"){var Ot=dr.arg;Re(Tt)}return Ot}}throw new Error("illegal catch attempt")},delegateYield:function(Ye,rt,Tt){return this.delegate={iterator:nt(Ye),resultName:rt,nextLoc:Tt},this.method==="next"&&(this.arg=y),mt}},ce}Ht.exports=de,Ht.exports.__esModule=!0,Ht.exports.default=Ht.exports},18698:function(Ht){function re(B){"@babel/helpers - typeof";return Ht.exports=re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ne){return typeof ne}:function(ne){return ne&&typeof Symbol=="function"&&ne.constructor===Symbol&&ne!==Symbol.prototype?"symbol":typeof ne},Ht.exports.__esModule=!0,Ht.exports.default=Ht.exports,re(B)}Ht.exports=re,Ht.exports.__esModule=!0,Ht.exports.default=Ht.exports},64687:function(Ht,re,B){var ne=B(17061)();Ht.exports=ne;try{regeneratorRuntime=ne}catch(de){typeof globalThis=="object"?globalThis.regeneratorRuntime=ne:Function("r","regeneratorRuntime = r")(ne)}},8520:function(Ht,re,B){var ne;(function(de){(function(y){var ce=typeof globalThis=="object"?globalThis:typeof B.g=="object"?B.g:typeof self=="object"?self:typeof this=="object"?this:se(),L=ue(de);typeof ce.Reflect!="undefined"&&(L=ue(ce.Reflect,L)),y(L,ce),typeof ce.Reflect=="undefined"&&(ce.Reflect=de);function ue(ze,Ge){return function(Ke,Rt){Object.defineProperty(ze,Ke,{configurable:!0,writable:!0,value:Rt}),Ge&&Ge(Ke,Rt)}}function oe(){try{return Function("return this;")()}catch(ze){}}function Be(){try{return(0,eval)("(function() { return this; })()")}catch(ze){}}function se(){return oe()||Be()}})(function(y,ce){var L=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",oe=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",se=typeof Object.create=="function",ze={__proto__:[]}instanceof Array,Ge=!se&&!ze,Ke={create:se?function(){return Ti(Object.create(null))}:ze?function(){return Ti({__proto__:null})}:function(){return Ti({})},has:Ge?function(fe,k){return L.call(fe,k)}:function(fe,k){return k in fe},get:Ge?function(fe,k){return L.call(fe,k)?fe[k]:void 0}:function(fe,k){return fe[k]}},Rt=Object.getPrototypeOf(Function),St=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Gr(),Nt=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:rn(),Pt=typeof WeakMap=="function"?WeakMap:yn(),Ct=ue?Symbol.for("@reflect-metadata:registry"):void 0,pt=po(),mt=Mo(pt);function pr(fe,k,z,le){if(Ot(z)){if(!Vn(fe))throw new TypeError;if(!hn(k))throw new TypeError;return V(fe,k)}else{if(!Vn(fe))throw new TypeError;if(!Or(k))throw new TypeError;if(!Or(le)&&!Ot(le)&&!Vr(le))throw new TypeError;return Vr(le)&&(le=void 0),z=Lr(z),Q(fe,k,z,le)}}y("decorate",pr);function gr(fe,k){function z(le,Se){if(!Or(le))throw new TypeError;if(!Ot(Se)&&!qi(Se))throw new TypeError;Ye(fe,k,le,Se)}return z}y("metadata",gr);function lr(fe,k,z,le){if(!Or(z))throw new TypeError;return Ot(le)||(le=Lr(le)),Ye(fe,k,z,le)}y("defineMetadata",lr);function ut(fe,k,z){if(!Or(k))throw new TypeError;return Ot(z)||(z=Lr(z)),Re(fe,k,z)}y("hasMetadata",ut);function we(fe,k,z){if(!Or(k))throw new TypeError;return Ot(z)||(z=Lr(z)),xe(fe,k,z)}y("hasOwnMetadata",we);function At(fe,k,z){if(!Or(k))throw new TypeError;return Ot(z)||(z=Lr(z)),nt(fe,k,z)}y("getMetadata",At);function Fe(fe,k,z){if(!Or(k))throw new TypeError;return Ot(z)||(z=Lr(z)),Le(fe,k,z)}y("getOwnMetadata",Fe);function Zt(fe,k){if(!Or(fe))throw new TypeError;return Ot(k)||(k=Lr(k)),rt(fe,k)}y("getMetadataKeys",Zt);function vr(fe,k){if(!Or(fe))throw new TypeError;return Ot(k)||(k=Lr(k)),Tt(fe,k)}y("getOwnMetadataKeys",vr);function ee(fe,k,z){if(!Or(k))throw new TypeError;if(Ot(z)||(z=Lr(z)),!Or(k))throw new TypeError;Ot(z)||(z=Lr(z));var le=_r(k,z,!1);return Ot(le)?!1:le.OrdinaryDeleteMetadata(fe,k,z)}y("deleteMetadata",ee);function V(fe,k){for(var z=fe.length-1;z>=0;--z){var le=fe[z],Se=le(k);if(!Ot(Se)&&!Vr(Se)){if(!hn(Se))throw new TypeError;k=Se}}return k}function Q(fe,k,z,le){for(var Se=fe.length-1;Se>=0;--Se){var De=fe[Se],$t=De(k,z,le);if(!Ot($t)&&!Vr($t)){if(!Or($t))throw new TypeError;le=$t}}return le}function Re(fe,k,z){var le=xe(fe,k,z);if(le)return!0;var Se=va(k);return Vr(Se)?!1:Re(fe,Se,z)}function xe(fe,k,z){var le=_r(k,z,!1);return Ot(le)?!1:nn(le.OrdinaryHasOwnMetadata(fe,k,z))}function nt(fe,k,z){var le=xe(fe,k,z);if(le)return Le(fe,k,z);var Se=va(k);if(!Vr(Se))return nt(fe,Se,z)}function Le(fe,k,z){var le=_r(k,z,!1);if(!Ot(le))return le.OrdinaryGetOwnMetadata(fe,k,z)}function Ye(fe,k,z,le){var Se=_r(z,le,!0);Se.OrdinaryDefineOwnMetadata(fe,k,z,le)}function rt(fe,k){var z=Tt(fe,k),le=va(fe);if(le===null)return z;var Se=rt(le,k);if(Se.length<=0)return z;if(z.length<=0)return Se;for(var De=new Nt,$t=[],Dt=0,Bt=z;Dt<Bt.length;Dt++){var yt=Bt[Dt],U=De.has(yt);U||(De.add(yt),$t.push(yt))}for(var N=0,$=Se;N<$.length;N++){var yt=$[N],U=De.has(yt);U||(De.add(yt),$t.push(yt))}return $t}function Tt(fe,k){var z=_r(fe,k,!1);return z?z.OrdinaryOwnMetadataKeys(fe,k):[]}function dr(fe){if(fe===null)return 1;switch(typeof fe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return fe===null?1:6;default:return 6}}function Ot(fe){return fe===void 0}function Vr(fe){return fe===null}function Kr(fe){return typeof fe=="symbol"}function Or(fe){return typeof fe=="object"?fe!==null:typeof fe=="function"}function In(fe,k){switch(dr(fe)){case 0:return fe;case 1:return fe;case 2:return fe;case 3:return fe;case 4:return fe;case 5:return fe}var z=k===3?"string":k===5?"number":"default",le=ia(fe,oe);if(le!==void 0){var Se=le.call(fe,z);if(Or(Se))throw new TypeError;return Se}return gn(fe,z==="default"?"number":z)}function gn(fe,k){if(k==="string"){var z=fe.toString;if(Hr(z)){var le=z.call(fe);if(!Or(le))return le}var Se=fe.valueOf;if(Hr(Se)){var le=Se.call(fe);if(!Or(le))return le}}else{var Se=fe.valueOf;if(Hr(Se)){var le=Se.call(fe);if(!Or(le))return le}var De=fe.toString;if(Hr(De)){var le=De.call(fe);if(!Or(le))return le}}throw new TypeError}function nn(fe){return!!fe}function fi(fe){return""+fe}function Lr(fe){var k=In(fe,3);return Kr(k)?k:fi(k)}function Vn(fe){return Array.isArray?Array.isArray(fe):fe instanceof Object?fe instanceof Array:Object.prototype.toString.call(fe)==="[object Array]"}function Hr(fe){return typeof fe=="function"}function hn(fe){return typeof fe=="function"}function qi(fe){switch(dr(fe)){case 3:return!0;case 4:return!0;default:return!1}}function xi(fe,k){return fe===k||fe!==fe&&k!==k}function ia(fe,k){var z=fe[k];if(z!=null){if(!Hr(z))throw new TypeError;return z}}function ea(fe){var k=ia(fe,Be);if(!Hr(k))throw new TypeError;var z=k.call(fe);if(!Or(z))throw new TypeError;return z}function be(fe){return fe.value}function Fi(fe){var k=fe.next();return k.done?!1:k}function aa(fe){var k=fe.return;k&&k.call(fe)}function va(fe){var k=Object.getPrototypeOf(fe);if(typeof fe!="function"||fe===Rt||k!==Rt)return k;var z=fe.prototype,le=z&&Object.getPrototypeOf(z);if(le==null||le===Object.prototype)return k;var Se=le.constructor;return typeof Se!="function"||Se===fe?k:Se}function oo(){var fe;!Ot(Ct)&&typeof ce.Reflect!="undefined"&&!(Ct in ce.Reflect)&&typeof ce.Reflect.defineMetadata=="function"&&(fe=Gt(ce.Reflect));var k,z,le,Se=new Pt,De={registerProvider:$t,getProvider:Bt,setProvider:U};return De;function $t(N){if(!Object.isExtensible(De))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case fe===N:break;case Ot(k):k=N;break;case k===N:break;case Ot(z):z=N;break;case z===N:break;default:le===void 0&&(le=new Nt),le.add(N);break}}function Dt(N,$){if(!Ot(k)){if(k.isProviderFor(N,$))return k;if(!Ot(z)){if(z.isProviderFor(N,$))return k;if(!Ot(le))for(var ae=ea(le);;){var Ae=Fi(ae);if(!Ae)return;var Ze=be(Ae);if(Ze.isProviderFor(N,$))return aa(ae),Ze}}}if(!Ot(fe)&&fe.isProviderFor(N,$))return fe}function Bt(N,$){var ae=Se.get(N),Ae;return Ot(ae)||(Ae=ae.get($)),Ot(Ae)&&(Ae=Dt(N,$),Ot(Ae)||(Ot(ae)&&(ae=new St,Se.set(N,ae)),ae.set($,Ae))),Ae}function yt(N){if(Ot(N))throw new TypeError;return k===N||z===N||!Ot(le)&&le.has(N)}function U(N,$,ae){if(!yt(ae))throw new Error("Metadata provider not registered.");var Ae=Bt(N,$);if(Ae!==ae){if(!Ot(Ae))return!1;var Ze=Se.get(N);Ot(Ze)&&(Ze=new St,Se.set(N,Ze)),Ze.set($,ae)}return!0}}function po(){var fe;return!Ot(Ct)&&Or(ce.Reflect)&&Object.isExtensible(ce.Reflect)&&(fe=ce.Reflect[Ct]),Ot(fe)&&(fe=oo()),!Ot(Ct)&&Or(ce.Reflect)&&Object.isExtensible(ce.Reflect)&&Object.defineProperty(ce.Reflect,Ct,{enumerable:!1,configurable:!1,writable:!1,value:fe}),fe}function Mo(fe){var k=new Pt,z={isProviderFor:function(yt,U){var N=k.get(yt);return Ot(N)?!1:N.has(U)},OrdinaryDefineOwnMetadata:$t,OrdinaryHasOwnMetadata:Se,OrdinaryGetOwnMetadata:De,OrdinaryOwnMetadataKeys:Dt,OrdinaryDeleteMetadata:Bt};return pt.registerProvider(z),z;function le(yt,U,N){var $=k.get(yt),ae=!1;if(Ot($)){if(!N)return;$=new St,k.set(yt,$),ae=!0}var Ae=$.get(U);if(Ot(Ae)){if(!N)return;if(Ae=new St,$.set(U,Ae),!fe.setProvider(yt,U,z))throw $.delete(U),ae&&k.delete(yt),new Error("Wrong provider for target.")}return Ae}function Se(yt,U,N){var $=le(U,N,!1);return Ot($)?!1:nn($.has(yt))}function De(yt,U,N){var $=le(U,N,!1);if(!Ot($))return $.get(yt)}function $t(yt,U,N,$){var ae=le(N,$,!0);ae.set(yt,U)}function Dt(yt,U){var N=[],$=le(yt,U,!1);if(Ot($))return N;for(var ae=$.keys(),Ae=ea(ae),Ze=0;;){var at=Fi(Ae);if(!at)return N.length=Ze,N;var j=be(at);try{N[Ze]=j}catch(J){try{aa(Ae)}finally{throw J}}Ze++}}function Bt(yt,U,N){var $=le(U,N,!1);if(Ot($)||!$.delete(yt))return!1;if($.size===0){var ae=k.get(U);Ot(ae)||(ae.delete(N),ae.size===0&&k.delete(ae))}return!0}}function Gt(fe){var k=fe.defineMetadata,z=fe.hasOwnMetadata,le=fe.getOwnMetadata,Se=fe.getOwnMetadataKeys,De=fe.deleteMetadata,$t=new Pt,Dt={isProviderFor:function(Bt,yt){var U=$t.get(Bt);return Ot(U)?Se(Bt,yt).length?(Ot(U)&&(U=new Nt,$t.set(Bt,U)),U.add(yt),!0):!1:U.has(yt)},OrdinaryDefineOwnMetadata:k,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:le,OrdinaryOwnMetadataKeys:Se,OrdinaryDeleteMetadata:De};return Dt}function _r(fe,k,z){var le=pt.getProvider(fe,k);if(!Ot(le))return le;if(z){if(pt.setProvider(fe,k,mt))return mt;throw new Error("Illegal state.")}}function Gr(){var fe={},k=[],z=function(){function Dt(Bt,yt,U){this._index=0,this._keys=Bt,this._values=yt,this._selector=U}return Dt.prototype["@@iterator"]=function(){return this},Dt.prototype[Be]=function(){return this},Dt.prototype.next=function(){var Bt=this._index;if(Bt>=0&&Bt<this._keys.length){var yt=this._selector(this._keys[Bt],this._values[Bt]);return Bt+1>=this._keys.length?(this._index=-1,this._keys=k,this._values=k):this._index++,{value:yt,done:!1}}return{value:void 0,done:!0}},Dt.prototype.throw=function(Bt){throw this._index>=0&&(this._index=-1,this._keys=k,this._values=k),Bt},Dt.prototype.return=function(Bt){return this._index>=0&&(this._index=-1,this._keys=k,this._values=k),{value:Bt,done:!0}},Dt}(),le=function(){function Dt(){this._keys=[],this._values=[],this._cacheKey=fe,this._cacheIndex=-2}return Object.defineProperty(Dt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Dt.prototype.has=function(Bt){return this._find(Bt,!1)>=0},Dt.prototype.get=function(Bt){var yt=this._find(Bt,!1);return yt>=0?this._values[yt]:void 0},Dt.prototype.set=function(Bt,yt){var U=this._find(Bt,!0);return this._values[U]=yt,this},Dt.prototype.delete=function(Bt){var yt=this._find(Bt,!1);if(yt>=0){for(var U=this._keys.length,N=yt+1;N<U;N++)this._keys[N-1]=this._keys[N],this._values[N-1]=this._values[N];return this._keys.length--,this._values.length--,xi(Bt,this._cacheKey)&&(this._cacheKey=fe,this._cacheIndex=-2),!0}return!1},Dt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=fe,this._cacheIndex=-2},Dt.prototype.keys=function(){return new z(this._keys,this._values,Se)},Dt.prototype.values=function(){return new z(this._keys,this._values,De)},Dt.prototype.entries=function(){return new z(this._keys,this._values,$t)},Dt.prototype["@@iterator"]=function(){return this.entries()},Dt.prototype[Be]=function(){return this.entries()},Dt.prototype._find=function(Bt,yt){if(!xi(this._cacheKey,Bt)){this._cacheIndex=-1;for(var U=0;U<this._keys.length;U++)if(xi(this._keys[U],Bt)){this._cacheIndex=U;break}}return this._cacheIndex<0&&yt&&(this._cacheIndex=this._keys.length,this._keys.push(Bt),this._values.push(void 0)),this._cacheIndex},Dt}();return le;function Se(Dt,Bt){return Dt}function De(Dt,Bt){return Bt}function $t(Dt,Bt){return[Dt,Bt]}}function rn(){var fe=function(){function k(){this._map=new St}return Object.defineProperty(k.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),k.prototype.has=function(z){return this._map.has(z)},k.prototype.add=function(z){return this._map.set(z,z),this},k.prototype.delete=function(z){return this._map.delete(z)},k.prototype.clear=function(){this._map.clear()},k.prototype.keys=function(){return this._map.keys()},k.prototype.values=function(){return this._map.keys()},k.prototype.entries=function(){return this._map.entries()},k.prototype["@@iterator"]=function(){return this.keys()},k.prototype[Be]=function(){return this.keys()},k}();return fe}function yn(){var fe=16,k=Ke.create(),z=le();return function(){function Bt(){this._key=le()}return Bt.prototype.has=function(yt){var U=Se(yt,!1);return U!==void 0?Ke.has(U,this._key):!1},Bt.prototype.get=function(yt){var U=Se(yt,!1);return U!==void 0?Ke.get(U,this._key):void 0},Bt.prototype.set=function(yt,U){var N=Se(yt,!0);return N[this._key]=U,this},Bt.prototype.delete=function(yt){var U=Se(yt,!1);return U!==void 0?delete U[this._key]:!1},Bt.prototype.clear=function(){this._key=le()},Bt}();function le(){var Bt;do Bt="@@WeakMap@@"+Dt();while(Ke.has(k,Bt));return k[Bt]=!0,Bt}function Se(Bt,yt){if(!L.call(Bt,z)){if(!yt)return;Object.defineProperty(Bt,z,{value:Ke.create()})}return Bt[z]}function De(Bt,yt){for(var U=0;U<yt;++U)Bt[U]=Math.random()*255|0;return Bt}function $t(Bt){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Bt)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Bt)):De(new Uint8Array(Bt),Bt):De(new Array(Bt),Bt)}function Dt(){var Bt=$t(fe);Bt[6]=Bt[6]&79|64,Bt[8]=Bt[8]&191|128;for(var yt="",U=0;U<fe;++U){var N=Bt[U];(U===4||U===6||U===8)&&(yt+="-"),N<16&&(yt+="0"),yt+=N.toString(16).toLowerCase()}return yt}}function Ti(fe){return fe.__=void 0,delete fe.__,fe}})})(ne||(ne={}))}}]);
}());